<html><!-- Online page at https://rx-angular.io/web/state/tutorials/basic-tutorial --><head><meta charset="utf-8"><title>Basic tutorial</title><link rel="stylesheet" href="../../../../angular.io/css_36.css" type="text/css"><link rel="stylesheet" href="../../../../angular.io/css_37.css" type="text/css"><link rel="stylesheet" href="../../../../angular.io/css_38.css" type="text/css"><link rel="stylesheet" href="../../../../angular.io/css_39.css" type="text/css"><link rel="stylesheet" href="../../../../angular.io/css_40.css" type="text/css"><link rel="stylesheet" href="../../../../angular.io/css_41.css" type="text/css"><script type="text/javascript" src="../../../../angular.io/js_1.js"></script><script type="text/javascript" src="../../../../angular.io/js_21.js"></script><script type="text/javascript" src="../../../../angular.io/js_22.js"></script><script type="text/javascript" src="../../../../angular.io/js_23.js"></script><script type="text/javascript" src="../../../../angular.io/js_24.js"></script><script type="text/javascript" src="../../../../angular.io/js_25.js"></script><script type="text/javascript" src="../../../../angular.io/js_26.js"></script><script type="text/javascript" src="../../../../angular.io/js_27.js"></script><script type="text/javascript" src="../../../../angular.io/js_28.js"></script></head><body data-page="/web/state/tutorials/basic-tutorial.md" class="ready">
    <section class="cover" style="background: linear-gradient(to left bottom, hsl(151, 100%, 85%) 0%,hsl(26, 100%, 85%) 100%)"><div class="mask"></div><div class="cover-main"><!--cover--></div></section><main><button class="sidebar-toggle" aria-label="Menu"><div class="sidebar-toggle-button"><span></span><span></span><span></span></div></button><aside class="sidebar"><div class="search"><div class="input-wrap">
      <input type="search" value="" aria-label="Search text" placeholder="Type to search">
      <div class="clear-button">
        <svg width="26" height="24">
          <circle cx="12" cy="12" r="11" fill="#ccc"></circle>
          <path stroke="white" stroke-width="2" d="M8.25,8.25,15.75,15.75"></path>
          <path stroke="white" stroke-width="2" d="M8.25,15.75,15.75,8.25"></path>
        </svg>
      </div>
    </div>
    <div class="results-panel"></div>
    </div><h1 class="app-name"><a class="app-name-link" data-nosearch="" href="./basic-tutorial.html">@rx-angular</a></h1><div class="sidebar-nav"><!-- - @rx-angular/template [BETA]

  - Getting started

    - [Overview](/template/overview.md)
    - [Setup](/template/basic-setup.md)

  - Theory

    - [Rendering issues in Angular](/template/theory/rendering-issues.md)
    - [Concepts](/template/theory/concepts.md)

  - Features

    - [LetDirective](/template/features/let.md)
    - [PushPipe](/template/features/push.md)
    - [RenderStrategies](/template/features/render-strategies.md)

  - Experimental

    - [Unpatch directive](/template/experimental/unpatch.md) -->

<ul><li><p><strong>@rx-angular/state</strong></p><ul><li><p>Getting started</p><ul><li><a href="../general/overview.html" title="Overview">Overview</a></li><li><a href="../general/basic-setup.html" title="Setup">Setup</a></li></ul></li><li><p>API</p><ul><li><a href="../api/rx-state.html" title="RxState">RxState</a></li><li><a href="../api/rxjs-operators.html" title="RxJS Operators">RxJS Operators</a></li><li><a href="../api/transformation-helpers.html" title="Transformation helpers">Transformation helpers</a></li><li><a href="../api/interfaces.html" title="Interfaces">Interfaces</a></li></ul></li><li><p>Tutorials</p><ul><li class="active"><a href="./basic-tutorial.html" title="Basic tutorial">Basic tutorial</a><ul class="app-sub-sidebar"><li><a class="section-link" href="./basic-tutorial.html" title="Implement RxState service">Implement RxState service</a></li><li><a class="section-link" href="./basic-tutorial.html" title="Initialize the state">Initialize the state</a></li><li><a class="section-link" href="./basic-tutorial.html" title="Handling Input Bindings">Handling Input Bindings</a></li><ul class="app-sub-sidebar"><li><a class="section-link" href="./basic-tutorial.html" title="Set up @Input bindings">Set up <code>@Input</code> bindings</a></li><li><a class="section-link" href="./basic-tutorial.html" title="Bind the state to the view">Bind the state to the view</a></li></ul><li><a class="section-link" href="./basic-tutorial.html" title="Handling Output Bindings">Handling Output Bindings</a></li><ul class="app-sub-sidebar"><li><a class="section-link" href="./basic-tutorial.html" title="React to state changes from child components">React to state changes from child components</a></li><li><a class="section-link" href="./basic-tutorial.html" title="Set up output bindings">Set up output bindings</a></li></ul><li><a class="section-link" href="./basic-tutorial.html" title="Global State">Global State</a></li><ul class="app-sub-sidebar"><li><a class="section-link" href="./basic-tutorial.html" title="Connect the global state to the list slice">Connect the global state to the <code>list</code> slice</a></li></ul><li><a class="section-link" href="./basic-tutorial.html" title="Handling Side Effects Reactively">Handling Side Effects Reactively</a></li><ul class="app-sub-sidebar"><li><a class="section-link" href="./basic-tutorial.html" title="Examples">Examples</a></li><li><a class="section-link" href="./basic-tutorial.html" title="Application">Application</a></li></ul><li><a class="section-link" href="./basic-tutorial.html" title="Refactor to a reactive UI">Refactor to a reactive UI</a></li><ul class="app-sub-sidebar"><li><a class="section-link" href="./basic-tutorial.html" title="hold the side effect"><code>hold</code> the side effect</a></li><li><a class="section-link" href="./basic-tutorial.html" title="Refactor the background-process side effect">Refactor the background-process side effect</a></li></ul></ul></li><li><a href="./incrementing-value.html" title="Incrementing a value">Incrementing a value</a></li><li><a href="./from-imperative-to-reactive.html" title="Migrating to RxState">Migrating to RxState</a></li><li><a href="./passing-observables.html" title="Passing observables directly">Passing observables directly</a></li></ul></li><li><p>Recipes</p><ul><li><a href="../howtos/determine-state.html" title="Determine state type">Determine state type</a></li><li><a href="../howtos/manage-viewmodel.html" title="Manage ViewModel">Manage ViewModel</a></li><li><a href="../howtos/partial-updates.html" title="Run partial updates">Run partial updates</a></li><li><a href="../howtos/load-data-on-route-change.html" title="Load data on route change">Load data on route change</a></li><li><a href="../howtos/hostbindings.html" title="Work with HostBindings">Work with HostBindings</a></li><li><a href="../howtos/rx-state-as-global-state.html" title="Use RxState as Global State">Use RxState as Global State</a></li></ul></li><li><p>Integrations</p><ul><li><a href="../integrations/compose-state-using-ngrx-selectors.html" title="Reuse ngrx selectors to compose state">Reuse ngrx selectors to compose state</a></li><li><a href="../integrations/manage-entities-ngrx.html" title="Manage entities using @ngrx/entity">Manage entities using <code>@ngrx/entity</code></a></li></ul></li></ul></li></ul><hr>
<ul><li><p><strong>Links</strong></p></li><li><p><a href="https://github.com/rx-angular/rx-angular" target="_blank" rel="noopener" title=" Github"><img src="../../../../icongr.am/simple/github.svg" data-origin="https://icongr.am/simple/github.svg?color=808080&amp;size=24" alt="Github"> Github</a></p></li><li><p><a href="https://discord.com/invite/XWWGZsQ" target="_blank" rel="noopener" title=" Discord"><img src="../../../../icongr.am/material/discord.svg" data-origin="https://icongr.am/material/discord.svg?size=24&amp;color=7289da" alt="Discord"> Discord</a></p></li></ul></div></aside><section class="content"><article class="markdown-section" id="main"><h1 id="setting-up-a-reactive-state"><a href="./basic-tutorial.html" data-id="setting-up-a-reactive-state" class="anchor"><span>Setting up a Reactive State</span></a></h1><p>In this section, we will be working with an <a href="https://github.com/rx-angular/rx-angular/blob/master/apps/demos/src/app/features/tutorials/basics/1-setup/setup.start.component.ts" target="_blank" rel="noopener">imperative code base</a> to refactor
its state management to a <a href="https://github.com/rx-angular/rx-angular/blob/master/apps/demos/src/app/features/tutorials/basics/1-setup/setup.solution.component.ts" target="_blank" rel="noopener">reactive setup</a>.</p><p>We will set up <code>RxState</code> in the component, initialize the component's local state, and render it in the template.</p><p>In addition, we've introduced automated subscription handling, the possibility for imperative interaction
over component's input bindings, and a clean separation of concerns.</p><hr>
<h2 id="implement-rxstate-service"><a href="./basic-tutorial.html" data-id="implement-rxstate-service" class="anchor"><span>Implement RxState service</span></a></h2><p>The first step is to introduce a reactive state to our component by using the <code>RxState</code> class.
This can be done either through inheritance, which means we extend the state service; or through composition, in which case we inject the service into the constructor and add the service to the component's <code>providers</code> section.</p><p>In this case, we will simply extend the service.
One distinct feature of this method, which is both its benefit and disadvantage, is that we can directly access the service's API using <code>this</code> (e.g., <code>this.select('prop')</code>.)</p><p>To this end, we have to extend our class and use the already existing <code>ComponentState</code> interface (see
<a href="https://github.com/rx-angular/rx-angular/blob/master/apps/demos/src/app/features/tutorials/basics/1-setup/setup.start.component.ts" target="_blank" rel="noopener">setup.start.component.ts</a> <a href="https://github.com/rx-angular/rx-angular/blob/master/apps/demos/src/app/features/tutorials/basics/1-setup/setup.start.component.ts" target="_blank" rel="noopener">setup.start.component.ts</a>.)</p><pre v-pre="" data-lang="typescript"><code class="lang-typescript">
<span class="token comment">// 1- import RxState</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> RxState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@rx-angular/state'</span><span class="token punctuation">;</span>

<span class="token operator">...</span>

<span class="token comment">// 2- define a component state</span>
<span class="token keyword">interface</span> <span class="token class-name">ComponentState</span> <span class="token punctuation">{</span>
  refreshInterval<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  list<span class="token operator">:</span> DemoBasicsItem<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  listExpanded<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 3- extend the component, or alternatively, register a local provider and inject it</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">SetupStart</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span><span class="token punctuation">,</span> OnDestroy <span class="token keyword">extends</span> <span class="token class-name">RxState<span class="token operator">&lt;</span>ComponentState<span class="token operator">&gt;</span></span> <span class="token operator">...</span> <span class="token punctuation">{</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>Since we decided to create a reactive state by extending an existing component, we will need to extend its class definition and call <code>super()</code> in the constructor.</p><pre v-pre="" data-lang="typescript"><code class="lang-typescript"><span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>For the sake of example, we added the state to the same file, but for a more robust architecture, consider having it in a separate file with the <code>.state.ts</code> extension.</p><h3 id="select-and-display-state"><a href="./basic-tutorial.html" data-id="select-and-display-state" class="anchor"><span>Select and display state</span></a></h3><p>The next step is to set up <code>model$</code>, a component property that holds all data we wish to display in the template.</p><p>By assigning the <code>model$</code> to the <code>$</code> property of the <code>RxState</code> class, we get the full state object as <code>Observable&lt;ComponentState&gt;</code>.</p><pre v-pre="" data-lang="typescript"><code class="lang-typescript">
@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  selector<span class="token operator">:</span> <span class="token string">'rxa-setup-solution'</span><span class="token punctuation">,</span>
  template<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    model$: &lt;pre&gt;{{model$ | async | json}}&lt;/pre&gt;
    ...
  </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">SetupReactiveComponentStateContainerComponent</span> <span class="token keyword">extends</span> <span class="token class-name">RxState<span class="token operator">&lt;</span>ComponentState<span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
  model$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><h2 id="initialize-the-state"><a href="./basic-tutorial.html" data-id="initialize-the-state" class="anchor"><span>Initialize the state</span></a></h2><p>As <code>RxState</code> is empty and thus lazy at initialization, we can decide if we want to assign initial values to the state and which values these will be.
We can initialize the state imperatively by calling <code>set()</code> or by using an observable and the <code>connect()</code> method.</p><p>We will use <code>set()</code> as we already have initial values assigned to the <code>initComponentState</code> object's properties.</p><pre v-pre="" data-lang="typescript"><code class="lang-typescript"> <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>initComponentState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>After we have completed all these steps, we should see the initial state in the template.</p><h1 id="handling-input-bindings"><a href="./basic-tutorial.html" data-id="handling-input-bindings" class="anchor"><span>Handling Input Bindings</span></a></h1><p>In this section, we will remove <code>this._refreshInterval</code> that defines how frequently our product list should be refreshed and save its data inside the component's state (see <a href="https://github.com/rx-angular/rx-angular/blob/master/apps/demos/src/app/features/tutorials/basics/2-input-bindings/input-bindings.start.component.ts" target="_blank" rel="noopener">input-bindings.start.component.ts</a> <a href="https://github.com/rx-angular/rx-angular/blob/master/apps/demos/src/app/features/tutorials/basics/2-input-bindings/input-bindings.start.component.ts" target="_blank" rel="noopener">input-bindings.start.component.ts</a>.)</p><hr>
<h2 id="set-up-input-bindings"><a href="./basic-tutorial.html" data-id="set-up-input-bindings" class="anchor"><span>Set up <code>@Input</code> bindings</span></a></h2><p>Since parts of our state are passed as input bindings, we need to insert these changes into the component's state. It requires setting values imperatively.
The problem with this approach is that it's not composable.
That's why in this case we will have to hook into the imperative callback of the <code>refreshInterval</code> component's input binding.</p><p>Thus, we have to perform a partial update to our state by providing an object containing the new state slice <code>{refreshInterval: number}</code>.
This can be done by using either a reduce function <code>(oldState) =&gt; ({refreshInterval: oldState.refreshInterval + 2})</code> or the state slice itself <code>{refreshInterval: 2}</code>.
As no previous state is needed to calculate the new value, we will opt for the latter and provide the slice itself to partially update our state.</p><p>Please note that <code>{refreshInterval}</code> is a short form of <code>{refreshInterval: refreshInterval}</code>.</p><pre v-pre="" data-lang="diff"><code class="lang-diff">@Input()
set refreshInterval(refreshInterval: number) {
    if (refreshInterval &gt; 100) {
+       this.set({refreshInterval});
-       this._refreshInterval = refreshInterval;
        this.resetRefreshInterval();
    }
}</code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>After removing the <code>_refreshInterval</code>, we also have to adopt the related method <code>resetRefreshTick</code> where <code>_refreshInterval</code> is used.
As <code>refreshInterval</code> is already part of the component's state,
we can easily access the value with <code>this.get('refreshInterval')</code>, using the <code>interval</code> operator to create a new interval.</p><pre v-pre="" data-lang="diff"><code class="lang-diff">resetRefreshTick() {
    this.intervalSubscription.unsubscribe();
+    this.intervalSubscription = interval(this.get('refreshInterval'))
-    this.intervalSubscription = interval(this._refreshInterval)
       .pipe(tap((_) =&gt; this.listService.refetchList()))
       .subscribe();
}</code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>If we edit the input field, we should see the changes in the component's logged state in the template.</p><h2 id="bind-the-state-to-the-view"><a href="./basic-tutorial.html" data-id="bind-the-state-to-the-view" class="anchor"><span>Bind the state to the view</span></a></h2><p>In this example, we will use a very simple method and directly bind the complete state of our component to the view.
Further performance improvements can be introduced later on.</p><p>To bind the state, we can use a simple trick with the structural directive <code>*ngIf</code>, the <code>as</code> syntax, and the <code>async</code> pipe.</p><pre v-pre="" data-lang="html"><code class="lang-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ng-container</span> <span class="token attr-name">*ngIf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>model$ | async as vm<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ng-container</span><span class="token punctuation">&gt;</span></span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>Please note that <code>vm</code> is an abbreviation for view model.</p><p>The implementation in our expansion panel will look as follows:</p><pre v-pre="" data-lang="html"><code class="lang-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mat-expansion-panel</span> <span class="token attr-name">*ngIf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>model$ | async as vm<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mat-expansion-panel</span><span class="token punctuation">&gt;</span></span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>Now we can replace the <code>_refreshInterval</code> component in the template with <code>vm.refreshInterval</code>.</p><pre v-pre="" data-lang="html"><code class="lang-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>
  (storeList$ | async)?.length }} Repositories Updated every: {{
  vm.refreshInterval }} ms
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><h1 id="handling-output-bindings"><a href="./basic-tutorial.html" data-id="handling-output-bindings" class="anchor"><span>Handling Output Bindings</span></a></h1><p>This section contains an <a href="https://github.com/rx-angular/rx-angular/blob/master/apps/demos/src/app/features/tutorials/basics/3-output-bindings/output-bindings.start.component.ts" target="_blank" rel="noopener">imperative code base</a> for you to refer to and a quick tutorial on how to set up and use output bindings reactively.</p><hr>
<h2 id="react-to-state-changes-from-child-components"><a href="./basic-tutorial.html" data-id="react-to-state-changes-from-child-components" class="anchor"><span>React to state changes from child components</span></a></h2><p>In this example, we will be using an expansion panel to display a list.
For the purpose of this tutorial, we identify the panel's open and close states as part of the component's state.<br>We will also have to forward the changes to the component's <code>listExpandedChange</code> output binding.</p><p>As it is essential to connect Observables to the state, there is a service method that deals with this specific issue.</p><p>This method is called <code>connect</code>, and it can assign values from an Observable to the component's state in 3 different ways.</p><p>One way of using it is passing an Observable of type <code>Partial&lt;ComponentState&gt;</code> to the <code>connect</code> method directly.</p><p>When choosing this way of connecting an Observable to the component's state, we will also need a subject called <code>listExpandedChanges</code> whose job is to ensure stable user interaction with the open/closed state.
This way, whenever we click on the expansion panel, the subject generates a new state using the <code>next</code> method.</p><p>We can generally use <code>connect</code> with multiple different overloads. In our case, however, the best use case scenario would look like this:</p><pre v-pre="" data-lang="typescript"><code class="lang-typescript"><span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'listExpanded'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>listExpandedChanges<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>Optionally, we can also provide it as <code>Partial</code>.
Thus, we will need to transform the <code>boolean</code> value to fit <code>Partial&lt;ComponentState&gt;</code>.
We can use the <code>map</code> operator here to achieve this transformation and pass the projection function <code>listExpanded =&gt; ({ listExpanded})</code>.</p><pre v-pre="" data-lang="typescript"><code class="lang-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> map <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rxjs</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>
<span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>listExpandedChanges<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">map</span><span class="token punctuation">(</span>listExpanded <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> listExpanded<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>This overload is especially useful when updating multiple properties at the same time.</p><p>Now let's refactor the state binding to the expand-panel.</p><pre v-pre="" data-lang="html"><code class="lang-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mat-expansion-panel</span>
  <span class="token attr-name">*ngIf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>model$ | async as vm<span class="token punctuation">"</span></span>
  <span class="token attr-name">(expandedChange)</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>listExpandedChanges.next($event)<span class="token punctuation">"</span></span>
  <span class="token attr-name">[expanded]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vm.listExpanded<span class="token punctuation">"</span></span>
<span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mat-expansion-panel</span><span class="token punctuation">&gt;</span></span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>If we open and close the expansion panel, we should see the change reflected in the state.</p><h2 id="set-up-output-bindings"><a href="./basic-tutorial.html" data-id="set-up-output-bindings" class="anchor"><span>Set up output bindings</span></a></h2><p>Next, we will replace the logic for the output binding of the component.</p><p>Since the open/closed state is already reflected in the component's state, we can derive changes directly from it.</p><p>As we are only interested in changing the slice <code>listExpanded</code>, we can use the <code>distinctUntilKeyChanged</code> operator
to get those changes.</p><p>Let's refactor it into the following and delete the <code>listExpanded</code> property in the class and template.</p><pre v-pre="" data-lang="typescript"><code class="lang-typescript">  <span class="token keyword">import</span> <span class="token punctuation">{</span> map<span class="token punctuation">,</span> distinctUntilKeyChanged <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rxjs</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
  @<span class="token function">Output</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  listExpandedChange <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">distinctUntilKeyChanged</span><span class="token punctuation">(</span><span class="token string">'listExpanded'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">map</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span>listExpanded<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>We are using <code>$</code> here to 'signal' that the state has been changed. Signals, in comparison to stateful streams, don't replay the last value on subscription.
This is especially useful as a way to avoid loops.</p><h1 id="global-state"><a href="./basic-tutorial.html" data-id="global-state" class="anchor"><span>Global State</span></a></h1><p>In this chapter, we will create the global state and attach it to our component (see <a href="https://github.com/rx-angular/rx-angular/blob/master/apps/demos/src/app/features/tutorials/basics/4-global-state/global-state.start.component.ts" target="_blank" rel="noopener">global-state.start.component.ts</a> <a href="https://github.com/rx-angular/rx-angular/blob/master/apps/demos/src/app/features/tutorials/basics/4-global-state/global-state.start.component.ts" target="_blank" rel="noopener">global-state.start.component.ts</a>) to enable reactive state management there.</p><hr>
<h2 id="connect-the-global-state-to-the-list-slice"><a href="./basic-tutorial.html" data-id="connect-the-global-state-to-the-list-slice" class="anchor"><span>Connect the global state to the <code>list</code> slice</span></a></h2><p>In components, we often need to transform global state into local state. Most often, you also need to map the global object into a new shape that would match the view. This state is provided as an <code>Observable</code> here.
In the current implementation, we use a method called <code>parseListItems</code> to achieve that.</p><p>We already used the <code>connect</code> method to [connect our child component's state] <a href="https://github.com/rx-angular/rx-angular/tree/master/apps/demos/src/app/features/tutorials/basics/3-output-bindings" target="_blank" rel="noopener">3-output-bindings</a>.
Now let's use another overload to connect the global state to the component.</p><p>With this overload, the first value is assigned to the property to determine the
target slice that we want to connect the global state to. In our case, this is the <code>list</code> slice.</p><pre v-pre="" data-lang="typescript"><code class="lang-typescript"><span class="token comment">// ...</span>
<span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> listService<span class="token operator">:</span> ListService<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>
    <span class="token string">'list'</span><span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>listService<span class="token punctuation">.</span>list$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>parseListItems<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>Now that the slice is connected, we can delete the <code>storeList$</code> property in our class and refactor the template into the following:</p><pre v-pre="" data-lang="html"><code class="lang-html">...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mat-panel-description</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span>
    <span class="token punctuation">&gt;</span></span>{{ vm.list.length }} Repositories Updated every: {{ vm.refreshInterval }}
    ms
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mat-panel-description</span><span class="token punctuation">&gt;</span></span>
...

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">*ngIf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vm.list?.length; else noList<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mat-list</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mat-list-item</span> <span class="token attr-name">*ngFor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>let item of list<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> {{ item.name }} <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mat-list-item</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mat-list</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>With this step, we're refactoring our state management from an imperative to a reactive implementation.</p><p>The benefits we can gain here are that we have our state centralized and reactive but, at the same time, can also include
imperative parts of our components, like input bindings, into the state.</p><h1 id="handling-side-effects-reactively"><a href="./basic-tutorial.html" data-id="handling-side-effects-reactively" class="anchor"><span>Handling Side Effects Reactively</span></a></h1><p>This section introduces and explores the concept of side effects and their reactive handling.</p><p>Before we get any further, let's define two terms, <em>side effect</em> and <em>pure function</em>.</p><p><strong>Pure function:</strong>
A function is called pure if:</p><ul><li>Its return value is the same for the same arguments, e.g. <code>function add(a, b) { return a + b}</code></li><li>Its executed internal logic has no side effects</li></ul><p><strong>Side Effect:</strong>
A function has a <em>side effect</em> if:</p><ul><li>There's a mutation of local static variables, e.g. <code>this.prop = value</code></li><li>Non-local variables are used</li></ul><hr>
<h2 id="examples"><a href="./basic-tutorial.html" data-id="examples" class="anchor"><span>Examples</span></a></h2><p>Let's look at a couple of examples that will make the above definitions easier to understand.</p><pre v-pre="" data-lang="typescript"><code class="lang-typescript"><span class="token keyword">let</span> state <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token function">sideEffectFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">sideEffectFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><ul><li>mutable reference arguments get passed</li></ul><pre v-pre="" data-lang="typescript"><code class="lang-typescript"><span class="token keyword">let</span> state <span class="token operator">=</span> <span class="token punctuation">{</span> isVisible<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> newState <span class="token operator">=</span> <span class="token function">sideEffectFn</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">sideEffectFn</span><span class="token punctuation">(</span>oldState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  oldState<span class="token punctuation">.</span>isVisible <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> oldState<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><ul><li>I/O is changed</li></ul><pre v-pre="" data-lang="typescript"><code class="lang-typescript"><span class="token keyword">let</span> state <span class="token operator">=</span> <span class="token punctuation">{</span> isVisible<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">sideEffectFn</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">sideEffectFn</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// or</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>As a good rule of thumb, you can consider every function without a return value to be a side effect.</p><p>Yet, essentially, a side effect always has 2 important parts associated with it:</p><ul><li>the trigger</li><li>the side-effect logic</li></ul><p>In the above examples, the trigger was the method call itself. That is one way of doing it, but not the only one. We can also set a value emitted from an <code>Observable</code> as a trigger.
Thus, you may use a render call or any other logic executed by the trigger as the side-effect logic.  </p><h2 id="application"><a href="./basic-tutorial.html" data-id="application" class="anchor"><span>Application</span></a></h2><p>With this in mind, let's take a look at the component logic and see if we can identify a side effect:</p><p>First, we initialize a background process in the <code>ngOnInit</code> over <code>resetRefreshTick</code> (see <a href="https://github.com/rx-angular/rx-angular/tree/master/apps/demos/src/app/features/tutorials/basics/5-side-effects" target="_blank" rel="noopener">side-effects.start.component.ts</a> <a href="https://github.com/rx-angular/rx-angular/tree/master/apps/demos/src/app/features/tutorials/basics/5-side-effects" target="_blank" rel="noopener">side-effects.start.component.ts</a>.)</p><pre v-pre="" data-lang="typescript"><code class="lang-typescript">  <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resetRefreshTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>The interval also gets reset whenever the input binding for <code>refreshInterval</code> changes.</p><pre v-pre="" data-lang="typescript"><code class="lang-typescript">   @<span class="token function">Input</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">set</span> <span class="token function">refreshInterval</span><span class="token punctuation">(</span>refreshInterval<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>refreshInterval <span class="token operator">&gt;</span> <span class="token number">4000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span> refreshInterval <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resetRefreshTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>Another side effect is contained in the <code>onRefreshClicks</code> callback. Here, we dispatch an action to the global store.</p><pre v-pre="" data-lang="typescript"><code class="lang-typescript">  <span class="token function">onRefreshClicks</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>listService<span class="token punctuation">.</span><span class="token function">refetchList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>Let's refactor those parts and handle them in a clean and reactive way.</p><h1 id="refactor-to-a-reactive-ui"><a href="./basic-tutorial.html" data-id="refactor-to-a-reactive-ui" class="anchor"><span>Refactor to a reactive UI</span></a></h1><p>As RxJS provides us with a very powerful way of composing emitted events, we will refactor our UI interaction with the streams.</p><p>UI interaction, in general, can come from buttons, inputs, forms, scroll or resize events, etc.</p><p>In our case, we have the refresh button as UI interaction. To get this interaction as an <code>Observable</code>, we create a <code>Subject</code> in the component class and fire its <code>next</code> method on every button click.</p><pre v-pre="" data-lang="html"><code class="lang-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">mat-raised-button</span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span> <span class="token attr-name">(click)</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>refreshClicks.next($event)<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  Refresh List
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><pre v-pre="" data-lang="typescript"><code class="lang-typescript"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">SideEffectsStart</span>
  <span class="token keyword">extends</span> <span class="token class-name">RxState<span class="token operator">&lt;</span>ComponentState<span class="token operator">&gt;</span></span>
  <span class="token keyword">implements</span> <span class="token class-name">OnInit</span><span class="token punctuation">,</span> OnDestroy <span class="token punctuation">{</span>
  refreshClicks$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subject<span class="token operator">&lt;</span>Event<span class="token operator">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//...</span>
<span class="token punctuation">}</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>This is the trigger for our side effect.</p><h2 id="hold-the-side-effect"><a href="./basic-tutorial.html" data-id="hold-the-side-effect" class="anchor"><span><code>hold</code> the side effect</span></a></h2><p>From the <code>resetRefreshTick</code> method, we now move the logic that starts the tick and place it in the <code>hold</code> method as a callback parameter.</p><p>The <code>hold</code> method's job, as the name implies, is to <em>hold</em> something. Namely, it holds a subscription to a side effect and takes care of its initialization.
Furthermore, it automatically handles the subscription management and unsubscribes if the component gets destroyed.</p><pre v-pre="" data-lang="typescript"><code class="lang-typescript"><span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hold</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>refreshClicks$<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>listService<span class="token punctuation">.</span><span class="token function">refetchList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>With this implementation, we should be able to dispatch an action on every button click.</p><p>Optionally, we could also put the side effect into a tap operator. To that end, we create a new property in our class called <code>refreshListSideEffect$</code> and assign the newly created click <code>Observable</code> to it:</p><pre v-pre="" data-lang="typescript"><code class="lang-typescript">refreshListSideEffect$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>refreshClicks$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
  <span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>listService<span class="token punctuation">.</span><span class="token function">refetchList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>and then hold it directly:</p><pre v-pre="" data-lang="typescript"><code class="lang-typescript"><span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hold</span><span class="token punctuation">(</span>refreshListSideEffect$<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><h2 id="refactor-the-background-process-side-effect"><a href="./basic-tutorial.html" data-id="refactor-the-background-process-side-effect" class="anchor"><span>Refactor the background-process side effect</span></a></h2><p>Another side effect in this component is the background process that dispatches the refresh action in an interval defined over the <code>refreshInterval</code> input binding.</p><p>If we take a look at the current implementation of <code>resetRefreshTick</code>, we will see 2 pieces:</p><ul><li>One piece is responsible for deriving an interval from the current <code>refreshInterval</code> value in milliseconds.</li><li>The other piece fires the actual side effect.</li></ul><p>Let's first refactor the trigger <code>this.select('refreshInterval').pipe(switchMap(ms =&gt; timer(0, ms)))</code> to a separate class property.</p><pre v-pre="" data-lang="typescript"><code class="lang-typescript">intervalRefreshTick$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>
  <span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span>refreshInterval<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">switchMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">timer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> ms<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>If we think about it, both the button click and interval are triggers for the same side effect.
Besides, their emitted value is irrelevant for the side effect and only serves as a trigger for its execution.</p><p>This means we can simply merge their outputs together.</p><pre v-pre="" data-lang="typescript"><code class="lang-typescript">refreshListSideEffect$ <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>refreshClicks<span class="token punctuation">,</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>intervalRefreshTick$
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>listService<span class="token punctuation">.</span><span class="token function">refetchList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>As a last step, we could use another overload of the <code>hold</code> method to get better readability of the code.</p><p>The second overload of the <code>hold</code> method takes a trigger <code>Observable</code> and a separate function that is executed whenever the trigger fires.
It generally looks like this:</p><p><code>hold(o$: Observable&lt;T&gt;, sideEffect: (v: T) =&gt; void)</code></p><p>In our constructor, we can use it as following:</p><pre v-pre="" data-lang="typescript"><code class="lang-typescript"><span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hold</span><span class="token punctuation">(</span>refreshListSideEffect$<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>listService<span class="token punctuation">.</span><span class="token function">refetchList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>Now, it's time to reap the benefits!</p><p>Let's delete code.</p><p>In the example, we can get rid of the following snippets:</p><pre v-pre="" data-lang="typescript"><code class="lang-typescript">  <span class="token keyword">implements</span> <span class="token class-name">OnInit</span><span class="token punctuation">,</span> OnDestroy
  <span class="token comment">// ..</span>
  intervalSubscription <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subscription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
  <span class="token function">ngOnDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>intervalSubscription<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
  <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resetRefreshTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
  <span class="token function">resetRefreshTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>intervalSubscription<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>intervalSubscription <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'refreshInterval'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
        <span class="token function">switchMap</span><span class="token punctuation">(</span>ms <span class="token operator">=&gt;</span> <span class="token function">interval</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">tap</span><span class="token punctuation">(</span>_ <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>listService<span class="token punctuation">.</span><span class="token function">refetchList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
  <span class="token function">onRefreshClicks</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>listService<span class="token punctuation">.</span><span class="token function">refetchList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>We can say without any doubt we did an excellent job. :)</p><p>Side effects are now organized in a structured and readable way, and the subscription handling gets done automatically by the state layer.
Furthermore, we managed to get rid of all implemented lifecycles as well as the callback function for the button click.</p><p>All in all, an amazing job!</p></article></section></main>
    <!-- Settings -->
    <script>
      window.$docsify = {
        search: 'auto',
        // Name that will be displayed in sidebar
        name: '@rx-angular',
        // Takes only # & ## as sidebar links
        subMaxLevel: 2,
        // Show sidebar
        loadSidebar: true,
        // Coverpage url
        coverpage: './web/partials/_coverpage.md',
        // Prevents multiple downloads of sidebar
        alias: {
          '/.*/_sidebar.md': './web/partials/_sidebar.md',
          '/_sidebar.md': './web/partials/_sidebar.md',
        },
        routerMode: 'history',
        // Autoscroll content to the top when changing page
        auto2top: true,
        relativePath: true,
      };
    </script>
    <!-- Main script -->
    <script src="../../../../cdn.jsdelivr.net/npm/docsify/lib/docsify.min.js"></script>
    <!-- Typescript highlight -->
    <script src="../../../../cdn.jsdelivr.net/npm/prismjs@1.21.0/components/prism-typescript.min.js"></script>
    <!-- Search -->
    <script src="../../../../cdn.jsdelivr.net/npm/docsify/lib/plugins/search.min.js"></script>
    <!-- Zoom image -->
    <script src="../../../../cdn.jsdelivr.net/npm/docsify/lib/plugins/zoom-image.min.js"></script>
    <!-- Copy code plugin -->
    <script src="https://unpkg.com/docsify-copy-code@2"></script>
  

<div class="progress" style="opacity: 0; width: 0%;"></div></body></html>