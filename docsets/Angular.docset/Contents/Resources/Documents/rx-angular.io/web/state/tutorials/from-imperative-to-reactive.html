<html><!-- Online page at https://rx-angular.io/web/state/tutorials/from-imperative-to-reactive --><head><meta charset="utf-8"><title>Migrating to RxState</title><link rel="stylesheet" href="../../../../angular.io/css_36.css" type="text/css"><link rel="stylesheet" href="../../../../angular.io/css_37.css" type="text/css"><link rel="stylesheet" href="../../../../angular.io/css_38.css" type="text/css"><link rel="stylesheet" href="../../../../angular.io/css_39.css" type="text/css"><link rel="stylesheet" href="../../../../angular.io/css_40.css" type="text/css"><link rel="stylesheet" href="../../../../angular.io/css_41.css" type="text/css"><script type="text/javascript" src="../../../../angular.io/js_1.js"></script><script type="text/javascript" src="../../../../angular.io/js_15.js"></script><script type="text/javascript" src="../../../../angular.io/js_16.js"></script><script type="text/javascript" src="../../../../angular.io/js_17.js"></script><script type="text/javascript" src="../../../../angular.io/js_18.js"></script><script type="text/javascript" src="../../../../angular.io/js_19.js"></script><script type="text/javascript" src="../../../../angular.io/js_20.js"></script><script type="text/javascript" src="../../../../angular.io/js_21.js"></script><script type="text/javascript" src="../../../../angular.io/js_22.js"></script></head><body data-page="/web/state/tutorials/from-imperative-to-reactive.md" class="ready">
    <section class="cover" style="background: linear-gradient(to left bottom, hsl(174, 100%, 85%) 0%,hsl(60, 100%, 85%) 100%)"><div class="mask"></div><div class="cover-main"><!--cover--></div></section><main><button class="sidebar-toggle" aria-label="Menu"><div class="sidebar-toggle-button"><span></span><span></span><span></span></div></button><aside class="sidebar"><div class="search"><div class="input-wrap">
      <input type="search" value="" aria-label="Search text" placeholder="Type to search">
      <div class="clear-button">
        <svg width="26" height="24">
          <circle cx="12" cy="12" r="11" fill="#ccc"></circle>
          <path stroke="white" stroke-width="2" d="M8.25,8.25,15.75,15.75"></path>
          <path stroke="white" stroke-width="2" d="M8.25,15.75,15.75,8.25"></path>
        </svg>
      </div>
    </div>
    <div class="results-panel"></div>
    </div><h1 class="app-name"><a class="app-name-link" data-nosearch="" href="./from-imperative-to-reactive.html">@rx-angular</a></h1><div class="sidebar-nav"><!-- - @rx-angular/template [BETA]

  - Getting started

    - [Overview](/template/overview.md)
    - [Setup](/template/basic-setup.md)

  - Theory

    - [Rendering issues in Angular](/template/theory/rendering-issues.md)
    - [Concepts](/template/theory/concepts.md)

  - Features

    - [LetDirective](/template/features/let.md)
    - [PushPipe](/template/features/push.md)
    - [RenderStrategies](/template/features/render-strategies.md)

  - Experimental

    - [Unpatch directive](/template/experimental/unpatch.md) -->

<ul><li><p><strong>@rx-angular/state</strong></p><ul><li><p>Getting started</p><ul><li><a href="../general/overview.html" title="Overview">Overview</a></li><li><a href="../general/basic-setup.html" title="Setup">Setup</a></li></ul></li><li><p>API</p><ul><li><a href="../api/rx-state.html" title="RxState">RxState</a></li><li><a href="../api/rxjs-operators.html" title="RxJS Operators">RxJS Operators</a></li><li><a href="../api/transformation-helpers.html" title="Transformation helpers">Transformation helpers</a></li><li><a href="../api/interfaces.html" title="Interfaces">Interfaces</a></li></ul></li><li><p>Tutorials</p><ul><li><a href="./basic-tutorial.html" title="Basic tutorial">Basic tutorial</a></li><li><a href="./incrementing-value.html" title="Incrementing a value">Incrementing a value</a></li><li class="active"><a href="./from-imperative-to-reactive.html" title="Migrating to RxState">Migrating to RxState</a><ul class="app-sub-sidebar"><li><a class="section-link" href="./from-imperative-to-reactive.html" title="Initial solution">Initial solution</a></li><li><a class="section-link" href="./from-imperative-to-reactive.html" title="Step 1. Basic solution using BehaviorSubject">Step 1. Basic solution using BehaviorSubject</a></li><li><a class="section-link" href="./from-imperative-to-reactive.html" title="Step 2. A bit more reactive component.">Step 2. A bit more reactive component.</a></li><li><a class="section-link" href="./from-imperative-to-reactive.html" title="Step 3. Fully reactive component.">Step 3. Fully reactive component.</a></li></ul></li><li><a href="./passing-observables.html" title="Passing observables directly">Passing observables directly</a></li></ul></li><li><p>Recipes</p><ul><li><a href="../howtos/determine-state.html" title="Determine state type">Determine state type</a></li><li><a href="../howtos/manage-viewmodel.html" title="Manage ViewModel">Manage ViewModel</a></li><li><a href="../howtos/partial-updates.html" title="Run partial updates">Run partial updates</a></li><li><a href="../howtos/load-data-on-route-change.html" title="Load data on route change">Load data on route change</a></li><li><a href="../howtos/hostbindings.html" title="Work with HostBindings">Work with HostBindings</a></li><li><a href="../howtos/rx-state-as-global-state.html" title="Use RxState as Global State">Use RxState as Global State</a></li></ul></li><li><p>Integrations</p><ul><li><a href="../integrations/compose-state-using-ngrx-selectors.html" title="Reuse ngrx selectors to compose state">Reuse ngrx selectors to compose state</a></li><li><a href="../integrations/manage-entities-ngrx.html" title="Manage entities using @ngrx/entity">Manage entities using <code>@ngrx/entity</code></a></li></ul></li></ul></li></ul><hr>
<ul><li><p><strong>Links</strong></p></li><li><p><a href="https://github.com/rx-angular/rx-angular" target="_blank" rel="noopener" title=" Github"><img src="../../../../icongr.am/simple/github.svg" data-origin="https://icongr.am/simple/github.svg?color=808080&amp;size=24" alt="Github"> Github</a></p></li><li><p><a href="https://discord.com/invite/XWWGZsQ" target="_blank" rel="noopener" title=" Discord"><img src="../../../../icongr.am/material/discord.svg" data-origin="https://icongr.am/material/discord.svg?size=24&amp;color=7289da" alt="Discord"> Discord</a></p></li></ul></div></aside><section class="content"><article class="markdown-section" id="main"><h1 id="migrating-to-rxstate"><a href="./from-imperative-to-reactive.html" data-id="migrating-to-rxstate" class="anchor"><span>Migrating to RxState</span></a></h1><p>Let's take a look at a simple checklist app, see how it can be implemented in an imperative way, and after that, we will iterate over it and add some reactiveness. We skip any additional logic such as routing, error handling etc., in these examples.</p><h2 id="initial-solution"><a href="./from-imperative-to-reactive.html" data-id="initial-solution" class="anchor"><span>Initial solution</span></a></h2><p><strong>Interfaces</strong></p><p>The checklist interface:</p><pre v-pre="" data-lang="ts"><code class="lang-ts"><span class="token keyword">interface</span> <span class="token class-name">Checklist</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  tasks<span class="token operator">:</span> Task<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>The task interface:</p><pre v-pre="" data-lang="ts"><code class="lang-ts"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">Task</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>List is a nested smart component.</p><p>The component code:</p><pre v-pre="" data-lang="ts"><code class="lang-ts"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ChecklistComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span><span class="token punctuation">,</span> OnDestroy <span class="token punctuation">{</span>
  @<span class="token function">Input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  checklist<span class="token operator">:</span> Checklist<span class="token punctuation">;</span>

  <span class="token keyword">private</span> destroy$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> api<span class="token operator">:</span> TodoApiService<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>api
      <span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">takeUntil</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>destroy$<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span>checklist<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>checklist <span class="token operator">=</span> checklist<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">ngOnDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>destroy$<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">answerTask</span><span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>api
      <span class="token punctuation">.</span><span class="token function">answerTask</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">takeUntil</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>destroy$<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>checklist<span class="token punctuation">.</span>tasks <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>checklist<span class="token punctuation">.</span>tasks<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> t<span class="token punctuation">.</span>id <span class="token operator">!==</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>The template:</p><pre v-pre="" data-lang="html"><code class="lang-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>checklist<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>{{ checklist.name }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>article</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>task<span class="token punctuation">"</span></span> <span class="token attr-name">*ngFor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>let task of checklist.tasks<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>{{ task.name }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>answer-button<span class="token punctuation">"</span></span> <span class="token attr-name">(click)</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>answerTask(task.id)<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Done<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>article</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">&gt;</span></span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><h2 id="step-1-basic-solution-using-behaviorsubject"><a href="./from-imperative-to-reactive.html" data-id="step-1-basic-solution-using-behaviorsubject" class="anchor"><span>Step 1. Basic solution using BehaviorSubject</span></a></h2><p>The first pattern that many developers switching to reactive programming with Angular &amp; RxJS will find is the so-called "Observable data service" (organization of state with <code>BehaviorSubject</code> as data storage).</p><p>This pattern is pretty flexible and can be applied to services and components. It can even serve as a lightweight alternative to NgRx, NGXS, Akita, and other state management solutions with some tuning.</p><p><em>Another alternative can be <code>merge</code> + <code>scan</code> operators to combine multiple observables and accumulate their values into a single state observable.</em></p><p><strong>Let's create a state class that abstracts our BehaviorSubject and some basic operations we can do with it.</strong></p><p><strong>State class</strong></p><pre v-pre="" data-lang="ts"><code class="lang-ts"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">State<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
  data$<span class="token operator">:</span> Observable<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>

  <span class="token keyword">private</span> dataSource$<span class="token operator">:</span> BehaviorSubject<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>

  <span class="token keyword">constructor</span><span class="token punctuation">(</span>initialData<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dataSource$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BehaviorSubject</span><span class="token punctuation">(</span>initialData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>data$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dataSource$<span class="token punctuation">.</span><span class="token function">asObservable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">get</span> <span class="token function">snapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dataSource$<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token generic-function"><span class="token function">select</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>path<span class="token operator">:</span> <span class="token constant">K</span><span class="token punctuation">)</span><span class="token operator">:</span> Observable<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
      <span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token comment">// some additional logic</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">patch</span><span class="token punctuation">(</span>data<span class="token operator">:</span> Partial<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dataSource$<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>snapshot<span class="token punctuation">,</span> <span class="token operator">...</span>data <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><ul><li>Data initialization happens inside the <code>constructor</code>. We are passing <code>initialData</code> of type <code>T</code>, and it is set to our <code>dataSource$</code>.</li><li><code>get snapshot()</code> returns the current value from the <code>dataSource$</code>.</li><li><code>select &lt;K extends keyof T&gt;(path: K): Observable&lt;T[K]&gt;</code> accepts key of <code>T</code> and returns value of type <code>T[K]</code> from <code>data$</code> as observable. Selection is done with <code>map</code> operator but <code>pluck</code> is also an option. We are skipping any additional filtering/sharing logic in this example.</li><li><code>patch(data: Partial&lt;T&gt;)</code> accepts data of <code>Partial&lt;T&gt;</code> and updates the current value of <code>dataSource$</code>.</li></ul><p><strong>Now we can organize <code>List</code> component in a more reactive way:</strong></p><pre v-pre="" data-lang="ts"><code class="lang-ts"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ChecklistComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span><span class="token punctuation">,</span> OnDestroy <span class="token punctuation">{</span>
  @<span class="token function">Input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  state <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">State<span class="token operator">&lt;</span>Checklist<span class="token operator">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    tasks<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  name$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  tasks$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'tasks'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">private</span> destroy$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> api<span class="token operator">:</span> TodoApiService<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>api
      <span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">takeUntil</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>destroy$<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span>checklist<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">patch</span><span class="token punctuation">(</span>checklist<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">ngOnDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>destroy$<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">answerTask</span><span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>api
      <span class="token punctuation">.</span><span class="token function">answerTask</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">takeUntil</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>destroy$<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> snapshot <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>snapshot<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">patch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          tasks<span class="token operator">:</span> snapshot<span class="token punctuation">.</span>tasks<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> t<span class="token punctuation">.</span>id <span class="token operator">!==</span> id<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p><strong>The template:</strong></p><pre v-pre="" data-lang="html"><code class="lang-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>checklist<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>{{ name$ | async }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>article</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>task<span class="token punctuation">"</span></span> <span class="token attr-name">*ngFor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>let task of (tasks$ | async)<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>{{ task.name }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>answer-button<span class="token punctuation">"</span></span> <span class="token attr-name">(click)</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>answerTask(task.id)<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Done<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>article</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">&gt;</span></span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>What happens here:</p><ul><li>Component gets initialized. Constructor gets involved.</li><li>Checklist id passed to the component through <code>@Input id: string</code></li><li>In <code>OnInit</code> lifecycle hook, we are getting our checklist by calling <code>get(id)</code> method from our API service, subscribe to results and updating our <code>state</code>.</li><li>After that <code>name$</code> and <code>tasks$</code> getting data from state through <code>select()</code> method. (let's assume we placed some filtering logic in the <code>select()</code> method, so we haven't received initial empty values).</li><li>Data is displayed in component template with <code>async</code> pipe. <code>&lt;h1&gt;{{name$ | async}}&lt;/h1&gt;</code> and <code>&lt;article class="task"*ngFor="let task of (tasks$ | async)"&gt;</code></li><li>User clicks on the <code>answer-button</code>. Method <code>answerTask(task.id)</code> is called.</li><li>We subscribe to the <code>answerTask</code> method from our API service. Our API returns only the status code. So what we can do is just remove this task from UI. For this, we need to get existing tasks in some way. We are using <code>this.state.snapshot</code> for this purpose. We filter tasks to exclude answered task from an array and updating our state with <code>patch()</code> method.</li></ul><p><strong>Looks reactive?</strong></p><p>The reading part is pretty reactive. With the <code>select()</code> method, we observe changes of state fields <code>name</code> and <code>tasks</code> and render them with an <code>async</code> pipe. So Angular will manage subscription for us. That's pretty cool.</p><p>But there are some issues with this approach.</p><ul><li>Solution is depending on lifecycle hooks of our component. We need to remember the order in which initialization happens <code>constructor</code> -&gt; <code>ngOnChanges</code> (that's where input binding will be initialized) -&gt; <code>ngOnInit</code> -&gt; .... -&gt; <code>ngOnDestroy</code>.</li><li>Update (or write) part is still imperative. We need to call a method in our component, subscribe to some observable and inside subscription update our state with <code>patch()</code> method. We are breaking the reactive flow.</li><li>We have multiple subscriptions in a pretty simple component. Subscription management should be done manually if we don't use external packages or create our solution.</li></ul><h2 id="step-2-a-bit-more-reactive-component"><a href="./from-imperative-to-reactive.html" data-id="step-2-a-bit-more-reactive-component" class="anchor"><span>Step 2. A bit more reactive component.</span></a></h2><p><strong>First, let's try to get rid of <code>OnInit</code> lifecycle hook.</strong></p><p>We need some <strong>event</strong> for initialization. Let's create a <code>Subject</code> for this.</p><pre v-pre="" data-lang="ts"><code class="lang-ts">init$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subject<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>Now we need a place from which we can <strong>trigger</strong> this event. <code>@Input id: string</code> is where we get the checklist id that is needed for initialization. We are planning to remove <code>OnInit</code>, so there is no need to introduce <code>OnChanges</code> to our component. Let's make a setter!</p><pre v-pre="" data-lang="ts"><code class="lang-ts">@<span class="token function">Input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">set</span> <span class="token function">id</span><span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>init$<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>Also, we need to write a logic for getting our checklist from API and storing a response:</p><pre v-pre="" data-lang="ts"><code class="lang-ts">initHandler$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>init$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
  <span class="token function">switchMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>api<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">(</span>checklist<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">patch</span><span class="token punctuation">(</span>checklist<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>So far, so good. Inside <code>switchMap</code>, we are getting value passed to <code>init$</code> and switching to our API call. We
are going as reactive as possible here and don't want to have any logic inside subscription and placed it
inside <code>tap</code>.</p><p>Nice. Now we can get rid of <code>OnInit</code> and subscription inside of it.</p><p><strong>Let's handle tasks answering in the same manner and get rid of <code>answerTask()</code> method.</strong></p><p>Event</p><pre v-pre="" data-lang="ts"><code class="lang-ts">answer$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subject<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>Trigger</p><pre v-pre="" data-lang="html"><code class="lang-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>answer-button<span class="token punctuation">"</span></span> <span class="token attr-name">(click)</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>answer$.next(task.id)<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Done<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>Answering logic</p><pre v-pre="" data-lang="ts"><code class="lang-ts">answerHandler$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>answer$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
  <span class="token function">withLatestFrom</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>tasks$<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">switchMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">[</span>id<span class="token punctuation">,</span> tasks<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>api
      <span class="token punctuation">.</span><span class="token function">answerTask</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
        <span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">patch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> tasks<span class="token operator">:</span> tasks<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> t<span class="token punctuation">.</span>id <span class="token operator">!==</span> id<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>Here we introduce an additional operator called <code>withLatestFrom</code>. This way we can get latest value from our <code>this.tasks$ = this.state.select('tasks')</code> in more reactive manner. <code>switchMap</code> will receive array of values. The first one will be <code>id</code> from <code>answer$</code> and the second one will be our tasks.</p><p><strong>Now we need to subscribe.</strong></p><p>Good fit is <code>constructor()</code>. Here we use <code>merge</code> to combine 2 observables and subscribe only once.
Unsubscribe will happen on component destruction as in the original example.</p><pre v-pre="" data-lang="ts"><code class="lang-ts"><span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> api<span class="token operator">:</span> TodoApiService<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">merge</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>initHandler$<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>answerHandler$<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">takeUntil</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>destroy$<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p><strong>The full component code:</strong></p><pre v-pre="" data-lang="ts"><code class="lang-ts"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ChecklistComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnDestroy</span> <span class="token punctuation">{</span>
  @<span class="token function">Input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">set</span> <span class="token function">id</span><span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>init$<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  state <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">State<span class="token operator">&lt;</span>Checklist<span class="token operator">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    tasks<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// READS</span>
  name$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  tasks$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'tasks'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// EVENTS</span>
  init$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subject<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  answer$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subject<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  initHandler$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>init$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">switchMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>api<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">(</span>checklist<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">patch</span><span class="token punctuation">(</span>checklist<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  answerHandler$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>answer$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">withLatestFrom</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>tasks$<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">switchMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">[</span>id<span class="token punctuation">,</span> tasks<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>api
        <span class="token punctuation">.</span><span class="token function">answerTask</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
          <span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">patch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> tasks<span class="token operator">:</span> tasks<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> t<span class="token punctuation">.</span>id <span class="token operator">!==</span> id<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">private</span> destroy$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> api<span class="token operator">:</span> TodoApiService<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">merge</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>initHandler$<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>answerHandler$<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">takeUntil</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>destroy$<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">ngOnDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>destroy$<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p><strong>Summary:</strong></p><ul><li>Now we have a bit more code but component is more reactive.</li><li>Component initialization is not depending on the <code>OnInit</code> lifecycle hook and will be a reaction to the <code>init$</code> event.</li><li>We removed imperative <code>answerTask()</code> method.</li><li>Now we have only one subscription to manage.</li><li>We dont have any code inside subscription.</li></ul><p><strong>However:</strong></p><ul><li>We still need to manage subscription.</li><li>State updates are side effects of our API calls. We are using <code>tap</code> in our pipe to handle this and manually calling the <code>this.state.patch()</code> method in our component. It is still not reactive.</li></ul><h2 id="step-3-fully-reactive-component"><a href="./from-imperative-to-reactive.html" data-id="step-3-fully-reactive-component" class="anchor"><span>Step 3. Fully reactive component.</span></a></h2><p>Let's do another round and refactor the <code>List</code> component using <code>@rx-angular/state</code>. The core of it is operators <code>mergeAll()</code> that works with a stream of streams instead of single values and <code>scan()</code> that accumulates values from these streams into single state observable.</p><p>First step will be adding <code>RxState</code> service to our component.</p><pre v-pre="" data-lang="ts"><code class="lang-ts">@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token operator">...</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>RxState<span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><pre v-pre="" data-lang="ts"><code class="lang-ts"><span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> api<span class="token operator">:</span> TodoApiService<span class="token punctuation">,</span> <span class="token keyword">private</span> state<span class="token operator">:</span> RxState<span class="token operator">&lt;</span>IChecklist<span class="token operator">&gt;</span><span class="token punctuation">)</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>RxState service is in component providers. That means that the lifecycle of this service will be nearly the same as the lifecycle of the component. And on component destruction, service will also be destroyed. We can now entirely remove our <code>State</code> class. Also, we can get rid of the <code>OnDestroy</code> lifecycle hook since we don't need to manage subscriptions manually anymore.</p><p><strong>Reading from state:</strong></p><pre v-pre="" data-lang="ts"><code class="lang-ts">name$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
tasks$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'tasks'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>Visually it looks the same but the select operator provides a lot more than just passing keys. You can read about it <a href="https://github.com/rx-angular/rx-angular/blob/master/libs/state/docs/api/rx-state.md#select" target="_blank" rel="noopener">here</a>. Also selection will be shareReplayed, distincted and undefined values will be filtered out.</p><p><strong>Updating state reactively</strong></p><p>Since in this example our api calls are main producers of our state we can connect them to state
using <code>connect</code> method.</p><p>Let's start with initialization. Event <code>init$</code> and trigger <code>@Input set id</code> remains the same, but now we can remove the <code>tap</code> operator from our <code>initHandler$</code> and simply return raw data from our API.</p><pre v-pre="" data-lang="ts"><code class="lang-ts">initHandler$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>init$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">switchMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>api<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>Now <code>initHandler$</code> is <code>Observable&lt;IChecklist&gt;</code>. Let's connect it to state.</p><pre v-pre="" data-lang="ts"><code class="lang-ts"><span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> api<span class="token operator">:</span> TodoApiService<span class="token punctuation">,</span> <span class="token keyword">private</span> state<span class="token operator">:</span> RxState<span class="token operator">&lt;</span>IChecklist<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>initHandler$<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>Cool, so now all values emitted by our <code>get()</code> API call will be merged into the state. Subscription
will be managed automatically.</p><p>Now we need to update our <code>answerHandler$</code> so it will return an id of task that was answered
(api returns only status code). And connect it to our <code>tasks</code> property.</p><pre v-pre="" data-lang="ts"><code class="lang-ts">answerHandler$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>answer$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
  <span class="token function">switchMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>api<span class="token punctuation">.</span><span class="token function">answerTask</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><pre v-pre="" data-lang="ts"><code class="lang-ts"><span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> api<span class="token operator">:</span> TodoApiService<span class="token punctuation">,</span> <span class="token keyword">private</span> state<span class="token operator">:</span> RxState<span class="token operator">&lt;</span>IChecklist<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">"tasks"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>answerHandler$<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> id<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    state<span class="token punctuation">.</span>tasks<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>t <span class="token operator">=&gt;</span> t<span class="token punctuation">.</span>id <span class="token operator">!==</span> id<span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p>Note that we removed <code>withLatestFrom(this.tasks$)</code> in favor of the <code>projectionFunction</code> in <code>connect</code>.
First we define fields to be updated, then the source of the changes and lastly we provide the <code>projectionFunction</code>. The functions' first first argument is the current state, the second is the change coming from
our source. More on possible <code>connect</code> variants <a href="https://github.com/rx-angular/rx-angular/blob/master/libs/state/docs/api/rx-state.md#connect" target="_blank" rel="noopener">here</a>.</p><p><strong>Full component code</strong></p><pre v-pre="" data-lang="ts"><code class="lang-ts"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ChecklistComponent</span> <span class="token punctuation">{</span>
  @<span class="token function">Input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">set</span> <span class="token function">id</span><span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>init$<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// READS</span>
  name$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  tasks$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'tasks'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// EVENTS</span>
  init$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subject<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  answer$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subject<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// HANDLERS</span>
  initHandler$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>init$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">switchMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>api<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  answerHandler$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>answer$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">switchMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>api<span class="token punctuation">.</span><span class="token function">answerTask</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> api<span class="token operator">:</span> TodoApiService<span class="token punctuation">,</span> <span class="token keyword">private</span> state<span class="token operator">:</span> RxState<span class="token operator">&lt;</span>IChecklist<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>initHandler$<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'tasks'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>answerHandler$<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> id<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
      state<span class="token punctuation">.</span>tasks<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> t<span class="token punctuation">.</span>id <span class="token operator">!==</span> id<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><button class="docsify-copy-code-button"><span class="label">Copy to clipboard</span><span class="error">Error</span><span class="success">Copied</span></button></pre><p><strong>Summary:</strong></p><ul><li>Both reading and writing are reactive.</li><li>No subscriptions. All managed automatically by package.</li><li>No lifecycle hooks.</li><li>Less code. No need to use tricky operators if you not sure how to use them. A massive chunk of a job done under the hood.</li></ul></article></section></main>
    <!-- Settings -->
    <script>
      window.$docsify = {
        search: 'auto',
        // Name that will be displayed in sidebar
        name: '@rx-angular',
        // Takes only # & ## as sidebar links
        subMaxLevel: 2,
        // Show sidebar
        loadSidebar: true,
        // Coverpage url
        coverpage: './web/partials/_coverpage.md',
        // Prevents multiple downloads of sidebar
        alias: {
          '/.*/_sidebar.md': './web/partials/_sidebar.md',
          '/_sidebar.md': './web/partials/_sidebar.md',
        },
        routerMode: 'history',
        // Autoscroll content to the top when changing page
        auto2top: true,
        relativePath: true,
      };
    </script>
    <!-- Main script -->
    <script src="../../../../cdn.jsdelivr.net/npm/docsify/lib/docsify.min.js"></script>
    <!-- Typescript highlight -->
    <script src="../../../../cdn.jsdelivr.net/npm/prismjs@1.21.0/components/prism-typescript.min.js"></script>
    <!-- Search -->
    <script src="../../../../cdn.jsdelivr.net/npm/docsify/lib/plugins/search.min.js"></script>
    <!-- Zoom image -->
    <script src="../../../../cdn.jsdelivr.net/npm/docsify/lib/plugins/zoom-image.min.js"></script>
    <!-- Copy code plugin -->
    <script src="https://unpkg.com/docsify-copy-code@2"></script>
  

<div class="progress" style="opacity: 0; width: 0%;"></div></body></html>