<html><!-- Mirrored from laravel.com/docs/9.x/billing by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 24 Mar 2022 16:17:12 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=UTF-8"><!-- /Added by HTTrack -->

    <meta charset="utf-8">
    <title>Laravel Cashier (Stripe)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

        <link rel="canonical" href="billing.html">
    
    <!-- Primary Meta Tags -->
    <meta name="title" content="Laravel - The PHP Framework For Web Artisans">
    <meta name="description" content="Laravel is a PHP web application framework with expressive, elegant syntax. We’ve already laid the foundation — freeing you to create without sweating the small things.">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://laravel.com/">
    <meta property="og:title" content="Laravel - The PHP Framework For Web Artisans">
    <meta property="og:description" content="Laravel is a PHP web application framework with expressive, elegant syntax. We’ve already laid the foundation — freeing you to create without sweating the small things.">
    <meta property="og:image" content="../../img/og-image.jpg">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://laravel.com/">
    <meta property="twitter:title" content="Laravel - The PHP Framework For Web Artisans">
    <meta property="twitter:description" content="Laravel is a PHP web application framework with expressive, elegant syntax. We’ve already laid the foundation — freeing you to create without sweating the small things.">
    <meta property="twitter:image" content="../../img/og-image.jpg">

    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="../../img/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../img/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../img/favicon/favicon-16x16.png">
    <link rel="manifest" href="https://laravel.com/img/favicon/site.webmanifest">
    <link rel="mask-icon" href="../../img/favicon/safari-pinned-tab.svg" color="#ff2d20">
    <link rel="shortcut icon" href="../../img/favicon/favicon.ico">
    <meta name="msapplication-TileColor" content="#ff2d20">
    <meta name="msapplication-config" content="https://laravel.com/img/favicon/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">

    <link rel="stylesheet" href="../../../use.typekit.net/ins2wgm.css">
    <link rel="stylesheet" type="text/css" href="../../css/app091f.css?id=b59affd817f095c5db73">

    <script src="//www.google-analytics.com/ga.js"></script><script src="//www.google-analytics.com/ga.js"></script><script>
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
        if (localStorage.theme === 'system') {
            if (e.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        }
    });

    function updateTheme() {
        if (!('theme' in localStorage)) {
            localStorage.theme = 'system';
        }

        switch (localStorage.theme) {
            case 'system':
                if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
                document.documentElement.setAttribute('color-theme', 'system');
                break;

            case 'dark':
                document.documentElement.classList.add('dark');
                document.documentElement.setAttribute('color-theme', 'dark');
                break;

            case 'light':
                document.documentElement.classList.remove('dark');
                document.documentElement.setAttribute('color-theme', 'light');
                break;
        }
    }

    updateTheme();
</script>
</head>
<body x-data="{
        navIsOpen: false,
        searchIsOpen: false,
        search: '',
    }" class="language-php h-full w-full font-sans text-gray-900 antialiased">

    <a id="skip-to-content-link" href="#main-content" class="absolute bg-gray-100 px-4 py-2 top-3 left-3 text-gray-700 shadow-xl">
    Skip to content
</a>
    <div class="relative overflow-auto dark:bg-dark-700" id="docsScreen">
        <div class="relative lg:flex lg:items-start">
            <aside x-data="{
                    navIsOpen: false,
                    init() {
                        this.$watch('navIsOpen', (val) => {
                            if (val) {
                                document.body.classList.add('overflow-hidden');
                            } else {
                                document.body.classList.remove('overflow-hidden');
                            }
                        });
                    }
                }" class="hidden fixed top-0 bottom-0 left-0 z-20 h-full w-16 bg-gradient-to-b from-gray-100 to-white transition-all duration-300 overflow-hidden lg:sticky lg:w-80 lg:shrink-0 lg:flex lg:flex-col lg:justify-end lg:items-end 2xl:max-w-lg 2xl:w-full dark:from-dark-800 dark:to-dark-700" :class="{ 'w-64': navIsOpen }" @click.away="navIsOpen = false" @keydown.window.escape="navIsOpen = false">
                <div class="relative min-h-0 flex-1 flex flex-col xl:w-80">
                    <a href="https://laravel.com/" class="flex items-center py-8 px-4 lg:px-8 xl:px-16">
                        <img class="w-8 h-8 shrink-0 transition-all duration-300 lg:w-12 lg:h-12" :class="{ 'w-12 h-12': navIsOpen }" src="../../img/logomark.min.svg" alt="Laravel" width="50" height="52">
                        <img x-show="navIsOpen" x-cloak="" class="ml-4 transition-all duration-300 lg:hidden" x-transition:enter="duration-250 ease-out" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" x-transition:leave="duration-250 ease-in" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0" src="../../img/logotype.min.svg" alt="Laravel" width="114" height="29">
                        <img src="../../img/logotype.min.svg" alt="Laravel" class="hidden ml-4 lg:block" width="114" height="29">
                    </a>
                    <div class="overflow-y-auto overflow-x-hidden px-4 lg:overflow-hidden lg:px-8 xl:px-16">
                        
                        

                        
                                                    <div :class="{ 'hidden': !navIsOpen }" x-cloak="" class="mt-4 px-3 py-2 border-dashed border-gray-200 border rounded-lg text-xs leading-loose text-gray-700 lg:block dark:border-gray-400 dark:text-gray-200">
                                <span class="font-medium">Laravel Forge:</span> create and manage PHP 8 servers. Deploy your Laravel applications in seconds. <a class="underline text-red-600" href="https://forge.laravel.com/">Sign up now!</a>.
                            </div>
                        
                        
                                            </div>
                    <div class="sticky bottom-0 flex-1 flex flex-col justify-end lg:hidden">
                        <div class="py-4 px-4 bg-white">
                            <button class="relative ml-1 w-6 h-6 text-red-600 lg:hidden focus:outline-none focus:shadow-outline" aria-label="Menu" @click.prevent="navIsOpen = !navIsOpen">
                                <svg x-show="! navIsOpen" x-transition.opacity="" class="absolute inset-0 w-6 h-6" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
                                <svg x-show="navIsOpen" x-transition.opacity="" x-cloak="" class="absolute inset-0 w-6 h-6" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                            </button>
                        </div>
                    </div>
                </div>
            </aside>

            <header class="lg:hidden" @keydown.window.escape="navIsOpen = false" @click.away="navIsOpen = false">
                <div class="relative mx-auto w-full py-10 bg-white transition duration-200 dark:bg-dark-700">
                    <div class="mx-auto px-8 sm:px-16 flex items-center justify-between">
                        <a href="https://laravel.com/" class="flex items-center">
                            <img class="" src="../../img/logomark.min.svg" alt="Laravel">
                            <img class="hidden ml-5 sm:block" src="../../img/logotype.min.svg" alt="Laravel">
                        </a>
                        <div class="flex-1 flex items-center justify-end">
                            <button id="header__sun" onclick="toSystemMode()" title="Switch to system theme" class="relative w-10 h-10 focus:outline-none focus:shadow-outline text-gray-500">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-sun" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                    <circle cx="12" cy="12" r="4"></circle>
                                    <path d="M3 12h1m8 -9v1m8 8h1m-9 8v1m-6.4 -15.4l.7 .7m12.1 -.7l-.7 .7m0 11.4l.7 .7m-12.1 -.7l-.7 .7"></path>
                                 </svg>
                            </button>
                            <button id="header__moon" onclick="toLightMode()" title="Switch to light mode" class="relative w-10 h-10 focus:outline-none focus:shadow-outline text-gray-500">
                                <svg style="width:24px;height:24px" viewBox="0 0 24 24">
                                    <path fill="currentColor" d="M17.75,4.09L15.22,6.03L16.13,9.09L13.5,7.28L10.87,9.09L11.78,6.03L9.25,4.09L12.44,4L13.5,1L14.56,4L17.75,4.09M21.25,11L19.61,12.25L20.2,14.23L18.5,13.06L16.8,14.23L17.39,12.25L15.75,11L17.81,10.95L18.5,9L19.19,10.95L21.25,11M18.97,15.95C19.8,15.87 20.69,17.05 20.16,17.8C19.84,18.25 19.5,18.67 19.08,19.07C15.17,23 8.84,23 4.94,19.07C1.03,15.17 1.03,8.83 4.94,4.93C5.34,4.53 5.76,4.17 6.21,3.85C6.96,3.32 8.14,4.21 8.06,5.04C7.79,7.9 8.75,10.87 10.95,13.06C13.14,15.26 16.1,16.22 18.97,15.95M17.33,17.97C14.5,17.81 11.7,16.64 9.53,14.5C7.36,12.31 6.2,9.5 6.04,6.68C3.23,9.82 3.34,14.64 6.35,17.66C9.37,20.67 14.19,20.78 17.33,17.97Z"></path>
                                </svg>
                            </button>
                            <button id="header__indeterminate" onclick="toDarkMode()" title="Switch to dark mode" class="relative w-10 h-10 focus:outline-none focus:shadow-outline text-gray-500">
                                <svg style="width:24px;height:24px" viewBox="0 0 24 24">
                                    <path fill="currentColor" d="M12 2A10 10 0 0 0 2 12A10 10 0 0 0 12 22A10 10 0 0 0 22 12A10 10 0 0 0 12 2M12 4A8 8 0 0 1 20 12A8 8 0 0 1 12 20V4Z"></path>
                                </svg>
                            </button>
                            <button class="ml-2 relative w-10 h-10 p-2 text-red-600 lg:hidden focus:outline-none focus:shadow-outline" aria-label="Menu" @click.prevent="navIsOpen = !navIsOpen">
                                <svg x-show="! navIsOpen" x-transition.opacity="" class="absolute inset-0 mt-2 ml-2 w-6 h-6" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
                                <svg x-show="navIsOpen" x-transition.opacity="" x-cloak="" class="absolute inset-0 mt-2 ml-2 w-6 h-6" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                            </button>
                        </div>
                    </div>
                    <span :class="{ 'shadow-sm': navIsOpen }" class="absolute inset-0 z-20 pointer-events-none"></span>
                </div>
                <div x-show="navIsOpen" x-transition:enter="duration-150" x-transition:leave="duration-100 ease-in" x-cloak="">
                    
                </div>
            </header>

            <section class="flex-1 dark:bg-dark-700">
                <div class="max-w-screen-lg px-8 sm:px-16 lg:px-24">
                    <div class="flex flex-col items-end border-b border-gray-200 py-1 transition-colors dark:border-gray-700 lg:mt-8 lg:flex-row-reverse">
                        <div class="hidden lg:flex items-center justify-center ml-8">
                            <button id="header__sun" onclick="toSystemMode()" title="Switch to system theme" class="relative w-10 h-10 focus:outline-none focus:shadow-outline text-gray-500">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-sun" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                    <circle cx="12" cy="12" r="4"></circle>
                                    <path d="M3 12h1m8 -9v1m8 8h1m-9 8v1m-6.4 -15.4l.7 .7m12.1 -.7l-.7 .7m0 11.4l.7 .7m-12.1 -.7l-.7 .7"></path>
                                 </svg>
                            </button>
                            <button id="header__moon" onclick="toLightMode()" title="Switch to light mode" class="relative w-10 h-10 focus:outline-none focus:shadow-outline text-gray-500">
                                <svg style="width:24px;height:24px" viewBox="0 0 24 24">
                                    <path fill="currentColor" d="M17.75,4.09L15.22,6.03L16.13,9.09L13.5,7.28L10.87,9.09L11.78,6.03L9.25,4.09L12.44,4L13.5,1L14.56,4L17.75,4.09M21.25,11L19.61,12.25L20.2,14.23L18.5,13.06L16.8,14.23L17.39,12.25L15.75,11L17.81,10.95L18.5,9L19.19,10.95L21.25,11M18.97,15.95C19.8,15.87 20.69,17.05 20.16,17.8C19.84,18.25 19.5,18.67 19.08,19.07C15.17,23 8.84,23 4.94,19.07C1.03,15.17 1.03,8.83 4.94,4.93C5.34,4.53 5.76,4.17 6.21,3.85C6.96,3.32 8.14,4.21 8.06,5.04C7.79,7.9 8.75,10.87 10.95,13.06C13.14,15.26 16.1,16.22 18.97,15.95M17.33,17.97C14.5,17.81 11.7,16.64 9.53,14.5C7.36,12.31 6.2,9.5 6.04,6.68C3.23,9.82 3.34,14.64 6.35,17.66C9.37,20.67 14.19,20.78 17.33,17.97Z"></path>
                                </svg>
                            </button>
                            <button id="header__indeterminate" onclick="toDarkMode()" title="Switch to dark mode" class="relative w-10 h-10 focus:outline-none focus:shadow-outline text-gray-500">
                                <svg style="width:24px;height:24px" viewBox="0 0 24 24">
                                    <path fill="currentColor" d="M12 2A10 10 0 0 0 2 12A10 10 0 0 0 12 22A10 10 0 0 0 22 12A10 10 0 0 0 12 2M12 4A8 8 0 0 1 20 12A8 8 0 0 1 12 20V4Z"></path>
                                </svg>
                            </button>
                        </div>
                        <div class="w-full lg:w-40 lg:pl-12">
                            <div>
                                <label class="text-gray-600 text-xs tracking-widest uppercase dark:text-gray-500" for="version-switcher">Version</label>
                                <div x-data="" class="relative w-full bg-white transition-all duration-500 focus-within:border-gray-600 dark:bg-gray-800">
                                    <select id="version-switcher" aria-label="Laravel version" class="appearance-none flex-1 w-full px-0 py-1 placeholder-gray-900 tracking-wide bg-white focus:outline-none dark:bg-dark-700 dark:text-gray-400 dark:placeholder-gray-500" @change="window.location = $event.target.value">
                                                                                    <option value="https://laravel.com/docs/master/billing">Master</option>
                                                                                    <option selected="" value="billing.html">9.x</option>
                                                                                    <option value="https://laravel.com/docs/8.x/billing">8.x</option>
                                                                                    <option value="https://laravel.com/docs/7.x/billing">7.x</option>
                                                                                    <option value="https://laravel.com/docs/6.x/billing">6.x</option>
                                                                                    <option value="https://laravel.com/docs/5.8/billing">5.8</option>
                                                                                    <option value="https://laravel.com/docs/5.7/billing">5.7</option>
                                                                                    <option value="https://laravel.com/docs/5.6/billing">5.6</option>
                                                                                    <option value="https://laravel.com/docs/5.5/billing">5.5</option>
                                                                                    <option value="https://laravel.com/docs/5.4/billing">5.4</option>
                                                                                    <option value="https://laravel.com/docs/5.3/billing">5.3</option>
                                                                                    <option value="https://laravel.com/docs/5.2/billing">5.2</option>
                                                                                    <option value="https://laravel.com/docs/5.1/billing">5.1</option>
                                                                                    <option value="https://laravel.com/docs/5.0/billing">5.0</option>
                                                                                    <option value="https://laravel.com/docs/4.2/billing">4.2</option>
                                                                            </select>
                                    <img class="absolute inset-y-0 right-0 mt-2.5 w-2.5 h-2.5 text-gray-900 pointer-events-none" id="docs_search__version_arrow" src="../../img/icons/drop_arrow.min.svg" alt="">
                                    <img class="absolute inset-y-0 right-0 mt-2.5 w-2.5 h-2.5 text-gray-900 pointer-events-none" id="docs_search__version_arrow_dark" src="../../img/icons/drop_arrow.dark.min.svg" alt="">
                                </div>
                            </div>
                        </div>
                        <div class="relative mt-8 flex items-center justify-end w-full h-10 lg:mt-0">
                            <div class="flex-1 flex items-center">
                                <button class="relative inline-flex items-center text-gray-800 transition-colors dark:text-gray-400 w-full" @click.prevent="$dispatch('toggle-search-modal')">
                                    <svg class="w-5 h-5 text-gray-700 pointer-events-none transition-colors dark:text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                                    <span class="ml-3">Search</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <section class="mt-8 md:mt-16">
                        <section class="docs_main max-w-prose">
                            
                                                        <div id="main-content">
    <h1>Laravel Cashier (Stripe)</h1>
<ul>
<li>
<a href="#introduction">Introduction</a>
</li>
<li>
<a href="#upgrading-cashier">Upgrading Cashier</a>
</li>
<li>
<a href="#installation">Installation</a>
<ul>
<li>
<a href="#database-migrations">Database Migrations</a>
</li>
</ul>
</li>
<li>
<a href="#configuration">Configuration</a>
<ul>
<li>
<a href="#billable-model">Billable Model</a>
</li>
<li>
<a href="#api-keys">API Keys</a>
</li>
<li>
<a href="#currency-configuration">Currency Configuration</a>
</li>
<li>
<a href="#tax-configuration">Tax Configuration</a>
</li>
<li>
<a href="#logging">Logging</a>
</li>
<li>
<a href="#using-custom-models">Using Custom Models</a>
</li>
</ul>
</li>
<li>
<a href="#customers">Customers</a>
<ul>
<li>
<a href="#retrieving-customers">Retrieving Customers</a>
</li>
<li>
<a href="#creating-customers">Creating Customers</a>
</li>
<li>
<a href="#updating-customers">Updating Customers</a>
</li>
<li>
<a href="#balances">Balances</a>
</li>
<li>
<a href="#tax-ids">Tax IDs</a>
</li>
<li>
<a href="#syncing-customer-data-with-stripe">Syncing Customer Data With Stripe</a>
</li>
<li>
<a href="#billing-portal">Billing Portal</a>
</li>
</ul>
</li>
<li>
<a href="#payment-methods">Payment Methods</a>
<ul>
<li>
<a href="#storing-payment-methods">Storing Payment Methods</a>
</li>
<li>
<a href="#retrieving-payment-methods">Retrieving Payment Methods</a>
</li>
<li>
<a href="#check-for-a-payment-method">Determining If A User Has A Payment Method</a>
</li>
<li>
<a href="#updating-the-default-payment-method">Updating The Default Payment Method</a>
</li>
<li>
<a href="#adding-payment-methods">Adding Payment Methods</a>
</li>
<li>
<a href="#deleting-payment-methods">Deleting Payment Methods</a>
</li>
</ul>
</li>
<li>
<a href="#subscriptions">Subscriptions</a>
<ul>
<li>
<a href="#creating-subscriptions">Creating Subscriptions</a>
</li>
<li>
<a href="#checking-subscription-status">Checking Subscription Status</a>
</li>
<li>
<a href="#changing-prices">Changing Prices</a>
</li>
<li>
<a href="#subscription-quantity">Subscription Quantity</a>
</li>
<li>
<a href="#multiprice-subscriptions">Multiprice Subscriptions</a>
</li>
<li>
<a href="#metered-billing">Metered Billing</a>
</li>
<li>
<a href="#subscription-taxes">Subscription Taxes</a>
</li>
<li>
<a href="#subscription-anchor-date">Subscription Anchor Date</a>
</li>
<li>
<a href="#cancelling-subscriptions">Canceling Subscriptions</a>
</li>
<li>
<a href="#resuming-subscriptions">Resuming Subscriptions</a>
</li>
</ul>
</li>
<li>
<a href="#subscription-trials">Subscription Trials</a>
<ul>
<li>
<a href="#with-payment-method-up-front">With Payment Method Up Front</a>
</li>
<li>
<a href="#without-payment-method-up-front">Without Payment Method Up Front</a>
</li>
<li>
<a href="#extending-trials">Extending Trials</a>
</li>
</ul>
</li>
<li>
<a href="#handling-stripe-webhooks">Handling Stripe Webhooks</a>
<ul>
<li>
<a href="#defining-webhook-event-handlers">Defining Webhook Event Handlers</a>
</li>
<li>
<a href="#verifying-webhook-signatures">Verifying Webhook Signatures</a>
</li>
</ul>
</li>
<li>
<a href="#single-charges">Single Charges</a>
<ul>
<li>
<a href="#simple-charge">Simple Charge</a>
</li>
<li>
<a href="#charge-with-invoice">Charge With Invoice</a>
</li>
<li>
<a href="#refunding-charges">Refunding Charges</a>
</li>
</ul>
</li>
<li>
<a href="#checkout">Checkout</a>
<ul>
<li>
<a href="#product-checkouts">Product Checkouts</a>
</li>
<li>
<a href="#single-charge-checkouts">Single Charge Checkouts</a>
</li>
<li>
<a href="#subscription-checkouts">Subscription Checkouts</a>
</li>
<li>
<a href="#collecting-tax-ids">Collecting Tax IDs</a>
</li>
</ul>
</li>
<li>
<a href="#invoices">Invoices</a>
<ul>
<li>
<a href="#retrieving-invoices">Retrieving Invoices</a>
</li>
<li>
<a href="#upcoming-invoices">Upcoming Invoices</a>
</li>
<li>
<a href="#previewing-subscription-invoices">Previewing Subscription Invoices</a>
</li>
<li>
<a href="#generating-invoice-pdfs">Generating Invoice PDFs</a>
</li>
</ul>
</li>
<li>
<a href="#handling-failed-payments">Handling Failed Payments</a>
</li>
<li>
<a href="#strong-customer-authentication">Strong Customer Authentication (SCA)</a>
<ul>
<li>
<a href="#payments-requiring-additional-confirmation">Payments Requiring Additional Confirmation</a>
</li>
<li>
<a href="#off-session-payment-notifications">Off-session Payment Notifications</a>
</li>
</ul>
</li>
<li>
<a href="#stripe-sdk">Stripe SDK</a>
</li>
<li>
<a href="#testing">Testing</a>
</li>
</ul>
<p><a class="dashAnchor" name="//apple_ref/Section/Introduction"></a><a name="introduction"></a></p>
<h2>Introduction</h2>
<p><a href="https://github.com/laravel/cashier-stripe">Laravel Cashier Stripe</a> provides an expressive, fluent interface to <a href="https://stripe.com/">Stripe's</a> subscription billing services. It handles almost all of the boilerplate subscription billing code you are dreading writing. In addition to basic subscription management, Cashier can handle coupons, swapping subscription, subscription "quantities", cancellation grace periods, and even generate invoice PDFs.</p>
<p><a class="dashAnchor" name="//apple_ref/Section/Upgrading%20Cashier"></a><a name="upgrading-cashier"></a></p>
<h2>Upgrading Cashier</h2>
<p>When upgrading to a new version of Cashier, it's important that you carefully review <a href="https://github.com/laravel/cashier-stripe/blob/master/UPGRADE.md">the upgrade guide</a>.</p>
<blockquote>
<p>{note} To prevent breaking changes, Cashier uses a fixed Stripe API version. Cashier 13 utilizes Stripe API version <code>2020-08-27</code>. The Stripe API version will be updated on minor releases in order to make use of new Stripe features and improvements.</p>
</blockquote>
<p><a class="dashAnchor" name="//apple_ref/Section/Installation"></a><a name="installation"></a></p>
<h2>Installation</h2>
<p>First, install the Cashier package for Stripe using the Composer package manager:</p>
<pre><code data-theme="olaolu-palenight" data-lang="shell" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BFC7D5;">composer </span><span style="color: #BFC7D5;">require</span><span style="color: #BFC7D5;"> </span><span style="color: #BFC7D5;">laravel/cashier</span></div></code></pre>
<blockquote>
<p>{note} To ensure Cashier properly handles all Stripe events, remember to <a href="#handling-stripe-webhooks">set up Cashier's webhook handling</a>.</p>
</blockquote>
<p><a class="dashAnchor" name="//apple_ref/Section/Database%20Migrations"></a><a name="database-migrations"></a></p>
<h3>Database Migrations</h3>
<p>Cashier's service provider registers its own database migration directory, so remember to migrate your database after installing the package. The Cashier migrations will add several columns to your <code>users</code> table as well as create a new <code>subscriptions</code> table to hold all of your customer's subscriptions:</p>
<pre><code data-theme="olaolu-palenight" data-lang="shell" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BFC7D5;">php </span><span style="color: #BFC7D5;">artisan</span><span style="color: #BFC7D5;"> </span><span style="color: #BFC7D5;">migrate</span></div></code></pre>
<p>If you need to overwrite the migrations that ship with Cashier, you can publish them using the <code>vendor:publish</code> Artisan command:</p>
<pre><code data-theme="olaolu-palenight" data-lang="shell" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BFC7D5;">php </span><span style="color: #BFC7D5;">artisan</span><span style="color: #BFC7D5;"> </span><span style="color: #BFC7D5;">vendor:publish</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">--tag=</span><span style="color: #D9F5DD;">"</span><span style="color: #C3E88D;">cashier-migrations</span><span style="color: #D9F5DD;">"</span></div></code></pre>
<p>If you would like to prevent Cashier's migrations from running entirely, you may use the <code>ignoreMigrations</code> method provided by Cashier. Typically, this method should be called in the <code>register</code> method of your <code>AppServiceProvider</code>:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> Laravel\Cashier\</span><span style="color: #FFCB8B;">Cashier</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #697098;">/**</span></div><div class="line"><span style="color: #697098;"> * Register any application services.</span></div><div class="line"><span style="color: #697098;"> *</span></div><div class="line"><span style="color: #697098;"> * </span><span style="color: #C792EA;">@return</span><span style="color: #697098;"> </span><span style="color: #C792EA;">void</span></div><div class="line"><span style="color: #697098;"> </span><span style="color: #697098;">*/</span></div><div class="line"><span style="color: #C792EA;">public</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">function</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">register</span><span style="color: #D9F5DD;">()</span></div><div class="line"><span style="color: #BFC7D5;">{</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #FFCB8B;">Cashier</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">ignoreMigrations</span><span style="color: #BFC7D5;">();</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<blockquote>
<p>{note} Stripe recommends that any column used for storing Stripe identifiers should be case-sensitive. Therefore, you should ensure the column collation for the <code>stripe_id</code> column is set to <code>utf8_bin</code> when using MySQL. More information regarding this can be found in the <a href="https://stripe.com/docs/upgrades#what-changes-does-stripe-consider-to-be-backwards-compatible">Stripe documentation</a>.</p>
</blockquote>
<p><a class="dashAnchor" name="//apple_ref/Section/Configuration"></a><a name="configuration"></a></p>
<h2>Configuration</h2>
<p><a class="dashAnchor" name="//apple_ref/Section/Billable%20Model"></a><a name="billable-model"></a></p>
<h3>Billable Model</h3>
<p>Before using Cashier, add the <code>Billable</code> trait to your billable model definition. Typically, this will be the <code>App\Models\User</code> model. This trait provides various methods to allow you to perform common billing tasks, such as creating subscriptions, applying coupons, and updating payment method information:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> Laravel\Cashier\</span><span style="color: #FFCB8B;">Billable</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #C792EA;">class</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB6B;">User</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">extends</span><span style="color: #BFC7D5;"> </span><span style="color: #A9C77D;">Authenticatable</span></div><div class="line"><span style="color: #BFC7D5;">{</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB8B;">Billable</span><span style="color: #BFC7D5;">;</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<p>Cashier assumes your billable model will be the <code>App\Models\User</code> class that ships with Laravel. If you wish to change this you may specify a different model via the <code>useCustomerModel</code> method. This method should typically be called in the <code>boot</code> method of your <code>AppServiceProvider</code> class:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> App\Models\Cashier\</span><span style="color: #FFCB8B;">User</span><span style="color: #BFC7D5;">;</span></div><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> Laravel\Cashier\</span><span style="color: #FFCB8B;">Cashier</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #697098;">/**</span></div><div class="line"><span style="color: #697098;"> * Bootstrap any application services.</span></div><div class="line"><span style="color: #697098;"> *</span></div><div class="line"><span style="color: #697098;"> * </span><span style="color: #C792EA;">@return</span><span style="color: #697098;"> </span><span style="color: #C792EA;">void</span></div><div class="line"><span style="color: #697098;"> </span><span style="color: #697098;">*/</span></div><div class="line"><span style="color: #C792EA;">public</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">function</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">boot</span><span style="color: #D9F5DD;">()</span></div><div class="line"><span style="color: #BFC7D5;">{</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #FFCB8B;">Cashier</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">useCustomerModel</span><span style="color: #BFC7D5;">(</span><span style="color: #FFCB8B;">User</span><span style="color: #89DDFF;">::</span><span style="color: #C792EA;">class</span><span style="color: #BFC7D5;">);</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<blockquote>
<p>{note} If you're using a model other than Laravel's supplied <code>App\Models\User</code> model, you'll need to publish and alter the <a href="#installation">Cashier migrations</a> provided to match your alternative model's table name.</p>
</blockquote>
<p><a class="dashAnchor" name="//apple_ref/Section/API%20Keys"></a><a name="api-keys"></a></p>
<h3>API Keys</h3>
<p>Next, you should configure your Stripe API keys in your application's <code>.env</code> file. You can retrieve your Stripe API keys from the Stripe control panel:</p>
<pre><code data-theme="olaolu-palenight" data-lang="ini" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">STRIPE_KEY</span><span style="color: #BFC7D5;">=your-stripe-key</span></div><div class="line"><span style="color: #C792EA;">STRIPE_SECRET</span><span style="color: #BFC7D5;">=your-stripe-secret</span></div></code></pre>
<p><a class="dashAnchor" name="//apple_ref/Section/Currency%20Configuration"></a><a name="currency-configuration"></a></p>
<h3>Currency Configuration</h3>
<p>The default Cashier currency is United States Dollars (USD). You can change the default currency by setting the <code>CASHIER_CURRENCY</code> environment variable within your application's <code>.env</code> file:</p>
<pre><code data-theme="olaolu-palenight" data-lang="ini" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">CASHIER_CURRENCY</span><span style="color: #BFC7D5;">=eur</span></div></code></pre>
<p>In addition to configuring Cashier's currency, you may also specify a locale to be used when formatting money values for display on invoices. Internally, Cashier utilizes <a href="https://www.php.net/manual/en/class.numberformatter.php">PHP's <code>NumberFormatter</code> class</a> to set the currency locale:</p>
<pre><code data-theme="olaolu-palenight" data-lang="ini" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">CASHIER_CURRENCY_LOCALE</span><span style="color: #BFC7D5;">=nl_BE</span></div></code></pre>
<blockquote>
<p>{note} In order to use locales other than <code>en</code>, ensure the <code>ext-intl</code> PHP extension is installed and configured on your server.</p>
</blockquote>
<p><a class="dashAnchor" name="//apple_ref/Section/Tax%20Configuration"></a><a name="tax-configuration"></a></p>
<h3>Tax Configuration</h3>
<p>Thanks to <a href="https://stripe.com/tax">Stripe Tax</a>, it's possible to automatically calculate taxes for all invoices generated by Stripe. You can enable automatic tax calculation by invoking the <code>calculateTaxes</code> method in the <code>boot</code> method of your application's <code>App\Providers\AppServiceProvider</code> class:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> Laravel\Cashier\</span><span style="color: #FFCB8B;">Cashier</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #697098;">/**</span></div><div class="line"><span style="color: #697098;"> * Bootstrap any application services.</span></div><div class="line"><span style="color: #697098;"> *</span></div><div class="line"><span style="color: #697098;"> * </span><span style="color: #C792EA;">@return</span><span style="color: #697098;"> </span><span style="color: #C792EA;">void</span></div><div class="line"><span style="color: #697098;"> </span><span style="color: #697098;">*/</span></div><div class="line"><span style="color: #C792EA;">public</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">function</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">boot</span><span style="color: #D9F5DD;">()</span></div><div class="line"><span style="color: #BFC7D5;">{</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #FFCB8B;">Cashier</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">calculateTaxes</span><span style="color: #BFC7D5;">();</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<p>Once tax calculation has been enabled, any new subscriptions and any one-off invoices that are generated will receive automatic tax calculation.</p>
<p>For this feature to work properly, your customer's billing details, such as the customer's name, address, and tax ID, need to be synced to Stripe. You may use the <a href="#syncing-customer-data-with-stripe">customer data synchronization</a> and <a href="#tax-ids">Tax ID</a> methods offered by Cashier to accomplish this.</p>
<blockquote>
<p>{note} Unfortunately, for now, no tax is calculated for <a href="#single-charges">single charges</a> or <a href="#single-charge-checkouts">single charge checkouts</a>. In addition, Stripe Tax is currently "invite-only" during its beta period. You can request access to Stripe Tax via the <a href="https://stripe.com/tax#request-access">Stripe Tax website</a>.</p>
</blockquote>
<p><a class="dashAnchor" name="//apple_ref/Section/Logging"></a><a name="logging"></a></p>
<h3>Logging</h3>
<p>Cashier allows you to specify the log channel to be used when logging fatal Stripe errors. You may specify the log channel by defining the <code>CASHIER_LOGGER</code> environment variable within your application's <code>.env</code> file:</p>
<pre><code data-theme="olaolu-palenight" data-lang="ini" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">CASHIER_LOGGER</span><span style="color: #BFC7D5;">=stack</span></div></code></pre>
<p>Exceptions that are generated by API calls to Stripe will be logged through your application's default log channel.</p>
<p><a class="dashAnchor" name="//apple_ref/Section/Using%20Custom%20Models"></a><a name="using-custom-models"></a></p>
<h3>Using Custom Models</h3>
<p>You are free to extend the models used internally by Cashier by defining your own model and extending the corresponding Cashier model:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> Laravel\Cashier\</span><span style="color: #FFCB8B;">Subscription</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">as</span><span style="color: #BFC7D5;"> CashierSubscription;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #C792EA;">class</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB6B;">Subscription</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">extends</span><span style="color: #BFC7D5;"> </span><span style="color: #A9C77D;">CashierSubscription</span></div><div class="line"><span style="color: #BFC7D5;">{</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #697098;">//</span><span style="color: #697098;"> ...</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<p>After defining your model, you may instruct Cashier to use your custom model via the <code>Laravel\Cashier\Cashier</code> class. Typically, you should inform Cashier about your custom models in the <code>boot</code> method of your application's <code>App\Providers\AppServiceProvider</code> class:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> App\Models\Cashier\</span><span style="color: #FFCB8B;">Subscription</span><span style="color: #BFC7D5;">;</span></div><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> App\Models\Cashier\</span><span style="color: #FFCB8B;">SubscriptionItem</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #697098;">/**</span></div><div class="line"><span style="color: #697098;"> * Bootstrap any application services.</span></div><div class="line"><span style="color: #697098;"> *</span></div><div class="line"><span style="color: #697098;"> * </span><span style="color: #C792EA;">@return</span><span style="color: #697098;"> </span><span style="color: #C792EA;">void</span></div><div class="line"><span style="color: #697098;"> </span><span style="color: #697098;">*/</span></div><div class="line"><span style="color: #C792EA;">public</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">function</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">boot</span><span style="color: #D9F5DD;">()</span></div><div class="line"><span style="color: #BFC7D5;">{</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #FFCB8B;">Cashier</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">useSubscriptionModel</span><span style="color: #BFC7D5;">(</span><span style="color: #FFCB8B;">Subscription</span><span style="color: #89DDFF;">::</span><span style="color: #C792EA;">class</span><span style="color: #BFC7D5;">);</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #FFCB8B;">Cashier</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">useSubscriptionItemModel</span><span style="color: #BFC7D5;">(</span><span style="color: #FFCB8B;">SubscriptionItem</span><span style="color: #89DDFF;">::</span><span style="color: #C792EA;">class</span><span style="color: #BFC7D5;">);</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<p><a class="dashAnchor" name="//apple_ref/Section/Customers"></a><a name="customers"></a></p>
<h2>Customers</h2>
<p><a class="dashAnchor" name="//apple_ref/Section/Retrieving%20Customers"></a><a name="retrieving-customers"></a></p>
<h3>Retrieving Customers</h3>
<p>You can retrieve a customer by their Stripe ID using the <code>Cashier::findBillable</code> method. This method will return an instance of the billable model:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> Laravel\Cashier\</span><span style="color: #FFCB8B;">Cashier</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB8B;">Cashier</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">findBillable</span><span style="color: #BFC7D5;">(</span><span style="color: #BEC5D4;">$stripeId</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p><a class="dashAnchor" name="//apple_ref/Section/Creating%20Customers"></a><a name="creating-customers"></a></p>
<h3>Creating Customers</h3>
<p>Occasionally, you may wish to create a Stripe customer without beginning a subscription. You may accomplish this using the <code>createAsStripeCustomer</code> method:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$stripeCustomer</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">createAsStripeCustomer</span><span style="color: #BFC7D5;">();</span></div></code></pre>
<p>Once the customer has been created in Stripe, you may begin a subscription at a later date. You may provide an optional <code>$options</code> array to pass in any additional <a href="https://stripe.com/docs/api/customers/create">customer creation parameters that are supported by the Stripe API</a>:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$stripeCustomer</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">createAsStripeCustomer</span><span style="color: #BFC7D5;">(</span><span style="color: #BEC5D4;">$options</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p>You may use the <code>asStripeCustomer</code> method if you want to return the Stripe customer object for a billable model:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$stripeCustomer</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">asStripeCustomer</span><span style="color: #BFC7D5;">();</span></div></code></pre>
<p>The <code>createOrGetStripeCustomer</code> method may be used if you would like to retrieve the Stripe customer object for a given billable model but are not sure whether the billable model is already a customer within Stripe. This method will create a new customer in Stripe if one does not already exist:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$stripeCustomer</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">createOrGetStripeCustomer</span><span style="color: #BFC7D5;">();</span></div></code></pre>
<p><a class="dashAnchor" name="//apple_ref/Section/Updating%20Customers"></a><a name="updating-customers"></a></p>
<h3>Updating Customers</h3>
<p>Occasionally, you may wish to update the Stripe customer directly with additional information. You may accomplish this using the <code>updateStripeCustomer</code> method. This method accepts an array of <a href="https://stripe.com/docs/api/customers/update">customer update options supported by the Stripe API</a>:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$stripeCustomer</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">updateStripeCustomer</span><span style="color: #BFC7D5;">(</span><span style="color: #BEC5D4;">$options</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p><a class="dashAnchor" name="//apple_ref/Section/Balances"></a><a name="balances"></a></p>
<h3>Balances</h3>
<p>Stripe allows you to credit or debit a customer's "balance". Later, this balance will be credited or debited on new invoices. To check the customer's total balance you may use the <code>balance</code> method that is available on your billable model. The <code>balance</code> method will return a formatted string representation of the balance in the customer's currency:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$balance</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">balance</span><span style="color: #BFC7D5;">();</span></div></code></pre>
<p>To credit a customer's balance, you may provide a negative value to the <code>applyBalance</code> method. If you wish, you may also provide a description:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">applyBalance</span><span style="color: #BFC7D5;">(</span><span style="color: #89DDFF;">-</span><span style="color: #F78C6C;">500</span><span style="color: #BFC7D5;">, </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">Premium customer top-up.</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p>Providing a positive value to the <code>applyBalance</code> method will debit the customer's balance:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">applyBalance</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">300</span><span style="color: #BFC7D5;">, </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">Bad usage penalty.</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p>The <code>applyBalance</code> method will create new customer balance transactions for the customer. You may retrieve these transaction records using the <code>balanceTransactions</code> method, which may be useful in order to provide a log of credits and debits for the customer to review:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #697098;">//</span><span style="color: #697098;"> Retrieve all transactions...</span></div><div class="line"><span style="color: #BEC5D4;">$transactions</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">balanceTransactions</span><span style="color: #BFC7D5;">();</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #C792EA;">foreach</span><span style="color: #BFC7D5;"> (</span><span style="color: #BEC5D4;">$transactions</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">as</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$transaction</span><span style="color: #BFC7D5;">) {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #697098;">//</span><span style="color: #697098;"> Transaction amount...</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #BEC5D4;">$amount</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$transaction</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">amount</span><span style="color: #BFC7D5;">(); </span><span style="color: #697098;">//</span><span style="color: #697098;"> $2.31</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #697098;">//</span><span style="color: #697098;"> Retrieve the related invoice when available...</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #BEC5D4;">$invoice</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$transaction</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">invoice</span><span style="color: #BFC7D5;">();</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<p><a class="dashAnchor" name="//apple_ref/Section/Tax%20IDs"></a><a name="tax-ids"></a></p>
<h3>Tax IDs</h3>
<p>Cashier offers an easy way to manage a customer's tax IDs. For example, the <code>taxIds</code> method may be used to retrieve all of the <a href="https://stripe.com/docs/api/customer_tax_ids/object">tax IDs</a> that are assigned to a customer as a collection:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$taxIds</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">taxIds</span><span style="color: #BFC7D5;">();</span></div></code></pre>
<p>You can also retrieve a specific tax ID for a customer by its identifier:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$taxId</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">findTaxId</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">txi_belgium</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p>You may create a new Tax ID by providing a valid <a href="https://stripe.com/docs/api/customer_tax_ids/object#tax_id_object-type">type</a> and value to the <code>createTaxId</code> method:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$taxId</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">createTaxId</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">eu_vat</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">BE0123456789</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p>The <code>createTaxId</code> method will immediately add the VAT ID to the customer's account. <a href="https://stripe.com/docs/invoicing/customer/tax-ids#validation">Verification of VAT IDs is also done by Stripe</a>; however, this is an asynchronous process. You can be notified of verification updates by subscribing to the <code>customer.tax_id.updated</code> webhook event and inspecting <a href="https://stripe.com/docs/api/customer_tax_ids/object#tax_id_object-verification">the VAT IDs <code>verification</code> parameter</a>. For more information on handling webhooks, please consult the <a href="#handling-stripe-webhooks">documentation on defining webhook handlers</a>.</p>
<p>You may delete a tax ID using the <code>deleteTaxId</code> method:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">deleteTaxId</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">txi_belgium</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p><a class="dashAnchor" name="//apple_ref/Section/Syncing%20Customer%20Data%20With%20Stripe"></a><a name="syncing-customer-data-with-stripe"></a></p>
<h3>Syncing Customer Data With Stripe</h3>
<p>Typically, when your application's users update their name, email address, or other information that is also stored by Stripe, you should inform Stripe of the updates. By doing so, Stripe's copy of the information will be in sync with your application's.</p>
<p>To automate this, you may define an event listener on your billable model that reacts to the model's <code>updated</code> event. Then, within your event listener, you may invoke the <code>syncStripeCustomerDetails</code> method on the model:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">function</span><span style="color: #BFC7D5;"> Illuminate\Events\</span><span style="color: #FFCB8B;">queueable</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #697098;">/**</span></div><div class="line"><span style="color: #697098;"> * The "booted" method of the model.</span></div><div class="line"><span style="color: #697098;"> *</span></div><div class="line"><span style="color: #697098;"> * </span><span style="color: #C792EA;">@return</span><span style="color: #697098;"> </span><span style="color: #C792EA;">void</span></div><div class="line"><span style="color: #697098;"> </span><span style="color: #697098;">*/</span></div><div class="line"><span style="color: #C792EA;">protected</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">static</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">function</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">booted</span><span style="color: #D9F5DD;">()</span></div><div class="line"><span style="color: #BFC7D5;">{</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #C792EA;">static</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">updated</span><span style="color: #BFC7D5;">(</span><span style="color: #82AAFF;">queueable</span><span style="color: #BFC7D5;">(</span><span style="color: #C792EA;">function</span><span style="color: #82AAFF;"> </span><span style="color: #D9F5DD;">(</span><span style="color: #BFC7D5;">$</span><span style="color: #BEC5D4;">customer</span><span style="color: #D9F5DD;">)</span><span style="color: #82AAFF;"> </span><span style="color: #BFC7D5;">{</span></div><div class="line"><span style="color: #82AAFF;">        </span><span style="color: #C792EA;">if</span><span style="color: #82AAFF;"> </span><span style="color: #BFC7D5;">($</span><span style="color: #BEC5D4;">customer</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">hasStripeId</span><span style="color: #BFC7D5;">())</span><span style="color: #82AAFF;"> </span><span style="color: #BFC7D5;">{</span></div><div class="line"><span style="color: #82AAFF;">            </span><span style="color: #BFC7D5;">$</span><span style="color: #BEC5D4;">customer</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">syncStripeCustomerDetails</span><span style="color: #BFC7D5;">();</span></div><div class="line"><span style="color: #82AAFF;">        </span><span style="color: #BFC7D5;">}</span></div><div class="line"><span style="color: #82AAFF;">    </span><span style="color: #BFC7D5;">}));</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<p>Now, every time your customer model is updated, its information will be synced with Stripe. For convenience, Cashier will automatically sync your customer's information with Stripe on the initial creation of the customer.</p>
<p>You may customize the columns used for syncing customer information to Stripe by overriding a variety of methods provided by Cashier. For example, you may override the <code>stripeName</code> method to customize the attribute that should be considered the customer's "name" when Cashier syncs customer information to Stripe:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #697098;">/**</span></div><div class="line"><span style="color: #697098;"> * Get the customer name that should be synced to Stripe.</span></div><div class="line"><span style="color: #697098;"> *</span></div><div class="line"><span style="color: #697098;"> * </span><span style="color: #C792EA;">@return</span><span style="color: #697098;"> </span><span style="color: #C792EA;">string</span><span style="color: #697098;">|</span><span style="color: #C792EA;">null</span></div><div class="line"><span style="color: #697098;"> </span><span style="color: #697098;">*/</span></div><div class="line"><span style="color: #C792EA;">public</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">function</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">stripeName</span><span style="color: #D9F5DD;">()</span></div><div class="line"><span style="color: #BFC7D5;">{</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #C792EA;">return</span><span style="color: #BFC7D5;"> </span><span style="color: #FF5572;">$this</span><span style="color: #89DDFF;">-&gt;company_name</span><span style="color: #BFC7D5;">;</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<p>Similarly, you may override the <code>stripeEmail</code>, <code>stripePhone</code>, and <code>stripeAddress</code> methods. These methods will sync information to their corresponding customer parameters when <a href="https://stripe.com/docs/api/customers/update">updating the Stripe customer object</a>. If you wish to take total control over the customer information sync process, you may override the <code>syncStripeCustomerDetails</code> method.</p>
<p><a class="dashAnchor" name="//apple_ref/Section/Billing%20Portal"></a><a name="billing-portal"></a></p>
<h3>Billing Portal</h3>
<p>Stripe offers <a href="https://stripe.com/docs/billing/subscriptions/customer-portal">an easy way to set up a billing portal</a> so that your customer can manage their subscription, payment methods, and view their billing history. You can redirect your users to the billing portal by invoking the <code>redirectToBillingPortal</code> method on the billable model from a controller or route:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> Illuminate\Http\</span><span style="color: #FFCB8B;">Request</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #FFCB8B;">Route</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">get</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">/billing-portal</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #C792EA;">function</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">(</span><span style="color: #FFCB8B;">Request</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$request</span><span style="color: #D9F5DD;">)</span><span style="color: #BFC7D5;"> {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #C792EA;">return</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$request</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">user</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">redirectToBillingPortal</span><span style="color: #BFC7D5;">();</span></div><div class="line"><span style="color: #BFC7D5;">});</span></div></code></pre>
<p>By default, when the user is finished managing their subscription, they will be able to return to the <code>home</code> route of your application via a link within the Stripe billing portal. You may provide a custom URL that the user should return to by passing the URL as an argument to the <code>redirectToBillingPortal</code> method:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> Illuminate\Http\</span><span style="color: #FFCB8B;">Request</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #FFCB8B;">Route</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">get</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">/billing-portal</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #C792EA;">function</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">(</span><span style="color: #FFCB8B;">Request</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$request</span><span style="color: #D9F5DD;">)</span><span style="color: #BFC7D5;"> {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #C792EA;">return</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$request</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">user</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">redirectToBillingPortal</span><span style="color: #BFC7D5;">(</span><span style="color: #82AAFF;">route</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">billing</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">));</span></div><div class="line"><span style="color: #BFC7D5;">});</span></div></code></pre>
<p>If you would like to generate the URL to the billing portal without generating an HTTP redirect response, you may invoke the <code>billingPortalUrl</code> method:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$url</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$request</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">user</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">billingPortalUrl</span><span style="color: #BFC7D5;">(</span><span style="color: #82AAFF;">route</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">billing</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">));</span></div></code></pre>
<p><a class="dashAnchor" name="//apple_ref/Section/Payment%20Methods"></a><a name="payment-methods"></a></p>
<h2>Payment Methods</h2>
<p><a class="dashAnchor" name="//apple_ref/Section/Storing%20Payment%20Methods"></a><a name="storing-payment-methods"></a></p>
<h3>Storing Payment Methods</h3>
<p>In order to create subscriptions or perform "one off" charges with Stripe, you will need to store a payment method and retrieve its identifier from Stripe. The approach used to accomplish this differs based on whether you plan to use the payment method for subscriptions or single charges, so we will examine both below.</p>
<p><a name="payment-methods-for-subscriptions"></a></p>
<h4>Payment Methods For Subscriptions</h4>
<p>When storing a customer's credit card information for future use by a subscription, the Stripe "Setup Intents" API must be used to securely gather the customer's payment method details. A "Setup Intent" indicates to Stripe the intention to charge a customer's payment method. Cashier's <code>Billable</code> trait includes the <code>createSetupIntent</code> method to easily create a new Setup Intent. You should invoke this method from the route or controller that will render the form which gathers your customer's payment method details:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">return</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">view</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">update-payment-method</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">,</span><span style="color: #82AAFF;"> </span><span style="color: #BFC7D5;">[</span></div><div class="line"><span style="color: #82AAFF;">    </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">intent</span><span style="color: #D9F5DD;">'</span><span style="color: #82AAFF;"> </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #82AAFF;"> </span><span style="color: #BFC7D5;">$</span><span style="color: #BEC5D4;">user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">createSetupIntent</span><span style="color: #BFC7D5;">()</span></div><div class="line"><span style="color: #BFC7D5;">]);</span></div></code></pre>
<p>After you have created the Setup Intent and passed it to the view, you should attach its secret to the element that will gather the payment method. For example, consider this "update payment method" form:</p>
<pre><code data-theme="olaolu-palenight" data-lang="html" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #89DDFF;">&lt;</span><span style="color: #FF5572;">input</span><span style="color: #89DDFF;"> </span><span style="color: #FFCB6B;">id</span><span style="color: #89DDFF;">=</span><span style="color: #D9F5DD;">"</span><span style="color: #C3E88D;">card-holder-name</span><span style="color: #D9F5DD;">"</span><span style="color: #89DDFF;"> </span><span style="color: #FFCB6B;">type</span><span style="color: #89DDFF;">=</span><span style="color: #D9F5DD;">"</span><span style="color: #C3E88D;">text</span><span style="color: #D9F5DD;">"</span><span style="color: #89DDFF;">&gt;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #697098;">&lt;!--</span><span style="color: #697098;"> Stripe Elements Placeholder </span><span style="color: #697098;">--&gt;</span></div><div class="line"><span style="color: #89DDFF;">&lt;</span><span style="color: #FF5572;">div</span><span style="color: #89DDFF;"> </span><span style="color: #FFCB6B;">id</span><span style="color: #89DDFF;">=</span><span style="color: #D9F5DD;">"</span><span style="color: #C3E88D;">card-element</span><span style="color: #D9F5DD;">"</span><span style="color: #89DDFF;">&gt;&lt;/</span><span style="color: #FF5572;">div</span><span style="color: #89DDFF;">&gt;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #89DDFF;">&lt;</span><span style="color: #FF5572;">button</span><span style="color: #89DDFF;"> </span><span style="color: #FFCB6B;">id</span><span style="color: #89DDFF;">=</span><span style="color: #D9F5DD;">"</span><span style="color: #C3E88D;">card-button</span><span style="color: #D9F5DD;">"</span><span style="color: #89DDFF;"> </span><span style="color: #FFCB6B;">data-secret</span><span style="color: #89DDFF;">=</span><span style="color: #D9F5DD;">"</span><span style="color: #C3E88D;">{{ $intent-&gt;client_secret }}</span><span style="color: #D9F5DD;">"</span><span style="color: #89DDFF;">&gt;</span></div><div class="line"><span style="color: #BFC7D5;">    Update Payment Method</span></div><div class="line"><span style="color: #89DDFF;">&lt;/</span><span style="color: #FF5572;">button</span><span style="color: #89DDFF;">&gt;</span></div></code></pre>
<p>Next, the Stripe.js library may be used to attach a <a href="https://stripe.com/docs/stripe-js">Stripe Element</a> to the form and securely gather the customer's payment details:</p>
<pre><code data-theme="olaolu-palenight" data-lang="html" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #89DDFF;">&lt;</span><span style="color: #FF5572;">script</span><span style="color: #89DDFF;"> </span><span style="color: #FFCB6B;">src</span><span style="color: #89DDFF;">=</span><span style="color: #D9F5DD;">"</span><span style="color: #C3E88D;">https://js.stripe.com/v3/</span><span style="color: #D9F5DD;">"</span><span style="color: #89DDFF;">&gt;&lt;/</span><span style="color: #FF5572;">script</span><span style="color: #89DDFF;">&gt;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #89DDFF;">&lt;</span><span style="color: #FF5572;">script</span><span style="color: #89DDFF;">&gt;</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #C792EA;">const</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">stripe</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">Stripe</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">stripe-public-key</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #C792EA;">const</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">elements</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> stripe</span><span style="color: #C792EA;">.</span><span style="color: #82AAFF;">elements</span><span style="color: #BFC7D5;">();</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #C792EA;">const</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">cardElement</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> elements</span><span style="color: #C792EA;">.</span><span style="color: #82AAFF;">create</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">card</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BFC7D5;">    cardElement</span><span style="color: #C792EA;">.</span><span style="color: #82AAFF;">mount</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">#card-element</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div><div class="line"><span style="color: #89DDFF;">&lt;/</span><span style="color: #FF5572;">script</span><span style="color: #89DDFF;">&gt;</span></div></code></pre>
<p>Next, the card can be verified and a secure "payment method identifier" can be retrieved from Stripe using <a href="https://stripe.com/docs/js/setup_intents/confirm_card_setup">Stripe's <code>confirmCardSetup</code> method</a>:</p>
<pre><code data-theme="olaolu-palenight" data-lang="js" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">const</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">cardHolderName</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> document</span><span style="color: #C792EA;">.</span><span style="color: #82AAFF;">getElementById</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">card-holder-name</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div><div class="line"><span style="color: #C792EA;">const</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">cardButton</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> document</span><span style="color: #C792EA;">.</span><span style="color: #82AAFF;">getElementById</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">card-button</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div><div class="line"><span style="color: #C792EA;">const</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">clientSecret</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> cardButton</span><span style="color: #C792EA;">.</span><span style="color: #89DDFF;">dataset</span><span style="color: #C792EA;">.</span><span style="color: #89DDFF;">secret</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BFC7D5;">cardButton</span><span style="color: #C792EA;">.</span><span style="color: #82AAFF;">addEventListener</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">click</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #C792EA;">async</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">(</span><span style="color: #7986E7;">e</span><span style="color: #D9F5DD;">)</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=&gt;</span><span style="color: #BFC7D5;"> {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #C792EA;">const</span><span style="color: #BFC7D5;"> { </span><span style="color: #82AAFF;">setupIntent</span><span style="color: #BFC7D5;">, </span><span style="color: #82AAFF;">error</span><span style="color: #BFC7D5;"> } </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">await</span><span style="color: #BFC7D5;"> stripe</span><span style="color: #C792EA;">.</span><span style="color: #82AAFF;">confirmCardSetup</span><span style="color: #BFC7D5;">(</span></div><div class="line"><span style="color: #BFC7D5;">        clientSecret, {</span></div><div class="line"><span style="color: #BFC7D5;">            payment_method: {</span></div><div class="line"><span style="color: #BFC7D5;">                card: cardElement,</span></div><div class="line"><span style="color: #BFC7D5;">                billing_details: { name: cardHolderName</span><span style="color: #C792EA;">.</span><span style="color: #89DDFF;">value</span><span style="color: #BFC7D5;"> }</span></div><div class="line"><span style="color: #BFC7D5;">            }</span></div><div class="line"><span style="color: #BFC7D5;">        }</span></div><div class="line"><span style="color: #BFC7D5;">    );</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #C792EA;">if</span><span style="color: #BFC7D5;"> (error) {</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #697098;">//</span><span style="color: #697098;"> Display "error.message" to the user...</span></div><div class="line"><span style="color: #BFC7D5;">    } </span><span style="color: #C792EA;">else</span><span style="color: #BFC7D5;"> {</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #697098;">//</span><span style="color: #697098;"> The card has been verified successfully...</span></div><div class="line"><span style="color: #BFC7D5;">    }</span></div><div class="line"><span style="color: #BFC7D5;">});</span></div></code></pre>
<p>After the card has been verified by Stripe, you may pass the resulting <code>setupIntent.payment_method</code> identifier to your Laravel application, where it can be attached to the customer. The payment method can either be <a href="#adding-payment-methods">added as a new payment method</a> or <a href="#updating-the-default-payment-method">used to update the default payment method</a>. You can also immediately use the payment method identifier to <a href="#creating-subscriptions">create a new subscription</a>.</p>
<blockquote>
<p>{tip} If you would like more information about Setup Intents and gathering customer payment details please <a href="https://stripe.com/docs/payments/save-and-reuse#php">review this overview provided by Stripe</a>.</p>
</blockquote>
<p><a name="payment-methods-for-single-charges"></a></p>
<h4>Payment Methods For Single Charges</h4>
<p>Of course, when making a single charge against a customer's payment method, we will only need to use a payment method identifier once. Due to Stripe limitations, you may not use the stored default payment method of a customer for single charges. You must allow the customer to enter their payment method details using the Stripe.js library. For example, consider the following form:</p>
<pre><code data-theme="olaolu-palenight" data-lang="html" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #89DDFF;">&lt;</span><span style="color: #FF5572;">input</span><span style="color: #89DDFF;"> </span><span style="color: #FFCB6B;">id</span><span style="color: #89DDFF;">=</span><span style="color: #D9F5DD;">"</span><span style="color: #C3E88D;">card-holder-name</span><span style="color: #D9F5DD;">"</span><span style="color: #89DDFF;"> </span><span style="color: #FFCB6B;">type</span><span style="color: #89DDFF;">=</span><span style="color: #D9F5DD;">"</span><span style="color: #C3E88D;">text</span><span style="color: #D9F5DD;">"</span><span style="color: #89DDFF;">&gt;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #697098;">&lt;!--</span><span style="color: #697098;"> Stripe Elements Placeholder </span><span style="color: #697098;">--&gt;</span></div><div class="line"><span style="color: #89DDFF;">&lt;</span><span style="color: #FF5572;">div</span><span style="color: #89DDFF;"> </span><span style="color: #FFCB6B;">id</span><span style="color: #89DDFF;">=</span><span style="color: #D9F5DD;">"</span><span style="color: #C3E88D;">card-element</span><span style="color: #D9F5DD;">"</span><span style="color: #89DDFF;">&gt;&lt;/</span><span style="color: #FF5572;">div</span><span style="color: #89DDFF;">&gt;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #89DDFF;">&lt;</span><span style="color: #FF5572;">button</span><span style="color: #89DDFF;"> </span><span style="color: #FFCB6B;">id</span><span style="color: #89DDFF;">=</span><span style="color: #D9F5DD;">"</span><span style="color: #C3E88D;">card-button</span><span style="color: #D9F5DD;">"</span><span style="color: #89DDFF;">&gt;</span></div><div class="line"><span style="color: #BFC7D5;">    Process Payment</span></div><div class="line"><span style="color: #89DDFF;">&lt;/</span><span style="color: #FF5572;">button</span><span style="color: #89DDFF;">&gt;</span></div></code></pre>
<p>After defining such a form, the Stripe.js library may be used to attach a <a href="https://stripe.com/docs/stripe-js">Stripe Element</a> to the form and securely gather the customer's payment details:</p>
<pre><code data-theme="olaolu-palenight" data-lang="html" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #89DDFF;">&lt;</span><span style="color: #FF5572;">script</span><span style="color: #89DDFF;"> </span><span style="color: #FFCB6B;">src</span><span style="color: #89DDFF;">=</span><span style="color: #D9F5DD;">"</span><span style="color: #C3E88D;">https://js.stripe.com/v3/</span><span style="color: #D9F5DD;">"</span><span style="color: #89DDFF;">&gt;&lt;/</span><span style="color: #FF5572;">script</span><span style="color: #89DDFF;">&gt;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #89DDFF;">&lt;</span><span style="color: #FF5572;">script</span><span style="color: #89DDFF;">&gt;</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #C792EA;">const</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">stripe</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">Stripe</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">stripe-public-key</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #C792EA;">const</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">elements</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> stripe</span><span style="color: #C792EA;">.</span><span style="color: #82AAFF;">elements</span><span style="color: #BFC7D5;">();</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #C792EA;">const</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">cardElement</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> elements</span><span style="color: #C792EA;">.</span><span style="color: #82AAFF;">create</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">card</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BFC7D5;">    cardElement</span><span style="color: #C792EA;">.</span><span style="color: #82AAFF;">mount</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">#card-element</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div><div class="line"><span style="color: #89DDFF;">&lt;/</span><span style="color: #FF5572;">script</span><span style="color: #89DDFF;">&gt;</span></div></code></pre>
<p>Next, the card can be verified and a secure "payment method identifier" can be retrieved from Stripe using <a href="https://stripe.com/docs/stripe-js/reference#stripe-create-payment-method">Stripe's <code>createPaymentMethod</code> method</a>:</p>
<pre><code data-theme="olaolu-palenight" data-lang="js" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">const</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">cardHolderName</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> document</span><span style="color: #C792EA;">.</span><span style="color: #82AAFF;">getElementById</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">card-holder-name</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div><div class="line"><span style="color: #C792EA;">const</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">cardButton</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> document</span><span style="color: #C792EA;">.</span><span style="color: #82AAFF;">getElementById</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">card-button</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BFC7D5;">cardButton</span><span style="color: #C792EA;">.</span><span style="color: #82AAFF;">addEventListener</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">click</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #C792EA;">async</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">(</span><span style="color: #7986E7;">e</span><span style="color: #D9F5DD;">)</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=&gt;</span><span style="color: #BFC7D5;"> {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #C792EA;">const</span><span style="color: #BFC7D5;"> { </span><span style="color: #82AAFF;">paymentMethod</span><span style="color: #BFC7D5;">, </span><span style="color: #82AAFF;">error</span><span style="color: #BFC7D5;"> } </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">await</span><span style="color: #BFC7D5;"> stripe</span><span style="color: #C792EA;">.</span><span style="color: #82AAFF;">createPaymentMethod</span><span style="color: #BFC7D5;">(</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">card</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, cardElement, {</span></div><div class="line"><span style="color: #BFC7D5;">            billing_details: { name: cardHolderName</span><span style="color: #C792EA;">.</span><span style="color: #89DDFF;">value</span><span style="color: #BFC7D5;"> }</span></div><div class="line"><span style="color: #BFC7D5;">        }</span></div><div class="line"><span style="color: #BFC7D5;">    );</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #C792EA;">if</span><span style="color: #BFC7D5;"> (error) {</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #697098;">//</span><span style="color: #697098;"> Display "error.message" to the user...</span></div><div class="line"><span style="color: #BFC7D5;">    } </span><span style="color: #C792EA;">else</span><span style="color: #BFC7D5;"> {</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #697098;">//</span><span style="color: #697098;"> The card has been verified successfully...</span></div><div class="line"><span style="color: #BFC7D5;">    }</span></div><div class="line"><span style="color: #BFC7D5;">});</span></div></code></pre>
<p>If the card is verified successfully, you may pass the <code>paymentMethod.id</code> to your Laravel application and process a <a href="#simple-charge">single charge</a>.</p>
<p><a class="dashAnchor" name="//apple_ref/Section/Retrieving%20Payment%20Methods"></a><a name="retrieving-payment-methods"></a></p>
<h3>Retrieving Payment Methods</h3>
<p>The <code>paymentMethods</code> method on the billable model instance returns a collection of <code>Laravel\Cashier\PaymentMethod</code> instances:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$paymentMethods</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">paymentMethods</span><span style="color: #BFC7D5;">();</span></div></code></pre>
<p>By default, this method will return payment methods of the <code>card</code> type. To retrieve payment methods of a different type, you may pass the <code>type</code> as an argument to the method:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$paymentMethods</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">paymentMethods</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">sepa_debit</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p>To retrieve the customer's default payment method, the <code>defaultPaymentMethod</code> method may be used:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$paymentMethod</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">defaultPaymentMethod</span><span style="color: #BFC7D5;">();</span></div></code></pre>
<p>You can retrieve a specific payment method that is attached to the billable model using the <code>findPaymentMethod</code> method:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$paymentMethod</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">findPaymentMethod</span><span style="color: #BFC7D5;">(</span><span style="color: #BEC5D4;">$paymentMethodId</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p><a class="dashAnchor" name="//apple_ref/Section/Determining%20If%20A%20User%20Has%20A%20Payment%20Method"></a><a name="check-for-a-payment-method"></a></p>
<h3>Determining If A User Has A Payment Method</h3>
<p>To determine if a billable model has a default payment method attached to their account, invoke the <code>hasDefaultPaymentMethod</code> method:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">if</span><span style="color: #BFC7D5;"> (</span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">hasDefaultPaymentMethod</span><span style="color: #BFC7D5;">()) {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #697098;">//</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<p>You may use the <code>hasPaymentMethod</code> method to determine if a billable model has at least one payment method attached to their account:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">if</span><span style="color: #BFC7D5;"> (</span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">hasPaymentMethod</span><span style="color: #BFC7D5;">()) {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #697098;">//</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<p>This method will determine if the billable model has payment methods of the <code>card</code> type. To determine if a payment method of another type exists for the model, you may pass the <code>type</code> as an argument to the method:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">if</span><span style="color: #BFC7D5;"> (</span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">hasPaymentMethod</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">sepa_debit</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)) {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #697098;">//</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<p><a class="dashAnchor" name="//apple_ref/Section/Updating%20The%20Default%20Payment%20Method"></a><a name="updating-the-default-payment-method"></a></p>
<h3>Updating The Default Payment Method</h3>
<p>The <code>updateDefaultPaymentMethod</code> method may be used to update a customer's default payment method information. This method accepts a Stripe payment method identifier and will assign the new payment method as the default billing payment method:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">updateDefaultPaymentMethod</span><span style="color: #BFC7D5;">(</span><span style="color: #BEC5D4;">$paymentMethod</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p>To sync your default payment method information with the customer's default payment method information in Stripe, you may use the <code>updateDefaultPaymentMethodFromStripe</code> method:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">updateDefaultPaymentMethodFromStripe</span><span style="color: #BFC7D5;">();</span></div></code></pre>
<blockquote>
<p>{note} The default payment method on a customer can only be used for invoicing and creating new subscriptions. Due to limitations imposed by Stripe, it may not be used for single charges.</p>
</blockquote>
<p><a class="dashAnchor" name="//apple_ref/Section/Adding%20Payment%20Methods"></a><a name="adding-payment-methods"></a></p>
<h3>Adding Payment Methods</h3>
<p>To add a new payment method, you may call the <code>addPaymentMethod</code> method on the billable model, passing the payment method identifier:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">addPaymentMethod</span><span style="color: #BFC7D5;">(</span><span style="color: #BEC5D4;">$paymentMethod</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<blockquote>
<p>{tip} To learn how to retrieve payment method identifiers please review the <a href="#storing-payment-methods">payment method storage documentation</a>.</p>
</blockquote>
<p><a class="dashAnchor" name="//apple_ref/Section/Deleting%20Payment%20Methods"></a><a name="deleting-payment-methods"></a></p>
<h3>Deleting Payment Methods</h3>
<p>To delete a payment method, you may call the <code>delete</code> method on the <code>Laravel\Cashier\PaymentMethod</code> instance you wish to delete:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$paymentMethod</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">delete</span><span style="color: #BFC7D5;">();</span></div></code></pre>
<p>The <code>deletePaymentMethod</code> method will delete a specific payment method from the billable model:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">deletePaymentMethod</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">pm_visa</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p>The <code>deletePaymentMethods</code> method will delete all of the payment method information for the billable model:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">deletePaymentMethods</span><span style="color: #BFC7D5;">();</span></div></code></pre>
<p>By default, this method will delete payment methods of the <code>card</code> type. To delete payment methods of a different type you can pass the <code>type</code> as an argument to the method:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">deletePaymentMethods</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">sepa_debit</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<blockquote>
<p>{note} If a user has an active subscription, your application should not allow them to delete their default payment method.</p>
</blockquote>
<p><a class="dashAnchor" name="//apple_ref/Section/Subscriptions"></a><a name="subscriptions"></a></p>
<h2>Subscriptions</h2>
<p>Subscriptions provide a way to set up recurring payments for your customers. Stripe subscriptions managed by Cashier provide support for multiple subscription prices, subscription quantities, trials, and more.</p>
<p><a class="dashAnchor" name="//apple_ref/Section/Creating%20Subscriptions"></a><a name="creating-subscriptions"></a></p>
<h3>Creating Subscriptions</h3>
<p>To create a subscription, first retrieve an instance of your billable model, which typically will be an instance of <code>App\Models\User</code>. Once you have retrieved the model instance, you may use the <code>newSubscription</code> method to create the model's subscription:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> Illuminate\Http\</span><span style="color: #FFCB8B;">Request</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #FFCB8B;">Route</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">post</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">/user/subscribe</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #C792EA;">function</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">(</span><span style="color: #FFCB8B;">Request</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$request</span><span style="color: #D9F5DD;">)</span><span style="color: #BFC7D5;"> {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #BEC5D4;">$request</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">user</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">newSubscription</span><span style="color: #BFC7D5;">(</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_monthly</span><span style="color: #D9F5DD;">'</span></div><div class="line"><span style="color: #BFC7D5;">    )</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">create</span><span style="color: #BFC7D5;">(</span><span style="color: #BEC5D4;">$request</span><span style="color: #89DDFF;">-&gt;paymentMethodId</span><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #697098;">//</span><span style="color: #697098;"> ...</span></div><div class="line"><span style="color: #BFC7D5;">});</span></div></code></pre>
<p>The first argument passed to the <code>newSubscription</code> method should be the internal name of the subscription. If your application only offers a single subscription, you might call this <code>default</code> or <code>primary</code>. This subscription name is only for internal application usage and is not meant to be shown to users. In addition, it should not contain spaces and it should never be changed after creating the subscription. The second argument is the specific price the user is subscribing to. This value should correspond to the price's identifier in Stripe.</p>
<p>The <code>create</code> method, which accepts <a href="#storing-payment-methods">a Stripe payment method identifier</a> or Stripe <code>PaymentMethod</code> object, will begin the subscription as well as update your database with the billable model's Stripe customer ID and other relevant billing information.</p>
<blockquote>
<p>{note} Passing a payment method identifier directly to the <code>create</code> subscription method will also automatically add it to the user's stored payment methods.</p>
</blockquote>
<p><a name="collecting-recurring-payments-via-invoice-emails"></a></p>
<h4>Collecting Recurring Payments Via Invoice Emails</h4>
<p>Instead of collecting a customer's recurring payments automatically, you may instruct Stripe to email an invoice to the customer each time their recurring payment is due. Then, the customer may manually pay the invoice once they receive it. The customer does not need to provide a payment method up front when collecting recurring payments via invoices:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">newSubscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_monthly</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">createAndSendInvoice</span><span style="color: #BFC7D5;">();</span></div></code></pre>
<p>The amount of time a customer has to pay their invoice before their subscription is canceled is determined by your subscription and invoice settings within the <a href="https://dashboard.stripe.com/settings/billing/automatic">Stripe dashboard</a>.</p>
<p><a name="subscription-quantities"></a></p>
<h4>Quantities</h4>
<p>If you would like to set a specific <a href="https://stripe.com/docs/billing/subscriptions/quantities">quantity</a> for the price when creating the subscription, you should invoke the <code>quantity</code> method on the subscription builder before creating the subscription:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">newSubscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_monthly</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span></div><div class="line"><span style="color: #BFC7D5;">     </span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">quantity</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">5</span><span style="color: #BFC7D5;">)</span></div><div class="line"><span style="color: #BFC7D5;">     </span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">create</span><span style="color: #BFC7D5;">(</span><span style="color: #BEC5D4;">$paymentMethod</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p><a name="additional-details"></a></p>
<h4>Additional Details</h4>
<p>If you would like to specify additional <a href="https://stripe.com/docs/api/customers/create">customer</a> or <a href="https://stripe.com/docs/api/subscriptions/create">subscription</a> options supported by Stripe, you may do so by passing them as the second and third arguments to the <code>create</code> method:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">newSubscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_monthly</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">create</span><span style="color: #BFC7D5;">(</span><span style="color: #BEC5D4;">$paymentMethod</span><span style="color: #BFC7D5;">, [</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">email</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;"> </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$email</span><span style="color: #BFC7D5;">,</span></div><div class="line"><span style="color: #BFC7D5;">], [</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">metadata</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;"> </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #BFC7D5;"> [</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">note</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;"> </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">Some extra information.</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">],</span></div><div class="line"><span style="color: #BFC7D5;">]);</span></div></code></pre>
<p><a name="coupons"></a></p>
<h4>Coupons</h4>
<p>If you would like to apply a coupon when creating the subscription, you may use the <code>withCoupon</code> method:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">newSubscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_monthly</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span></div><div class="line"><span style="color: #BFC7D5;">     </span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">withCoupon</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">code</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span></div><div class="line"><span style="color: #BFC7D5;">     </span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">create</span><span style="color: #BFC7D5;">(</span><span style="color: #BEC5D4;">$paymentMethod</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p>Or, if you would like to apply a <a href="https://stripe.com/docs/billing/subscriptions/discounts/codes">Stripe promotion code</a>, you may use the <code>withPromotionCode</code> method. The given promotion code ID should be the Stripe API ID assigned to the promotion code and not the customer facing promotion code:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">newSubscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_monthly</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span></div><div class="line"><span style="color: #BFC7D5;">     </span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">withPromotionCode</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">promo_code</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span></div><div class="line"><span style="color: #BFC7D5;">     </span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">create</span><span style="color: #BFC7D5;">(</span><span style="color: #BEC5D4;">$paymentMethod</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p><a name="adding-subscriptions"></a></p>
<h4>Adding Subscriptions</h4>
<p>If you would like to add a subscription to a customer who already has a default payment method you may invoke the <code>add</code> method on the subscription builder:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> App\Models\</span><span style="color: #FFCB8B;">User</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB8B;">User</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">find</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">1</span><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">newSubscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_monthly</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">add</span><span style="color: #BFC7D5;">();</span></div></code></pre>
<p><a name="creating-subscriptions-from-the-stripe-dashboard"></a></p>
<h4>Creating Subscriptions From The Stripe Dashboard</h4>
<p>You may also create subscriptions from the Stripe dashboard itself. When doing so, Cashier will sync newly added subscriptions and assign them a name of <code>default</code>. To customize the subscription name that is assigned to dashboard created subscriptions, <a href="billing.html#defining-webhook-event-handlers">extend the <code>WebhookController</code></a> and overwrite the <code>newSubscriptionName</code> method.</p>
<p>In addition, you may only create one type of subscription via the Stripe dashboard. If your application offers multiple subscriptions that use different names, only one type of subscription may be added through the Stripe dashboard.</p>
<p>Finally, you should always make sure to only add one active subscription per type of subscription offered by your application. If customer has two <code>default</code> subscriptions, only the most recently added subscription will be used by Cashier even though both would be synced with your application's database.</p>
<p><a class="dashAnchor" name="//apple_ref/Section/Checking%20Subscription%20Status"></a><a name="checking-subscription-status"></a></p>
<h3>Checking Subscription Status</h3>
<p>Once a customer is subscribed to your application, you may easily check their subscription status using a variety of convenient methods. First, the <code>subscribed</code> method returns <code>true</code> if the customer has an active subscription, even if the subscription is currently within its trial period. The <code>subscribed</code> method accepts the name of the subscription as its first argument:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">if</span><span style="color: #BFC7D5;"> (</span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscribed</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)) {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #697098;">//</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<p>The <code>subscribed</code> method also makes a great candidate for a <a href="middleware.html">route middleware</a>, allowing you to filter access to routes and controllers based on the user's subscription status:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">&lt;</span><span style="color: #89DDFF;">?</span><span style="color: #82AAFF;">php</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #C792EA;">namespace</span><span style="color: #BFC7D5;"> App\Http\Middleware;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB8B;">Closure</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #C792EA;">class</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB6B;">EnsureUserIsSubscribed</span></div><div class="line"><span style="color: #BFC7D5;">{</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #697098;">/**</span></div><div class="line"><span style="color: #697098;">     * Handle an incoming request.</span></div><div class="line"><span style="color: #697098;">     *</span></div><div class="line"><span style="color: #697098;">     * </span><span style="color: #C792EA;">@param</span><span style="color: #697098;">  </span><span style="color: #697098;">\</span><span style="color: #697098;">Illuminate</span><span style="color: #697098;">\</span><span style="color: #697098;">Http</span><span style="color: #697098;">\</span><span style="color: #FFCB8B;">Request</span><span style="color: #697098;">  $request</span></div><div class="line"><span style="color: #697098;">     * </span><span style="color: #C792EA;">@param</span><span style="color: #697098;">  </span><span style="color: #697098;">\</span><span style="color: #FFCB8B;">Closure</span><span style="color: #697098;">  $next</span></div><div class="line"><span style="color: #697098;">     * </span><span style="color: #C792EA;">@return</span><span style="color: #697098;"> </span><span style="color: #C792EA;">mixed</span></div><div class="line"><span style="color: #697098;">     </span><span style="color: #697098;">*/</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #C792EA;">public</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">function</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">handle</span><span style="color: #D9F5DD;">(</span><span style="color: #BEC5D4;">$request</span><span style="color: #BFC7D5;">, </span><span style="color: #FFCB8B;">Closure</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$next</span><span style="color: #D9F5DD;">)</span></div><div class="line"><span style="color: #BFC7D5;">    {</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #C792EA;">if</span><span style="color: #BFC7D5;"> (</span><span style="color: #BEC5D4;">$request</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">user</span><span style="color: #BFC7D5;">() </span><span style="color: #C792EA;">&amp;&amp;</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">!</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$request</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">user</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscribed</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)) {</span></div><div class="line"><span style="color: #BFC7D5;">            </span><span style="color: #697098;">//</span><span style="color: #697098;"> This user is not a paying customer...</span></div><div class="line"><span style="color: #BFC7D5;">            </span><span style="color: #C792EA;">return</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">redirect</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">billing</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div><div class="line"><span style="color: #BFC7D5;">        }</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #C792EA;">return</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$next</span><span style="color: #BFC7D5;">(</span><span style="color: #BEC5D4;">$request</span><span style="color: #BFC7D5;">);</span></div><div class="line"><span style="color: #BFC7D5;">    }</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<p>If you would like to determine if a user is still within their trial period, you may use the <code>onTrial</code> method. This method can be useful for determining if you should display a warning to the user that they are still on their trial period:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">if</span><span style="color: #BFC7D5;"> (</span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">onTrial</span><span style="color: #BFC7D5;">()) {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #697098;">//</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<p>The <code>subscribedToProduct</code> method may be used to determine if the user is subscribed to a given product based on a given Stripe product's identifier. In Stripe, products are collections of prices. In this example, we will determine if the user's <code>default</code> subscription is actively subscribed to the application's "premium" product. The given Stripe product identifier should correspond to one of your product's identifiers in the Stripe dashboard:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">if</span><span style="color: #BFC7D5;"> (</span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscribedToProduct</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">prod_premium</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)) {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #697098;">//</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<p>By passing an array to the <code>subscribedToProduct</code> method, you may determine if the user's <code>default</code> subscription is actively subscribed to the application's "basic" or "premium" product:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">if</span><span style="color: #BFC7D5;"> (</span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscribedToProduct</span><span style="color: #BFC7D5;">([</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">prod_basic</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">prod_premium</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">], </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)) {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #697098;">//</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<p>The <code>subscribedToPrice</code> method may be used to determine if a customer's subscription corresponds to a given price ID:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">if</span><span style="color: #BFC7D5;"> (</span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscribedToPrice</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_basic_monthly</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)) {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #697098;">//</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<p>The <code>recurring</code> method may be used to determine if the user is currently subscribed and is no longer within their trial period:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">if</span><span style="color: #BFC7D5;"> (</span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">recurring</span><span style="color: #BFC7D5;">()) {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #697098;">//</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<blockquote>
<p>{note} If a user has two subscriptions with the same name, the most recent subscription will always be returned by the <code>subscription</code> method. For example, a user might have two subscription records named <code>default</code>; however, one of the subscriptions may be an old, expired subscription, while the other is the current, active subscription. The most recent subscription will always be returned while older subscriptions are kept in the database for historical review.</p>
</blockquote>
<p><a name="cancelled-subscription-status"></a></p>
<h4>Canceled Subscription Status</h4>
<p>To determine if the user was once an active subscriber but has canceled their subscription, you may use the <code>canceled</code> method:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">if</span><span style="color: #BFC7D5;"> (</span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">canceled</span><span style="color: #BFC7D5;">()) {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #697098;">//</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<p>You may also determine if a user has canceled their subscription but are still on their "grace period" until the subscription fully expires. For example, if a user cancels a subscription on March 5th that was originally scheduled to expire on March 10th, the user is on their "grace period" until March 10th. Note that the <code>subscribed</code> method still returns <code>true</code> during this time:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">if</span><span style="color: #BFC7D5;"> (</span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">onGracePeriod</span><span style="color: #BFC7D5;">()) {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #697098;">//</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<p>To determine if the user has canceled their subscription and is no longer within their "grace period", you may use the <code>ended</code> method:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">if</span><span style="color: #BFC7D5;"> (</span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">ended</span><span style="color: #BFC7D5;">()) {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #697098;">//</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<p><a name="incomplete-and-past-due-status"></a></p>
<h4>Incomplete and Past Due Status</h4>
<p>If a subscription requires a secondary payment action after creation the subscription will be marked as <code>incomplete</code>. Subscription statuses are stored in the <code>stripe_status</code> column of Cashier's <code>subscriptions</code> database table.</p>
<p>Similarly, if a secondary payment action is required when swapping prices the subscription will be marked as <code>past_due</code>. When your subscription is in either of these states it will not be active until the customer has confirmed their payment. Determining if a subscription has an incomplete payment may be accomplished using the <code>hasIncompletePayment</code> method on the billable model or a subscription instance:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">if</span><span style="color: #BFC7D5;"> (</span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">hasIncompletePayment</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)) {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #697098;">//</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #C792EA;">if</span><span style="color: #BFC7D5;"> (</span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">hasIncompletePayment</span><span style="color: #BFC7D5;">()) {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #697098;">//</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<p>When a subscription has an incomplete payment, you should direct the user to Cashier's payment confirmation page, passing the <code>latestPayment</code> identifier. You may use the <code>latestPayment</code> method available on subscription instance to retrieve this identifier:</p>
<pre><code data-theme="olaolu-palenight" data-lang="html" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #89DDFF;">&lt;</span><span style="color: #FF5572;">a</span><span style="color: #89DDFF;"> </span><span style="color: #FFCB6B;">href</span><span style="color: #89DDFF;">=</span><span style="color: #D9F5DD;">"</span><span style="color: #C3E88D;">{{ route('cashier.payment', $subscription-&gt;latestPayment()-&gt;id) }}</span><span style="color: #D9F5DD;">"</span><span style="color: #89DDFF;">&gt;</span></div><div class="line"><span style="color: #BFC7D5;">    Please confirm your payment.</span></div><div class="line"><span style="color: #89DDFF;">&lt;/</span><span style="color: #FF5572;">a</span><span style="color: #89DDFF;">&gt;</span></div></code></pre>
<p>If you would like the subscription to still be considered active when it's in a <code>past_due</code> state, you may use the <code>keepPastDueSubscriptionsActive</code> method provided by Cashier. Typically, this method should be called in the <code>register</code> method of your <code>App\Providers\AppServiceProvider</code>:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> Laravel\Cashier\</span><span style="color: #FFCB8B;">Cashier</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #697098;">/**</span></div><div class="line"><span style="color: #697098;"> * Register any application services.</span></div><div class="line"><span style="color: #697098;"> *</span></div><div class="line"><span style="color: #697098;"> * </span><span style="color: #C792EA;">@return</span><span style="color: #697098;"> </span><span style="color: #C792EA;">void</span></div><div class="line"><span style="color: #697098;"> </span><span style="color: #697098;">*/</span></div><div class="line"><span style="color: #C792EA;">public</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">function</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">register</span><span style="color: #D9F5DD;">()</span></div><div class="line"><span style="color: #BFC7D5;">{</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #FFCB8B;">Cashier</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">keepPastDueSubscriptionsActive</span><span style="color: #BFC7D5;">();</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<blockquote>
<p>{note} When a subscription is in an <code>incomplete</code> state it cannot be changed until the payment is confirmed. Therefore, the <code>swap</code> and <code>updateQuantity</code> methods will throw an exception when the subscription is in an <code>incomplete</code> state.</p>
</blockquote>
<p><a name="subscription-scopes"></a></p>
<h4>Subscription Scopes</h4>
<p>Most subscription states are also available as query scopes so that you may easily query your database for subscriptions that are in a given state:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #697098;">//</span><span style="color: #697098;"> Get all active subscriptions...</span></div><div class="line"><span style="color: #BEC5D4;">$subscriptions</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB8B;">Subscription</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">query</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">active</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">get</span><span style="color: #BFC7D5;">();</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #697098;">//</span><span style="color: #697098;"> Get all of the canceled subscriptions for a user...</span></div><div class="line"><span style="color: #BEC5D4;">$subscriptions</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscriptions</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">canceled</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">get</span><span style="color: #BFC7D5;">();</span></div></code></pre>
<p>A complete list of available scopes is available below:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #FFCB8B;">Subscription</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">query</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">active</span><span style="color: #BFC7D5;">();</span></div><div class="line"><span style="color: #FFCB8B;">Subscription</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">query</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">canceled</span><span style="color: #BFC7D5;">();</span></div><div class="line"><span style="color: #FFCB8B;">Subscription</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">query</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">ended</span><span style="color: #BFC7D5;">();</span></div><div class="line"><span style="color: #FFCB8B;">Subscription</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">query</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">incomplete</span><span style="color: #BFC7D5;">();</span></div><div class="line"><span style="color: #FFCB8B;">Subscription</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">query</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">notCanceled</span><span style="color: #BFC7D5;">();</span></div><div class="line"><span style="color: #FFCB8B;">Subscription</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">query</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">notOnGracePeriod</span><span style="color: #BFC7D5;">();</span></div><div class="line"><span style="color: #FFCB8B;">Subscription</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">query</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">notOnTrial</span><span style="color: #BFC7D5;">();</span></div><div class="line"><span style="color: #FFCB8B;">Subscription</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">query</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">onGracePeriod</span><span style="color: #BFC7D5;">();</span></div><div class="line"><span style="color: #FFCB8B;">Subscription</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">query</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">onTrial</span><span style="color: #BFC7D5;">();</span></div><div class="line"><span style="color: #FFCB8B;">Subscription</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">query</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">pastDue</span><span style="color: #BFC7D5;">();</span></div><div class="line"><span style="color: #FFCB8B;">Subscription</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">query</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">recurring</span><span style="color: #BFC7D5;">();</span></div></code></pre>
<p><a class="dashAnchor" name="//apple_ref/Section/Changing%20Prices"></a><a name="changing-prices"></a></p>
<h3>Changing Prices</h3>
<p>After a customer is subscribed to your application, they may occasionally want to change to a new subscription price. To swap a customer to a new price, pass the Stripe price's identifier to the <code>swap</code> method. When swapping prices, it is assumed that the user would like to re-activate their subscription if it was previously canceled. The given price identifier should correspond to a Stripe price identifier available in the Stripe dashboard:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> App\Models\</span><span style="color: #FFCB8B;">User</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> App\Models\</span><span style="color: #FFCB8B;">User</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">find</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">1</span><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">swap</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_yearly</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p>If the customer is on trial, the trial period will be maintained. Additionally, if a "quantity" exists for the subscription, that quantity will also be maintained.</p>
<p>If you would like to swap prices and cancel any trial period the customer is currently on, you may invoke the <code>skipTrial</code> method:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">skipTrial</span><span style="color: #BFC7D5;">()</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">swap</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_yearly</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p>If you would like to swap prices and immediately invoice the customer instead of waiting for their next billing cycle, you may use the <code>swapAndInvoice</code> method:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB8B;">User</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">find</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">1</span><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">swapAndInvoice</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_yearly</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p><a name="prorations"></a></p>
<h4>Prorations</h4>
<p>By default, Stripe prorates charges when swapping between prices. The <code>noProrate</code> method may be used to update the subscription's price without prorating the charges:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">noProrate</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">swap</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_yearly</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p>For more information on subscription proration, consult the <a href="https://stripe.com/docs/billing/subscriptions/prorations">Stripe documentation</a>.</p>
<blockquote>
<p>{note} Executing the <code>noProrate</code> method before the <code>swapAndInvoice</code> method will have no effect on proration. An invoice will always be issued.</p>
</blockquote>
<p><a class="dashAnchor" name="//apple_ref/Section/Subscription%20Quantity"></a><a name="subscription-quantity"></a></p>
<h3>Subscription Quantity</h3>
<p>Sometimes subscriptions are affected by "quantity". For example, a project management application might charge $10 per month per project. You may use the <code>incrementQuantity</code> and <code>decrementQuantity</code> methods to easily increment or decrement your subscription quantity:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> App\Models\</span><span style="color: #FFCB8B;">User</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB8B;">User</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">find</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">1</span><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">incrementQuantity</span><span style="color: #BFC7D5;">();</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #697098;">//</span><span style="color: #697098;"> Add five to the subscription's current quantity...</span></div><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">incrementQuantity</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">5</span><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">decrementQuantity</span><span style="color: #BFC7D5;">();</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #697098;">//</span><span style="color: #697098;"> Subtract five from the subscription's current quantity...</span></div><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">decrementQuantity</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">5</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p>Alternatively, you may set a specific quantity using the <code>updateQuantity</code> method:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">updateQuantity</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">10</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p>The <code>noProrate</code> method may be used to update the subscription's quantity without prorating the charges:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">noProrate</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">updateQuantity</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">10</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p>For more information on subscription quantities, consult the <a href="https://stripe.com/docs/subscriptions/quantities">Stripe documentation</a>.</p>
<p><a name="multiprice-subscription-quantities"></a></p>
<h4>Multiprice Subscription Quantities</h4>
<p>If your subscription is a <a href="#multiprice-subscriptions">multiprice subscription</a>, you should pass the name of the price whose quantity you wish to increment or decrement as the second argument to the increment / decrement methods:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">incrementQuantity</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">1</span><span style="color: #BFC7D5;">, </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_chat</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p><a class="dashAnchor" name="//apple_ref/Section/Multiprice%20Subscriptions"></a><a name="multiprice-subscriptions"></a></p>
<h3>Multiprice Subscriptions</h3>
<p><a href="https://stripe.com/docs/billing/subscriptions/multiple-products">Multiprice subscriptions</a> allow you to assign multiple billing prices to a single subscription. For example, imagine you are building a customer service "helpdesk" application that has a base subscription price of $10 per month but offers a live chat add-on price for an additional $15 per month. Multiprice subscription information is stored in Cashier's <code>subscription_items</code> database table.</p>
<p>You may specify multiple prices for a given subscription by passing an array of prices as the second argument to the <code>newSubscription</code> method:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> Illuminate\Http\</span><span style="color: #FFCB8B;">Request</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #FFCB8B;">Route</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">post</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">/user/subscribe</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #C792EA;">function</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">(</span><span style="color: #FFCB8B;">Request</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$request</span><span style="color: #D9F5DD;">)</span><span style="color: #BFC7D5;"> {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #BEC5D4;">$request</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">user</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">newSubscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, [</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_monthly</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">,</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_chat</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">,</span></div><div class="line"><span style="color: #BFC7D5;">    ])</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">create</span><span style="color: #BFC7D5;">(</span><span style="color: #BEC5D4;">$request</span><span style="color: #89DDFF;">-&gt;paymentMethodId</span><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #697098;">//</span><span style="color: #697098;"> ...</span></div><div class="line"><span style="color: #BFC7D5;">});</span></div></code></pre>
<p>In the example above, the customer will have two prices attached to their <code>default</code> subscription. Both prices will be charged on their respective billing intervals. If necessary, you may use the <code>quantity</code> method to indicate a specific quantity for each price:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB8B;">User</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">find</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">1</span><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">newSubscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, [</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_monthly</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_chat</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">])</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">quantity</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">5</span><span style="color: #BFC7D5;">, </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_chat</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">create</span><span style="color: #BFC7D5;">(</span><span style="color: #BEC5D4;">$paymentMethod</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p>If you would like to add another price to an existing subscription, you may invoke the subscription's <code>addPrice</code> method:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB8B;">User</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">find</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">1</span><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">addPrice</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_chat</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p>The example above will add the new price and the customer will be billed for it on their next billing cycle. If you would like to bill the customer immediately you may use the <code>addPriceAndInvoice</code> method:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">addPriceAndInvoice</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_chat</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p>If you would like to add a price with a specific quantity, you can pass the quantity as the second argument of the <code>addPrice</code> or <code>addPriceAndInvoice</code> methods:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB8B;">User</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">find</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">1</span><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">addPrice</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_chat</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #F78C6C;">5</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p>You may remove prices from subscriptions using the <code>removePrice</code> method:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">removePrice</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_chat</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<blockquote>
<p>{note} You may not remove the last price on a subscription. Instead, you should simply cancel the subscription.</p>
</blockquote>
<p><a name="swapping-prices"></a></p>
<h4>Swapping Prices</h4>
<p>You may also change the prices attached to a multiprice subscription. For example, imagine a customer has a <code>price_basic</code> subscription with a <code>price_chat</code> add-on price and you want to upgrade the customer from the <code>price_basic</code> to the <code>price_pro</code> price:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> App\Models\</span><span style="color: #FFCB8B;">User</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB8B;">User</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">find</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">1</span><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">swap</span><span style="color: #BFC7D5;">([</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_pro</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_chat</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">]);</span></div></code></pre>
<p>When executing the example above, the underlying subscription item with the <code>price_basic</code> is deleted and the one with the <code>price_chat</code> is preserved. Additionally, a new subscription item for the <code>price_pro</code> is created.</p>
<p>You can also specify subscription item options by passing an array of key / value pairs to the <code>swap</code> method. For example, you may need to specify the subscription price quantities:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB8B;">User</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">find</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">1</span><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">swap</span><span style="color: #BFC7D5;">([</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_pro</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;"> </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #BFC7D5;"> [</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">quantity</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;"> </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #BFC7D5;"> </span><span style="color: #F78C6C;">5</span><span style="color: #BFC7D5;">],</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_chat</span><span style="color: #D9F5DD;">'</span></div><div class="line"><span style="color: #BFC7D5;">]);</span></div></code></pre>
<p>If you want to swap a single price on a subscription, you may do so using the <code>swap</code> method on the subscription item itself. This approach is particularly useful if you would like to preserve all of the existing metadata on the subscription's other prices:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB8B;">User</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">find</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">1</span><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">findItemOrFail</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_basic</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">swap</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_pro</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p><a name="proration"></a></p>
<h4>Proration</h4>
<p>By default, Stripe will prorate charges when adding or removing prices from a multiprice subscription. If you would like to make a price adjustment without proration, you should chain the <code>noProrate</code> method onto your price operation:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">noProrate</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">removePrice</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_chat</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p><a name="swapping-quantities"></a></p>
<h4>Quantities</h4>
<p>If you would like to update quantities on individual subscription prices, you may do so using the <a href="#subscription-quantity">existing quantity methods</a> by passing the name of the price as an additional argument to the method:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB8B;">User</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">find</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">1</span><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">incrementQuantity</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">5</span><span style="color: #BFC7D5;">, </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_chat</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">decrementQuantity</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">3</span><span style="color: #BFC7D5;">, </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_chat</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">updateQuantity</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">10</span><span style="color: #BFC7D5;">, </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_chat</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<blockquote>
<p>{note} When a subscription has multiple prices the <code>stripe_price</code> and <code>quantity</code> attributes on the <code>Subscription</code> model will be <code>null</code>. To access the individual price attributes, you should use the <code>items</code> relationship available on the <code>Subscription</code> model.</p>
</blockquote>
<p><a name="subscription-items"></a></p>
<h4>Subscription Items</h4>
<p>When a subscription has multiple prices, it will have multiple subscription "items" stored in your database's <code>subscription_items</code> table. You may access these via the <code>items</code> relationship on the subscription:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> App\Models\</span><span style="color: #FFCB8B;">User</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB8B;">User</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">find</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">1</span><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$subscriptionItem</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;items-&gt;</span><span style="color: #82AAFF;">first</span><span style="color: #BFC7D5;">();</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #697098;">//</span><span style="color: #697098;"> Retrieve the Stripe price and quantity for a specific item...</span></div><div class="line"><span style="color: #BEC5D4;">$stripePrice</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$subscriptionItem</span><span style="color: #89DDFF;">-&gt;stripe_price</span><span style="color: #BFC7D5;">;</span></div><div class="line"><span style="color: #BEC5D4;">$quantity</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$subscriptionItem</span><span style="color: #89DDFF;">-&gt;quantity</span><span style="color: #BFC7D5;">;</span></div></code></pre>
<p>You can also retrieve a specific price using the <code>findItemOrFail</code> method:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB8B;">User</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">find</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">1</span><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$subscriptionItem</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">findItemOrFail</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_chat</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p><a class="dashAnchor" name="//apple_ref/Section/Metered%20Billing"></a><a name="metered-billing"></a></p>
<h3>Metered Billing</h3>
<p><a href="https://stripe.com/docs/billing/subscriptions/metered-billing">Metered billing</a> allows you to charge customers based on their product usage during a billing cycle. For example, you may charge customers based on the number of text messages or emails they send per month.</p>
<p>To start using metered billing, you will first need to create a new product in your Stripe dashboard with a metered price. Then, use the <code>meteredPrice</code> to add the metered price ID to a customer subscription:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> Illuminate\Http\</span><span style="color: #FFCB8B;">Request</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #FFCB8B;">Route</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">post</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">/user/subscribe</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #C792EA;">function</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">(</span><span style="color: #FFCB8B;">Request</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$request</span><span style="color: #D9F5DD;">)</span><span style="color: #BFC7D5;"> {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #BEC5D4;">$request</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">user</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">newSubscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">meteredPrice</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_metered</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">create</span><span style="color: #BFC7D5;">(</span><span style="color: #BEC5D4;">$request</span><span style="color: #89DDFF;">-&gt;paymentMethodId</span><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #697098;">//</span><span style="color: #697098;"> ...</span></div><div class="line"><span style="color: #BFC7D5;">});</span></div></code></pre>
<p>You may also start a metered subscription via <a href="#checkout">Stripe Checkout</a>:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$checkout</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB8B;">Auth</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">user</span><span style="color: #BFC7D5;">()</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">newSubscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, [])</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">meteredPrice</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_metered</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">checkout</span><span style="color: #BFC7D5;">();</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #C792EA;">return</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">view</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">your-checkout-view</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">,</span><span style="color: #82AAFF;"> </span><span style="color: #BFC7D5;">[</span></div><div class="line"><span style="color: #82AAFF;">    </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">checkout</span><span style="color: #D9F5DD;">'</span><span style="color: #82AAFF;"> </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #82AAFF;"> </span><span style="color: #BFC7D5;">$</span><span style="color: #BEC5D4;">checkout</span><span style="color: #BFC7D5;">,</span></div><div class="line"><span style="color: #BFC7D5;">]);</span></div></code></pre>
<p><a name="reporting-usage"></a></p>
<h4>Reporting Usage</h4>
<p>As your customer uses your application, you will report their usage to Stripe so that they can be billed accurately. To increment the usage of a metered subscription, you may use the <code>reportUsage</code> method:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB8B;">User</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">find</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">1</span><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">reportUsage</span><span style="color: #BFC7D5;">();</span></div></code></pre>
<p>By default, a "usage quantity" of 1 is added to the billing period. Alternatively, you may pass a specific amount of "usage" to add to the customer's usage for the billing period:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB8B;">User</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">find</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">1</span><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">reportUsage</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">15</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p>If your application offers multiple prices on a single subscription, you will need to use the <code>reportUsageFor</code> method to specify the metered price you want to report usage for:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB8B;">User</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">find</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">1</span><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">reportUsageFor</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_metered</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #F78C6C;">15</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p>Sometimes, you may need to update usage which you have previously reported. To accomplish this, you may pass a timestamp or a <code>DateTimeInterface</code> instance as the second parameter to <code>reportUsage</code>. When doing so, Stripe will update the usage that was reported at that given time. You can continue to update previous usage records as the given date and time is still within the current billing period:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB8B;">User</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">find</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">1</span><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">reportUsage</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">5</span><span style="color: #BFC7D5;">, </span><span style="color: #BEC5D4;">$timestamp</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p><a name="retrieving-usage-records"></a></p>
<h4>Retrieving Usage Records</h4>
<p>To retrieve a customer's past usage, you may use a subscription instance's <code>usageRecords</code> method:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB8B;">User</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">find</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">1</span><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$usageRecords</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">usageRecords</span><span style="color: #BFC7D5;">();</span></div></code></pre>
<p>If your application offers multiple prices on a single subscription, you may use the <code>usageRecordsFor</code> method to specify the metered price that you wish to retrieve usage records for:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB8B;">User</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">find</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">1</span><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$usageRecords</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">usageRecordsFor</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_metered</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p>The <code>usageRecords</code> and <code>usageRecordsFor</code> methods return a Collection instance containing an associative array of usage records. You may iterate over this array to display a customer's total usage:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #89DDFF;">@</span><span style="color: #C792EA;">foreach</span><span style="color: #BFC7D5;"> (</span><span style="color: #BEC5D4;">$usageRecords</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">as</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$usageRecord</span><span style="color: #BFC7D5;">)</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #89DDFF;">-</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">Period</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">Starting</span><span style="color: #BFC7D5;">: {{ </span><span style="color: #BEC5D4;">$usageRecord</span><span style="color: #BFC7D5;">[</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">period</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">][</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">start</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">] }}</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #89DDFF;">-</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">Period</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">Ending</span><span style="color: #BFC7D5;">: {{ </span><span style="color: #BEC5D4;">$usageRecord</span><span style="color: #BFC7D5;">[</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">period</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">][</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">end</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">] }}</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #89DDFF;">-</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">Total</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">Usage</span><span style="color: #BFC7D5;">: {{ </span><span style="color: #BEC5D4;">$usageRecord</span><span style="color: #BFC7D5;">[</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">total_usage</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">] }}</span></div><div class="line"><span style="color: #89DDFF;">@</span><span style="color: #C792EA;">endforeach</span></div></code></pre>
<p>For a full reference of all usage data returned and how to use Stripe's cursor based pagination, please consult <a href="https://stripe.com/docs/api/usage_records/subscription_item_summary_list">the official Stripe API documentation</a>.</p>
<p><a class="dashAnchor" name="//apple_ref/Section/Subscription%20Taxes"></a><a name="subscription-taxes"></a></p>
<h3>Subscription Taxes</h3>
<blockquote>
<p>{note} Instead of calculating Tax Rates manually, you can <a href="#tax-configuration">automatically calculate taxes using Stripe Tax</a></p>
</blockquote>
<p>To specify the tax rates a user pays on a subscription, you should implement the <code>taxRates</code> method on your billable model and return an array containing the Stripe tax rate IDs. You can define these tax rates in <a href="https://dashboard.stripe.com/test/tax-rates">your Stripe dashboard</a>:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #697098;">/**</span></div><div class="line"><span style="color: #697098;"> * The tax rates that should apply to the customer's subscriptions.</span></div><div class="line"><span style="color: #697098;"> *</span></div><div class="line"><span style="color: #697098;"> * </span><span style="color: #C792EA;">@return</span><span style="color: #697098;"> </span><span style="color: #C792EA;">array</span></div><div class="line"><span style="color: #697098;"> </span><span style="color: #697098;">*/</span></div><div class="line"><span style="color: #C792EA;">public</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">function</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">taxRates</span><span style="color: #D9F5DD;">()</span></div><div class="line"><span style="color: #BFC7D5;">{</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #C792EA;">return</span><span style="color: #BFC7D5;"> [</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">txr_id</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">];</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<p>The <code>taxRates</code> method enables you to apply a tax rate on a customer-by-customer basis, which may be helpful for a user base that spans multiple countries and tax rates.</p>
<p>If you're offering multiprice subscriptions, you may define different tax rates for each price by implementing a <code>priceTaxRates</code> method on your billable model:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #697098;">/**</span></div><div class="line"><span style="color: #697098;"> * The tax rates that should apply to the customer's subscriptions.</span></div><div class="line"><span style="color: #697098;"> *</span></div><div class="line"><span style="color: #697098;"> * </span><span style="color: #C792EA;">@return</span><span style="color: #697098;"> </span><span style="color: #C792EA;">array</span></div><div class="line"><span style="color: #697098;"> </span><span style="color: #697098;">*/</span></div><div class="line"><span style="color: #C792EA;">public</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">function</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">priceTaxRates</span><span style="color: #D9F5DD;">()</span></div><div class="line"><span style="color: #BFC7D5;">{</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #C792EA;">return</span><span style="color: #BFC7D5;"> [</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_monthly</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;"> </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #BFC7D5;"> [</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">txr_id</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">],</span></div><div class="line"><span style="color: #BFC7D5;">    ];</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<blockquote>
<p>{note} The <code>taxRates</code> method only applies to subscription charges. If you use Cashier to make "one off" charges, you will need to manually specify the tax rate at that time.</p>
</blockquote>
<p><a name="syncing-tax-rates"></a></p>
<h4>Syncing Tax Rates</h4>
<p>When changing the hard-coded tax rate IDs returned by the <code>taxRates</code> method, the tax settings on any existing subscriptions for the user will remain the same. If you wish to update the tax value for existing subscriptions with the new <code>taxRates</code> values, you should call the <code>syncTaxRates</code> method on the user's subscription instance:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">syncTaxRates</span><span style="color: #BFC7D5;">();</span></div></code></pre>
<p>This will also sync any multiprice subscription item tax rates. If your application is offering multiprice subscriptions, you should ensure that your billable model implements the <code>priceTaxRates</code> method <a href="#subscription-taxes">discussed above</a>.</p>
<p><a name="tax-exemption"></a></p>
<h4>Tax Exemption</h4>
<p>Cashier also offers the <code>isNotTaxExempt</code>, <code>isTaxExempt</code>, and <code>reverseChargeApplies</code> methods to determine if the customer is tax exempt. These methods will call the Stripe API to determine a customer's tax exemption status:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> App\Models\</span><span style="color: #FFCB8B;">User</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB8B;">User</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">find</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">1</span><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">isTaxExempt</span><span style="color: #BFC7D5;">();</span></div><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">isNotTaxExempt</span><span style="color: #BFC7D5;">();</span></div><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">reverseChargeApplies</span><span style="color: #BFC7D5;">();</span></div></code></pre>
<blockquote>
<p>{note} These methods are also available on any <code>Laravel\Cashier\Invoice</code> object. However, when invoked on an <code>Invoice</code> object, the methods will determine the exemption status at the time the invoice was created.</p>
</blockquote>
<p><a class="dashAnchor" name="//apple_ref/Section/Subscription%20Anchor%20Date"></a><a name="subscription-anchor-date"></a></p>
<h3>Subscription Anchor Date</h3>
<p>By default, the billing cycle anchor is the date the subscription was created or, if a trial period is used, the date that the trial ends. If you would like to modify the billing anchor date, you may use the <code>anchorBillingCycleOn</code> method:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> Illuminate\Http\</span><span style="color: #FFCB8B;">Request</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #FFCB8B;">Route</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">post</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">/user/subscribe</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #C792EA;">function</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">(</span><span style="color: #FFCB8B;">Request</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$request</span><span style="color: #D9F5DD;">)</span><span style="color: #BFC7D5;"> {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #BEC5D4;">$anchor</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB8B;">Carbon</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">parse</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">first day of next month</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #BEC5D4;">$request</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">user</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">newSubscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_monthly</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span></div><div class="line"><span style="color: #BFC7D5;">                </span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">anchorBillingCycleOn</span><span style="color: #BFC7D5;">(</span><span style="color: #BEC5D4;">$anchor</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">startOfDay</span><span style="color: #BFC7D5;">())</span></div><div class="line"><span style="color: #BFC7D5;">                </span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">create</span><span style="color: #BFC7D5;">(</span><span style="color: #BEC5D4;">$request</span><span style="color: #89DDFF;">-&gt;paymentMethodId</span><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #697098;">//</span><span style="color: #697098;"> ...</span></div><div class="line"><span style="color: #BFC7D5;">});</span></div></code></pre>
<p>For more information on managing subscription billing cycles, consult the <a href="https://stripe.com/docs/billing/subscriptions/billing-cycle">Stripe billing cycle documentation</a></p>
<p><a class="dashAnchor" name="//apple_ref/Section/Canceling%20Subscriptions"></a><a name="cancelling-subscriptions"></a></p>
<h3>Cancelling Subscriptions</h3>
<p>To cancel a subscription, call the <code>cancel</code> method on the user's subscription:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">cancel</span><span style="color: #BFC7D5;">();</span></div></code></pre>
<p>When a subscription is canceled, Cashier will automatically set the <code>ends_at</code> column in your <code>subscriptions</code> database table. This column is used to know when the <code>subscribed</code> method should begin returning <code>false</code>.</p>
<p>For example, if a customer cancels a subscription on March 1st, but the subscription was not scheduled to end until March 5th, the <code>subscribed</code> method will continue to return <code>true</code> until March 5th. This is done because a user is typically allowed to continue using an application until the end of their billing cycle.</p>
<p>You may determine if a user has canceled their subscription but are still on their "grace period" using the <code>onGracePeriod</code> method:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">if</span><span style="color: #BFC7D5;"> (</span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">onGracePeriod</span><span style="color: #BFC7D5;">()) {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #697098;">//</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<p>If you wish to cancel a subscription immediately, call the <code>cancelNow</code> method on the user's subscription:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">cancelNow</span><span style="color: #BFC7D5;">();</span></div></code></pre>
<p>If you wish to cancel a subscription immediately and invoice any remaining un-invoiced metered usage or new / pending proration invoice items, call the <code>cancelNowAndInvoice</code> method on the user's subscription:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">cancelNowAndInvoice</span><span style="color: #BFC7D5;">();</span></div></code></pre>
<p>You may also choose to cancel the subscription at a specific moment in time:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">cancelAt</span><span style="color: #BFC7D5;">(</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #82AAFF;">now</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">addDays</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">10</span><span style="color: #BFC7D5;">)</span></div><div class="line"><span style="color: #BFC7D5;">);</span></div></code></pre>
<p><a class="dashAnchor" name="//apple_ref/Section/Resuming%20Subscriptions"></a><a name="resuming-subscriptions"></a></p>
<h3>Resuming Subscriptions</h3>
<p>If a customer has canceled their subscription and you wish to resume it, you may invoke the <code>resume</code> method on the subscription. The customer must still be within their "grace period" in order to resume a subscription:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">resume</span><span style="color: #BFC7D5;">();</span></div></code></pre>
<p>If the customer cancels a subscription and then resumes that subscription before the subscription has fully expired the customer will not be billed immediately. Instead, their subscription will be re-activated and they will be billed on the original billing cycle.</p>
<p><a class="dashAnchor" name="//apple_ref/Section/Subscription%20Trials"></a><a name="subscription-trials"></a></p>
<h2>Subscription Trials</h2>
<p><a class="dashAnchor" name="//apple_ref/Section/With%20Payment%20Method%20Up%20Front"></a><a name="with-payment-method-up-front"></a></p>
<h3>With Payment Method Up Front</h3>
<p>If you would like to offer trial periods to your customers while still collecting payment method information up front, you should use the <code>trialDays</code> method when creating your subscriptions:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> Illuminate\Http\</span><span style="color: #FFCB8B;">Request</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #FFCB8B;">Route</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">post</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">/user/subscribe</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #C792EA;">function</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">(</span><span style="color: #FFCB8B;">Request</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$request</span><span style="color: #D9F5DD;">)</span><span style="color: #BFC7D5;"> {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #BEC5D4;">$request</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">user</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">newSubscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_monthly</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span></div><div class="line"><span style="color: #BFC7D5;">                </span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">trialDays</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">10</span><span style="color: #BFC7D5;">)</span></div><div class="line"><span style="color: #BFC7D5;">                </span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">create</span><span style="color: #BFC7D5;">(</span><span style="color: #BEC5D4;">$request</span><span style="color: #89DDFF;">-&gt;paymentMethodId</span><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #697098;">//</span><span style="color: #697098;"> ...</span></div><div class="line"><span style="color: #BFC7D5;">});</span></div></code></pre>
<p>This method will set the trial period ending date on the subscription record within the database and instruct Stripe to not begin billing the customer until after this date. When using the <code>trialDays</code> method, Cashier will overwrite any default trial period configured for the price in Stripe.</p>
<blockquote>
<p>{note} If the customer's subscription is not canceled before the trial ending date they will be charged as soon as the trial expires, so you should be sure to notify your users of their trial ending date.</p>
</blockquote>
<p>The <code>trialUntil</code> method allows you to provide a <code>DateTime</code> instance that specifies when the trial period should end:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> Carbon\</span><span style="color: #FFCB8B;">Carbon</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">newSubscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_monthly</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span></div><div class="line"><span style="color: #BFC7D5;">            </span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">trialUntil</span><span style="color: #BFC7D5;">(</span><span style="color: #FFCB8B;">Carbon</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">now</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">addDays</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">10</span><span style="color: #BFC7D5;">))</span></div><div class="line"><span style="color: #BFC7D5;">            </span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">create</span><span style="color: #BFC7D5;">(</span><span style="color: #BEC5D4;">$paymentMethod</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p>You may determine if a user is within their trial period using either the <code>onTrial</code> method of the user instance or the <code>onTrial</code> method of the subscription instance. The two examples below are equivalent:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">if</span><span style="color: #BFC7D5;"> (</span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">onTrial</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)) {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #697098;">//</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #C792EA;">if</span><span style="color: #BFC7D5;"> (</span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">onTrial</span><span style="color: #BFC7D5;">()) {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #697098;">//</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<p>You may use the <code>endTrial</code> method to immediately end a subscription trial:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">endTrial</span><span style="color: #BFC7D5;">();</span></div></code></pre>
<p><a name="defining-trial-days-in-stripe-cashier"></a></p>
<h4>Defining Trial Days In Stripe / Cashier</h4>
<p>You may choose to define how many trial days your price's receive in the Stripe dashboard or always pass them explicitly using Cashier. If you choose to define your price's trial days in Stripe you should be aware that new subscriptions, including new subscriptions for a customer that had a subscription in the past, will always receive a trial period unless you explicitly call the <code>skipTrial()</code> method.</p>
<p><a class="dashAnchor" name="//apple_ref/Section/Without%20Payment%20Method%20Up%20Front"></a><a name="without-payment-method-up-front"></a></p>
<h3>Without Payment Method Up Front</h3>
<p>If you would like to offer trial periods without collecting the user's payment method information up front, you may set the <code>trial_ends_at</code> column on the user record to your desired trial ending date. This is typically done during user registration:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> App\Models\</span><span style="color: #FFCB8B;">User</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB8B;">User</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">create</span><span style="color: #BFC7D5;">([</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #697098;">//</span><span style="color: #697098;"> ...</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">trial_ends_at</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;"> </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">now</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">addDays</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">10</span><span style="color: #BFC7D5;">),</span></div><div class="line"><span style="color: #BFC7D5;">]);</span></div></code></pre>
<blockquote>
<p>{note} Be sure to add a <a href="eloquent-mutators.html##date-casting">date cast</a> for the <code>trial_ends_at</code> attribute within your billable model's class definition.</p>
</blockquote>
<p>Cashier refers to this type of trial as a "generic trial", since it is not attached to any existing subscription. The <code>onTrial</code> method on the billable model instance will return <code>true</code> if the current date is not past the value of <code>trial_ends_at</code>:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">if</span><span style="color: #BFC7D5;"> (</span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">onTrial</span><span style="color: #BFC7D5;">()) {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #697098;">//</span><span style="color: #697098;"> User is within their trial period...</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<p>Once you are ready to create an actual subscription for the user, you may use the <code>newSubscription</code> method as usual:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB8B;">User</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">find</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">1</span><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">newSubscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_monthly</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">create</span><span style="color: #BFC7D5;">(</span><span style="color: #BEC5D4;">$paymentMethod</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p>To retrieve the user's trial ending date, you may use the <code>trialEndsAt</code> method. This method will return a Carbon date instance if a user is on a trial or <code>null</code> if they aren't. You may also pass an optional subscription name parameter if you would like to get the trial ending date for a specific subscription other than the default one:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">if</span><span style="color: #BFC7D5;"> (</span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">onTrial</span><span style="color: #BFC7D5;">()) {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #BEC5D4;">$trialEndsAt</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">trialEndsAt</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">main</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<p>You may also use the <code>onGenericTrial</code> method if you wish to know specifically that the user is within their "generic" trial period and has not yet created an actual subscription:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">if</span><span style="color: #BFC7D5;"> (</span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">onGenericTrial</span><span style="color: #BFC7D5;">()) {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #697098;">//</span><span style="color: #697098;"> User is within their "generic" trial period...</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<p><a class="dashAnchor" name="//apple_ref/Section/Extending%20Trials"></a><a name="extending-trials"></a></p>
<h3>Extending Trials</h3>
<p>The <code>extendTrial</code> method allows you to extend the trial period of a subscription after the subscription has been created. If the trial has already expired and the customer is already being billed for the subscription, you can still offer them an extended trial. The time spent within the trial period will be deducted from the customer's next invoice:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> App\Models\</span><span style="color: #FFCB8B;">User</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$subscription</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB8B;">User</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">find</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">1</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #697098;">//</span><span style="color: #697098;"> End the trial 7 days from now...</span></div><div class="line"><span style="color: #BEC5D4;">$subscription</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">extendTrial</span><span style="color: #BFC7D5;">(</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #82AAFF;">now</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">addDays</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">7</span><span style="color: #BFC7D5;">)</span></div><div class="line"><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #697098;">//</span><span style="color: #697098;"> Add an additional 5 days to the trial...</span></div><div class="line"><span style="color: #BEC5D4;">$subscription</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">extendTrial</span><span style="color: #BFC7D5;">(</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #BEC5D4;">$subscription</span><span style="color: #89DDFF;">-&gt;trial_ends_at-&gt;</span><span style="color: #82AAFF;">addDays</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">5</span><span style="color: #BFC7D5;">)</span></div><div class="line"><span style="color: #BFC7D5;">);</span></div></code></pre>
<p><a class="dashAnchor" name="//apple_ref/Section/Handling%20Stripe%20Webhooks"></a><a name="handling-stripe-webhooks"></a></p>
<h2>Handling Stripe Webhooks</h2>
<blockquote>
<p>{tip} You may use <a href="https://stripe.com/docs/stripe-cli">the Stripe CLI</a> to help test webhooks during local development.</p>
</blockquote>
<p>Stripe can notify your application of a variety of events via webhooks. By default, a route that points to Cashier's webhook controller is automatically registered by the Cashier service provider. This controller will handle all incoming webhook requests.</p>
<p>By default, the Cashier webhook controller will automatically handle cancelling subscriptions that have too many failed charges (as defined by your Stripe settings), customer updates, customer deletions, subscription updates, and payment method changes; however, as we'll soon discover, you can extend this controller to handle any Stripe webhook event you like.</p>
<p>To ensure your application can handle Stripe webhooks, be sure to configure the webhook URL in the Stripe control panel. By default, Cashier's webhook controller responds to the <code>/stripe/webhook</code> URL path. The full list of all webhooks you should enable in the Stripe control panel are:</p>
<ul>
<li>
<code>customer.subscription.created</code>
</li>
<li>
<code>customer.subscription.updated</code>
</li>
<li>
<code>customer.subscription.deleted</code>
</li>
<li>
<code>customer.updated</code>
</li>
<li>
<code>customer.deleted</code>
</li>
<li>
<code>invoice.payment_action_required</code>
</li>
</ul>
<p>For convenience, Cashier includes a <code>cashier:webhook</code> Artisan command. This command will create a webhook in Stripe that listens to all of the events required by Cashier:</p>
<pre><code data-theme="olaolu-palenight" data-lang="shell" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BFC7D5;">php </span><span style="color: #BFC7D5;">artisan</span><span style="color: #BFC7D5;"> </span><span style="color: #BFC7D5;">cashier:webhook</span></div></code></pre>
<p>By default, the created webhook will point to the URL defined by the <code>APP_URL</code> environment variable and the <code>cashier.webhook</code> route that is included with Cashier. You may provide the <code>--url</code> option when invoking the command if you would like to use a different URL:</p>
<pre><code data-theme="olaolu-palenight" data-lang="shell" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BFC7D5;">php </span><span style="color: #BFC7D5;">artisan</span><span style="color: #BFC7D5;"> </span><span style="color: #BFC7D5;">cashier:webhook</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">--url</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">"</span><span style="color: #C3E88D;">https://example.com/stripe/webhook</span><span style="color: #D9F5DD;">"</span></div></code></pre>
<p>The webhook that is created will use the Stripe API version that your version of Cashier is compatible with. If you would like to use a different Stripe version, you may provide the <code>--api-version</code> option:</p>
<pre><code data-theme="olaolu-palenight" data-lang="shell" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BFC7D5;">php </span><span style="color: #BFC7D5;">artisan</span><span style="color: #BFC7D5;"> </span><span style="color: #BFC7D5;">cashier:webhook</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">--api-version=</span><span style="color: #D9F5DD;">"</span><span style="color: #C3E88D;">2019-12-03</span><span style="color: #D9F5DD;">"</span></div></code></pre>
<p>After creation, the webhook will be immediately active. If you wish to create the webhook but have it disabled until you're ready, you may provide the <code>--disabled</code> option when invoking the command:</p>
<pre><code data-theme="olaolu-palenight" data-lang="shell" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BFC7D5;">php </span><span style="color: #BFC7D5;">artisan</span><span style="color: #BFC7D5;"> </span><span style="color: #BFC7D5;">cashier:webhook</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">--disabled</span></div></code></pre>
<blockquote>
<p>{note} Make sure you protect incoming Stripe webhook requests with Cashier's included <a href="#verifying-webhook-signatures">webhook signature verification</a> middleware.</p>
</blockquote>
<p><a name="webhooks-csrf-protection"></a></p>
<h4>Webhooks &amp; CSRF Protection</h4>
<p>Since Stripe webhooks need to bypass Laravel's <a href="csrf.html">CSRF protection</a>, be sure to list the URI as an exception in your application's <code>App\Http\Middleware\VerifyCsrfToken</code> middleware or list the route outside of the <code>web</code> middleware group:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">protected</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$except</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> [</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">stripe/*</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">,</span></div><div class="line"><span style="color: #BFC7D5;">];</span></div></code></pre>
<p><a class="dashAnchor" name="//apple_ref/Section/Defining%20Webhook%20Event%20Handlers"></a><a name="defining-webhook-event-handlers"></a></p>
<h3>Defining Webhook Event Handlers</h3>
<p>Cashier automatically handles subscription cancellations for failed charges and other common Stripe webhook events. However, if you have additional webhook events you would like to handle, you may do so by listening to the following events that are dispatched by Cashier:</p>
<ul>
<li>
<code>Laravel\Cashier\Events\WebhookReceived</code>
</li>
<li>
<code>Laravel\Cashier\Events\WebhookHandled</code>
</li>
</ul>
<p>Both events contain the full payload of the Stripe webhook. For example, if you wish to handle the <code>invoice.payment_succeeded</code> webhook, you may register a <a href="events.html#defining-listeners">listener</a> that will handle the event:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">&lt;</span><span style="color: #89DDFF;">?</span><span style="color: #82AAFF;">php</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #C792EA;">namespace</span><span style="color: #BFC7D5;"> App\Listeners;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> Laravel\Cashier\Events\</span><span style="color: #FFCB8B;">WebhookReceived</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #C792EA;">class</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB6B;">StripeEventListener</span></div><div class="line"><span style="color: #BFC7D5;">{</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #697098;">/**</span></div><div class="line"><span style="color: #697098;">     * Handle received Stripe webhooks.</span></div><div class="line"><span style="color: #697098;">     *</span></div><div class="line"><span style="color: #697098;">     * </span><span style="color: #C792EA;">@param</span><span style="color: #697098;">  </span><span style="color: #697098;">\</span><span style="color: #697098;">Laravel</span><span style="color: #697098;">\</span><span style="color: #697098;">Cashier</span><span style="color: #697098;">\</span><span style="color: #697098;">Events</span><span style="color: #697098;">\</span><span style="color: #FFCB8B;">WebhookReceived</span><span style="color: #697098;">  $event</span></div><div class="line"><span style="color: #697098;">     * </span><span style="color: #C792EA;">@return</span><span style="color: #697098;"> </span><span style="color: #C792EA;">void</span></div><div class="line"><span style="color: #697098;">     </span><span style="color: #697098;">*/</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #C792EA;">public</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">function</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">handle</span><span style="color: #D9F5DD;">(</span><span style="color: #FFCB8B;">WebhookReceived</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$event</span><span style="color: #D9F5DD;">)</span></div><div class="line"><span style="color: #BFC7D5;">    {</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #C792EA;">if</span><span style="color: #BFC7D5;"> (</span><span style="color: #BEC5D4;">$event</span><span style="color: #89DDFF;">-&gt;payload</span><span style="color: #BFC7D5;">[</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">type</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">] </span><span style="color: #C792EA;">===</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">invoice.payment_succeeded</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">) {</span></div><div class="line"><span style="color: #BFC7D5;">            </span><span style="color: #697098;">//</span><span style="color: #697098;"> Handle the incoming event...</span></div><div class="line"><span style="color: #BFC7D5;">        }</span></div><div class="line"><span style="color: #BFC7D5;">    }</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<p>Once your listener has been defined, you may register it within your application's <code>EventServiceProvider</code>:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">&lt;</span><span style="color: #89DDFF;">?</span><span style="color: #82AAFF;">php</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #C792EA;">namespace</span><span style="color: #BFC7D5;"> App\Providers;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> App\Listeners\</span><span style="color: #FFCB8B;">StripeEventListener</span><span style="color: #BFC7D5;">;</span></div><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> Illuminate\Foundation\Support\Providers\</span><span style="color: #FFCB8B;">EventServiceProvider</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">as</span><span style="color: #BFC7D5;"> ServiceProvider;</span></div><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> Laravel\Cashier\Events\</span><span style="color: #FFCB8B;">WebhookReceived</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #C792EA;">class</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB6B;">EventServiceProvider</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">extends</span><span style="color: #BFC7D5;"> </span><span style="color: #A9C77D;">ServiceProvider</span></div><div class="line"><span style="color: #BFC7D5;">{</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #C792EA;">protected</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$listen</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> [</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #FFCB8B;">WebhookReceived</span><span style="color: #89DDFF;">::</span><span style="color: #C792EA;">class</span><span style="color: #BFC7D5;"> </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #BFC7D5;"> [</span></div><div class="line"><span style="color: #BFC7D5;">            </span><span style="color: #FFCB8B;">StripeEventListener</span><span style="color: #89DDFF;">::</span><span style="color: #C792EA;">class</span><span style="color: #BFC7D5;">,</span></div><div class="line"><span style="color: #BFC7D5;">        ],</span></div><div class="line"><span style="color: #BFC7D5;">    ];</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<p><a class="dashAnchor" name="//apple_ref/Section/Verifying%20Webhook%20Signatures"></a><a name="verifying-webhook-signatures"></a></p>
<h3>Verifying Webhook Signatures</h3>
<p>To secure your webhooks, you may use <a href="https://stripe.com/docs/webhooks/signatures">Stripe's webhook signatures</a>. For convenience, Cashier automatically includes a middleware which validates that the incoming Stripe webhook request is valid.</p>
<p>To enable webhook verification, ensure that the <code>STRIPE_WEBHOOK_SECRET</code> environment variable is set in your application's <code>.env</code> file. The webhook <code>secret</code> may be retrieved from your Stripe account dashboard.</p>
<p><a class="dashAnchor" name="//apple_ref/Section/Single%20Charges"></a><a name="single-charges"></a></p>
<h2>Single Charges</h2>
<p><a class="dashAnchor" name="//apple_ref/Section/Simple%20Charge"></a><a name="simple-charge"></a></p>
<h3>Simple Charge</h3>
<blockquote>
<p>{note} The <code>charge</code> method accepts the amount you would like to charge in the lowest denominator of the currency used by your application. For example, when using United States Dollars, amounts should be specified in pennies.</p>
</blockquote>
<p>If you would like to make a one-time charge against a customer, you may use the <code>charge</code> method on a billable model instance. You will need to <a href="#payment-methods-for-single-charges">provide a payment method identifier</a> as the second argument to the <code>charge</code> method:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> Illuminate\Http\</span><span style="color: #FFCB8B;">Request</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #FFCB8B;">Route</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">post</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">/purchase</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #C792EA;">function</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">(</span><span style="color: #FFCB8B;">Request</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$request</span><span style="color: #D9F5DD;">)</span><span style="color: #BFC7D5;"> {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #BEC5D4;">$stripeCharge</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$request</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">user</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">charge</span><span style="color: #BFC7D5;">(</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #F78C6C;">100</span><span style="color: #BFC7D5;">, </span><span style="color: #BEC5D4;">$request</span><span style="color: #89DDFF;">-&gt;paymentMethodId</span></div><div class="line"><span style="color: #BFC7D5;">    );</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #697098;">//</span><span style="color: #697098;"> ...</span></div><div class="line"><span style="color: #BFC7D5;">});</span></div></code></pre>
<p>The <code>charge</code> method accepts an array as its third argument, allowing you to pass any options you wish to the underlying Stripe charge creation. More information regarding the options available to you when creating charges may be found in the <a href="https://stripe.com/docs/api/charges/create">Stripe documentation</a>:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">charge</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">100</span><span style="color: #BFC7D5;">, </span><span style="color: #BEC5D4;">$paymentMethod</span><span style="color: #BFC7D5;">, [</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">custom_option</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;"> </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$value</span><span style="color: #BFC7D5;">,</span></div><div class="line"><span style="color: #BFC7D5;">]);</span></div></code></pre>
<p>You may also use the <code>charge</code> method without an underlying customer or user. To accomplish this, invoke the <code>charge</code> method on a new instance of your application's billable model:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> App\Models\</span><span style="color: #FFCB8B;">User</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$stripeCharge</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> (</span><span style="color: #89DDFF;">new</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB8B;">User</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">charge</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">100</span><span style="color: #BFC7D5;">, </span><span style="color: #BEC5D4;">$paymentMethod</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p>The <code>charge</code> method will throw an exception if the charge fails. If the charge is successful, an instance of <code>Laravel\Cashier\Payment</code> will be returned from the method:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">try</span><span style="color: #BFC7D5;"> {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #BEC5D4;">$payment</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">charge</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">100</span><span style="color: #BFC7D5;">, </span><span style="color: #BEC5D4;">$paymentMethod</span><span style="color: #BFC7D5;">);</span></div><div class="line"><span style="color: #BFC7D5;">} </span><span style="color: #C792EA;">catch</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">(</span><span style="color: #FFCB6B;">Exception</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$e</span><span style="color: #D9F5DD;">)</span><span style="color: #BFC7D5;"> {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #697098;">//</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<p><a class="dashAnchor" name="//apple_ref/Section/Charge%20With%20Invoice"></a><a name="charge-with-invoice"></a></p>
<h3>Charge With Invoice</h3>
<p>Sometimes you may need to make a one-time charge and offer a PDF receipt to your customer. The <code>invoicePrice</code> method lets you do just that. For example, let's invoice a customer for five new shirts:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">invoicePrice</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_tshirt</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #F78C6C;">5</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p>The invoice will be immediately charged against the user's default payment method. The <code>invoicePrice</code> method also accepts an array as its third argument. This array contains the billing options for the invoice item. The fourth argument accepted by the method is also an array which should contain the billing options for the invoice itself:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">invoicePrice</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_tshirt</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #F78C6C;">5</span><span style="color: #BFC7D5;">, [</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">discounts</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;"> </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #BFC7D5;"> [</span></div><div class="line"><span style="color: #BFC7D5;">        [</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">coupon</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;"> </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">SUMMER21SALE</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">]</span></div><div class="line"><span style="color: #BFC7D5;">    ],</span></div><div class="line"><span style="color: #BFC7D5;">], [</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default_tax_rates</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;"> </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #BFC7D5;"> [</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">txr_id</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">],</span></div><div class="line"><span style="color: #BFC7D5;">]);</span></div></code></pre>
<p>Alternatively, you may use the <code>invoiceFor</code> method to make a "one-off" charge against the customer's default payment method:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">invoiceFor</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">One Time Fee</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #F78C6C;">500</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p>Although the <code>invoiceFor</code> method is available for you to use, it is recommendeded that you use the <code>invoicePrice</code> method with pre-defined prices. By doing so, you will have access to better analytics and data within your Stripe dashboard regarding your sales on a per-product basis.</p>
<blockquote>
<p>{note} The <code>invoicePrice</code> and <code>invoiceFor</code> methods will create a Stripe invoice which will retry failed billing attempts. If you do not want invoices to retry failed charges, you will need to close them using the Stripe API after the first failed charge.</p>
</blockquote>
<p><a class="dashAnchor" name="//apple_ref/Section/Refunding%20Charges"></a><a name="refunding-charges"></a></p>
<h3>Refunding Charges</h3>
<p>If you need to refund a Stripe charge, you may use the <code>refund</code> method. This method accepts the Stripe <a href="#payment-methods-for-single-charges">payment intent ID</a> as its first argument:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$payment</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">charge</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">100</span><span style="color: #BFC7D5;">, </span><span style="color: #BEC5D4;">$paymentMethodId</span><span style="color: #BFC7D5;">);</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">refund</span><span style="color: #BFC7D5;">(</span><span style="color: #BEC5D4;">$payment</span><span style="color: #89DDFF;">-&gt;id</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p><a class="dashAnchor" name="//apple_ref/Section/Invoices"></a><a name="invoices"></a></p>
<h2>Invoices</h2>
<p><a class="dashAnchor" name="//apple_ref/Section/Retrieving%20Invoices"></a><a name="retrieving-invoices"></a></p>
<h3>Retrieving Invoices</h3>
<p>You may easily retrieve an array of a billable model's invoices using the <code>invoices</code> method. The <code>invoices</code> method returns a collection of <code>Laravel\Cashier\Invoice</code> instances:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$invoices</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">invoices</span><span style="color: #BFC7D5;">();</span></div></code></pre>
<p>If you would like to include pending invoices in the results, you may use the <code>invoicesIncludingPending</code> method:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$invoices</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">invoicesIncludingPending</span><span style="color: #BFC7D5;">();</span></div></code></pre>
<p>You may use the <code>findInvoice</code> method to retrieve a specific invoice by its ID:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$invoice</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">findInvoice</span><span style="color: #BFC7D5;">(</span><span style="color: #BEC5D4;">$invoiceId</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p><a name="displaying-invoice-information"></a></p>
<h4>Displaying Invoice Information</h4>
<p>When listing the invoices for the customer, you may use the invoice's methods to display the relevant invoice information. For example, you may wish to list every invoice in a table, allowing the user to easily download any of them:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">&lt;</span><span style="color: #82AAFF;">table</span><span style="color: #C792EA;">&gt;</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #89DDFF;">@</span><span style="color: #C792EA;">foreach</span><span style="color: #BFC7D5;"> (</span><span style="color: #BEC5D4;">$invoices</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">as</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$invoice</span><span style="color: #BFC7D5;">)</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #C792EA;">&lt;</span><span style="color: #82AAFF;">tr</span><span style="color: #C792EA;">&gt;</span></div><div class="line"><span style="color: #BFC7D5;">            </span><span style="color: #C792EA;">&lt;</span><span style="color: #82AAFF;">td</span><span style="color: #C792EA;">&gt;</span><span style="color: #BFC7D5;">{{ </span><span style="color: #BEC5D4;">$invoice</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">date</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">toFormattedDateString</span><span style="color: #BFC7D5;">() }}</span><span style="color: #C792EA;">&lt;</span><span style="color: #89DDFF;">/</span><span style="color: #82AAFF;">td</span><span style="color: #C792EA;">&gt;</span></div><div class="line"><span style="color: #BFC7D5;">            </span><span style="color: #C792EA;">&lt;</span><span style="color: #82AAFF;">td</span><span style="color: #C792EA;">&gt;</span><span style="color: #BFC7D5;">{{ </span><span style="color: #BEC5D4;">$invoice</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">total</span><span style="color: #BFC7D5;">() }}</span><span style="color: #C792EA;">&lt;</span><span style="color: #89DDFF;">/</span><span style="color: #82AAFF;">td</span><span style="color: #C792EA;">&gt;</span></div><div class="line"><span style="color: #BFC7D5;">            </span><span style="color: #C792EA;">&lt;</span><span style="color: #82AAFF;">td</span><span style="color: #C792EA;">&gt;&lt;</span><span style="color: #82AAFF;">a</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">href</span><span style="color: #C792EA;">=</span><span style="color: #D9F5DD;">"</span><span style="color: #C3E88D;">/user/invoice/{{ </span><span style="color: #BEC5D4;">$invoice</span><span style="color: #89DDFF;">-&gt;id</span><span style="color: #C3E88D;"> }}</span><span style="color: #D9F5DD;">"</span><span style="color: #C792EA;">&gt;</span><span style="color: #82AAFF;">Download</span><span style="color: #C792EA;">&lt;</span><span style="color: #89DDFF;">/</span><span style="color: #82AAFF;">a</span><span style="color: #C792EA;">&gt;&lt;</span><span style="color: #89DDFF;">/</span><span style="color: #82AAFF;">td</span><span style="color: #C792EA;">&gt;</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #C792EA;">&lt;</span><span style="color: #89DDFF;">/</span><span style="color: #82AAFF;">tr</span><span style="color: #C792EA;">&gt;</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #89DDFF;">@</span><span style="color: #C792EA;">endforeach</span></div><div class="line"><span style="color: #C792EA;">&lt;</span><span style="color: #89DDFF;">/</span><span style="color: #82AAFF;">table</span><span style="color: #C792EA;">&gt;</span></div></code></pre>
<p><a class="dashAnchor" name="//apple_ref/Section/Upcoming%20Invoices"></a><a name="upcoming-invoices"></a></p>
<h3>Upcoming Invoices</h3>
<p>To retrieve the upcoming invoice for a customer, you may use the <code>upcomingInvoice</code> method:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$invoice</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">upcomingInvoice</span><span style="color: #BFC7D5;">();</span></div></code></pre>
<p>Similary, if the customer has multiple subscriptions, you can also retrieve the upcoming invoice for a specific subscription:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$invoice</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">upcomingInvoice</span><span style="color: #BFC7D5;">();</span></div></code></pre>
<p><a class="dashAnchor" name="//apple_ref/Section/Previewing%20Subscription%20Invoices"></a><a name="previewing-subscription-invoices"></a></p>
<h3>Previewing Subscription Invoices</h3>
<p>Using the <code>previewInvoice</code> method, you can preview an invoice before making price changes. This will allow you to determine what your customer's invoice will look like when a given price change is made:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$invoice</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">previewInvoice</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_yearly</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p>You may pass an array of prices to the <code>previewInvoice</code> method in order to preview invoices with multiple new prices:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$invoice</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">previewInvoice</span><span style="color: #BFC7D5;">([</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_yearly</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_metered</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">]);</span></div></code></pre>
<p><a class="dashAnchor" name="//apple_ref/Section/Generating%20Invoice%20PDFs"></a><a name="generating-invoice-pdfs"></a></p>
<h3>Generating Invoice PDFs</h3>
<p>From within a route or controller, you may use the <code>downloadInvoice</code> method to generate a PDF download of a given invoice. This method will automatically generate the proper HTTP response needed to download the invoice:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> Illuminate\Http\</span><span style="color: #FFCB8B;">Request</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #FFCB8B;">Route</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">get</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">/user/invoice/{invoice}</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #C792EA;">function</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">(</span><span style="color: #FFCB8B;">Request</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$request</span><span style="color: #BFC7D5;">, </span><span style="color: #BEC5D4;">$invoiceId</span><span style="color: #D9F5DD;">)</span><span style="color: #BFC7D5;"> {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #C792EA;">return</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$request</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">user</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">downloadInvoice</span><span style="color: #BFC7D5;">(</span><span style="color: #BEC5D4;">$invoiceId</span><span style="color: #BFC7D5;">, [</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">vendor</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;"> </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">Your Company</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">,</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">product</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;"> </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">Your Product</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">,</span></div><div class="line"><span style="color: #BFC7D5;">    ]);</span></div><div class="line"><span style="color: #BFC7D5;">});</span></div></code></pre>
<p>By default, all data on the invoice is derived from the customer and invoice data stored in Stripe. However, you can customize some of this data by providing an array as the second argument to the <code>downloadInvoice</code> method. This array allows you to customize information such as your company and product details:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">return</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$request</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">user</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">downloadInvoice</span><span style="color: #BFC7D5;">(</span><span style="color: #BEC5D4;">$invoiceId</span><span style="color: #BFC7D5;">, [</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">vendor</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;"> </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">Your Company</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">,</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">product</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;"> </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">Your Product</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">,</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">street</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;"> </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">Main Str. 1</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">,</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">location</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;"> </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">2000 Antwerp, Belgium</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">,</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">phone</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;"> </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">+32 499 00 00 00</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">,</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">email</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;"> </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;"><a href="https://laravel.com/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="167f78707956736e777b667a733875797b">[email&nbsp;protected]</a></span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">,</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">url</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;"> </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">https://example.com</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">,</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">vendorVat</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;"> </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">BE123456789</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">,</span></div><div class="line"><span style="color: #BFC7D5;">], </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">my-invoice</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p>The <code>downloadInvoice</code> method also allows for a custom filename via its third argument. This filename will automatically be suffixed with <code>.pdf</code>:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">return</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$request</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">user</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">downloadInvoice</span><span style="color: #BFC7D5;">(</span><span style="color: #BEC5D4;">$invoiceId</span><span style="color: #BFC7D5;">, [], </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">my-invoice</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p><a name="custom-invoice-render"></a></p>
<h4>Custom Invoice Renderer</h4>
<p>Cashier also makes it possible to use a custom invoice renderer. By default, Cashier uses the <code>DompdfInvoiceRenderer</code> implementation, which utilizes the <a href="https://github.com/dompdf/dompdf">dompdf</a> PHP library to generate Cashier's invoices. However, you may use any renderer you wish by implementing the <code>Laravel\Cashier\Contracts\InvoiceRenderer</code> interface. For example, you may wish to render an invoice PDF using an API call to a third-party PDF rendering service:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> Illuminate\Support\Facades\</span><span style="color: #FFCB8B;">Http</span><span style="color: #BFC7D5;">;</span></div><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> Laravel\Cashier\Contracts\</span><span style="color: #FFCB8B;">InvoiceRenderer</span><span style="color: #BFC7D5;">;</span></div><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> Laravel\Cashier\</span><span style="color: #FFCB8B;">Invoice</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #C792EA;">class</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB6B;">ApiInvoiceRenderer</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">implements</span><span style="color: #BFC7D5;"> </span><span style="color: #A9C77D;">InvoiceRenderer</span></div><div class="line"><span style="color: #BFC7D5;">{</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #697098;">/**</span></div><div class="line"><span style="color: #697098;">     * Render the given invoice and return the raw PDF bytes.</span></div><div class="line"><span style="color: #697098;">     *</span></div><div class="line"><span style="color: #697098;">     * </span><span style="color: #C792EA;">@param</span><span style="color: #697098;">  </span><span style="color: #697098;">\</span><span style="color: #697098;">Laravel</span><span style="color: #697098;">\</span><span style="color: #697098;">Cashier</span><span style="color: #697098;">\</span><span style="color: #FFCB8B;">Invoice</span><span style="color: #697098;">. $invoice</span></div><div class="line"><span style="color: #697098;">     * </span><span style="color: #C792EA;">@param</span><span style="color: #697098;">  </span><span style="color: #C792EA;">array</span><span style="color: #697098;">  $data</span></div><div class="line"><span style="color: #697098;">     * </span><span style="color: #C792EA;">@param</span><span style="color: #697098;">  </span><span style="color: #C792EA;">array</span><span style="color: #697098;">  $options</span></div><div class="line"><span style="color: #697098;">     * </span><span style="color: #C792EA;">@return</span><span style="color: #697098;"> </span><span style="color: #C792EA;">string</span></div><div class="line"><span style="color: #697098;">     </span><span style="color: #697098;">*/</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #C792EA;">public</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">function</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">render</span><span style="color: #D9F5DD;">(</span><span style="color: #FFCB8B;">Invoice</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$invoice</span><span style="color: #BFC7D5;">, </span><span style="color: #C792EA;">array</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$data</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> [], </span><span style="color: #C792EA;">array</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$options</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> []</span><span style="color: #D9F5DD;">)</span><span style="color: #89DDFF;">:</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">string</span></div><div class="line"><span style="color: #BFC7D5;">    {</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #BEC5D4;">$html</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$invoice</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">view</span><span style="color: #BFC7D5;">(</span><span style="color: #BEC5D4;">$data</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">render</span><span style="color: #BFC7D5;">();</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #C792EA;">return</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB8B;">Http</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">get</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">https://example.com/html-to-pdf</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, [</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">html</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;"> </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$html</span><span style="color: #BFC7D5;">])</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">get</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">body</span><span style="color: #BFC7D5;">();</span></div><div class="line"><span style="color: #BFC7D5;">    }</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<p>Once you have implemented the invoice renderer contract, you should update the <code>cashier.invoices.renderer</code> configuration value in your application's <code>config/cashier.php</code> configuration file. This configuration value should be set to the class name of your custom renderer implementation.</p>
<p><a class="dashAnchor" name="//apple_ref/Section/Checkout"></a><a name="checkout"></a></p>
<h2>Checkout</h2>
<p>Cashier Stripe also provides support for <a href="https://stripe.com/payments/checkout">Stripe Checkout</a>. Stripe Checkout takes the pain out of implementing custom pages to accept payments by providing a pre-built, hosted payment page.</p>
<p>The following documentation contains information on how to get started using Stripe Checkout with Cashier. To learn more about Stripe Checkout, you should also consider reviewing <a href="https://stripe.com/docs/payments/checkout">Stripe's own documentation on Checkout</a>.</p>
<p><a class="dashAnchor" name="//apple_ref/Section/Product%20Checkouts"></a><a name="product-checkouts"></a></p>
<h3>Product Checkouts</h3>
<p>You may perform a checkout for an existing product that has been created within your Stripe dashboard using the <code>checkout</code> method on a billable model. The <code>checkout</code> method will initiate a new Stripe Checkout session. By default, you're required to pass a Stripe Price ID:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> Illuminate\Http\</span><span style="color: #FFCB8B;">Request</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #FFCB8B;">Route</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">get</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">/product-checkout</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #C792EA;">function</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">(</span><span style="color: #FFCB8B;">Request</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$request</span><span style="color: #D9F5DD;">)</span><span style="color: #BFC7D5;"> {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #C792EA;">return</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$request</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">user</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">checkout</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_tshirt</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div><div class="line"><span style="color: #BFC7D5;">});</span></div></code></pre>
<p>If needed, you may also specify a product quantity:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> Illuminate\Http\</span><span style="color: #FFCB8B;">Request</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #FFCB8B;">Route</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">get</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">/product-checkout</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #C792EA;">function</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">(</span><span style="color: #FFCB8B;">Request</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$request</span><span style="color: #D9F5DD;">)</span><span style="color: #BFC7D5;"> {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #C792EA;">return</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$request</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">user</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">checkout</span><span style="color: #BFC7D5;">([</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_tshirt</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;"> </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #BFC7D5;"> </span><span style="color: #F78C6C;">15</span><span style="color: #BFC7D5;">]);</span></div><div class="line"><span style="color: #BFC7D5;">});</span></div></code></pre>
<p>When a customer visits this route they will be redirected to Stripe's Checkout page. By default, when a user successfully completes or cancels a purchase they will be redirected to your <code>home</code> route location, but you may specify custom callback URLs using the <code>success_url</code> and <code>cancel_url</code> options:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> Illuminate\Http\</span><span style="color: #FFCB8B;">Request</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #FFCB8B;">Route</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">get</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">/product-checkout</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #C792EA;">function</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">(</span><span style="color: #FFCB8B;">Request</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$request</span><span style="color: #D9F5DD;">)</span><span style="color: #BFC7D5;"> {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #C792EA;">return</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$request</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">user</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">checkout</span><span style="color: #BFC7D5;">([</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_tshirt</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;"> </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #BFC7D5;"> </span><span style="color: #F78C6C;">1</span><span style="color: #BFC7D5;">], [</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">success_url</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;"> </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">route</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">your-success-route</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">),</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">cancel_url</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;"> </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">route</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">your-cancel-route</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">),</span></div><div class="line"><span style="color: #BFC7D5;">    ]);</span></div><div class="line"><span style="color: #BFC7D5;">});</span></div></code></pre>
<p>When defining your <code>success_url</code> checkout option, you may instruct Stripe to add the checkout session ID as a query string parameter when invoking your URL. To do so, add the literal string <code>{CHECKOUT_SESSION_ID}</code> to your <code>success_url</code> query string. Stripe will replace this placeholder with the actual checkout session ID:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> Illuminate\Http\</span><span style="color: #FFCB8B;">Request</span><span style="color: #BFC7D5;">;</span></div><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> Stripe\Checkout\</span><span style="color: #FFCB8B;">Session</span><span style="color: #BFC7D5;">;</span></div><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> Stripe\</span><span style="color: #FFCB8B;">Customer</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #FFCB8B;">Route</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">get</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">/product-checkout</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #C792EA;">function</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">(</span><span style="color: #FFCB8B;">Request</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$request</span><span style="color: #D9F5DD;">)</span><span style="color: #BFC7D5;"> {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #C792EA;">return</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$request</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">user</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">checkout</span><span style="color: #BFC7D5;">([</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_tshirt</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;"> </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #BFC7D5;"> </span><span style="color: #F78C6C;">1</span><span style="color: #BFC7D5;">], [</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">success_url</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;"> </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">route</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">checkout-success</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">) </span><span style="color: #89DDFF;">.</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">?session_id={CHECKOUT_SESSION_ID}</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">,</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">cancel_url</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;"> </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">route</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">checkout-cancel</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">),</span></div><div class="line"><span style="color: #BFC7D5;">    ]);</span></div><div class="line"><span style="color: #BFC7D5;">});</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #FFCB8B;">Route</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">get</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">/checkout-success</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #C792EA;">function</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">(</span><span style="color: #FFCB8B;">Request</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$request</span><span style="color: #D9F5DD;">)</span><span style="color: #BFC7D5;"> {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #BEC5D4;">$checkoutSession</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$request</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">user</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">stripe</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;checkout-&gt;sessions-&gt;</span><span style="color: #82AAFF;">retrieve</span><span style="color: #BFC7D5;">(</span><span style="color: #BEC5D4;">$request</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">get</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">session_id</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">));</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #C792EA;">return</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">view</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">checkout.success</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">,</span><span style="color: #82AAFF;"> </span><span style="color: #BFC7D5;">[</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">checkoutSession</span><span style="color: #D9F5DD;">'</span><span style="color: #82AAFF;"> </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #82AAFF;"> </span><span style="color: #BFC7D5;">$</span><span style="color: #BEC5D4;">checkoutSession</span><span style="color: #BFC7D5;">]);</span></div><div class="line"><span style="color: #BFC7D5;">})</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">name</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">checkout-success</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p><a name="checkout-promotion-codes"></a></p>
<h4>Promotion Codes</h4>
<p>By default, Stripe Checkout does not allow <a href="https://stripe.com/docs/billing/subscriptions/discounts/codes">user redeemable promotion codes</a>. Luckily, there's an easy way to enable these for your Checkout page. To do so, you may invoke the <code>allowPromotionCodes</code> method:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> Illuminate\Http\</span><span style="color: #FFCB8B;">Request</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #FFCB8B;">Route</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">get</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">/product-checkout</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #C792EA;">function</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">(</span><span style="color: #FFCB8B;">Request</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$request</span><span style="color: #D9F5DD;">)</span><span style="color: #BFC7D5;"> {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #C792EA;">return</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$request</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">user</span><span style="color: #BFC7D5;">()</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">allowPromotionCodes</span><span style="color: #BFC7D5;">()</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">checkout</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_tshirt</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div><div class="line"><span style="color: #BFC7D5;">});</span></div></code></pre>
<p><a class="dashAnchor" name="//apple_ref/Section/Single%20Charge%20Checkouts"></a><a name="single-charge-checkouts"></a></p>
<h3>Single Charge Checkouts</h3>
<p>You can also perform a simple charge for an ad-hoc product that has not been created in your Stripe dashboard. To do so you may use the <code>checkoutCharge</code> method on a billable model and pass it a chargeable amount, a product name, and an optional quantity. When a customer visits this route they will be redirected to Stripe's Checkout page:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> Illuminate\Http\</span><span style="color: #FFCB8B;">Request</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #FFCB8B;">Route</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">get</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">/charge-checkout</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #C792EA;">function</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">(</span><span style="color: #FFCB8B;">Request</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$request</span><span style="color: #D9F5DD;">)</span><span style="color: #BFC7D5;"> {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #C792EA;">return</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$request</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">user</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">checkoutCharge</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">1200</span><span style="color: #BFC7D5;">, </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">T-Shirt</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #F78C6C;">5</span><span style="color: #BFC7D5;">);</span></div><div class="line"><span style="color: #BFC7D5;">});</span></div></code></pre>
<blockquote>
<p>{note} When using the <code>checkoutCharge</code> method, Stripe will always create a new product and price in your Stripe dashboard. Therefore, we recommend that you create the products up front in your Stripe dashboard and use the <code>checkout</code> method instead.</p>
</blockquote>
<p><a class="dashAnchor" name="//apple_ref/Section/Subscription%20Checkouts"></a><a name="subscription-checkouts"></a></p>
<h3>Subscription Checkouts</h3>
<blockquote>
<p>{note} Using Stripe Checkout for subscriptions requires you to enable the <code>customer.subscription.created</code> webhook in your Stripe dashboard. This webhook will create the subscription record in your database and store all of the relevant subscription items.</p>
</blockquote>
<p>You may also use Stripe Checkout to initiate subscriptions. After defining your subscription with Cashier's subscription builder methods, you may call the <code>checkout </code>method. When a customer visits this route they will be redirected to Stripe's Checkout page:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> Illuminate\Http\</span><span style="color: #FFCB8B;">Request</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #FFCB8B;">Route</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">get</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">/subscription-checkout</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #C792EA;">function</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">(</span><span style="color: #FFCB8B;">Request</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$request</span><span style="color: #D9F5DD;">)</span><span style="color: #BFC7D5;"> {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #C792EA;">return</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$request</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">user</span><span style="color: #BFC7D5;">()</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">newSubscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_monthly</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">checkout</span><span style="color: #BFC7D5;">();</span></div><div class="line"><span style="color: #BFC7D5;">});</span></div></code></pre>
<p>Just as with product checkouts, you may customize the success and cancellation URLs:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> Illuminate\Http\</span><span style="color: #FFCB8B;">Request</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #FFCB8B;">Route</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">get</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">/subscription-checkout</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #C792EA;">function</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">(</span><span style="color: #FFCB8B;">Request</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$request</span><span style="color: #D9F5DD;">)</span><span style="color: #BFC7D5;"> {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #C792EA;">return</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$request</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">user</span><span style="color: #BFC7D5;">()</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">newSubscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_monthly</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">checkout</span><span style="color: #BFC7D5;">([</span></div><div class="line"><span style="color: #BFC7D5;">            </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">success_url</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;"> </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">route</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">your-success-route</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">),</span></div><div class="line"><span style="color: #BFC7D5;">            </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">cancel_url</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;"> </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">route</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">your-cancel-route</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">),</span></div><div class="line"><span style="color: #BFC7D5;">        ]);</span></div><div class="line"><span style="color: #BFC7D5;">});</span></div></code></pre>
<p>Of course, you can also enable promotion codes for subscription checkouts:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> Illuminate\Http\</span><span style="color: #FFCB8B;">Request</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #FFCB8B;">Route</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">get</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">/subscription-checkout</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #C792EA;">function</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">(</span><span style="color: #FFCB8B;">Request</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$request</span><span style="color: #D9F5DD;">)</span><span style="color: #BFC7D5;"> {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #C792EA;">return</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$request</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">user</span><span style="color: #BFC7D5;">()</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">newSubscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_monthly</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">allowPromotionCodes</span><span style="color: #BFC7D5;">()</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">checkout</span><span style="color: #BFC7D5;">();</span></div><div class="line"><span style="color: #BFC7D5;">});</span></div></code></pre>
<blockquote>
<p>{note} Unfortunately Stripe Checkout does not support all subscription billing options when starting subscriptions. Using the <code>anchorBillingCycleOn</code> method on the subscription builder, setting proration behavior, or setting payment behavior will not have any effect during Stripe Checkout sessions. Please consult <a href="https://stripe.com/docs/api/checkout/sessions/create">the Stripe Checkout Session API documentation</a> to review which parameters are available.</p>
</blockquote>
<p><a name="stripe-checkout-trial-periods"></a></p>
<h4>Stripe Checkout &amp; Trial Periods</h4>
<p>Of course, you can define a trial period when building a subscription that will be completed using Stripe Checkout:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$checkout</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB8B;">Auth</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">user</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">newSubscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_monthly</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">trialDays</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">3</span><span style="color: #BFC7D5;">)</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">checkout</span><span style="color: #BFC7D5;">();</span></div></code></pre>
<p>However, the trial period must be at least 48 hours, which is the minimum amount of trial time supported by Stripe Checkout.</p>
<p><a name="stripe-checkout-subscriptions-and-webhooks"></a></p>
<h4>Subscriptions &amp; Webhooks</h4>
<p>Remember, Stripe and Cashier update subscription statuses via webhooks, so there's a possibility a subscription might not yet be active when the customer returns to the application after entering their payment information. To handle this scenario, you may wish to display a message informing the user that their payment or subscription is pending.</p>
<p><a class="dashAnchor" name="//apple_ref/Section/Collecting%20Tax%20IDs"></a><a name="collecting-tax-ids"></a></p>
<h3>Collecting Tax IDs</h3>
<p>Checkout also supports collecting a customer's Tax ID. To enable this on a checkout session, invoke the <code>collectTaxIds</code> method when creating the session:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$checkout</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">collectTaxIds</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">checkout</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_tshirt</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div></code></pre>
<p>When this method is invoked, a new checkbox will be available to the customer that allows them to indicate if they're purchasing as a company. If so, they will have the opportunity to provide their Tax ID number.</p>
<blockquote>
<p>{note} If you have already configured <a href="#tax-configuration">automatic tax collection</a> in your application's service provider then this feature will be enabled automatically and there is no need to invoke the <code>collectTaxIds</code> method.</p>
</blockquote>
<p><a class="dashAnchor" name="//apple_ref/Section/Handling%20Failed%20Payments"></a><a name="handling-failed-payments"></a></p>
<h2>Handling Failed Payments</h2>
<p>Sometimes, payments for subscriptions or single charges can fail. When this happens, Cashier will throw an <code>Laravel\Cashier\Exceptions\IncompletePayment</code> exception that informs you that this happened. After catching this exception, you have two options on how to proceed.</p>
<p>First, you could redirect your customer to the dedicated payment confirmation page which is included with Cashier. This page already has an associated named route that is registered via Cashier's service provider. So, you may catch the <code>IncompletePayment</code> exception and redirect the user to the payment confirmation page:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> Laravel\Cashier\Exceptions\</span><span style="color: #FFCB8B;">IncompletePayment</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #C792EA;">try</span><span style="color: #BFC7D5;"> {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #BEC5D4;">$subscription</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">newSubscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">, </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">price_monthly</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span></div><div class="line"><span style="color: #BFC7D5;">                            </span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">create</span><span style="color: #BFC7D5;">(</span><span style="color: #BEC5D4;">$paymentMethod</span><span style="color: #BFC7D5;">);</span></div><div class="line"><span style="color: #BFC7D5;">} </span><span style="color: #C792EA;">catch</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">(</span><span style="color: #FFCB6B;">IncompletePayment</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$exception</span><span style="color: #D9F5DD;">)</span><span style="color: #BFC7D5;"> {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #C792EA;">return</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">redirect</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">route</span><span style="color: #BFC7D5;">(</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">cashier.payment</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">,</span></div><div class="line"><span style="color: #BFC7D5;">        [</span><span style="color: #BEC5D4;">$exception</span><span style="color: #89DDFF;">-&gt;payment-&gt;id</span><span style="color: #BFC7D5;">, </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">redirect</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;"> </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">route</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">home</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)]</span></div><div class="line"><span style="color: #BFC7D5;">    );</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<p>On the payment confirmation page, the customer will be prompted to enter their credit card information again and perform any additional actions required by Stripe, such as "3D Secure" confirmation. After confirming their payment, the user will be redirected to the URL provided by the <code>redirect</code> parameter specified above. Upon redirection, <code>message</code> (string) and <code>success</code> (integer) query string variables will be added to the URL. The payment page currently supports the following payment method types:</p>
<div class="content-list" markdown="1">
<ul>
<li>Credit Cards</li>
<li>Alipay</li>
<li>Bancontact</li>
<li>BECS Direct Debit</li>
<li>EPS</li>
<li>Giropay</li>
<li>iDEAL</li>
<li>SEPA Direct Debit</li>
</ul>
</div>
<p>Alternatively, you could allow Stripe to handle the payment confirmation for you. In this case, instead of redirecting to the payment confirmation page, you may <a href="https://dashboard.stripe.com/account/billing/automatic">setup Stripe's automatic billing emails</a> in your Stripe dashboard. However, if an <code>IncompletePayment</code> exception is caught, you should still inform the user they will receive an email with further payment confirmation instructions.</p>
<p>Payment exceptions may be thrown for the following methods: <code>charge</code>, <code>invoiceFor</code>, and <code>invoice</code> on models using the <code>Billable</code> trait. When interacting with subscriptions, the <code>create</code> method on the <code>SubscriptionBuilder</code>, and the <code>incrementAndInvoice</code> and <code>swapAndInvoice</code> methods on the <code>Subscription</code> and <code>SubscriptionItem</code> models may throw incomplete payment exceptions.</p>
<p>Determining if an existing subscription has an incomplete payment may be accomplished using the <code>hasIncompletePayment</code> method on the billable model or a subscription instance:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">if</span><span style="color: #BFC7D5;"> (</span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">hasIncompletePayment</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)) {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #697098;">//</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #C792EA;">if</span><span style="color: #BFC7D5;"> (</span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">subscription</span><span style="color: #BFC7D5;">(</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">default</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">)</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">hasIncompletePayment</span><span style="color: #BFC7D5;">()) {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #697098;">//</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<p>You can derive the specific status of an incomplete payment by inspecting the <code>payment</code> property on the exception instance:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> Laravel\Cashier\Exceptions\</span><span style="color: #FFCB8B;">IncompletePayment</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #C792EA;">try</span><span style="color: #BFC7D5;"> {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #BEC5D4;">$user</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">charge</span><span style="color: #BFC7D5;">(</span><span style="color: #F78C6C;">1000</span><span style="color: #BFC7D5;">, </span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">pm_card_threeDSecure2Required</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;">);</span></div><div class="line"><span style="color: #BFC7D5;">} </span><span style="color: #C792EA;">catch</span><span style="color: #BFC7D5;"> </span><span style="color: #D9F5DD;">(</span><span style="color: #FFCB6B;">IncompletePayment</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$exception</span><span style="color: #D9F5DD;">)</span><span style="color: #BFC7D5;"> {</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #697098;">//</span><span style="color: #697098;"> Get the payment intent status...</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #BEC5D4;">$exception</span><span style="color: #89DDFF;">-&gt;payment-&gt;status</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #697098;">//</span><span style="color: #697098;"> Check specific conditions...</span></div><div class="line"><span style="color: #BFC7D5;">    </span><span style="color: #C792EA;">if</span><span style="color: #BFC7D5;"> (</span><span style="color: #BEC5D4;">$exception</span><span style="color: #89DDFF;">-&gt;payment-&gt;</span><span style="color: #82AAFF;">requiresPaymentMethod</span><span style="color: #BFC7D5;">()) {</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #697098;">//</span><span style="color: #697098;"> ...</span></div><div class="line"><span style="color: #BFC7D5;">    } </span><span style="color: #C792EA;">elseif</span><span style="color: #BFC7D5;"> (</span><span style="color: #BEC5D4;">$exception</span><span style="color: #89DDFF;">-&gt;payment-&gt;</span><span style="color: #82AAFF;">requiresConfirmation</span><span style="color: #BFC7D5;">()) {</span></div><div class="line"><span style="color: #BFC7D5;">        </span><span style="color: #697098;">//</span><span style="color: #697098;"> ...</span></div><div class="line"><span style="color: #BFC7D5;">    }</span></div><div class="line"><span style="color: #BFC7D5;">}</span></div></code></pre>
<p><a class="dashAnchor" name="//apple_ref/Section/Strong%20Customer%20Authentication%20%28SCA%29"></a><a name="strong-customer-authentication"></a></p>
<h2>Strong Customer Authentication</h2>
<p>If your business or one of your customers is based in Europe you will need to abide by the EU's Strong Customer Authentication (SCA) regulations. These regulations were imposed&nbsp;in September 2019 by the European Union to prevent payment fraud. Luckily, Stripe and Cashier are prepared for building SCA compliant applications.</p>
<blockquote>
<p>{note} Before getting started, review <a href="https://stripe.com/guides/strong-customer-authentication">Stripe's guide on PSD2 and SCA</a> as well as their <a href="https://stripe.com/docs/strong-customer-authentication">documentation on the new SCA APIs</a>.</p>
</blockquote>
<p><a class="dashAnchor" name="//apple_ref/Section/Payments%20Requiring%20Additional%20Confirmation"></a><a name="payments-requiring-additional-confirmation"></a></p>
<h3>Payments Requiring Additional Confirmation</h3>
<p>SCA regulations often require extra verification in order to confirm and process a payment. When this happens, Cashier will throw a <code>Laravel\Cashier\Exceptions\IncompletePayment</code> exception that informs you that extra verification is needed. More information on how to handle these exceptions be found can be found in the documentation on <a href="#handling-failed-payments">handling failed payments</a>.</p>
<p>Payment confirmation screens presented by Stripe or Cashier may be tailored to a specific bank or card issuer's payment flow and can include additional card confirmation, a temporary small charge, separate device authentication, or other forms of verification.</p>
<p><a name="incomplete-and-past-due-state"></a></p>
<h4>Incomplete and Past Due State</h4>
<p>When a payment needs additional confirmation, the subscription will remain in an <code>incomplete</code> or <code>past_due</code> state as indicated by its <code>stripe_status</code> database column. Cashier will automatically activate the customer's subscription as soon as payment confirmation is complete and your application is notified by Stripe via webhook of its completion.</p>
<p>For more information on <code>incomplete</code> and <code>past_due</code> states, please refer to <a href="#incomplete-and-past-due-status">our additional documentation on these states</a>.</p>
<p><a class="dashAnchor" name="//apple_ref/Section/Off%2Dsession%20Payment%20Notifications"></a><a name="off-session-payment-notifications"></a></p>
<h3>Off-Session Payment Notifications</h3>
<p>Since SCA regulations require customers to occasionally verify their payment details even while their subscription is active, Cashier can send a notification to the customer when off-session payment confirmation is required. For example, this may occur when a subscription is renewing. Cashier's payment notification can be enabled by setting the <code>CASHIER_PAYMENT_NOTIFICATION</code> environment variable to a notification class. By default, this notification is disabled. Of course, Cashier includes a notification class you may use for this purpose, but you are free to provide your own notification class if desired:</p>
<pre><code data-theme="olaolu-palenight" data-lang="ini" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">CASHIER_PAYMENT_NOTIFICATION</span><span style="color: #BFC7D5;">=Laravel\Cashier\Notifications\ConfirmPayment</span></div></code></pre>
<p>To ensure that off-session payment confirmation notifications are delivered, verify that <a href="#handling-stripe-webhooks">Stripe webhooks are configured</a> for your application and the <code>invoice.payment_action_required</code> webhook is enabled in your Stripe dashboard. In addition, your <code>Billable</code> model should also use Laravel's <code>Illuminate\Notifications\Notifiable</code> trait.</p>
<blockquote>
<p>{note} Notifications will be sent even when customers are manually making a payment that requires additional confirmation. Unfortunately, there is no way for Stripe to know that the payment was done manually or "off-session". But, a customer will simply see a "Payment Successful" message if they visit the payment page after already confirming their payment. The customer will not be allowed to accidentally confirm the same payment twice and incur an accidental second charge.</p>
</blockquote>
<p><a class="dashAnchor" name="//apple_ref/Section/Stripe%20SDK"></a><a name="stripe-sdk"></a></p>
<h2>Stripe SDK</h2>
<p>Many of Cashier's objects are wrappers around Stripe SDK objects. If you would like to interact with the Stripe objects directly, you may conveniently retrieve them using the <code>asStripe</code> method:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$stripeSubscription</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #BEC5D4;">$subscription</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">asStripeSubscription</span><span style="color: #BFC7D5;">();</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$stripeSubscription</span><span style="color: #89DDFF;">-&gt;application_fee_percent</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #F78C6C;">5</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$stripeSubscription</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">save</span><span style="color: #BFC7D5;">();</span></div></code></pre>
<p>You may also use the <code>updateStripeSubscription</code> method to update a Stripe subscription directly:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #BEC5D4;">$subscription</span><span style="color: #89DDFF;">-&gt;</span><span style="color: #82AAFF;">updateStripeSubscription</span><span style="color: #BFC7D5;">([</span><span style="color: #D9F5DD;">'</span><span style="color: #C3E88D;">application_fee_percent</span><span style="color: #D9F5DD;">'</span><span style="color: #BFC7D5;"> </span><span style="color: #89DDFF;">=&gt;</span><span style="color: #BFC7D5;"> </span><span style="color: #F78C6C;">5</span><span style="color: #BFC7D5;">]);</span></div></code></pre>
<p>You may invoke the <code>stripe</code> method on the <code>Cashier</code> class if you would like to use the <code>Stripe\StripeClient</code> client directly. For example, you could use this method to access the <code>StripeClient</code> instance and retrieve a list of prices from your Stripe account:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">use</span><span style="color: #BFC7D5;"> Laravel\Cashier\</span><span style="color: #FFCB8B;">Cashier</span><span style="color: #BFC7D5;">;</span></div><div class="line">&nbsp;</div><div class="line"><span style="color: #BEC5D4;">$prices</span><span style="color: #BFC7D5;"> </span><span style="color: #C792EA;">=</span><span style="color: #BFC7D5;"> </span><span style="color: #FFCB8B;">Cashier</span><span style="color: #89DDFF;">::</span><span style="color: #82AAFF;">stripe</span><span style="color: #BFC7D5;">()</span><span style="color: #89DDFF;">-&gt;prices-&gt;</span><span style="color: #82AAFF;">all</span><span style="color: #BFC7D5;">();</span></div></code></pre>
<p><a class="dashAnchor" name="//apple_ref/Section/Testing"></a><a name="testing"></a></p>
<h2>Testing</h2>
<p>When testing an application that uses Cashier, you may mock the actual HTTP requests to the Stripe API; however, this requires you to partially re-implement Cashier's own behavior. Therefore, we recommend allowing your tests to hit the actual Stripe API. While this is slower, it provides more confidence that your application is working as expected and any slow tests may be placed within their own PHPUnit testing group.</p>
<p>When testing, remember that Cashier itself already has a great test suite, so you should only focus on testing the subscription and payment flow of your own application and not every underlying Cashier behavior.</p>
<p>To get started, add the <strong>testing</strong> version of your Stripe secret to your <code>phpunit.xml</code> file:</p>
<pre><code data-theme="olaolu-palenight" data-lang="php" class="torchlight" style="background-color: #292D3E; --theme-selection-background: #7580B850;"><!-- Syntax highlighted by torchlight.dev --><div class="line"><span style="color: #C792EA;">&lt;</span><span style="color: #82AAFF;">env</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">name</span><span style="color: #C792EA;">=</span><span style="color: #D9F5DD;">"</span><span style="color: #C3E88D;">STRIPE_SECRET</span><span style="color: #D9F5DD;">"</span><span style="color: #BFC7D5;"> </span><span style="color: #82AAFF;">value</span><span style="color: #C792EA;">=</span><span style="color: #D9F5DD;">"</span><span style="color: #C3E88D;">sk_test_&lt;your-key&gt;</span><span style="color: #D9F5DD;">"</span><span style="color: #89DDFF;">/</span><span style="color: #C792EA;">&gt;</span></div></code></pre>
<p>Now, whenever you interact with Cashier while testing, it will send actual API requests to your Stripe testing environment. For convenience, you should pre-fill your Stripe testing account with subscriptions / prices that you may use during testing.</p>
<blockquote>
<p>{tip} In order to test a variety of billing scenarios, such as credit card denials and failures, you may use the vast range of <a href="https://stripe.com/docs/testing">testing card numbers and tokens</a> provided by Stripe.</p>
</blockquote>

                                <script data-cfasync="false" src="../../cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script async="" type="text/javascript" src="../../../cdn.carbonads.com/carbon83bb.js?serve=CKYILK3E&amp;placement=laravelcom" id="_carbonads_js"></script>
</div>
                        </section>
                    </section>
                </div>
            </section>
        </div>
    </div>

<footer class="relative pt-12 dark:bg-dark-700">
    <div class="max-w-screen-2xl mx-auto w-full px-8">
        <div>
            <a href="https://laravel.com/" class="inline-flex">
                <img class="w-16 h-16" src="../../img/logomark.min.svg" alt="Laravel" loading="lazy">
            </a>
        </div>

        <div class="mt-6 grid grid-cols-12 md:gap-x-8 gap-y-12 sm:mt-12">
            <div class="col-span-12 lg:col-span-4">
                <p class="max-w-sm text-xs text-gray-700 sm:text-sm dark:text-gray-500">Laravel is a web application framework with expressive, elegant syntax. We believe development must be an enjoyable and creative experience to be truly fulfilling. Laravel attempts to take the pain out of development by easing common tasks used in most web projects.</p>
                <ul class="mt-6 flex items-center space-x-3">
                    <li>
                        <a href="https://twitter.com/laravelphp">
                            <img id="footer__twitter_dark" class="hidden dark:inline-block w-6 h-6" src="../../img/social/twitter.dark.min.svg" alt="Twitter" width="24" height="20" loading="lazy">
                            <img id="footer__twitter" class="inline-block dark:hidden w-6 h-6" src="../../img/social/twitter.min.svg" alt="Twitter" width="24" height="20" loading="lazy">
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/laravel">
                            <img id="footer__github_dark" class="hidden dark:inline-block w-6 h-6" src="../../img/social/github.dark.min.svg" alt="GitHub" width="24" height="24" loading="lazy">
                            <img id="footer__github" class="inline-block dark:hidden w-6 h-6" src="../../img/social/github.min.svg" alt="GitHub" width="24" height="24" loading="lazy">
                        </a>
                    </li>
                    <li>
                        <a href="https://discord.gg/mPZNm7A">
                            <img id="footer__discord_dark" class="hidden dark:inline-block w-6 h-6" src="../../img/social/discord.dark.min.svg" alt="Discord" width="21" height="24" loading="lazy">
                            <img id="footer__discord" class="inline-block dark:hidden w-6 h-6" src="../../img/social/discord.min.svg" alt="Discord" width="21" height="24" loading="lazy">
                        </a>
                    </li>
                    <li>
                        <a href="https://www.youtube.com/laravelphp">
                            <img id="footer__youtube_dark" class="hidden dark:inline-block w-6 h-6" src="../../img/social/youtube.dark.min.svg" alt="YouTube" width="169" height="150" loading="lazy">
                            <img id="footer__youtube" class="inline-block dark:hidden w-6 h-6" src="../../img/social/youtube.min.svg" alt="YouTube" width="169" height="150" loading="lazy">
                        </a>
                    </li>
                </ul>
            </div>
                            <div class="text-xs col-span-6 md:col-span-3 lg:col-span-2">
                    <span class="uppercase dark:text-gray-200">Highlights</span>
                    <div class="mt-5">
                        <ul class="space-y-3 text-gray-700 dark:text-gray-500">
                                                            <li>
                                    <a href="https://laravel.com/team" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Our Team</a>
                                </li>
                                                            <li>
                                    <a href="releases.html" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Release Notes</a>
                                </li>
                                                            <li>
                                    <a href="installation.html" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Getting Started</a>
                                </li>
                                                            <li>
                                    <a href="routing.html" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Routing</a>
                                </li>
                                                            <li>
                                    <a href="blade.html" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Blade Templates</a>
                                </li>
                                                            <li>
                                    <a href="authentication.html" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Authentication</a>
                                </li>
                                                            <li>
                                    <a href="authorization.html" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Authorization</a>
                                </li>
                                                            <li>
                                    <a href="artisan.html" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Artisan Console</a>
                                </li>
                                                            <li>
                                    <a href="database.html" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Database</a>
                                </li>
                                                            <li>
                                    <a href="eloquent.html" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Eloquent ORM</a>
                                </li>
                                                            <li>
                                    <a href="testing.html" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Testing</a>
                                </li>
                                                    </ul>
                    </div>
                </div>
                            <div class="text-xs col-span-6 md:col-span-3 lg:col-span-2">
                    <span class="uppercase dark:text-gray-200">Resources</span>
                    <div class="mt-5">
                        <ul class="space-y-3 text-gray-700 dark:text-gray-500">
                                                            <li>
                                    <a href="https://laracasts.com/" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Laracasts</a>
                                </li>
                                                            <li>
                                    <a href="https://laravel-news.com/" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Laravel News</a>
                                </li>
                                                            <li>
                                    <a href="https://laracon.us/" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Laracon</a>
                                </li>
                                                            <li>
                                    <a href="https://laracon.eu/" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Laracon EU</a>
                                </li>
                                                            <li>
                                    <a href="https://larajobs.com/" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Jobs</a>
                                </li>
                                                            <li>
                                    <a href="https://certification.laravel.com/" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Certification</a>
                                </li>
                                                            <li>
                                    <a href="https://laracasts.com/discuss" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Forums</a>
                                </li>
                                                    </ul>
                    </div>
                </div>
                            <div class="text-xs col-span-6 md:col-span-3 lg:col-span-2">
                    <span class="uppercase dark:text-gray-200">Partners</span>
                    <div class="mt-5">
                        <ul class="space-y-3 text-gray-700 dark:text-gray-500">
                                                            <li>
                                    <a href="https://vehikl.com/" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Vehikl</a>
                                </li>
                                                            <li>
                                    <a href="https://tighten.co/" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Tighten</a>
                                </li>
                                                            <li>
                                    <a href="https://64robots.com/" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">64 Robots</a>
                                </li>
                                                            <li>
                                    <a href="https://kirschbaumdevelopment.com/" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Kirschbaum</a>
                                </li>
                                                            <li>
                                    <a href="https://www.curotec.com/services/technologies/laravel/" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Curotec</a>
                                </li>
                                                            <li>
                                    <a href="https://jump24.co.uk/" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Jump24</a>
                                </li>
                                                            <li>
                                    <a href="https://www.a2design.biz/" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">A2 Design</a>
                                </li>
                                                            <li>
                                    <a href="https://corporate.aboutyou.de/app/uploads/2019/08/INTRO-Pitch-I-AY-Tech.pdf?utm_source=laravelpartnersfindoutmore&amp;utm_medium=socialgroups&amp;utm_campaign=tech" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">ABOUT YOU</a>
                                </li>
                                                            <li>
                                    <a href="https://www.byte5.net/" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Byte 5</a>
                                </li>
                                                            <li>
                                    <a href="https://cubettech.com/" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Cubet</a>
                                </li>
                                                            <li>
                                    <a href="https://www.cyber-duck.co.uk/how-we-work/technology/laravel?utm_source=Laravel%20Partner&amp;utm_medium=Sponsorship" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Cyber-Duck</a>
                                </li>
                                                            <li>
                                    <a href="https://devsquad.com/" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">DevSquad</a>
                                </li>
                                                            <li>
                                    <a href="https://www.ideil.com/" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Ideil</a>
                                </li>
                                                            <li>
                                    <a href="https://romegadigital.com/" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Romega Software</a>
                                </li>
                                                            <li>
                                    <a href="https://www.worksome.com/" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Worksome</a>
                                </li>
                                                            <li>
                                    <a href="https://webreinvent.com/?utm_source=laravel&amp;utm_medium=laravel.com&amp;utm_campaign=patreon-sponsors" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">WebReinvent</a>
                                </li>
                                                    </ul>
                    </div>
                </div>
                            <div class="text-xs col-span-6 md:col-span-3 lg:col-span-2">
                    <span class="uppercase dark:text-gray-200">Ecosystem</span>
                    <div class="mt-5">
                        <ul class="space-y-3 text-gray-700 dark:text-gray-500">
                                                            <li>
                                    <a href="billing.html" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Cashier</a>
                                </li>
                                                            <li>
                                    <a href="dusk.html" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Dusk</a>
                                </li>
                                                            <li>
                                    <a href="broadcasting.html" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Echo</a>
                                </li>
                                                            <li>
                                    <a href="https://envoyer.io/" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Envoyer</a>
                                </li>
                                                            <li>
                                    <a href="https://forge.laravel.com/" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Forge</a>
                                </li>
                                                            <li>
                                    <a href="homestead.html" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Homestead</a>
                                </li>
                                                            <li>
                                    <a href="horizon.html" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Horizon</a>
                                </li>
                                                            <li>
                                    <a href="mix.html" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Mix</a>
                                </li>
                                                            <li>
                                    <a href="https://nova.laravel.com/" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Nova</a>
                                </li>
                                                            <li>
                                    <a href="passport.html" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Passport</a>
                                </li>
                                                            <li>
                                    <a href="scout.html" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Scout</a>
                                </li>
                                                            <li>
                                    <a href="socialite.html" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Socialite</a>
                                </li>
                                                            <li>
                                    <a href="https://spark.laravel.com/" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Spark</a>
                                </li>
                                                            <li>
                                    <a href="telescope.html" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Telescope</a>
                                </li>
                                                            <li>
                                    <a href="valet.html" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Valet</a>
                                </li>
                                                            <li>
                                    <a href="https://vapor.laravel.com/" class="transition-colors hover:text-gray-600 dark:hover:text-gray-400">Vapor</a>
                                </li>
                                                    </ul>
                    </div>
                </div>
                    </div>
        <div class="mt-10 border-t pt-6 pb-16 border-gray-200 dark:border-dark-500">
            <p class="text-xs text-gray-700 dark:text-gray-400">
                Laravel is a Trademark of Taylor Otwell. Copyright © 2011-2022 Laravel LLC.
            </p>
            <p class="mt-6 text-xs text-gray-700 dark:text-gray-400">
                Code highlighting provided by <a href="https://torchlight.dev/">Torchlight</a>
            </p>
        </div>
    </div>
</footer>

<div x-data="searchComponent()" @toggle-search-modal.window="open = !open" @keydown.window.escape="close" @keydown.window="handleKeydown" @keydown.escape.prevent.stop="close" x-show="open" x-cloak="" x-trap.noscroll.inert="open" role="dialog" aria-modal="true" x-id="['search-modal']" :aria-labelledby="$id('search-modal')" class="fixed inset-0 z-50 text-gray-400 overflow-y-auto">
    <div x-show="open" x-transition.opacity="" class="fixed inset-0 bg-dark-900 bg-opacity-80"></div>

    <div x-show="open" x-transition="" @click="close()" class="relative min-h-screen flex items-start justify-center p-4 lg:py-20">
        <div @click.stop="" class="relative max-w-2xl w-full bg-dark-700 pt-8 px-8 pb-16">
            <div class="relative w-full border-b border-gray-600 border-opacity-50 overflow-hidden transition-all duration-500 focus-within:border-gray-600">
                <svg class="absolute inset-y-0 left-0 mt-1 w-5 h-5 text-gray-500 pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                <input x-model.debouce.200ms="search" x-ref="searchInput" class="flex-1 w-full pl-8 pr-4 py-1 tracking-wide text-gray-400 placeholder-gray-500 bg-transparent focus:outline-none" placeholder="Search Docs (Press '/')" aria-label="Search in the documentation" @keydown.arrow-up.prevent="focusPreviousResult()" @keydown.arrow-down.prevent="focusNextResult()">
            </div>

            <div x-show="search">
                <div x-show="hits.length" x-cloak="" class="mt-5 divide-y divide-gray-700 z-30">
                    <template x-for="(hit, index) in hits" :key="index" hidden="">
                        <div>
                            <a :id="'search-result-' + index" :href="hit.url" class="search-result -mx-2 block p-3 text-gray-400 transition-colors duration-200 focus:outline-none focus:bg-dark-800 focus:text-gray-200 hover:text-gray-200" @keydown.arrow-up.prevent="focusPreviousResult(index)" @keydown.arrow-down.prevent="focusNextResult(index)">
                                <div x-show="hit._highlightResult.hierarchy.lvl0" class="text-sm font-medium" x-html="hit._highlightResult.hierarchy.lvl0 ? hit._highlightResult.hierarchy.lvl0.value : ''"></div>
                                <div class="mt-2">
                                    <div x-show="hit._highlightResult.hierarchy.lvl1" class="text-sm">
                                        <span class="text-red-600 opacity-75">#</span> <span x-html="hit._highlightResult.hierarchy.lvl1 ? hit._highlightResult.hierarchy.lvl1.value : ''"></span>
                                    </div>

                                    <div x-show="hit._highlightResult.hierarchy.lvl2" class="text-sm">
                                        &gt; <span x-html="hit._highlightResult.hierarchy.lvl2 ? hit._highlightResult.hierarchy.lvl2.value : ''"></span>
                                    </div>

                                    <div x-show="hit._highlightResult.hierarchy.lvl3" class="text-sm">
                                        &gt; <span x-html="hit._highlightResult.hierarchy.lvl3 ? hit._highlightResult.hierarchy.lvl3.value : ''"></span>
                                    </div>

                                    <div x-show="hit._highlightResult.hierarchy.lvl4" class="text-sm">
                                        &gt; <span x-html="hit._highlightResult.hierarchy.lvl4 ? hit._highlightResult.hierarchy.lvl4.value : ''"></span>
                                    </div>

                                    <div x-show="hit._highlightResult.hierarchy.lvl5" class="text-sm">
                                        &gt; <span x-html="hit._highlightResult.hierarchy.lvl5 ? hit._highlightResult.hierarchy.lvl5.value : ''"></span>
                                    </div>
                                </div>
                            </a>
                        </div>
                    </template>
                </div>

                <div x-show="! hits.length" x-cloak="" class="mt-8 pb-32">
                    <div x-text="`We didn't find any result for '${search}'. Sorry!`"></div>
                </div>
            </div>

            <div x-show="! search" class="mt-8 pb-32">
                <p>Enter a search term to find results in the documentation.</p>
            </div>

            <div class="absolute bottom-0 inset-x-0 border-t border-dark-800 text-gray-400 flex justify-end">
                <a class="px-4 py-2 inline-block" target="_blank" href="https://www.algolia.com/?utm_source=laravel&amp;utm_medium=link&amp;utm_campaign=laravel_documentation_search">
                    <img width="105" src="../../img/icons/algolia.dark.min.svg" id="docs_search__algolia_dark" alt="Algolia">
                </a>
            </div>
        </div>

        <button x-show="open" x-transition.opacity="" class="absolute top-8 right-8 text-gray-400" @click.prevent="close">
            <span class="sr-only">Close search</span>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
        </button>
    </div>
</div>

<script>
    var algolia_app_id = 'E3MIRNPJH5';
    var algolia_search_key = '1fa3a8fec06eb1858d6ca137211225c0';
    var version = '9.x';
</script>

<script src="../../js/appee68.js?id=100f797fd909ecd1c2f2"></script>

<script>
    var _gaq=[['_setAccount','UA-23865777-1'],['_trackPageview']];
    (function(d,t){
        var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
        g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
        s.parentNode.insertBefore(g,s)
    }(document,'script'));
</script>


<!-- Mirrored from laravel.com/docs/9.x/billing by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 24 Mar 2022 16:17:12 GMT -->

</body></html>