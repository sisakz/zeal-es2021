<!DOCTYPE html>

<html lang="it" prefix="og: http://ogp.me/ns#">

<!-- Mirrored from expressjs.com/it/advanced/best-practice-performance.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 10 Jul 2019 00:23:47 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<title>Best Practice sulle prestazioni utilizzando Express in fase di produzione</title>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="og:image" content="../../images/express-facebook-share.png">
<link rel="icon" type="image/png" href="../../images/favicon.png" />
<link rel="stylesheet" href="../../css/style.css">
<link rel="stylesheet" href="../../css/dropit.css">
<link rel="stylesheet" href="../../css/prism.css">
<link rel="stylesheet" href="../../css/font-awesome.min.css">
<link rel="stylesheet" href="../../../fonts.googleapis.com/css2a1d.css?family=Open+Sans:300,400,600,700&amp;amp;subset=latin,latin-ext">
<link rel="stylesheet" href="../../css/it.css">
<link rel="stylesheet" href="../../css/nodeinteractive.css">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script data-cfasync="false" src="../../../ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script data-cfasync="false" src="../../js/ismobile.js"></script>
<script data-cfasync="false" src="../../js/app.js"></script>
<script data-cfasync="false" src="../../js/retina.js"></script>
<script data-cfasync="false" src="../../js/dropit.js"></script>
<script data-cfasync="false" src="../../js/prism.js"></script>
<link rel="stylesheet" href="../../../cdn.jsdelivr.net/npm/docsearch.js%402/dist/cdn/docsearch.min.css" />
</head>
<body class="non-en-doc">
<section class="page content">
<header>
<div id="mobile-menu">
<div id="nav-button" class="fa fa-bars fa-2x button"></div>
</div>
<section id="logo"><a href="../../index.html" class="express">Express</a>
</section>
<div id="navbar">
<input id="q" placeholder="üîé search">
<ul id="navmenu">
<li><a href="../index.html" id="home-menu">Home</a></li>
<li>
<ul id="getting-started-menu" class="menu">
<li><a href="../starter/installing.html">Introduzione</a>
<ul>
<li>
<a href="../starter/installing.html">
Installazione</a>
</li>
<li>
<a href="../starter/hello-world.html">
Hello world
</a>
</li>
<li>
<a href="../starter/generator.html">
Programma di creazione Express
</a>
</li>
<li>
<a href="../starter/basic-routing.html">
Routing di base</a>
</li>
<li>
<a href="../starter/static-files.html">
File statici
</a>
</li>
<li>
<a href="../starter/faq.html">
FAQ</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<ul id="guide-menu" class="menu">
<li><a href="../guide/routing.html">Guida</a>
<ul>
<li><a href="../guide/routing.html">Routing</a>
</li>
<li><a href="../guide/writing-middleware.html">Scrittura del middleware</a>
</li>
<li><a href="../guide/using-middleware.html">Utilizzo del middleware</a>
</li>
<li><a href="../guide/using-template-engines.html">Utilizzo dei motori di template</a>
</li>
<li><a href="../guide/error-handling.html">Gestione degli errori</a>
</li>
<li><a href="../guide/debugging.html">Debug</a>
</li>
<li><a href="../guide/behind-proxies.html">Express con i proxy</a>
</li>
<li><a href="../guide/migrating-4.html">Passaggio a Express 4</a>
</li>
<li><a href="../guide/migrating-5.html">Passaggio a Express 5</a>
</li>
<li><a href="../guide/database-integration.html">Integrazione database</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<ul id="application-menu" class="menu">
<li><a href="../4x/api.html">Riferimento API</a>
<ul>
<li><a href="../4x/api.html">4.x</a>
</li>
<li><a href="../3x/api.html">3.x (deprecato)</a>
</li>
<li><a href="../../2x/index.html">2.x (deprecato)</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<ul id="advanced-topics-menu" class="menu">
<li><a href="developing-template-engines.html" class="active">Argomenti avanzati</a>
<ul>
<li><a href="developing-template-engines.html">Motori di template</a>
</li>
<li><a href="pm.html">Utilizzo dei process manager</a>
</li>
<li><a href="security-updates.html">Aggiornamenti sulla sicurezza</a>
</li>
<li><a href="best-practice-security.html">Best practice sulla sicurezza</a>
</li>
<li><a href="best-practice-performance.html">Best practice sulle prestazioni</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<ul id="resources-menu" class="menu">
<li><a href="../resources/glossary.html">Risorse</a>
<ul>
<li><a href="../resources/glossary.html">Glossario</a>
</li>
<li><a href="../resources/middleware.html">Middleware</a>
</li>
<li><a href="../resources/community.html">Community</a>
</li>
<li><a href="../resources/books-blogs.html">Manuali e blog</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</header>
<div id="overlay"></div>
<div id="i18n-notice-box" class="doc-box doc-warn">
<p><p>Questa traduzione fornita da <a href="http://strongloop.com/">StrongLoop / IBM</a>.</p>
√à possibile che questo documento non sia aggiornato poich√© la documentazione √® in inglese. Per gli ultimi aggiornamenti, fare riferimento alla <a href="../../index.html">documentazione in inglese</a>.
</p>
<div id="close-i18n-notice-box" title="Close">‚úñ</div>
</div>
<div id="page-doc" markdown="1">
<h1 id="best-practice-sulla-produzione-prestazioni-e-affidabilit√†">Best practice sulla produzione: prestazioni e affidabilit√†</h1>
<h2 id="panoramica">Panoramica</h2>
<p>In questo articolo vengono descritte le best practice sulle prestazioni e sull‚Äôaffidabilit√† per le applicazioni Express implementate per la produzione.</p>
<p>Questo argomento entra nel mondo di ‚Äúdevops‚Äù, coprendo sia le operazioni che lo sviluppo tradizionale. Di conseguenza, le informazioni sono divise in due parti:</p>
<ul>
<li><a href="#code">Operazioni da effettuare nel codice</a> (la parte dello sviluppo).</li>
<li><a href="#env">Operazioni da effettuare nell‚Äôambiente / configurazione</a> (la parte delle operazioni).</li>
</ul>
<p><a name="code"></a></p>
<h2 id="operazioni-da-effettuare-nel-codice">Operazioni da effettuare nel codice</h2>
<p>Di seguito sono elencate alcune operazioni che √® possibile effettuare nel codice per migliorare le prestazioni dell‚Äôapplicazione:</p>
<ul>
<li>Utilizzare la compressione gzip</li>
<li>Non utilizzare funzioni sincrone</li>
<li>Utilizzare il middleware per servire file statici</li>
<li>Effettuare correttamente la registrazione</li>
<li>Gestire in modo appropriato le eccezioni</li>
</ul>
<h3 id="utilizzare-la-compressione-gzip">Utilizzare la compressione gzip</h3>
<p>La compressione gzip √® in grado di ridurre notevolmente la dimensione del contenuto della risposta e di conseguenza aumentare la velocit√† di un‚Äôapplicazione web. Utilizzare il middleware di <a href="https://www.npmjs.com/package/compression">compressione</a> per la compressione gzip nell‚Äôapplicazione Express. Ad esempio:</p>
<pre><code class="language-javascript" translate="no">
var compression = require('compression');
var express = require('express');
var app = express();
app.use(compression());
</code>
</pre>
<p>Per un sito web ad elevato traffico nella produzione, il miglior modo per utilizzare la compressione √® quello di implementarla ad un livello di proxy inverso (consultare <a href="#proxy">Utilizzare un proxy inverso</a>). In questo caso, non √® necessario utilizzare il middleware di compressione. Per dettagli su come abilitare la compressione gzip in Nginx, consultare <a href="http://nginx.org/en/docs/http/ngx_http_gzip_module.html">Modulo ngx_http_gzip_module</a> nella documentazione Nginx.</p>
<h3 id="non-utilizzare-funzioni-sincrone">Non utilizzare funzioni sincrone</h3>
<p>I metodi e le funzioni sincrone ostacolano il processo di esecuzione finch√© non restituiscono un risultato. Una chiamata singola a una funzione sincrona potrebbe restituire un risultato in pochi microsecondi o millisecondi, tuttavia in siti web ad elevato traffico, queste chiamate aggiungono e riducono le prestazioni di un‚Äôapplicazione. Evitarne l‚Äôutilizzo in produzione.</p>
<p>Poich√© Node e molti moduli forniscono versioni sicrone e asincrone delle relative funzioni, utilizzare sempre la versione asincrona nella produzione. L‚Äôunico caso in cui l‚Äôutilizzo di una funzione sincrona √® giustificato, √® allo startup iniziale.</p>
<p>Se si sta utilizzando Node.js 4.0+ o io.js 2.1.0+, √® possibile utilizzare il flag della riga di comando <code>--trace-sync-io</code> per stampare un avviso e un‚Äôanalisi dello stack ogniqualvolta che un‚Äôapplicazione utilizza una API sincrona. Naturalmente, non si consiglia di utilizzarlo nella produzione, ma solo per assicurare che il codice sia pronto per la produzione. Consultare l‚Äô<a href="https://nodejs.org/en/blog/weekly-updates/weekly-update.2015-05-22/#2-1-0">aggiornamento settimanale per io.js 2.1.0</a> per ulteriori informazioni.</p>
<h3 id="utilizzare-il-middleware-per-servire-file-statici">Utilizzare il middleware per servire file statici</h3>
<p>Nello sviluppo, √® possibile utilizzare <a href="../4x/api.html#res.sendFile">res.sendFile()</a> per servire i file statici. Ma non effettuare questa operazione in fase di produzione, poich√© questa funzione deve effettuare un processo di lettura dal file system per ciascuna richiesta file, quindi si verificher√† una latenza importante e si andr√† a influenzare le prestazioni dell‚Äôapplicazione. Notare che <code>res.sendFile()</code> <em>non</em> viene implementato con la chiamata di sistema <a href="http://linux.die.net/man/2/sendfile">sendfile</a>, che lo renderebbe molto pi√π efficiente.</p>
<p>Al contrario, utilizzare il middleware <a href="https://www.npmjs.com/package/serve-static">serve-static</a> (o qualcosa di equivalente), ottimizzato per servire i file per le applicazioni Express.</p>
<p>Un‚Äôaltra opzione potrebbe essere quella di utilizzare un proxy inverso per servire file statici; consultare <a href="#proxy">Utilizzare un proxy inverso</a> per ulteriori informazioni.</p>
<h3 id="effettuare-correttamente-la-registrazione">Effettuare correttamente la registrazione</h3>
<p>Solitamente, esistono due motivi per effettuare la registrazione dall‚Äôapplicazione: per il debug e la registrazione dell‚Äôattivit√† dell‚Äôapplicazione (sostanzialmente, qualsiasi altra cosa). L‚Äôutilizzo di <code>console.log()</code> o <code>console.err()</code> per stampare i messaggi di log sul terminale, √® un‚Äôoperazione comune nello sviluppo. Ma <a href="https://nodejs.org/api/console.html#console_console_1">queste funzioni sono sincrone</a> quando la destinazione √® un terminale o un file, pertanto non sono adatte per la produzione, a meno che non si indirizzi l‚Äôoutput a un altro programma.</p>
<h4 id="per-il-debug">Per il debug</h4>
<p>Se si sta effettuando la registrazione per motivi di debug, allora invece di utilizzare <code>console.log()</code>, utilizzare un modulo di debug speciale quale <a href="https://www.npmjs.com/package/debug">debug</a>. Questo modulo consente di utilizzare la variabile di ambiente DEBUG per controllare quali messaggi di debug vengono inviati a <code>console.err()</code>, se presenti. Per fare in modo che l‚Äôapplicazione resti strettamente asincrona, √® necessario instradare <code>console.err()</code> a un altro programma. Per√≤ a questo punto, non andrai ad effettuare il debug in fase di produzione giusto?</p>
<h4 id="per-lattivit√†-dellapplicazione">Per l‚Äôattivit√† dell‚Äôapplicazione</h4>
<p>Se si sta registrando l‚Äôattivit√† dell‚Äôapplicazione (ad esempio, si sta tenendo traccia del traffico e delle chiamate API), invece di utilizzare <code>console.log()</code>, utilizzare una libreria di registrazione quale <a href="https://www.npmjs.com/package/winston">Winston</a> o <a href="https://www.npmjs.com/package/bunyan">Bunyan</a>. Per un confronto dettagliato di queste due librerie, consultare il post del blog di StrongLoop <a href="https://strongloop.com/strongblog/compare-node-js-logging-winston-bunyan/">Comparing Winston and Bunyan Node.js Logging</a>.</p>
<p><a name="exceptions"></a></p>
<h3 id="gestire-in-modo-appropriato-le-eccezioni">Gestire in modo appropriato le eccezioni</h3>
<p>Le applicazioni Node danno origine a errori quando riscontrano eccezioni non rilevate. Se tali eccezioni non vengono gestite o se non si effettuano operazioni appropriate, l‚Äôapplicazione Express si arrester√† in modo anomalo. Seguendo i consigli descritti in <a href="#restart">Riavvio automatico dell‚Äôapplicazione</a>, sar√† possibile recuperare l‚Äôapplicazione dopo un arresto anomalo. Fortunatamente, le applicazioni Express solitamente hanno tempi di avvio molto brevi. Tuttavia, per prima cosa √® necessario evitare che si verifichino arresti anomali, e per effettuare ci√≤, √® necessario gestire in modo appropriato le eccezioni.</p>
<p>Per essere sicuri di gestire al meglio tutte le eccezioni, utilizzare le seguenti tecniche:</p>
<ul>
<li><a href="#try-catch">Utilizzare try-catch</a></li>
<li><a href="#promises">Utilizzare promises</a></li>
</ul>
<p>Prima di leggere questi argomenti, √® necessario avere una conoscenza base della gestione degli errori di Node/Express: utilizzo di error-first callback e diffusione degli errori al middleware. Node utilizza la convenzione ‚Äúerror-first callback‚Äù per restituire gli errori da funzioni asincrone, dove il primo parametro per la funzione callback √® l‚Äôoggetto dell‚Äôerrore, seguito dai dati nei parametri successivi. Per indicare un errore, indicare null come primo parametro. La funzione callback deve seguire in modo corrispondente la convenzione error-first callback per gestire l‚Äôerrore in modo significativo. In Express, il miglior modo √® quello di utilizzare la funzione next() per diffondere gli errori attraverso la catena middleware.</p>
<p>Per ulteriori informazioni sulle nozioni di base della gestione degli errori, consultare:</p>
<ul>
<li><a href="https://www.joyent.com/developers/node/design/errors">Gestione degli errori in Node.js</a></li>
<li><a href="https://strongloop.com/strongblog/robust-node-applications-error-handling/">Come creare applicazioni Node solide: Gestione degli errori</a> (blog di StrongLoop)</li>
</ul>
<h4 id="cosa-non-fare">Cosa non fare</h4>
<p>Una cosa da <em>non</em> fare √® quella di stare in ascolto per un evento <code>uncaughtException</code>, emesso quando un‚Äôeccezione si verifica ed √® costante nel loop degli eventi. Se si aggiunge un programma di ascolto dell‚Äôevento per <code>uncaughtException</code> si cambier√† il funzionamento predefinito del processo che sta riscontrando un‚Äôeccezione; il processo continuer√† ad operare malgrado l‚Äôeccezione. Questo potrebbe risultare un ottimo modo per prevenire un arresto anomalo dell‚Äôapplicazione, ma continuare ad utilizzare un‚Äôapplicazione dopo che si √® verificata un‚Äôeccezione non rilevata √® pericoloso e non √® consigliato, poich√© lo stato del processo diventa non affidabile e non prevedibile.</p>
<p>Inoltre, l‚Äôutilizzo di <code>uncaughtException</code> √® ufficialmente riconosciuto come <a href="https://nodejs.org/api/process.html#process_event_uncaughtexception">non conforme</a> ed esiste una <a href="https://github.com/nodejs/node-v0.x-archive/issues/2582">proposta</a> per la relativa rimozione dal core. Quindi continuare a visualizzare un evento <code>uncaughtException</code> non √® un buon segno. Ecco perch√© consigliamo di usufruire di pi√π processi e supervisori: l‚Äôarresto anomalo e il riavvio sono spesso il modo pi√π affidabile per ripristinare una situazione dopo un errore.</p>
<p>Inoltre, non si consiglia di utilizzare l‚Äôopzione <a href="https://nodejs.org/api/domain.html">domini</a>. Solitamente non risolve il problema ed √® considerato un modulo obsoleto.</p>
<p><a name="try-catch"></a></p>
<h4 id="utilizzare-try-catch">Utilizzare try-catch</h4>
<p>Try-catch √® un linguaggio JavaScript che √® possibile utilizzare per rilevare eccezioni in codice sincrono. Ad esempio, utilizzare try-catch, per gestire errori di analisi JSON come mostrato di seguito.</p>
<p>Utilizzare uno strumento come <a href="http://jshint.com/">JSHint</a> o <a href="http://www.jslint.com/">JSLint</a> come supporto nel rilevamento di eccezioni implicite quali <a href="http://www.jshint.com/docs/options/#undef">errori di riferimento su variabili non definite</a>.</p>
<p>Di seguito viene riportato un esempio di utilizzo di try-catch per la gestione di un‚Äôeccezione che d√† origine a un arresto anomalo del processo.
Questa funzione middleware accetta un parametro del campo query denominato ‚Äúparams‚Äù che √® un oggetto JSON.</p>
<pre><code class="language-javascript" translate="no">
app.get('/search', function (req, res) {
  // Simulating async operation
  setImmediate(function () {
    var jsonStr = req.query.params;
    try {
      var jsonObj = JSON.parse(jsonStr);
      res.send('Success');
    } catch (e) {
      res.status(400).send('Invalid JSON string');
    }
  });
});
</code>
</pre>
<p>Tuttavia, try-catch funziona solo per il codice sincrono. Poich√© la piattaforma Node √® principalmente asincrona (nello specifico in un ambiente di produzione), try-catch non sar√† in grado di rilevare molte eccezioni.</p>
<p><a name="promises"></a></p>
<h4 id="utilizzare-promises">Utilizzare promises</h4>
<p>Promises gestir√† qualsiasi eccezione (sia implicita che esplicita) in blocchi di codice asincrono che utilizzano <code>then()</code>. Aggiungere <code>.catch(next)</code> alla fine della catena promise. Ad esempio:</p>
<pre><code class="language-javascript" translate="no">
app.get('/', function (req, res, next) {
  // do some sync stuff
  queryDb()
    .then(function (data) {
      // handle data
      return makeCsv(data)
    })
    .then(function (csv) {
      // handle csv
    })
    .catch(next);
});

app.use(function (err, req, res, next) {
  // handle error
});
</code>
</pre>
<p>Ora, tutti gli errori asincroni e sincroni vengono inoltrati al middleware degli errori.</p>
<p>Tuttavia, esistono due punti a cui prestare attenzione:</p>
<ol>
<li>Tutto il codice asincrono deve restituire promises (ad eccezione di emettitori). Se una libreria particolare non restituire promises, convertire l‚Äôoggetto base utilizzando una funzione di supporto come <a href="http://bluebirdjs.com/docs/api/promise.promisifyall.html">Bluebird.promisifyAll()</a>.</li>
<li>Emettitori evento (come flussi) possono ancora dare origine ad eccezioni non rilevate. Quindi, assicurarsi di gestire l‚Äôevento di errore in modo appropriato, ad esempio:</li>
</ol>
<pre><code class="language-javascript" translate="no">
app.get('/', wrap(async (req, res, next) =&gt; {
  let company = await getCompanyById(req.query.id)
  let stream = getLogoStreamById(company.id)
  stream.on('error', next).pipe(res)
}))
</code>
</pre>
<p>Per ulteriori informazioni sulla gestione degli errori mediante l‚Äôutilizzo di promises, consultare:</p>
<ul>
<li><a href="https://strongloop.com/strongblog/async-error-handling-expressjs-es7-promises-generators/">Asynchronous Error Handling in Express with Promises, Generators and ES7</a></li>
<li><a href="https://strongloop.com/strongblog/promises-in-node-js-with-q-an-alternative-to-callbacks/">Promises in Node.js with Q ‚Äì An Alternative to Callbacks</a></li>
</ul>
<p><a name="env"></a></p>
<h2 id="operazioni-da-effettuare-nellambiente--configurazione">Operazioni da effettuare nell‚Äôambiente / configurazione</h2>
<p>Di seguito sono elencate alcune operazioni che √® possibile effettuare nell‚Äôambiente del sistema per migliorare le prestazioni dell‚Äôapplicazione:</p>
<ul>
<li>Impostare NODE_ENV su ‚Äúproduzione‚Äù</li>
<li>Verificare che l‚Äôapplicazione sia in grado di riavviarsi automaticamente</li>
<li>Eseguire l‚Äôapplicazione in un cluster</li>
<li>Memorizzare in cache i risultati della richiesta</li>
<li>Utilizzare un servizio di bilanciamento del carico</li>
<li>Utilizzare un proxy inverso</li>
</ul>
<h3 id="impostare-node_env-su-produzione">Impostare NODE_ENV su ‚Äúproduzione‚Äù</h3>
<p>La variabile di ambiente NODE_ENV indica l‚Äôambiente in cui √® in esecuzione un‚Äôapplicazione (solitamente, sviluppo o applicazione). Una delle cose pi√π semplici da fare per migliorare le prestazioni, √® impostare NODE_ENV su ‚Äúproduzione.‚Äù</p>
<p>L‚Äôimpostazione di NODE_ENV su ‚Äúproduzione‚Äù consente ad Express di:</p>
<ul>
<li>Memorizzare in cache i template di visualizzazione.</li>
<li>Memorizzare in cache i file CSS generati da stensioni CSS.</li>
<li>Generare meno messaggi di errore ridondanti.</li>
</ul>
<p><a href="http://apmblog.dynatrace.com/2015/07/22/the-drastic-effects-of-omitting-node_env-in-your-express-js-applications/">I test hanno confermato</a> che seguendo queste indicazioni √® possibile migliorare le prestazioni dell‚Äôapplicazione di tre volte!</p>
<p>Se si ha la necessit√† di scrivere codice specifico dell‚Äôambiente, √® possibile selezionare il valore di NODE_ENV con <code>process.env.NODE_ENV</code>. Notare che la selezione del valore di qualsiasi variabile di ambiente influisce sulle prestazioni in modo negativo, quindi questa operazione deve essere effettuata con moderazione.</p>
<p>Nello sviluppo, solitamente si impostano le variabili di ambiente nella shell interattiva, ad esempio utilizzando <code>export</code> o il file <code>.bash_profile</code>. Ma solitamente non si consiglia di effettuare questa operazione su un server di produzione; al contrario, utilizzare il sistema init del sistema operativo (systemd o Upstart). La sezione successiva fornisce ulteriori dettagli sull‚Äôutilizzo in generale del sistema init, per√≤ anche impostare NODE_ENV √® molto importante per le prestazioni (ed √® facile da fare), evidenziato di seguito.</p>
<p>Con Upstart, utilizzare la parola chiave <code>env</code> nel file job. Ad esempio:</p>
<pre><code class="language-sh" translate="no">
# /etc/init/env.conf
 env NODE_ENV=production
</code>
</pre>
<p>Per ulteriori informazioni, consultare <a href="http://upstart.ubuntu.com/cookbook/#environment-variables">Upstart Intro, Cookbook and Best Practices</a>.</p>
<p>Con systemd, utilizzare la direttiva <code>Environment</code> nel file unit. Ad esempio:</p>
<pre><code class="language-sh" translate="no">
# /etc/systemd/system/myservice.service
Environment=NODE_ENV=production
</code>
</pre>
<p>Per ulteriori informazioni, consultare <a href="https://coreos.com/os/docs/latest/using-environment-variables-in-systemd-units.html">Using Environment Variables In systemd Units</a>.</p>
<p>Se si sta utilizzando StrongLoop Process Manager, √® inoltre possibile <a href="https://docs.strongloop.com/display/SLC/Setting+up+a+production+host#Settingupaproductionhost-Setenvironmentvariables">impostare la variabile di ambiente quando si installa StrongLoop PM as a service</a>.</p>
<h3 id="verificare-che-lapplicazione-sia-in-grado-di-riavviarsi-automaticamente">Verificare che l‚Äôapplicazione sia in grado di riavviarsi automaticamente</h3>
<p>In fase di produzione, l‚Äôapplicazione non deve mai andare offline. Ci√≤ significa che deve riavviarsi nel caso in cui sia l‚Äôapplicazione che il server terminino in modo anomalo. Anche se ovviamente si spera che entrambe queste situazioni non si verifichino mai, realisticamente √® necessario considerare l‚Äôeventualit√† di:</p>
<ul>
<li>Utilizzare un process manager per riavviare l‚Äôapplicazione (e Node) quando termina in modo anomalo.</li>
<li>Utilizzare il sistema init fornito dal sistema operativo per riavviare il process manager quando il sistema operativo termina in modo anomalo. √à inoltre possibile utilizzare il sistema init senza un process manager.</li>
</ul>
<p>Le applicazioni Node terminano in modo anomalo se riscontrano eccezioni non rilevate. La prima cosa da fare √® verificare che l‚Äôapplicazione sia stata verificata e che sia in grado di gestire tutte le eccezioni (consultare <a href="#exceptions">Gestire in modo appropriato le eccezioni</a> per dettagli). Come prevenzione, attivare un meccanismo che assicuri che applicazione si riavvii automaticamente in caso di arresto anomalo.</p>
<h4 id="utilizzare-un-process-manager">Utilizzare un process manager</h4>
<p>Nello sviluppo, l‚Äôapplicazione √® stata avviata semplicemente dalla riga comandi con <code>node server.js</code> o qualcosa di simile. Ma se si effettua questa stessa operazione in campo di produzione si andr√† incontro a situazioni pericolose. Se l‚Äôapplicazione termina in modo anomalo, sar√† offline finch√© non viene riavviata. Per fare in modo che l‚Äôapplicazione si riavvii nel caso in cui termini in modo anomalo, utilizzare un process manager. Un process manager √® un ‚Äúcontenitore‚Äù per le applicazioni che facilita lo sviluppo, fornisce un‚Äôelevata disponibilit√† e consente di gestire l‚Äôapplicazione al momento del runtime.</p>
<p>Oltre a fare in modo di riavviare l‚Äôapplicazione in caso di arresto anomalo, un process manager consente di:</p>
<ul>
<li>Ottenere insight relativi alle prestazioni di runtime e al consumo delle risorse.</li>
<li>Modificare le impostazioni in modo dinamico per migliorare le prestazioni.</li>
<li>Controllare il processo di clustering (StrongLoop PM e pm2).</li>
</ul>
<p>I process manager pi√π noti per Node sono i seguenti:</p>
<ul>
<li><a href="http://strong-pm.io/">StrongLoop Process Manager</a></li>
<li><a href="https://github.com/Unitech/pm2">PM2</a></li>
<li><a href="https://www.npmjs.com/package/forever">Forever</a></li>
</ul>
<p>Per un paragone a livello di funzioni dei tre process manager, consultare l‚Äôindirizzo <a href="http://strong-pm.io/compare/">http://strong-pm.io/compare/</a>. Per informazioni pi√π dettagliate su tutti e tre i process manager, consultare <a href="pm.html">Process manager per le applicazioni Express</a>.</p>
<p>L‚Äôutilizzo di questi process manager sar√† sufficiente per far restare attiva l‚Äôapplicazione, anche se dovesse capitare che si arresti in modo anomalo.</p>
<p>Tuttavia, StrongLoop PM dispone di molte funzioni che sono indicate in modo specifico per l‚Äôimplementazione della produzione. √à possibile utilizzarle insieme ai relativi strumenti di StrongLoop per:</p>
<ul>
<li>Creare e confezionare l‚Äôapplicazione localmente, quindi implementarla in modo sicuro al sistema di produzione.</li>
<li>Riavviare automaticamente l‚Äôapplicazione se termina in modo anomalo per qualsiasi motivo.</li>
<li>Gestire i cluster in modo remoto.</li>
<li>Visualizzare i profili CPU e accumulare le istantanee per ottimizzare le prestazioni e diagnosticare le perdite di memoria.</li>
<li>Visualizzare le metriche delle prestazioni per l‚Äôapplicazione.</li>
<li>Scalare facilmente a pi√π host con un controllo integrato per il servizio di bilanciamento del carico Nginx.</li>
</ul>
<p>Come mostrato di seguito, quando si installa StrongLoop PM come servizio del sistema operativo utilizzando il sistema init, si riavvier√† automaticamente quando si riavvia il sistema. Pertanto, consentir√† ai processi delle applicazioni e ai cluster di restare sempre attivi.</p>
<h4 id="utilizzare-un-sistema-init">Utilizzare un sistema init</h4>
<p>Il successivo livello di affidabilit√† √® quello di assicurare che l‚Äôapplicazione venga riavviata quando si riavvia il server. I sistemi possono ancora arrestarsi per moltissimi motivi. Per fare in modo che l‚Äôapplicazione si riavvii nel caso in cui un server si arresti in modo anomalo, utilizzare il sistema init integrato al sistema operativo. Oggi, i due sistemi init principali in uso sono <a href="https://wiki.debian.org/systemd">systemd</a> e <a href="http://upstart.ubuntu.com/">Upstart</a>.</p>
<p>Esistono due modi per utilizzare i sistemi init con l‚Äôapplicazione Express:</p>
<ul>
<li>Far eseguire l‚Äôapplicazione in un process manager e installare il process manager come servizio con il sistema init. Il process manager riavvier√† l‚Äôapplicazione nel caso in cui termini in modo anomalo e il sistema init riavvier√† il process manager quando si riavvia il sistema operativo. Questa √® la procedura consigliata.</li>
<li>Far eseguire l‚Äôapplicazione (e Node) direttamente con il sistema init. Questa operazione risulta pi√π semplice ma non si hanno gli stessi vantaggi dell‚Äôutilizzo di un process manager.</li>
</ul>
<h5 id="systemd">Systemd</h5>
<p>Systemd √® un sistema Linux e un service manager. Le pi√π importanti distribuzioni Linux hanno utilizzato systemd come sistema init predefinito.</p>
<p>Un file di configurazione del servizio systemd √® denominato <em>unit file</em>, con un nome file che termina con .service. Segue un unit file di esempio per gestire un‚Äôapplicazione Node direttamente (sostituire il testo in grassetto con i valori appropriati per il proprio sistema e applicazione):</p>
<pre><code class="language-sh" translate="no">
[Unit]
Description=Awesome Express App

[Service]
Type=simple
ExecStart=/usr/local/bin/node /projects/myapp/index.js
WorkingDirectory=/projects/myapp

User=nobody
Group=nogroup

# Environment variables:
Environment=NODE_ENV=production

# Allow many incoming connections
LimitNOFILE=infinity

# Allow core dumps for debugging
LimitCORE=infinity

StandardInput=null
StandardOutput=syslog
StandardError=syslog
Restart=always

[Install]
WantedBy=multi-user.target
</code>
</pre>
<p>Per ulteriori informazioni su systemd, consultare <a href="http://www.freedesktop.org/software/systemd/man/systemd.unit.html">systemd reference (man page)</a>.</p>
<h5 id="strongloop-pm-in-qualit√†-di-servizio-systemd">StrongLoop PM in qualit√† di servizio systemd</h5>
<p>√à possibile installare facilmente StrongLoop Process Manager in qualit√† di servizio systemd. Dopo l‚Äôinstallazione, quando il server si riavvia, si riavvier√† automaticamente StrongLoop PM, il quale riavvier√† di conseguenza tutte le applicazioni che sta gestendo.</p>
<p>Per installare StrongLoop PM in qualit√† di servizio systemd:</p>
<pre><code class="language-sh" translate="no">
$ sudo sl-pm-install --systemd
</code>
</pre>
<p>Successivamente, avviare il servizio con:</p>
<pre><code class="language-sh" translate="no">
$ sudo /usr/bin/systemctl start strong-pm
</code>
</pre>
<p>Per ulteriori informazioni, consultare <a href="https://docs.strongloop.com/display/SLC/Setting+up+a+production+host#Settingupaproductionhost-RHEL7+,Ubuntu15.04or15.10">Configurazione di un host di produzione (documentazione StrongLoop)</a>.</p>
<h5 id="upstart">Upstart</h5>
<p>Upstart √® uno strumento di sistema disponibile su molte distribuzioni Linux per l‚Äôavvio delle attivit√† e dei servizi durante lo startup del sistema, per l‚Äôarresto delle stesse durante la fase di shutdown e per il controllo delle stesse. √à possibile configurare l‚Äôapplicazione Express o il process manager in qualit√† di servizio e successivamente Upstart le riavvier√† automaticamente quando terminano in modo anomalo.</p>
<p>Un servizio Upstart √® definito in un file di configurazione del lavoro (anche noto come ‚Äúlavoro‚Äù) con un nome file che termina con <code>.conf</code>. Il seguente esempio mostra come creare un lavoro denominato ‚Äúmyapp‚Äù per un‚Äôapplicazione denominata ‚Äúmyapp‚Äù con il file principale ubicato in <code>/projects/myapp/index.js</code>.</p>
<p>Creare un file denominato <code>myapp.conf</code> in <code>/etc/init/</code> con il seguente contenuto (sostituire il testo in grassetto con i valori appropriati per il proprio sistema e applicazione):</p>
<pre><code class="language-sh" translate="no">
# When to start the process
start on runlevel [2345]

# When to stop the process
stop on runlevel [016]

# Increase file descriptor limit to be able to handle more requests
limit nofile 50000 50000

# Use production mode
env NODE_ENV=production

# Run as www-data
setuid www-data
setgid www-data

# Run from inside the app dir
chdir /projects/myapp

# The process to start
exec /usr/local/bin/node /projects/myapp/index.js

# Restart the process if it is down
respawn

# Limit restart attempt to 10 times within 10 seconds
respawn limit 10 10
</code>
</pre>
<p>NOTA: questo script richiede Upstart 1.4 o versione successiva, supportato su Ubuntu 12.04-14.10.</p>
<p>Poich√© il lavoro √® configurato per essere eseguito quando si avvia il sistema, l‚Äôapplicazione verr√† avviata insieme al sistema operativo e riavviata automaticamente se l‚Äôapplicazione termina in modo anomalo o se il sistema si arresta.</p>
<p>Oltre a riavviare automaticamente l‚Äôapplicazione, Upstart consente di utilizzare i seguenti comandi:</p>
<ul>
<li><code>start myapp</code> ‚Äì Avviare l‚Äôapplicazione</li>
<li><code>restart myapp</code> ‚Äì Riavviare l‚Äôapplicazione</li>
<li><code>stop myapp</code> ‚Äì Arrestare l‚Äôapplicazione.</li>
</ul>
<p>Per ulteriori informazioni su Upstart, consultare <a href="http://upstart.ubuntu.com/cookbook">Upstart Intro, Cookbook and Best Practises</a>.</p>
<h5 id="strongloop-pm-in-qualit√†-di-servizio-upstart">StrongLoop PM in qualit√† di servizio Upstart</h5>
<p>√à possibile installare facilmente StrongLoop Process Manager in qualit√† di servizio Upstart. Dopo l‚Äôinstallazione, quando il server si riavvia, si riavvier√† automaticamente StrongLoop PM, il quale riavvier√† di conseguenza tutte le applicazioni che sta gestendo.</p>
<p>Per installare StrongLoop PM in qualit√† di servizio Upstart 1.4:</p>
<pre><code class="language-sh" translate="no">
$ sudo sl-pm-install
</code>
</pre>
<p>Successivamente, eseguire il servizio con:</p>
<pre><code class="language-sh" translate="no">
$ sudo /sbin/initctl start strong-pm
</code>
</pre>
<p>NOTA: su sistemi che non supportano Upstart 1.4, i comandi sono leggermente differenti. Consultare <a href="https://docs.strongloop.com/display/SLC/Setting+up+a+production+host#Settingupaproductionhost-RHELLinux5and6,Ubuntu10.04-.10,11.04-.10">Configurazione di un host di produzione (documentazione StrongLoop)</a> per ulteriori informazioni.</p>
<h3 id="eseguire-lapplicazione-in-un-cluster">Eseguire l‚Äôapplicazione in un cluster</h3>
<p>In un sistema multicore, √® possibile aumentare le prestazioni di un‚Äôapplicazione Node di molte volte avviando un cluster di processi. Un cluster esegue molte istanze di un‚Äôapplicazione, nel caso ideale, un‚Äôistanza su ciascun core CPU, quindi, distribuendo il carico e le attivit√† tra le istanze.</p>

<p>IMPORTANTE: poich√© le istanze dell‚Äôapplicazione vengono eseguite come processi separati, non condividono lo stesso spazio di memoria. Ossia, gli oggetti sono locali rispetto a ciascuna istanza dell‚Äôapplicazione. Pertanto, non √® possibile conservare lo stato nel codice dell‚Äôapplicazione. Tuttavia, √® possibile utilizzare un datastore in-memory, ad esempio <a href="http://redis.io/">Redis</a> per memorizzare lo stato e i dati relativi alla sessione. Questa condizione si applica fondamentalmente a tutti i moduli di scaling orizzontale, se il processo di clustering viene effettuato con pi√π processi o pi√π server fisici.</p>
<p>Nelle applicazioni sottoposte a cluster, i processi di lavoro possono ternare in modo anomalo individualmente senza influenzare gli altri processi. Oltre ai vantaggi che si possono ottenere dalle prestazioni, l‚Äôisolamento dell‚Äôerrore √® un altro motivo che spinge a eseguire un cluster di processi di applicazioni. Quando un processo di lavoro termina in modo anomalo, ricordarsi sempre di registrare l‚Äôevento e di dare origine a un nuovo processo utilizzando cluster.fork().</p>
<h4 id="utilizzo-del-modulo-cluster-di-node">Utilizzo del modulo cluster di Node</h4>
<p>Il processo di clustering √® stato reso possibile con il <a href="https://nodejs.org/docs/latest/api/cluster.html">cluster module</a> di Node. Ci√≤ consente a un processo principale di dare origine a processi di lavoro e di distribuire le connessioni in entrata tra i processi di lavoro. Tuttavia, invece di utilizzare direttamente questo modulo, √® meglio utilizzare uno dei molti strumenti disponibili che svolgono questa attivit√† automaticamente; ad esempio <a href="https://www.npmjs.com/package/node-pm">node-pm</a> o <a href="https://www.npmjs.com/package/cluster-service">cluster-service</a>.</p>
<h4 id="utilizzo-di-strongloop-pm">Utilizzo di StrongLoop PM</h4>
<p>Se si implementa l‚Äôapplicazione a StrongLoop Process Manager (PM), √® possibile sfruttare i vantaggi del processo di clustering <em>senza</em> dover modificare il codice dell‚Äôapplicazione.</p>
<p>Quando StrongLoop Process Manager (PM) esegue un‚Äôapplicazione, la esegue automaticamente in un cluster con un numero di processi di lavoro equivalente al numero di core CPU presenti sul sistema. √à possibile modificare manualmente il numero di processi di lavoro nel cluster utilizzando lo strumento della riga comandi senza arrestare l‚Äôapplicazione.</p>
<p>Ad esempio, se l‚Äôapplicazione √® stata implementata su prod.foo.com e StrongLoop PM √® in ascolto sulla porta 8701 (quella predefinita), per impostare la dimensione del cluster a otto utilizzando slc:</p>
<pre><code class="language-sh" translate="no">
$ slc ctl -C http://prod.foo.com:8701 set-size my-app 8
</code>
</pre>
<p>Per ulteriori informazioni sul processo di clustering con StrongLoop PM, consultare <a href="https://docs.strongloop.com/display/SLC/Clustering">Processo di clustering</a> nella documentazione StrongLoop.</p>
<h3 id="memorizzare-in-cache-i-risultati-della-richiesta">Memorizzare in cache i risultati della richiesta</h3>
<p>Un‚Äôaltra strategia per migliorare le prestazioni in fase di produzione √® quella di memorizzare in cache i risultati delle richieste, in modo tale che l‚Äôapplicazione non debba gestire nuovamente la stessa richiesta.</p>
<p>Utilizzare un server di memorizzazione in cache quale <a href="https://www.varnish-cache.org/">Varnish</a> o <a href="https://www.nginx.com/resources/wiki/start/topics/examples/reverseproxycachingexample/">Nginx</a> (vedere anche <a href="https://serversforhackers.com/nginx-caching/">Nginx Caching</a>) per migliorare notevolmente la velocit√† e le prestazioni dell‚Äôapplicazione.</p>
<h3 id="utilizzare-un-servizio-di-bilanciamento-del-carico">Utilizzare un servizio di bilanciamento del carico</h3>
<p>A prescindere da quanto sia ottimizzata un‚Äôapplicazione, una singola istanza √® in grado di gestire solo una quantit√† limitata di carico e traffico. Un modo per scalare un‚Äôapplicazione √® quello di eseguire pi√π delle proprie istanze e distribuire il traffico tramite un servizio di bilanciamento del carico. L‚Äôimpostazione di un servizio di bilanciamento del carico pu√≤ migliorare la velocit√† e le prestazioni dell‚Äôapplicazione e abilitarla a scalare di pi√π di quanto sia possibile fare con una singola istanza.</p>
<p>Un servizio di bilanciamento del carico √® solitamente un proxy inverso che gestisce il traffico a e d pi√π istanze di applicazione e server. √à possibile impostare facilmente un servizio di bilanciamento del carico per l‚Äôapplicazione utilizzando <a href="http://nginx.org/en/docs/http/load_balancing.html">Nginx</a> or <a href="https://www.digitalocean.com/community/tutorials/an-introduction-to-haproxy-and-load-balancing-concepts">HAProxy</a>.</p>
<p>Con il servizio di bilanciamento del carico, √® possibile che sia necessario garantire che le richieste associate a un ID sessione particolare si connettano al processo che le ha originate. Questo processo √® noto come <em>affinit√† sessione</em> o <em>sessioni delicate</em>. Si consiglia di utilizzare un data store, ad esempio Redis, per i dati sessione (a seconda dell‚Äôapplicazione). Per informazioni, consultare <a href="http://socket.io/docs/using-multiple-nodes/">Utilizzo di pi√π nodi</a>.</p>
<h4 id="utilizzo-di-strongloop-pm-con-un-servizio-di-bilanciamento-del-carico-nginx">Utilizzo di StrongLoop PM con un servizio di bilanciamento del carico Nginx</h4>
<p><a href="http://strong-pm.io/">StrongLoop Process Manager</a> si integra con un controller Nginx, rendendo semplice il processo di configurazione di ambienti di produzione multi host. Per ulteriori informazioni, consultare <a href="https://docs.strongloop.com/display/SLC/Scaling+to+multiple+servers">Processo di scaling su pi√π server</a> (documentazione StrongLoop).
<a name="proxy"></a></p>
<h3 id="utilizzare-un-proxy-inverso">Utilizzare un proxy inverso</h3>
<p>Un proxy inverso si trova davanti a un‚Äôapplicazione web ed esegue le operazioni di supporto sulle richieste, oltre a indirizzare le richieste all‚Äôapplicazione. Inoltre, √® in grado di gestire pagine di errore, compressioni, memorizzazioni in cache e il bilanciamento del carico.</p>
<p>Le attivit√† di gestione che non richiedono la conoscenza dello stato dell‚Äôapplicazione per un proxy inverso consentono ad Express di eseguire attivit√† dell‚Äôapplicazione specializzate. Per questo motivo, si consiglia di eseguire Express dietro un proxy inverso come <a href="https://www.nginx.com/">Nginx</a> o <a href="http://www.haproxy.org/">HAProxy</a> in fase di produzione.</p>
</div>
</section>

<noscript>
    <iframe src="http://www.googletagmanager.com/ns.html?id=GTM-5XL76H" height="0" width="0" style="display: none; visibility: hidden;"></iframe>
</noscript>
<script type="bafb51365d162bca866bddc1-text/javascript">
(function(w, d, s, l, i) {
    w[l] = w[l] || [];
    w[l].push({
        'gtm.start': new Date().getTime(),
        event: 'gtm.js'
    });
    var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s),
        dl = l != 'dataLayer' ? '&l=' + l : '';
    j.async = true;
    j.src =
        '../../../www.googletagmanager.com/gtm5445.js?id=' + i + dl;
    f.parentNode.insertBefore(j, f);
})(window, document, 'script', 'dataLayer', 'GTM-5XL76H');
</script>
<a id="top" href="#"><img src="../../images/arrow.png"></a>
<footer>
<div id="footer-content">
<div id="github">
<iframe src="http://ghbtns.com/github-btn.html?user=expressjs&amp;repo=express&amp;type=watch&amp;count=true" allowtransparency="true" frameborder="0" scrolling="0" width="110" height="20"></iframe>
</div>
<div id="sponsor"><a href="https://github.com/expressjs/express">Express</a> √® un progetto della Fondazione Node.js.</div>
<div id="fork"><a href="https://github.com/expressjs/expressjs.com">Avviare il sito web su GitHub</a>.
</div>
<div>Copyright &copy; StrongLoop, Inc. e altri contributor di expressjs.com.</div>
</div>
<div id="license">
<a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/us/"><img alt="Licenza Creative Commons" style="border-width:0" src="../../../i.creativecommons.org/l/by-sa/3.0/us/80x15.png" /></a> Quest'opera √® distribuita con Licenza <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/us/">Creative Commons Attribuzione - Condividi allo stesso modo 3.0 Stati Uniti</a>.
</div>
</footer>
<script type="bafb51365d162bca866bddc1-text/javascript" src="../../../cdn.jsdelivr.net/npm/docsearch.js%402/dist/cdn/docsearch.min.js" onload="docsearch({
  apiKey: '7164e33055faa6ecddefd9e08fc59f5d',
  indexName: 'expressjs',
  inputSelector: '#q',
  algoliaOptions: { 'facetFilters': ['lang:it'] }
})" async></script>
<script src="../../../ajax.cloudflare.com/cdn-cgi/scripts/a2bd7673/cloudflare-static/rocket-loader.min.js" data-cf-settings="bafb51365d162bca866bddc1-|49" defer=""></script></body>

<!-- Mirrored from expressjs.com/it/advanced/best-practice-performance.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 10 Jul 2019 00:23:47 GMT -->
</html>
