<!DOCTYPE html>

<html lang="es" prefix="og: http://ogp.me/ns#">

<!-- Mirrored from expressjs.com/es/advanced/best-practice-performance.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 10 Jul 2019 00:23:47 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<title>Mejores pr√°cticas de rendimiento cuando se utiliza Express en producci√≥n</title>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="og:image" content="../../images/express-facebook-share.png">
<link rel="icon" type="image/png" href="../../images/favicon.png" />
<link rel="stylesheet" href="../../css/style.css">
<link rel="stylesheet" href="../../css/dropit.css">
<link rel="stylesheet" href="../../css/prism.css">
<link rel="stylesheet" href="../../css/font-awesome.min.css">
<link rel="stylesheet" href="../../../fonts.googleapis.com/css2a1d.css?family=Open+Sans:300,400,600,700&amp;amp;subset=latin,latin-ext">
<link rel="stylesheet" href="../../css/es.css">
<link rel="stylesheet" href="../../css/nodeinteractive.css">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script data-cfasync="false" src="../../../ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script data-cfasync="false" src="../../js/ismobile.js"></script>
<script data-cfasync="false" src="../../js/app.js"></script>
<script data-cfasync="false" src="../../js/retina.js"></script>
<script data-cfasync="false" src="../../js/dropit.js"></script>
<script data-cfasync="false" src="../../js/prism.js"></script>
<link rel="stylesheet" href="../../../cdn.jsdelivr.net/npm/docsearch.js%402/dist/cdn/docsearch.min.css" />
</head>
<body class="non-en-doc">
<section class="page content">
<header>
<div id="mobile-menu">
<div id="nav-button" class="fa fa-bars fa-2x button"></div>
</div>
<section id="logo"><a href="../../index.html" class="express">Express</a>
</section>
<div id="navbar">
<input id="q" placeholder="üîé search">
<ul id="navmenu">
<li><a href="../index.html" id="home-menu">Inicio</a></li>
<li>
<ul id="getting-started-menu" class="menu">
<li><a href="../starter/installing.html">C√≥mo empezar</a>
<ul>
<li>
<a href="../starter/installing.html">
Instalaci√≥n
</a>
</li>
<li>
<a href="../starter/hello-world.html">
Hello world
</a>
</li>
<li>
<a href="../starter/generator.html">
Generador de Express
</a>
</li>
<li>
<a href="../starter/basic-routing.html">
Direccionamiento b√°sico
</a>
</li>
<li>
<a href="../starter/static-files.html">
Archivos est√°ticos
</a>
</li>
<li>
<a href="../starter/faq.html">
Preguntas m√°s frecuentes
</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<ul id="guide-menu" class="menu">
<li><a href="../guide/routing.html">Gu√≠a</a>
<ul>
<li><a href="../guide/routing.html">Direccionamiento</a>
</li>
<li><a href="../guide/writing-middleware.html">Escritura de middleware</a>
</li>
<li><a href="../guide/using-middleware.html">Utilizaci√≥n del middleware</a>
</li>
<li><a href="../guide/using-template-engines.html">Utilizaci√≥n de motores de plantilla</a>
</li>
<li><a href="../guide/error-handling.html">Manejo de errores</a>
</li>
<li><a href="../guide/debugging.html">Depuraci√≥n</a>
</li>
<li><a href="../guide/behind-proxies.html">Express detr√°s de proxies</a>
</li>
<li><a href="../guide/migrating-4.html">Migraci√≥n a Express 4</a>
</li>
<li><a href="../guide/migrating-5.html">Migraci√≥n a Express 5</a>
</li>
<li><a href="../guide/database-integration.html">Integraci√≥n de la base de datos</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<ul id="application-menu" class="menu">
<li><a href="../4x/api.html">Referencia de API</a>
<ul>
<li><a href="../4x/api.html">4.x</a>
</li>
<li><a href="../3x/api.html">3.x (en desuso)</a>
</li>
<li><a href="../../2x/index.html">2.x (en desuso)</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<ul id="advanced-topics-menu" class="menu">
<li><a href="developing-template-engines.html" class="active">Temas avanzados</a>
<ul>
<li><a href="developing-template-engines.html">Motores de plantilla</a>
</li>
<li><a href="pm.html">Utilizaci√≥n de gestores de procesos</a>
</li>
 <li><a href="security-updates.html">Actualizaciones de seguridad</a>
</li>
<li><a href="best-practice-security.html">Mejores pr√°cticas de seguridad</a>
</li>
<li><a href="best-practice-performance.html">Mejores pr√°cticas de rendimiento</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<ul id="resources-menu" class="menu">
<li><a href="../resources/glossary.html">Recursos</a>
<ul>
<li><a href="../resources/glossary.html">Glosario</a>
</li>
<li><a href="../resources/middleware.html">Middleware</a>
</li>
<li><a href="../resources/community.html">Comunidad</a>
</li>
<li><a href="../resources/books-blogs.html">Manuales y blogs</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</header>
<div id="overlay"></div>
<div id="i18n-notice-box" class="doc-box doc-warn">
<p><p>Esta traducci√≥n proporcionada por <a href="http://strongloop.com/">StrongLoop / IBM</a>.</p>
Este documento puede estar desfasado respecto a la documentaci√≥n en ingl√©s. Para ver las √∫ltimas actualizaciones, consulte la <a href="../../index.html">documentaci√≥n en ingl√©s</a>.
</p>
<div id="close-i18n-notice-box" title="Close">‚úñ</div>
</div>
<div id="page-doc" markdown="1">
<h1 id="mejores-pr√°cticas-de-producci√≥n-rendimiento-y-fiabilidad">Mejores pr√°cticas de producci√≥n: rendimiento y fiabilidad</h1>
<h2 id="visi√≥n-general">Visi√≥n general</h2>
<p>En este art√≠culo se describen las mejores pr√°cticas de rendimiento y fiabilidad para las aplicaciones Express desplegadas en producci√≥n.</p>
<p>Este tema entra claramente dentro del √°rea de ‚ÄúDevOps‚Äù, que abarca operaciones y desarrollos tradicionales. Por lo tanto, la informaci√≥n se divide en dos partes:</p>
<ul>
<li><a href="#code">Cosas que hacer en el c√≥digo</a> (la parte de desarrollo).</li>
<li><a href="#env">Cosas que hacer en el entorno / configuraci√≥n</a> (la parte de operaciones).</li>
</ul>
<p><a name="code"></a></p>
<h2 id="cosas-que-hacer-en-el-c√≥digo">Cosas que hacer en el c√≥digo</h2>
<p>Estas son algunas de las cosas que puede hacer en el c√≥digo para mejorar el rendimiento de la aplicaci√≥n:</p>
<ul>
<li>Utilizar la compresi√≥n de gzip</li>
<li>No utilizar funciones s√≠ncronas</li>
<li>Utilizar el middleware para el servicio de archivos est√°ticos</li>
<li>Realizar un registro correcto</li>
<li>Manejar las excepciones correctamente</li>
</ul>
<h3 id="utilizar-la-compresi√≥n-de-gzip">Utilizar la compresi√≥n de gzip</h3>
<p>La compresi√≥n de gzip puede disminuir significativamente el tama√±o del cuerpo de respuesta y, por lo tanto, aumentar la velocidad de una aplicaci√≥n web. Utilice el middleware de <a href="https://www.npmjs.com/package/compression">compresi√≥n</a> para la compresi√≥n de gzip en la aplicaci√≥n Express. Por ejemplo:</p>
<pre><code class="language-javascript" translate="no">
var compression = require('compression');
var express = require('express');
var app = express();
app.use(compression());
</code>
</pre>
<p>Para un sitio web con un tr√°fico elevado en producci√≥n, la mejor forma de aplicar la compresi√≥n es implementarla como un nivel de proxy inverso (consulte <a href="#proxy">Utilizar un proxy inverso</a>). En este caso, no es necesario utilizar el middleware de compresi√≥n. Para obtener detalles sobre c√≥mo habilitar la compresi√≥n de gzip en Nginx, consulte <a href="http://nginx.org/en/docs/http/ngx_http_gzip_module.html">Module ngx_http_gzip_module</a> en la documentaci√≥n de Nginx.</p>
<h3 id="no-utilizar-funciones-s√≠ncronas">No utilizar funciones s√≠ncronas</h3>
<p>Las funciones s√≠ncronas y los m√©todos impiden el avance del proceso de ejecuci√≥n hasta que vuelven. Una llamada individual a una funci√≥n s√≠ncrona puede volver en pocos microsegundos o milisegundos, aunque en sitios web de tr√°fico elevado, estas llamadas se suman y reducen el rendimiento de la aplicaci√≥n. Evite su uso en producci√≥n.</p>
<p>Aunque Node y muchos m√≥dulos proporcionan versiones s√≠ncronas y as√≠ncronas de las funciones, utilice siempre la versi√≥n as√≠ncrona en producci√≥n. La √∫nica vez que est√° justificado utilizar una funci√≥n s√≠ncrona es en el arranque inicial.</p>
<p>Si utiliza Node.js 4.0+ o io.js 2.1.0+, puede utilizar el distintivo de l√≠nea de mandatos <code>--trace-sync-io</code> para imprimir un aviso y un seguimiento de la pila siempre que la aplicaci√≥n utilice una API s√≠ncrona. Desde luego, no desear√° utilizarlo en producci√≥n, s√≥lo para garantizar que el c√≥digo est√° listo para producci√≥n. Consulte <a href="https://nodejs.org/en/blog/weekly-updates/weekly-update.2015-05-22/#2-1-0">Weekly update for io.js 2.1.0</a> para obtener m√°s informaci√≥n.</p>
<h3 id="utilizar-el-middleware-para-el-servicio-de-archivos-est√°ticos">Utilizar el middleware para el servicio de archivos est√°ticos</h3>
<p>En el desarrollo, puede utilizar <a href="../4x/api.html#res.sendFile">res.sendFile()</a> para el servicio de archivos est√°ticos. Sin embargo, no lo haga en producci√≥n, porque esta funci√≥n debe leer el sistema de archivos para cada solicitud de archivo, por lo que encontrar√° una latencia significativa y afectar√° al rendimiento general de la aplicaci√≥n. Tenga en cuenta que <code>res.sendFile()</code> <em>no</em> se implementa con la llamada al sistema <a href="http://linux.die.net/man/2/sendfile">sendfile</a>, lo que har√≠a que fuera mucho m√°s eficaz.</p>
<p>En su lugar, utilice el middleware <a href="https://www.npmjs.com/package/serve-static">serve-static</a> (o algo equivalente), que est√° optimizado para el servicio de archivos para aplicaciones Express.</p>
<p>Una soluci√≥n a√∫n mejor es utilizar un proxy inverso para el servicio de archivos est√°ticos; consulte <a href="#proxy">Utilizar un proxy inverso</a> para obtener m√°s informaci√≥n.</p>
<h3 id="realizar-un-registro-correcto">Realizar un registro correcto</h3>
<p>En general, hay dos motivos para realizar un registro desde la aplicaci√≥n: a efectos de depuraci√≥n o para registrar la actividad de la aplicaci√≥n (b√°sicamente, todo lo dem√°s). El uso de <code>console.log()</code> o <code>console.err()</code> para imprimir mensajes de registro en el terminal es una pr√°ctica com√∫n en el desarrollo. No obstante, <a href="https://nodejs.org/api/console.html#console_console_1">estas funciones son s√≠ncronas</a> cuando el destino es un terminal o un archivo, por lo que no son adecuadas para producci√≥n, a menos que canalice la salida a otro programa.</p>
<h4 id="a-efectos-de-depuraci√≥n">A efectos de depuraci√≥n</h4>
<p>Si realiza el registro a efectos de depuraci√≥n, en lugar de utilizar <code>console.log()</code>, utilice un m√≥dulo de depuraci√≥n especial como <a href="https://www.npmjs.com/package/debug">debug</a>. Este m√≥dulo permite utilizar la variable de entorno DEBUG para controlar qu√© mensajes de depuraci√≥n se env√≠an a <code>console.err()</code>, si se env√≠a alguno. Para mantener la aplicaci√≥n b√°sicamente as√≠ncrona, deber√° canalizar <code>console.err()</code> a otro programa. Pero en este caso, realmente no va a depurar en producci√≥n, ¬øno?</p>
<h4 id="para-la-actividad-de-la-aplicaci√≥n">Para la actividad de la aplicaci√≥n</h4>
<p>Si est√° registrando la actividad de la aplicaci√≥n (por ejemplo, realizando un seguimiento del tr√°fico o las llamadas de API), en lugar de utilizar <code>console.log()</code>, utilice una biblioteca de registro como <a href="https://www.npmjs.com/package/winston">Winston</a> o <a href="https://www.npmjs.com/package/bunyan">Bunyan</a>. Para ver una comparaci√≥n detallada de estas dos bibliotecas, consulte el post del blog StrongLoop <a href="https://strongloop.com/strongblog/compare-node-js-logging-winston-bunyan/">Comparing Winston and Bunyan Node.js Logging</a>.</p>
<p><a name="exceptions"></a></p>
<h3 id="manejar-las-excepciones-correctamente">Manejar las excepciones correctamente</h3>
<p>Las aplicaciones Node se bloquean cuando encuentran una excepci√≥n no capturada. Si no maneja las excepciones ni realiza las acciones necesarias, la aplicaci√≥n Express se bloquear√° y quedar√° fuera de l√≠nea. Si sigue el consejo de <a href="#restart">Asegurarse de que la aplicaci√≥n se reinicia autom√°ticamente</a> m√°s abajo, la aplicaci√≥n se recuperar√° de un bloqueo. Afortunadamente, las aplicaciones Express normalmente necesitan un breve tiempo de arranque. No obstante, desea evitar el bloqueo en primer lugar y, para ello, deber√° manejar correctamente las excepciones.</p>
<p>Para asegurarse de manejar todas las excepciones, siga estas t√©cnicas:</p>
<ul>
<li><a href="#try-catch">Utilizar try-catch</a></li>
<li><a href="#promises">Utilizar promesas</a></li>
</ul>
<p>Antes de profundizar en estos temas, deber√° tener unos conocimientos b√°sicos del manejo de errores de Node/Express: el uso de devoluciones de llamada error-first y la propagaci√≥n de errores en el middleware. Node utiliza un convenio de ‚Äúdevoluci√≥n de llamada error-first‚Äù para devolver los errores de las funciones as√≠ncronas, donde el primer par√°metro en la funci√≥n de devoluci√≥n de llamada es el objeto de error, seguido de los datos de resultados en los par√°metros posteriores. Para indicar que no hay ning√∫n error, pase null como el primer par√°metro. La funci√≥n de devoluci√≥n de llamada debe seguir por lo tanto el convenio de devoluci√≥n de llamada error-first para manejar correctamente el error. En Express, la pr√°ctica recomendada es utilizar la funci√≥n next() para propagar los errores a trav√©s de la cadena de middleware.</p>
<p>Para obtener m√°s informaci√≥n sobre los aspectos b√°sicos del manejo de errores, consulte:</p>
<ul>
<li><a href="https://www.joyent.com/developers/node/design/errors">Error Handling in Node.js</a></li>
<li><a href="https://strongloop.com/strongblog/robust-node-applications-error-handling/">Building Robust Node Applications: Error Handling</a> (blog StrongLoop)</li>
</ul>
<h4 id="qu√©-no-debe-hacer">Qu√© no debe hacer</h4>
<p>Algo que <em>no</em> debe hacer es escuchar el suceso <code>uncaughtException</code>, que se emite cuando una excepci√≥n se reproduce hacia atr√°s en el bucle de sucesos. La adici√≥n de un escucha de sucesos para <code>uncaughtException</code> cambiar√° el comportamiento predeterminado del proceso que se encuentra con la excepci√≥n; el proceso continuar√° ejecut√°ndose a pesar de la excepci√≥n. Esto puede parecer una buena forma de evitar el bloqueo de la aplicaci√≥n, pero continuar ejecutando la aplicaci√≥n despu√©s de una excepci√≥n no capturada es una pr√°ctica peligrosa y no se recomienda, ya que el estado del proceso se vuelve imprevisible y poco fiable.</p>
<p>Asimismo, el uso de <code>uncaughtException</code> se reconoce oficialmente como un mecanismo <a href="https://nodejs.org/api/process.html#process_event_uncaughtexception">arduo</a> y hay una <a href="https://github.com/nodejs/node-v0.x-archive/issues/2582">propuesta</a> para eliminarlo del n√∫cleo. Por lo tanto, la escucha <code>uncaughtException</code> no es una buena idea. Es por esto por lo que se recomiendan varios procesos y supervisores; el bloqueo y el reinicio es a menudo la forma m√°s fiable de recuperarse de un error.</p>
<p>Tampoco se recomienda el uso de <a href="https://nodejs.org/api/domain.html">dominios</a>. Generalmente no soluciona el problema y es un m√≥dulo en desuso.</p>
<p><a name="try-catch"></a></p>
<h4 id="utilizar-try-catch">Utilizar try-catch</h4>
<p>Try-catch es una construcci√≥n de lenguaje JavaScript que puede utilizar para capturar excepciones en c√≥digo s√≠ncrono. Por ejemplo, utilice try-catch para manejar los errores de an√°lisis de JSON, como se muestra a continuaci√≥n.</p>
<p>Utilice una herramienta como <a href="http://jshint.com/">JSHint</a> o <a href="http://www.jslint.com/">JSLint</a> para buscar excepciones impl√≠citas como <a href="http://www.jshint.com/docs/options/#undef">errores de referencia o variables sin definir</a>.</p>
<p>A continuaci√≥n, se muestra un ejemplo de uso de try-catch para manejar una posible excepci√≥n de bloqueo de proceso.
Esta funci√≥n de middleware acepta un par√°metro de campo de consulta denominado ‚Äúparams‚Äù que es un objeto JSON.</p>
<pre><code class="language-javascript" translate="no">
app.get('/search', function (req, res) {
  // Simulating async operation
  setImmediate(function () {
    var jsonStr = req.query.params;
    try {
      var jsonObj = JSON.parse(jsonStr);
      res.send('Success');
    } catch (e) {
      res.status(400).send('Invalid JSON string');
    }
  });
});
</code>
</pre>
<p>No obstante, try-catch s√≥lo funciona para el c√≥digo s√≠ncrono. Como la plataforma de Node es principalmente as√≠ncrona (particularmente en un entorno de producci√≥n), try-catch no capturar√° muchas excepciones.</p>
<p><a name="promises"></a></p>
<h4 id="utilizar-promesas">Utilizar promesas</h4>
<p>Las promesas manejar√°n todas las excepciones (expl√≠citas e impl√≠citas) en los bloques de c√≥digos as√≠ncronos que utilicen <code>then()</code>. S√≥lo tiene que a√±adir <code>.catch(next)</code> al final de las cadenas de promesas. Por ejemplo:</p>
<pre><code class="language-javascript" translate="no">
app.get('/', function (req, res, next) {
  // do some sync stuff
  queryDb()
    .then(function (data) {
      // handle data
      return makeCsv(data)
    })
    .then(function (csv) {
      // handle csv
    })
    .catch(next);
});

app.use(function (err, req, res, next) {
  // handle error
});
</code>
</pre>
<p>Ahora todos los errores, as√≠ncronos y s√≠ncronos, se propagar√°n al middleware de errores.</p>
<p>No obstante, hay dos advertencias:</p>
<ol>
<li>Todo el c√≥digo as√≠ncrono debe devolver promesas (excepto los emisores). Si una determinada biblioteca no devuelve promesas, convierta el objeto base utilizando una funci√≥n de ayuda como <a href="http://bluebirdjs.com/docs/api/promise.promisifyall.html">Bluebird.promisifyAll()</a>.</li>
<li>Los emisores de sucesos (como las secuencias) todav√≠a pueden provocar excepciones no capturadas. Por lo tanto, aseg√∫rese de que est√° manejando el suceso de error correctamente; por ejemplo:</li>
</ol>
<pre><code class="language-javascript" translate="no">
app.get('/', wrap(async (req, res, next) =&gt; {
  let company = await getCompanyById(req.query.id)
  let stream = getLogoStreamById(company.id)
  stream.on('error', next).pipe(res)
}))
</code>
</pre>
<p>Para obtener m√°s informaci√≥n sobre el manejo de errores utilizando promesas, consulte:</p>
<ul>
<li><a href="https://strongloop.com/strongblog/async-error-handling-expressjs-es7-promises-generators/">Asynchronous Error Handling in Express with Promises, Generators and ES7</a></li>
<li><a href="https://strongloop.com/strongblog/promises-in-node-js-with-q-an-alternative-to-callbacks/">Promises in Node.js with Q ‚Äì An Alternative to Callbacks</a></li>
</ul>
<p><a name="env"></a></p>
<h2 id="cosas-que-hacer-en-el-entorno--configuraci√≥n">Cosas que hacer en el entorno / configuraci√≥n</h2>
<p>Estas son algunas de las cosas que puede hacer en el entorno del sistema para mejorar el rendimiento de la aplicaci√≥n:</p>
<ul>
<li>Establecer NODE_ENV en ‚Äúproduction‚Äù</li>
<li>Asegurarse de que la aplicaci√≥n se reinicia autom√°ticamente</li>
<li>Ejecutar la aplicaci√≥n en un cl√∫ster</li>
<li>Almacenar en la cach√© los resultados de la solicitud</li>
<li>Utilizar un equilibrador de carga</li>
<li>Utilizar un proxy inverso</li>
</ul>
<h3 id="establecer-node_env-en-production">Establecer NODE_ENV en ‚Äúproduction‚Äù</h3>
<p>La variable de entorno NODE_ENV especifica el entorno en el que se ejecuta una aplicaci√≥n (normalmente, desarrollo o producci√≥n). Una de las cosas m√°s sencillas que puede hacer para mejorar el rendimiento es establecer NODE_ENV en ‚Äúproduction‚Äù.</p>
<p>Si establece NODE_ENV en ‚Äúproduction‚Äù, Express:</p>
<ul>
<li>Almacena en la cach√© las plantillas de vistas.</li>
<li>Almacena en la cach√© los archivos CSS generados en las extensiones CSS.</li>
<li>Genera menos mensajes de error detallados.</li>
</ul>
<p>Las <a href="http://apmblog.dynatrace.com/2015/07/22/the-drastic-effects-of-omitting-node_env-in-your-express-js-applications/">pruebas indican</a> que s√≥lo esta acci√≥n puede mejorar hasta tres veces el rendimiento de la aplicaci√≥n.</p>
<p>Si necesita escribir c√≥digo espec√≠fico del entorno, puede comprobar el valor de NODE_ENV con <code>process.env.NODE_ENV</code>. Tenga en cuenta que comprobar el valor de una variable de entorno supone una reducci√≥n de rendimiento, por lo que debe hacerse moderadamente.</p>
<p>En el desarrollo, normalmente establece las variables de entorno en el shell interactivo, por ejemplo, utilizando <code>export</code> o su archivo <code>.bash_profile</code>. Sin embargo, en general, no debe hacerlo en un servidor de producci√≥n; en su lugar, utilice el sistema init de su sistema operativo (systemd o Upstart). En la siguiente secci√≥n se proporcionan m√°s detalles sobre el uso del sistema init en general, pero el establecimiento de NODE_ENV es tan importante (y f√°cil de hacer) para el rendimiento, que se resalta aqu√≠.</p>
<p>Con Upstart, utilice la palabra clave <code>env</code> en el archivo de trabajo. Por ejemplo:</p>
<pre><code class="language-sh" translate="no">
# /etc/init/env.conf
 env NODE_ENV=production
</code>
</pre>
<p>Para obtener m√°s informaci√≥n, consulte <a href="http://upstart.ubuntu.com/cookbook/#environment-variables">Upstart Intro, Cookbook and Best Practices</a>.</p>
<p>Con systemd, utilice la directiva <code>Environment</code> en el archivo unit. Por ejemplo:</p>
<pre><code class="language-sh" translate="no">
# /etc/systemd/system/myservice.service
Environment=NODE_ENV=production
</code>
</pre>
<p>Para obtener m√°s informaci√≥n, consulte <a href="https://coreos.com/os/docs/latest/using-environment-variables-in-systemd-units.html">Using Environment Variables In systemd Units</a>.</p>
<p>Si est√° utilizando StrongLoop Process Manager, tambi√©n puede <a href="https://docs.strongloop.com/display/SLC/Setting+up+a+production+host#Settingupaproductionhost-Setenvironmentvariables">establecer la variable de entorno cuando instala StrongLoop PM como un servicio</a>.</p>
<h3 id="asegurarse-de-que-la-aplicaci√≥n-se-reinicia-autom√°ticamente">Asegurarse de que la aplicaci√≥n se reinicia autom√°ticamente</h3>
<p>En la producci√≥n, no desea que la aplicaci√≥n est√© nunca fuera de l√≠nea. Esto significa que debe asegurarse de que se reinicia si la aplicaci√≥n o el servidor se bloquean. Aunque espera que no se produzca ninguno de estos sucesos, si somos realistas, debe tener en cuenta ambas eventualidades de la siguiente manera:</p>
<ul>
<li>Utilizando un gestor de procesos para reiniciar la aplicaci√≥n (y Node) cuando se bloquea.</li>
<li>Utilizando el sistema init que proporciona su sistema operativo para reiniciar el gestor de procesos cuando se bloquea el sistema operativo. Tambi√©n puede utilizar el sistema init sin un gestor de procesos.</li>
</ul>
<p>Las aplicaciones Node se bloquean si encuentran una excepci√≥n no capturada. Lo primero que debe hacer es asegurarse de que se realizan las pruebas correctas en la aplicaci√≥n y que se manejan todas las excepciones (consulte <a href="#exceptions">Manejar correctamente las excepciones</a> para obtener detalles). No obstante, para estar libre de errores, aplique un mecanismo para garantizar que cuando se bloquee la aplicaci√≥n, se reinicie autom√°ticamente.</p>
<h4 id="utilizar-un-gestor-de-procesos">Utilizar un gestor de procesos</h4>
<p>En el desarrollo, la aplicaci√≥n se inicia simplemente desde la l√≠nea de mandatos con <code>node server.js</code> o algo similar. Pero hacer esto en la producci√≥n es sin√≥nimo de desastre. Si la aplicaci√≥n se bloquea, estar√° fuera de l√≠nea hasta que la reinicie. Para garantizar el reinicio de la aplicaci√≥n si se bloquea, utilice un gestor de procesos. Un gestor de procesos es un ‚Äúcontenedor‚Äù de aplicaciones que facilita el despliegue, proporciona una alta disponibilidad y permite gestionar la aplicaci√≥n en el tiempo de ejecuci√≥n.</p>
<p>Adem√°s de reiniciar la aplicaci√≥n cuando se bloquea, un gestor de procesos permite:</p>
<ul>
<li>Obtener informaci√≥n √∫til sobre el rendimiento en tiempo de ejecuci√≥n y el consumo de recursos.</li>
<li>Modificar din√°micamente los valores para mejorar el rendimiento.</li>
<li>Controlar la agrupaci√≥n en cl√∫ster (StrongLoop PM y pm2).</li>
</ul>
<p>Los gestores de procesos m√°s conocidos para Node son los siguientes:</p>
<ul>
<li><a href="http://strong-pm.io/">StrongLoop Process Manager</a></li>
<li><a href="https://github.com/Unitech/pm2">PM2</a></li>
<li><a href="https://www.npmjs.com/package/forever">Forever</a></li>
</ul>
<p>Para ver una comparaci√≥n caracter√≠stica a caracter√≠stica de los tres gestores de procesos, consulte <a href="http://strong-pm.io/compare/">http://strong-pm.io/compare/</a>. Para ver una introducci√≥n m√°s detallada de los tres, consulte <a href="pm.html">Gestores de procesos para las aplicaciones Express</a>.</p>
<p>El uso de cualquiera de estos gestores de procesos bastar√° para mantener activa la aplicaci√≥n, aunque se bloquee cada cierto tiempo.</p>
<p>No obstante, StrongLoop PM tiene muchas caracter√≠sticas especialmente indicadas para el despliegue de producci√≥n. Puede utilizarlo y las herramientas relacionadas de StrongLoop para:</p>
<ul>
<li>Crear y empaquetar la aplicaci√≥n localmente y, a continuaci√≥n, desplegarla de forma segura en el sistema de producci√≥n.</li>
<li>Reiniciar autom√°ticamente la aplicaci√≥n si se bloque por cualquier motivo.</li>
<li>Gestionar los cl√∫steres de forma remota.</li>
<li>Ver perfiles de CPU e instant√°neas de almacenamiento din√°mico para optimizar el rendimiento y diagnosticar fugas de memoria.</li>
<li>Ver medidas de rendimiento para la aplicaci√≥n.</li>
<li>Escalar f√°cilmente a varios hosts con control integrado para el equilibrador de carga Nginx.</li>
</ul>
<p>Como se explica a continuaci√≥n, cuando instala StrongLoop PM como un servicio de sistema operativo utilizando el sistema init, se reinicia autom√°ticamente cuando se reinicia el sistema. De esta forma, mantiene activos siempre los cl√∫steres y los procesos de aplicaciones.</p>
<h4 id="utilizar-un-sistema-init">Utilizar un sistema init</h4>
<p>La siguiente capa de fiabilidad es garantizar que la aplicaci√≥n se reinicie cuando se reinicie el servidor. Los sistemas pueden bloquearse por una amplia variedad de motivos. Para garantizar que la aplicaci√≥n se reinicie si se bloquea el servidor, utilice el sistema init incorporado en su sistema operativo. Los dos principales sistemas init que se utilizan hoy d√≠a son <a href="https://wiki.debian.org/systemd">systemd</a> y <a href="http://upstart.ubuntu.com/">Upstart</a>.</p>
<p>Hay dos formas de utilizar los sistemas init con la aplicaci√≥n Express:</p>
<ul>
<li>Ejecutar la aplicaci√≥n en un gestor de procesos e instalar el gestor de procesos como un servicio con el sistema init. El gestor de procesos reiniciar√° la aplicaci√≥n cuando esta se bloquee y el sistema init reiniciar√° el gestor de procesos cuando se reinicie el sistema operativo. Este es el enfoque recomendado.</li>
<li>Ejecutar la aplicaci√≥n (y Node) directamente con el sistema init. Esta opci√≥n parece m√°s simple, pero no tiene las ventajas adicionales de utilizar el gestor de procesos.</li>
</ul>
<h5 id="systemd">Systemd</h5>
<p>Systemd es un administrador de servicios y sistemas Linux. La mayor√≠a de las principales distribuciones Linux han adoptado systemd como su sistema init predeterminado.</p>
<p>Un archivo de configuraci√≥n de servicio de systemd se denomina un <em>archivo unit</em>, con un nombre de archivo terminado en .service. A continuaci√≥n, se muestra un archivo unit de ejemplo para gestionar directamente una aplicaci√≥n Node (sustituya el texto en negrita por los valores de su sistema y su aplicaci√≥n):</p>
<pre><code class="language-sh" translate="no">
[Unit]
Description=Awesome Express App

[Service]
Type=simple
ExecStart=/usr/local/bin/node /projects/myapp/index.js
WorkingDirectory=/projects/myapp

User=nobody
Group=nogroup

# Environment variables:
Environment=NODE_ENV=production

# Allow many incoming connections
LimitNOFILE=infinity

# Allow core dumps for debugging
LimitCORE=infinity

StandardInput=null
StandardOutput=syslog
StandardError=syslog
Restart=always

[Install]
WantedBy=multi-user.target
</code>
</pre>
<p>Para obtener m√°s informaci√≥n sobre systemd, consulte <a href="http://www.freedesktop.org/software/systemd/man/systemd.unit.html">systemd reference (man page)</a>.</p>
<h5 id="strongloop-pm-como-un-servicio-systemd">StrongLoop PM como un servicio systemd</h5>
<p>Puede instalar f√°cilmente StrongLoop Process Manager como un servicio systemd. A continuaci√≥n, cuando se reinicie el servidor, se reiniciar√° autom√°ticamente StrongLoop PM, que a su vez reiniciar√° todas las aplicaciones que est√© gestionando.</p>
<p>Para instalar StrongLoop PM como un servicio systemd:</p>
<pre><code class="language-sh" translate="no">
$ sudo sl-pm-install --systemd
</code>
</pre>
<p>A continuaci√≥n, inicie el servicio con:</p>
<pre><code class="language-sh" translate="no">
$ sudo /usr/bin/systemctl start strong-pm
</code>
</pre>
<p>Para obtener m√°s informaci√≥n, consulte <a href="https://docs.strongloop.com/display/SLC/Setting+up+a+production+host#Settingupaproductionhost-RHEL7+,Ubuntu15.04or15.10">Setting up a production host (documentaci√≥n de StrongLoop)</a>.</p>
<h5 id="upstart">Upstart</h5>
<p>Upstart es una herramienta del sistema disponible en muchas distribuciones Linux para iniciar tareas y servicios durante el arranque del sistema, detenerlos durante la conclusi√≥n y supervisarlos. Puede configurar la aplicaci√≥n Express o el gestor de procesos como un servicio y, a continuaci√≥n, Upstart lo reiniciar√° autom√°ticamente cuando se bloquee.</p>
<p>Un servicio de Upstart se define en un archivo de configuraci√≥n de trabajo (tambi√©n denominado un ‚Äútrabajo‚Äù) con un nombre de archivo terminado en <code>.conf</code>. El siguiente ejemplo muestra c√≥mo crear un trabajo denominado ‚Äúmyapp‚Äù para una aplicaci√≥n denominada ‚Äúmyapp‚Äù con el archivo principal ubicado en <code>/projects/myapp/index.js</code>.</p>
<p>Cree un archivo denominado <code>myapp.conf</code> en <code>/etc/init/</code> con el siguiente contenido (sustituya el texto en negrita por los valores de su sistema y su aplicaci√≥n):</p>
<pre><code class="language-sh" translate="no">
# When to start the process
start on runlevel [2345]

# When to stop the process
stop on runlevel [016]

# Increase file descriptor limit to be able to handle more requests
limit nofile 50000 50000

# Use production mode
env NODE_ENV=production

# Run as www-data
setuid www-data
setgid www-data

# Run from inside the app dir
chdir /projects/myapp

# The process to start
exec /usr/local/bin/node /projects/myapp/index.js

# Restart the process if it is down
respawn

# Limit restart attempt to 10 times within 10 seconds
respawn limit 10 10
</code>
</pre>
<p>NOTA: este script requiere Upstart 1.4 o posterior, soportado en Ubuntu 12.04-14.10.</p>
<p>Como el trabajo se configura para ejecutarse cuando se inicia el sistema, la aplicaci√≥n se iniciar√° junto con el sistema operativo, y se reiniciar√° autom√°ticamente si la aplicaci√≥n se bloquea o el sistema se cuelga.</p>
<p>Aparte reiniciar autom√°ticamente la aplicaci√≥n, Upstart permite utilizar estos mandatos:</p>
<ul>
<li><code>start myapp</code> ‚Äì Iniciar la aplicaci√≥n</li>
<li><code>restart myapp</code> ‚Äì Reiniciar la aplicaci√≥n</li>
<li><code>stop myapp</code> ‚Äì Detener la aplicaci√≥n</li>
</ul>
<p>Para obtener m√°s informaci√≥n sobre Upstart, consulte <a href="http://upstart.ubuntu.com/cookbook">Upstart Intro, Cookbook and Best Practises</a>.</p>
<h5 id="strongloop-pm-como-un-servicio-upstart">StrongLoop PM como un servicio Upstart</h5>
<p>Puede instalar f√°cilmente StrongLoop Process Manager como un servicio Upstart. A continuaci√≥n, cuando se reinicie el servidor, se reiniciar√° autom√°ticamente StrongLoop PM, que a su vez reiniciar√° todas las aplicaciones que est√© gestionando.</p>
<p>Para instalar StrongLoop PM como un servicio Upstart 1.4:</p>
<pre><code class="language-sh" translate="no">
$ sudo sl-pm-install
</code>
</pre>
<p>A continuaci√≥n, ejecute el servicio con:</p>
<pre><code class="language-sh" translate="no">
$ sudo /sbin/initctl start strong-pm
</code>
</pre>
<p>NOTA: en los sistemas que no dan soporte a Upstart 1.4, los mandatos son ligeramente diferentes. Consulte <a href="https://docs.strongloop.com/display/SLC/Setting+up+a+production+host#Settingupaproductionhost-RHELLinux5and6,Ubuntu10.04-.10,11.04-.10">Setting up a production host (documentaci√≥n de StrongLoop)</a> para obtener m√°s informaci√≥n.</p>
<h3 id="ejecutar-la-aplicaci√≥n-en-un-cl√∫ster">Ejecutar la aplicaci√≥n en un cl√∫ster</h3>
<p>En un sistema multin√∫cleo, puede multiplicar el rendimiento de una aplicaci√≥n Node iniciando un cl√∫ster de procesos. Un cl√∫ster ejecuta varias instancias de la aplicaci√≥n, idealmente una instancia en cada n√∫cleo de CPU, lo que permite distribuir la carga y las tareas entre las instancias.</p>

<p>IMPORTANTE: como las instancias de aplicaci√≥n se ejecutan como procesos independientes, no comparten el mismo espacio de memoria. Es decir, los objetos son locales para cada instancia de la aplicaci√≥n. Por lo tanto, no puede mantener el estado en el c√≥digo de aplicaci√≥n. No obstante, puede utilizar un almac√©n de datos en memoria como <a href="http://redis.io/">Redis</a> para almacenar los datos y los estados relacionados con la sesi√≥n. Esta advertencia se aplica b√°sicamente a todas las formas de escalado horizontal, ya sean cl√∫steres con varios procesos o varios servidores f√≠sicos.</p>
<p>En las aplicaciones en cl√∫ster, los procesos de trabajador pueden bloquearse individualmente sin afectar al resto de los procesos. Aparte de las ventajas de rendimiento, el aislamiento de errores es otro motivo para ejecutar un cl√∫ster de procesos de aplicaci√≥n. Siempre que se bloquee un proceso de trabajador, aseg√∫rese de registrar el suceso y generar un nuevo proceso utilizando cluster.fork().</p>
<h4 id="mediante-el-m√≥dulo-de-cl√∫ster-de-node">Mediante el m√≥dulo de cl√∫ster de Node</h4>
<p>La agrupaci√≥n en cl√∫steres es posible gracias al <a href="https://nodejs.org/docs/latest/api/cluster.html">m√≥dulo de cl√∫ster</a> de Node. Esto permite al proceso maestro generar procesos de trabajador y distribuir las conexiones entrantes entre los trabajadores. No obstante, en lugar de utilizar este m√≥dulo directamente, es mucho mejor utilizar una de las muchas herramientas que lo hacen autom√°ticamente, por ejemplo, <a href="https://www.npmjs.com/package/node-pm">node-pm</a> o <a href="https://www.npmjs.com/package/cluster-service">cluster-service</a>.</p>
<h4 id="mediante-strongloop-pm">Mediante StrongLoop PM</h4>
<p>Si despliega la aplicaci√≥n en StrongLoop Process Manager (PM), puede aprovechar la agrupaci√≥n en cl√∫ster <em>sin</em> modificar el c√≥digo de aplicaci√≥n.</p>
<p>Cuando StrongLoop Process Manager (PM) ejecuta una aplicaci√≥n, la ejecuta autom√°ticamente en un cl√∫ster con un n√∫mero de trabajadores igual al n√∫mero de n√∫cleos de CPU en el sistema. Puede cambiar manualmente el n√∫mero de procesos de trabajador en el cl√∫ster utilizando la herramienta de l√≠nea de mandatos slc sin detener la aplicaci√≥n.</p>
<p>Por ejemplo, suponiendo que ha desplegado la aplicaci√≥n en prod.foo.com y que StrongLoop PM escucha en el puerto 8701 (el valor predeterminado), para establecer el tama√±o de cl√∫ster en ocho utilizando slc:</p>
<pre><code class="language-sh" translate="no">
$ slc ctl -C http://prod.foo.com:8701 set-size my-app 8
</code>
</pre>
<p>Para obtener m√°s informaci√≥n sobre la agrupaci√≥n en cl√∫ster con StrongLoop PM, consulte <a href="https://docs.strongloop.com/display/SLC/Clustering">Clustering</a> en la documentaci√≥n de StrongLoop.</p>
<h3 id="almacenar-en-la-cach√©-los-resultados-de-la-solicitud">Almacenar en la cach√© los resultados de la solicitud</h3>
<p>Otra estrategia para mejorar el rendimiento en la producci√≥n es almacenar en la cach√© el resultado de las solicitudes, para que la aplicaci√≥n no repita la operaci√≥n de dar servicio a la misma solicitud repetidamente.</p>
<p>Utilice un servidor de almacenamiento en memoria cach√© como <a href="https://www.varnish-cache.org/">Varnish</a> o <a href="https://www.nginx.com/resources/wiki/start/topics/examples/reverseproxycachingexample/">Nginx</a> (consulte tambi√©n <a href="https://serversforhackers.com/nginx-caching/">Nginx Caching</a>) para mejorar significativamente la velocidad y el rendimiento de la aplicaci√≥n.</p>
<h3 id="utilizar-un-equilibrador-de-carga">Utilizar un equilibrador de carga</h3>
<p>Independientemente de lo optimizada que est√© una aplicaci√≥n, una √∫nica instancia s√≥lo puede manejar una cantidad limitada de carga y tr√°fico. Una forma de escalar una aplicaci√≥n es ejecutar varias instancias de la misma y distribuir el tr√°fico utilizando un equilibrador de carga. La configuraci√≥n de un equilibrador de carga puede mejorar el rendimiento y la velocidad de la aplicaci√≥n, lo que permite escalarla m√°s que con una √∫nica instancia.</p>
<p>Un equilibrador de carga normalmente es un proxy inverso que orquesta el tr√°fico hacia y desde los servidores y las instancias de aplicaci√≥n. Puede configurar f√°cilmente un equilibrador de carga para la aplicaci√≥n utilizando <a href="http://nginx.org/en/docs/http/load_balancing.html">Nginx</a> o <a href="https://www.digitalocean.com/community/tutorials/an-introduction-to-haproxy-and-load-balancing-concepts">HAProxy</a>.</p>
<p>Con el equilibrio de carga, deber√° asegurarse de que las solicitudes asociadas con un determinado ID de sesi√≥n se conecten al proceso que las ha originado. Esto se conoce como <em>afinidad de sesiones</em> o <em>sesiones adhesivas</em>, y puede solucionarse con la recomendaci√≥n anterior de utilizar un almac√©n de datos como, por ejemplo, Redis para los datos de sesi√≥n (dependiendo de la aplicaci√≥n). Para obtener m√°s informaci√≥n, consulte <a href="http://socket.io/docs/using-multiple-nodes/">Using multiple nodes</a>.</p>
<h4 id="mediante-strongloop-pm-con-un-equilibrador-de-carga-nginx">Mediante StrongLoop PM con un equilibrador de carga Nginx</h4>
<p><a href="http://strong-pm.io/">StrongLoop Process Manager</a> se integra con un Nginx Controller, lo que simplifica las configuraciones de entornos de producci√≥n de varios hosts. Para obtener m√°s informaci√≥n, consulte <a href="https://docs.strongloop.com/display/SLC/Scaling+to+multiple+servers">Scaling to multiple servers</a> (documentaci√≥n de StrongLoop).
<a name="proxy"></a></p>
<h3 id="utilizar-un-proxy-inverso">Utilizar un proxy inverso</h3>
<p>Un proxy inverso se coloca delante de una aplicaci√≥n web y realiza operaciones de soporte en las solicitudes, aparte de dirigir las solicitudes a la aplicaci√≥n. Puede manejar las p√°ginas de errores, la compresi√≥n, el almacenamiento en memoria cach√©, el servicio de archivos y el equilibrio de carga, entre otros.</p>
<p>La entrega de tareas que no necesitan saber el estado de la aplicaci√≥n a un proxy inverso permite a Express realizar tareas de aplicaci√≥n especializadas. Por este motivo, se recomienda ejecutar Express detr√°s de un proxy inverso como <a href="https://www.nginx.com/">Nginx</a> o <a href="http://www.haproxy.org/">HAProxy</a> en la producci√≥n.</p>
</div>
</section>

<noscript>
    <iframe src="http://www.googletagmanager.com/ns.html?id=GTM-5XL76H" height="0" width="0" style="display: none; visibility: hidden;"></iframe>
</noscript>
<script type="f2abbf1947c77bc82513f486-text/javascript">
(function(w, d, s, l, i) {
    w[l] = w[l] || [];
    w[l].push({
        'gtm.start': new Date().getTime(),
        event: 'gtm.js'
    });
    var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s),
        dl = l != 'dataLayer' ? '&l=' + l : '';
    j.async = true;
    j.src =
        '../../../www.googletagmanager.com/gtm5445.js?id=' + i + dl;
    f.parentNode.insertBefore(j, f);
})(window, document, 'script', 'dataLayer', 'GTM-5XL76H');
</script>
<a id="top" href="#"><img src="../../images/arrow.png"></a>
<footer>
<div id="footer-content">
<div id="github">
<iframe src="http://ghbtns.com/github-btn.html?user=expressjs&amp;repo=express&amp;type=watch&amp;count=true" allowtransparency="true" frameborder="0" scrolling="0" width="110" height="20"></iframe>
</div>
<div id="sponsor"><a href="https://github.com/expressjs/express">Express</a> es un proyecto de la Fundaci√≥n Node.js.</div>
<div id="fork"><a href="https://github.com/expressjs/expressjs.com">Bifurque el sitio web en GitHub</a>.
</div>
<div>Copyright &copy; StrongLoop, Inc. y otros colaboradores de expressjs.com.</div>
</div>
<div id="license">
<a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/us/"><img alt="Licencia Creative Commons" style="border-width:0" src="../../../i.creativecommons.org/l/by-sa/3.0/us/80x15.png" /></a> Esta obra est√° bajo una <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/us/">Licencia Creative Commons Atribuci√≥n-CompartirIgual 3.0 Estados Unidos de Am√©rica</a>.
</div>
</footer>
<script type="f2abbf1947c77bc82513f486-text/javascript" src="../../../cdn.jsdelivr.net/npm/docsearch.js%402/dist/cdn/docsearch.min.js" onload="docsearch({
  apiKey: '7164e33055faa6ecddefd9e08fc59f5d',
  indexName: 'expressjs',
  inputSelector: '#q',
  algoliaOptions: { 'facetFilters': ['lang:es'] }
})" async></script>
<script src="../../../ajax.cloudflare.com/cdn-cgi/scripts/a2bd7673/cloudflare-static/rocket-loader.min.js" data-cf-settings="f2abbf1947c77bc82513f486-|49" defer=""></script></body>

<!-- Mirrored from expressjs.com/es/advanced/best-practice-performance.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 10 Jul 2019 00:23:47 GMT -->
</html>
