<!DOCTYPE html>

<html lang="en" prefix="og: http://ogp.me/ns#">

<!-- Mirrored from expressjs.com/th/resources/middleware/timeout.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 10 Jul 2019 00:24:03 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<title>Express timeout middleware</title>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="og:image" content="../../../images/express-facebook-share.png">
<link rel="icon" type="image/png" href="../../../images/favicon.png" />
<link rel="stylesheet" href="../../../css/style.css">
<link rel="stylesheet" href="../../../css/dropit.css">
<link rel="stylesheet" href="../../../css/prism.css">
<link rel="stylesheet" href="../../../css/font-awesome.min.css">
<link rel="stylesheet" href="../../../../fonts.googleapis.com/css2a1d.css?family=Open+Sans:300,400,600,700&amp;amp;subset=latin,latin-ext">
<link rel="stylesheet" href="../../../css/en.css">
<link rel="stylesheet" href="../../../css/nodeinteractive.css">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script data-cfasync="false" src="../../../../ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script data-cfasync="false" src="../../../js/ismobile.js"></script>
<script data-cfasync="false" src="../../../js/app.js"></script>
<script data-cfasync="false" src="../../../js/retina.js"></script>
<script data-cfasync="false" src="../../../js/dropit.js"></script>
<script data-cfasync="false" src="../../../js/prism.js"></script>
<link rel="stylesheet" href="../../../../cdn.jsdelivr.net/npm/docsearch.js%402/dist/cdn/docsearch.min.css" />
</head>
<body class="en-doc">
<section class="page content">
<header>
<div id="mobile-menu">
<div id="nav-button" class="fa fa-bars fa-2x button"></div>
</div>
<section id="logo"><a href="../../../index.html" class="express">Express</a>
</section>
<div id="navbar">
<input id="q" placeholder="üîé search">
<ul id="navmenu">
<li><a href="../../../index.html" id="home-menu">Home</a></li>
<li>
<ul id="getting-started-menu" class="menu">
<li><a href="../../../en/starter/installing.html">Getting started</a>
<ul>
<li>
<a href="../../../en/starter/installing.html">
Installing
</a>
</li>
<li>
<a href="../../../en/starter/hello-world.html">
Hello world
</a>
</li>
<li>
<a href="../../../en/starter/generator.html">
Express generator
</a>
</li>
<li>
<a href="../../../en/starter/basic-routing.html">
Basic routing
</a>
</li>
<li>
<a href="../../../en/starter/static-files.html">
Static files
</a>
</li>
<li>
<a href="../../../en/starter/faq.html">
FAQ
</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<ul id="guide-menu" class="menu">
<li><a href="../../../en/guide/routing.html">Guide</a>
<ul>
<li><a href="../../../en/guide/routing.html">Routing</a>
</li>
<li><a href="../../../en/guide/writing-middleware.html">Writing middleware</a>
</li>
<li><a href="../../../en/guide/using-middleware.html">Using middleware</a>
</li>
<li><a href="../../../en/guide/using-template-engines.html">Using template engines</a>
</li>
<li><a href="../../../en/guide/error-handling.html">Error handling</a>
</li>
<li><a href="../../../en/guide/debugging.html">Debugging</a>
</li>
<li><a href="../../../en/guide/behind-proxies.html">Express behind proxies</a>
</li>
<li><a href="../../../en/guide/migrating-4.html">Moving to Express 4</a>
</li>
<li><a href="../../../en/guide/migrating-5.html">Moving to Express 5</a>
</li>
<li><a href="../../../en/guide/database-integration.html">Database integration</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<ul id="application-menu" class="menu">
<li><a href="../../../en/4x/api.html">API reference</a>
<ul>
<li><a href="../../../en/5x/api.html">5.x (alpha)</a>
</li>
<li><a href="../../../en/4x/api.html">4.x</a>
</li>
<li><a href="../../../en/3x/api.html">3.x (deprecated)</a>
</li>
<li><a href="../../../2x/index.html">2.x (deprecated)</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<ul id="advanced-topics-menu" class="menu">
<li><a href="../../../en/advanced/developing-template-engines.html">Advanced topics</a>
<ul>
<li><a href="../../../en/advanced/developing-template-engines.html">Template engines</a>
</li>
<li><a href="../../../en/advanced/pm.html">Process managers</a>
</li>
<li><a href="../../../en/advanced/security-updates.html">Security updates</a>
</li>
<li><a href="../../../en/advanced/best-practice-security.html">Security best practices</a>
</li>
<li><a href="../../../en/advanced/best-practice-performance.html">Performance best practices</a>
</li>
<li><a href="../../../en/advanced/healthcheck-graceful-shutdown.html">Health checks and graceful shutdown</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<ul id="resources-menu" class="menu">
<li><a href="../../../en/resources/glossary.html" class="active">Resources</a>
<ul>
<li>
<a href="../../../en/resources/community.html">Community</a>
</li>
<li>
<a href="../../../en/resources/glossary.html">Glossary</a>
</li>
<li>
<a href="../../../en/resources/template-engines.html">Template Engines</a>
</li>
<li>
<a href="../../../en/resources/middleware.html">Middleware</a>
</li>
<li>
<a href="../../../en/resources/utils.html">Utility modules</a>
</li>
<li>
<a href="../../../en/resources/frameworks.html">Frameworks</a>
</li>
<li>
<a href="../../../en/resources/companies-using-express.html">Companies using Express</a>
</li>
<li>
<a href="../../../en/resources/open-source-using-express.html">Open-source projects</a>
</li>
<li>
<a href="../../../en/resources/books-blogs.html">Books and blogs</a>
</li>
<li>
<a href="../../../en/resources/contributing.html">Contributing to Express</a>
</li>
<li>
<a href="../../../en/changelog/4x.html">Release Change Log</a>
</li>
</ul>
</li>
</ul>
</li>

</ul>
</div>
</header>
<div id="overlay"></div>
<div id="page-doc" markdown="1">
<div id="mw-container">
<div id="mw-list">
<ul>
<li><a href="../../../en/resources/middleware/body-parser.html">body-parser</a></li>
<li><a href="../../../en/resources/middleware/compression.html">compression</a></li>
<li><a href="../../../en/resources/middleware/connect-rid.html">connect-rid</a></li>
<li><a href="../../../en/resources/middleware/cookie-parser.html">cookie-parser</a></li>
<li><a href="../../../en/resources/middleware/cookie-session.html">cookie-session</a></li>
<li><a href="../../../en/resources/middleware/cors.html">cors</a></li>
<li><a href="../../../en/resources/middleware/csurf.html">csurf</a></li>
<li><a href="../../../en/resources/middleware/errorhandler.html">errorhandler</a></li>
<li><a href="../../../en/resources/middleware/method-override.html">method-override</a></li>
<li><a href="../../../en/resources/middleware/morgan.html">morgan</a></li>
<li><a href="../../../en/resources/middleware/multer.html">multer</a></li>
<li><a href="../../../en/resources/middleware/response-time.html">response-time</a></li>
<li><a href="../../../en/resources/middleware/serve-favicon.html">serve-favicon</a></li>
<li><a href="../../../en/resources/middleware/serve-index.html">serve-index</a></li>
<li><a href="../../../en/resources/middleware/serve-static.html">serve-static</a></li>
<li><a href="../../../en/resources/middleware/session.html">session</a></li>
<li><a href="../../../en/resources/middleware/timeout.html">timeout</a></li>
<li><a href="../../../en/resources/middleware/vhost.html">vhost</a></li>
</ul>
</div>
<div id="middleware-content">
<div class="alert alert-info" role="alert"><i class="fa fa-info-circle"></i>
<b>Note:</b> This page was generated from the
<a target="_blank" href="https://github.com/expressjs/timeout">timeout README</a>.
</div>
<h1 id="connect-timeout">connect-timeout</h1>
<p><a href="https://npmjs.org/package/connect-timeout"><img src="../../../../img.shields.io/npm/v/connect-timeout.svg" alt="NPM Version" /></a>
<a href="https://npmjs.org/package/connect-timeout"><img src="../../../../img.shields.io/npm/dm/connect-timeout.svg" alt="NPM Downloads" /></a>
<a href="https://travis-ci.org/expressjs/timeout"><img src="../../../../img.shields.io/travis/expressjs/timeout/master.svg" alt="Build Status" /></a>
<a href="https://coveralls.io/r/expressjs/timeout?branch=master"><img src="../../../../img.shields.io/coveralls/expressjs/timeout/master.svg" alt="Test Coverage" /></a>
<a href="https://www.gratipay.com/dougwilson/"><img src="../../../../img.shields.io/gratipay/dougwilson.svg" alt="Gratipay" /></a></p>
<p>Times out a request in the Connect/Express application framework.</p>
<h2 id="install">Install</h2>
<p>This is a <a href="https://nodejs.org/en/">Node.js</a> module available through the
<a href="https://www.npmjs.com/">npm registry</a>. Installation is done using the
<a href="https://docs.npmjs.com/getting-started/installing-npm-packages-locally"><code>npm install</code> command</a>:</p>
<pre><code class="language-sh">$ npm install connect-timeout
</code></pre>
<h2 id="api">API</h2>
<p><strong>NOTE</strong> This module is not recommend as a ‚Äútop-level‚Äù middleware (i.e.
<code>app.use(timeout('5s'))</code>) unless you take precautions to halt your own
middleware processing. See <a href="#as-top-level-middleware">as top-level middleware</a>
for how to use as a top-level middleware.</p>
<p>While the library will emit a ‚Äòtimeout‚Äô event when requests exceed the given
timeout, node will continue processing the slow request until it terminates.
Slow requests will continue to use CPU and memory, even if you are returning
a HTTP response in the timeout callback. For better control over CPU/memory,
you may need to find the events that are taking a long time (3rd party HTTP
requests, disk I/O, database calls) and find a way to cancel them, and/or
close the attached sockets.</p>
<h3 id="timeouttime-options">timeout(time, [options])</h3>
<p>Returns middleware that times out in <code>time</code> milliseconds. <code>time</code> can also
be a string accepted by the <a href="https://www.npmjs.org/package/ms#readme">ms</a>
module. On timeout, <code>req</code> will emit <code>"timeout"</code>.</p>
<h4 id="options">Options</h4>
<p>The <code>timeout</code> function takes an optional <code>options</code> object that may contain
any of the following keys:</p>
<h5 id="respond">respond</h5>
<p>Controls if this module will ‚Äúrespond‚Äù in the form of forwarding an error.
If <code>true</code>, the timeout error is passed to <code>next()</code> so that you may customize
the response behavior. This error has a <code>.timeout</code> property as well as
<code>.status == 503</code>. This defaults to <code>true</code>.</p>
<h3 id="reqcleartimeout">req.clearTimeout()</h3>
<p>Clears the timeout on the request. The timeout is completely removed and
will not fire for this request in the future.</p>
<h3 id="reqtimedout">req.timedout</h3>
<p><code>true</code> if timeout fired; <code>false</code> otherwise.</p>
<h2 id="examples">Examples</h2>
<h3 id="as-top-level-middleware">as top-level middleware</h3>
<p>Because of the way middleware processing works, once this module
passes the request to the next middleware (which it has to do in order
for you to do work), it can no longer stop the flow, so you must take
care to check if the request has timedout before you continue to act
on the request.</p>
<pre><code class="language-javascript">var bodyParser = require('body-parser')
var cookieParser = require('cookie-parser')
var express = require('express')
var timeout = require('connect-timeout')

// example of using this top-level; note the use of haltOnTimedout
// after every middleware; it will stop the request flow on a timeout
var app = express()
app.use(timeout('5s'))
app.use(bodyParser())
app.use(haltOnTimedout)
app.use(cookieParser())
app.use(haltOnTimedout)

// Add your routes here, etc.

function haltOnTimedout (req, res, next) {
  if (!req.timedout) next()
}

app.listen(3000)
</code></pre>
<h3 id="express-3x">express 3.x</h3>
<pre><code class="language-javascript">var express = require('express')
var bodyParser = require('body-parser')
var timeout = require('connect-timeout')

var app = express()
app.post('/save', timeout('5s'), bodyParser.json(), haltOnTimedout, function (req, res, next) {
  savePost(req.body, function (err, id) {
    if (err) return next(err)
    if (req.timedout) return
    res.send('saved as id ' + id)
  })
})

function haltOnTimedout (req, res, next) {
  if (!req.timedout) next()
}

function savePost (post, cb) {
  setTimeout(function () {
    cb(null, ((Math.random() * 40000) &gt;&gt;&gt; 0))
  }, (Math.random() * 7000) &gt;&gt;&gt; 0)
}

app.listen(3000)
</code></pre>
<h3 id="connect">connect</h3>
<pre><code class="language-javascript">var bodyParser = require('body-parser')
var connect = require('connect')
var timeout = require('connect-timeout')

var app = connect()
app.use('/save', timeout('5s'), bodyParser.json(), haltOnTimedout, function (req, res, next) {
  savePost(req.body, function (err, id) {
    if (err) return next(err)
    if (req.timedout) return
    res.send('saved as id ' + id)
  })
})

function haltOnTimedout (req, res, next) {
  if (!req.timedout) next()
}

function savePost (post, cb) {
  setTimeout(function () {
    cb(null, ((Math.random() * 40000) &gt;&gt;&gt; 0))
  }, (Math.random() * 7000) &gt;&gt;&gt; 0)
}

app.listen(3000)
</code></pre>
<h2 id="license">License</h2>
<p><a href="LICENSE.html">MIT</a></p>
</div>
</div>
</div>
</section>
<noscript>
    <iframe src="http://www.googletagmanager.com/ns.html?id=GTM-5XL76H" height="0" width="0" style="display: none; visibility: hidden;"></iframe>
</noscript>
<script type="455ea1a320f2bbefd2d59590-text/javascript">
(function(w, d, s, l, i) {
    w[l] = w[l] || [];
    w[l].push({
        'gtm.start': new Date().getTime(),
        event: 'gtm.js'
    });
    var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s),
        dl = l != 'dataLayer' ? '&l=' + l : '';
    j.async = true;
    j.src =
        '../../../../www.googletagmanager.com/gtm5445.js?id=' + i + dl;
    f.parentNode.insertBefore(j, f);
})(window, document, 'script', 'dataLayer', 'GTM-5XL76H');
</script>
<a id="top" href="#"><img src="../../../images/arrow.png"></a>
<footer>
<section id="doc-langs">
Documentation translations provided by <a href="http://strongloop.com/">StrongLoop/IBM</a>:
<a href="../../../fr/index.html">French</a>, <a href="../../../de/index.html">German</a>, <a href="../../../es/index.html">Spanish</a>, <a href="../../../it/index.html">Italian</a>, <a href="../../../ja/index.html">Japanese</a>, <a href="../../../ru/index.html">Russian</a>, <a href="../../../zh-cn/index.html">Chinese</a>, <a href="../../../zh-tw/index.html">Traditional Chinese</a>, <a href="../../../ko/index.html">Korean</a>, <a href="../../../pt-br/index.html">Portuguese</a>.
<br>
Community translation available for: <a href="../../../sk/index.html">Slovak</a>, <a href="../../../uk/index.html">Ukrainian</a>, <a href="../../../uz/index.html">Uzbek</a>, <a href="../../../tr/index.html">Turkish</a> and <a href="../../index.html">Thai</a>.
</section>
<div id="footer-content">
<div id="github">
<a class="github-button" href="https://github.com/expressjs/expressjs.com" data-icon="octicon-star" aria-label="Star expressjs/expressjs.com on GitHub">Star</a>
</div>
<div id="sponsor"><a href="https://github.com/expressjs/express/">Express</a>
is a project of the <a href="http://nodejs.org/foundation"></a>Node.js Foundation</a>.</div>
<div id="fork"><a href="https://github.com/expressjs/expressjs.com">Fork the website on GitHub</a>.
</div>
<div>Copyright &copy; 2017 StrongLoop, IBM, and other expressjs.com contributors.</div>
</div>
<div id="license">
<a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/us/"><img alt="Creative Commons License" style="border-width:0" src="../../../../i.creativecommons.org/l/by-sa/3.0/us/80x15.png" /></a> This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/us/">Creative Commons Attribution-ShareAlike 3.0 United States License</a>.
</div>
</footer>
<script async defer src="../../../../buttons.github.io/buttons.js" type="455ea1a320f2bbefd2d59590-text/javascript"></script>
<script type="455ea1a320f2bbefd2d59590-text/javascript" src="../../../../cdn.jsdelivr.net/npm/docsearch.js%402/dist/cdn/docsearch.min.js" onload="docsearch({
  apiKey: '7164e33055faa6ecddefd9e08fc59f5d',
  indexName: 'expressjs',
  inputSelector: '#q',
  algoliaOptions: { 'facetFilters': ['lang:en'] }
})" async></script>
<script src="../../../../ajax.cloudflare.com/cdn-cgi/scripts/a2bd7673/cloudflare-static/rocket-loader.min.js" data-cf-settings="455ea1a320f2bbefd2d59590-|49" defer=""></script></body>

<!-- Mirrored from expressjs.com/th/resources/middleware/timeout.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 10 Jul 2019 00:24:03 GMT -->
</html>
