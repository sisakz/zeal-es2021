<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">

<!-- Mirrored from developer.wordpress.org/reference/classes/custom_image_header/ by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 31 Aug 2021 16:49:10 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<!--
<meta property="fb:page_id" content="6427302910" />
-->
<meta name="google-site-verification" content="7VWES_-rcHBcmaQis9mSYamPfNwE03f4vyTj4pfuAw0" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Custom_Image_Header</title>
<meta name="referrer" content="always">

		<link href='../../../../fonts.googleapis.com/css.css?family=Open+Sans:300italic,400italic,600italic,400,300,600&amp;subset=latin,cyrillic-ext,greek-ext,greek,vietnamese,latin-ext,cyrillic' rel='stylesheet' type='text/css'>

		<link rel="stylesheet" href="../../../../s.w.org/style/wp4.css?95" />

<link rel="shortcut icon" href="../../../../s.w.org/favicon.ico?2" type="image/x-icon" />
<link rel="pingback" href="../../../xmlrpc.php" /><meta name='robots' content='max-image-preview:large' />
<link rel='dns-prefetch' href='../../../../fonts.googleapis.com/index.html' />
<link rel='dns-prefetch' href='http://s.w.org/' />
<link rel='dns-prefetch' href='http://www.googletagmanager.com/' />
<link rel='dns-prefetch' href='http://fonts.gstatic.com/' />
<link rel="alternate" type="application/rss+xml" title="WordPress Developer Resources &raquo; Feed" href="../../../feed/index.html" />
<link rel="alternate" type="application/rss+xml" title="WordPress Developer Resources &raquo; Comments Feed" href="../../../comments/feed/index.html" />
<meta property="og:title" content="Custom_Image_Header | Class | WordPress Developer Resources" />
<meta property="og:site_name" content="WordPress Developer Resources" />
<meta property="og:type" content="website" />
<meta property="og:url" content="../../../index.html" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@WordPress" />
<meta name="description" content="The custom header image class." />
<meta property="og:description" content="The custom header image class." />
<link rel="alternate" type="application/rss+xml" title="WordPress Developer Resources &raquo; Custom_Image_Header Comments Feed" href="https://developer.wordpress.org/reference/classes/custom_image_header/feed/" />
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'../../../../www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-P24PF4B');</script>
			<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.1.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.1.0\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/developer.wordpress.org\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.9-alpha-51701"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([10084,65039,8205,55357,56613],[10084,65039,8203,55357,56613])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='dashicons-css'  href='../../../wp-includes/css/dashicons.min.css?ver=5.9-alpha-51701' type='text/css' media='all' />
<link rel='stylesheet' id='admin-bar-css'  href='../../../wp-includes/css/admin-bar.min.css?ver=5.9-alpha-51701' type='text/css' media='all' />
<link rel='stylesheet' id='wp-block-library-css'  href='../../../wp-includes/css/dist/block-library/style.min.css?ver=5.9-alpha-51701' type='text/css' media='all' />
<link rel='stylesheet' id='wporg-handbook-css-css'  href='../../../wp-content/plugins/handbook/stylesheets/callout-boxes.css?ver=20200121' type='text/css' media='all' />
<link rel='stylesheet' id='open-sans-css'  href='../../../../fonts.googleapis.com/css-2.css?family=Open+Sans%3A300italic%2C400italic%2C600italic%2C300%2C400%2C600&amp;subset=latin%2Clatin-ext&amp;display=fallback&amp;ver=5.9-alpha-51701' type='text/css' media='all' />
<link rel='stylesheet' id='wporg-developer-style-css'  href='../../../wp-content/themes/pub/wporg-developer/style.css?ver=3' type='text/css' media='all' />
<link rel='stylesheet' id='wp-dev-sass-compiled-css'  href='../../../wp-content/themes/pub/wporg-developer/stylesheets/main.css?ver=20200713' type='text/css' media='all' />
<link rel='stylesheet' id='awesomplete-css-css'  href='../../../wp-content/themes/pub/wporg-developer/stylesheets/awesomplete.css?ver=20160114' type='text/css' media='all' />
<link rel='stylesheet' id='autocomplete-css-css'  href='../../../wp-content/themes/pub/wporg-developer/stylesheets/autocomplete.css?ver=20171220' type='text/css' media='all' />
<link rel='stylesheet' id='syntaxhighlighter-core-css'  href='../../../wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.9b' type='text/css' media='all' />
<link rel='stylesheet' id='syntaxhighlighter-theme-default-css'  href='../../../wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.9b' type='text/css' media='all' />
<script type='text/javascript' src='../../../wp-includes/js/jquery/jquery.min.js?ver=3.6.0' id='jquery-core-js'></script>
<script type='text/javascript' src='../../../wp-includes/js/jquery/jquery-migrate.min.js?ver=3.3.2' id='jquery-migrate-js'></script>
<script type='text/javascript' src='../../../wp-content/plugins/handbook/scripts/handbook.js?ver=20150930' id='wporg-handbook-js'></script>
<script type='text/javascript' src='../../../wp-content/themes/pub/wporg-developer/js/chapters.js?ver=20190603' id='wporg-developer-chapters-js'></script>
<script type='text/javascript' src='../../../wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.9b' id='syntaxhighlighter-core-js'></script>
<script type='text/javascript' src='../../../wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushPhp.js?ver=3.0.9b' id='syntaxhighlighter-brush-php-js'></script>
<link rel="https://api.w.org/" href="https://developer.wordpress.org/wp-json/" /><link rel="alternate" type="application/json" href="https://developer.wordpress.org/wp-json/wp/v2/wp-parser-class/4000" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../../xmlrpc-2.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../../../wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.9-alpha-51701" />
<link rel='shortlink' href='https://developer.wordpress.org/?p=4000' />
<link rel="alternate" type="application/json+oembed" href="https://developer.wordpress.org/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Fclasses%2Fcustom_image_header%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://developer.wordpress.org/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Fclasses%2Fcustom_image_header%2F&amp;format=xml" />
<link rel="canonical" href="index.html">
<!-- Stream WordPress user activity plugin v3.6.2 -->
	<style>
		@media screen and (max-width: 782px) {
			#wpadminbar li#wp-admin-bar-log-in,
			#wpadminbar li#wp-admin-bar-register {
				display: block;
			}

			#wpadminbar li#wp-admin-bar-log-in a,
			#wpadminbar li#wp-admin-bar-register a {
				padding: 0 8px;
			}
		}
	</style>
		<style>
			a.github-edit {
				margin-left: .5em;
				font-size: .5em;
				vertical-align: top;
				display: inline-block;
				border: 1px solid #eeeeee;
				border-radius: 2px;
				background: #eeeeee;
				padding: .5em .6em .4em;
				color: black;
				margin-top: 0.1em;
			}
			a.github-edit > * {
				opacity: 0.6;
			}
			a.github-edit:hover > * {
				opacity: 1;
				color: black;
			}
			a.github-edit img {
				height: .8em;
			}
		</style>
		
	<script type="text/javascript">
		jQuery( '<style>.hide-if-js { display: none; }</style>' ).appendTo( 'head' );
		jQuery( function($) {
			$( 'body' ).addClass('js');
		} );
	</script>
<style type="text/css" media="print">#wpadminbar { display:none; }</style>
	<style type="text/css" media="screen">
	</style>
	<script>document.cookie='devicePixelRatio='+((window.devicePixelRatio === undefined) ? 1 : window.devicePixelRatio)+'; path=/';</script>

</head>


<body id="wordpress-org" class="wp-parser-class-template-default single single-wp-parser-class postid-4000 admin-bar no-customize-support">
		<div id="wpadminbar" class="nojq nojs">
						<div class="quicklinks" id="wp-toolbar" role="navigation" aria-label="Toolbar">
				<ul id='wp-admin-bar-root-default' class="ab-top-menu"><li id='wp-admin-bar-wp-logo' class="menupop"><a class='ab-item' aria-haspopup="true" href='https://wordpress.org/about/'><span class="ab-icon" aria-hidden="true"></span><span class="screen-reader-text">About WordPress</span></a><div class="ab-sub-wrapper"><ul id='wp-admin-bar-wp-logo-default' class="ab-submenu"><li id='wp-admin-bar-about'><a class='ab-item' href='https://wordpress.org/about/'>About WordPress</a></li></ul><ul id='wp-admin-bar-wp-logo-external' class="ab-sub-secondary ab-submenu"><li id='wp-admin-bar-wporg'><a class='ab-item' href='https://wordpress.org/'>WordPress.org</a></li><li id='wp-admin-bar-documentation'><a class='ab-item' href='https://wordpress.org/support/'>Documentation</a></li><li id='wp-admin-bar-support-forums'><a class='ab-item' href='https://wordpress.org/support/forums/'>Support</a></li><li id='wp-admin-bar-feedback'><a class='ab-item' href='https://wordpress.org/support/forum/requests-and-feedback'>Feedback</a></li></ul></div></li></ul><ul id='wp-admin-bar-top-secondary' class="ab-top-secondary ab-top-menu"><li id='wp-admin-bar-search' class="admin-bar-search"><div class="ab-item ab-empty-item" tabindex="-1"><form action="https://developer.wordpress.org/" method="get" id="adminbarsearch"><input class="adminbar-input" name="s" id="adminbar-search" type="text" value="" maxlength="150" /><label for="adminbar-search" class="screen-reader-text">Search</label><input type="submit" class="adminbar-button" value="Search" /></form></div></li><li id='wp-admin-bar-log-in'><a class='ab-item' href='https://login.wordpress.org/?locale=en_US'>Log In</a></li><li id='wp-admin-bar-register'><a class='ab-item' href='https://login.wordpress.org/register?locale=en_US'>Register</a></li></ul>			</div>
					</div>

		<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P24PF4B" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
	<div id="wporg-header">
	<div class="wrapper">
	<h1><a href="http://wordpress.org/">WordPress.org</a></h1>				<div id="head-search">
		<form action="http://wordpress.org/search/do-search.php" method="get">
			<label for="global-search" class="screen-reader-text">Search WordPress.org for:</label>
			<input id="global-search" class="text" name="search" type="text" value="" maxlength="150" placeholder="Search WordPress.org" />
			<button type="submit" class="button"><span class="screen-reader-text">Submit</span></button>
		</form>
		</div>
				<div style="clear:both"></div>
		<button id="mobile-menu-button" aria-expanded="false"><span class="screen-reader-text">Toggle Menu</span></button>
		
<nav aria-label="Main Menu">
<ul id="wporg-header-menu">
<li class="menu-item"><a href='http://wordpress.org/showcase/' data-title='See some of the sites built on WordPress.'>Showcase</a></li>
<li class="menu-item"><a href='http://learn.wordpress.org/' data-title='Resources to help you learn more about WordPress and teach it to others.'>Learn</a></li>
<li class="menu-item"><a href='http://wordpress.org/themes/' data-title='Find just the right look for your website.'>Themes</a></li>
<li class="menu-item"><a href='http://wordpress.org/plugins/' data-title='Plugins can extend WordPress to do almost anything you can imagine.'>Plugins</a></li>
<li class="menu-item"><a href='http://wordpress.org/mobile/' data-title='Take your website on the go!'>Mobile</a></li>
<li class="menu-item"><a href='http://wordpress.org/support/' data-title='Forums, documentation, help.'>Support</a><ul class="nav-submenu"><li><a href='http://wordpress.org/support/' title='Documentation, tutorials, best practices.'>Documentation</a></li><li><a href='http://wordpress.org/support/forums/' title='Support and discussion forums.'>Forums</a></li></ul><div class="uparrow"></div></li>
<li class="menu-item"><a href='http://make.wordpress.org/' data-title='Contribute your knowledge.'>Get Involved</a><ul class="nav-submenu"><li><a href='http://wordpress.org/five-for-the-future/' title='How five percent is powering the next generation of the web'>Five for the Future</a></li></ul><div class="uparrow"></div></li>
<li class="menu-item"><a href='http://wordpress.org/about/' data-title='About the WordPress Organization, and where we&#039;re going.'>About</a></li>
<li class="menu-item"><a href='http://wordpress.org/news/' data-title='Come here for the latest scoop.'>Blog</a></li>
<li class="menu-item"><a href='http://wordpress.org/hosting/' data-title='Find a home for your blog.'>Hosting</a></li>
<li id="download" class="button download-button menu-item"><a href='http://wordpress.org/download/' data-title='Get it. Got it? Good.'>Get WordPress</a></li>
</ul>
</nav>
		<div style="clear:both"></div>
	</div>
</div>



<header id="masthead" class="site-header" role="banner">
		<div class="site-branding">
		<h1 class="site-title">
			<a href="../../index.html" rel="home">Code Reference</a>
		</h1>

		
		<nav id="site-navigation" class="main-navigation" role="navigation">
			<button class="menu-toggle dashicons dashicons-arrow-down-alt2" aria-controls="primary-menu" aria-expanded="false" aria-label="Primary Menu"></button>
					</nav>
	</div>
</header><!-- #masthead -->

<div id="page" class="hfeed site devhub-wrap">
	<a href="#main" class="screen-reader-text">Skip to content</a>

				<div id="inner-search">
			<div class="search-section section clear hide-if-js">


	
	<form role="search" method="get" class="searchform searchform-filtered" action="https://developer.wordpress.org/">
		<label for="search-field" class="screen-reader-text">Search for:</label>
		<input type="text" id="search-field" class="search-field" placeholder="Search &hellip;" value="" name="s">
		<button class="button button-primary button-search"><i class="dashicons dashicons-search"></i><span class="screen-reader-text">Search plugins</span></button>
	
		<div class="search-post-type">
			<span>Filter by type:</span>
									<label><input type="checkbox" name="post_type[]" value="wp-parser-function"
						 /> Functions</label>
									<label><input type="checkbox" name="post_type[]" value="wp-parser-hook"
						 /> Hooks</label>
									<label><input type="checkbox" name="post_type[]" value="wp-parser-class"
						 /> Classes</label>
									<label><input type="checkbox" name="post_type[]" value="wp-parser-method"
						 /> Methods</label>
					</div>

	
	</form>

</div><!-- /search-guide -->
			<div id="inner-search-icon-container">
				<div id="inner-search-icon">
					<div class="dashicons dashicons-search"><span class="screen-reader-text">Search</span></div>
				</div>
			</div>
		</div>

		<div id="content" class="site-content">

	<div id="content-area" class="wp-parser-class-template-default single single-wp-parser-class postid-4000 admin-bar no-customize-support code-reference">

		
		<div class="breadcrumb-trail breadcrumbs" itemprop="breadcrumb">
			<span class="trail-browse">Browse:</span> 
			<span class="trail-begin"><a href="../../../index.html" title="WordPress Developer Resources" rel="home">Home</a></span> <span class="sep">&#47;</span> 
			<span class="trail-inner"><a href="../../index.html" title="Reference">Reference</a></span> <span class="sep">&#47;</span> 
			<span class="trail-inner"><a href="../index.html">Classes</a></span> <span class="sep">&#47;</span> <span class="trail-end">Custom_Image_Header</span>
		</div>
		<main id="main" class="site-main" role="main">

		
			
<article id="post-4000" class="post-4000 wp-parser-class type-wp-parser-class status-publish hentry wp-parser-source-file-wp-admin_includes_class-custom-image-header-php wp-parser-package-administration wp-parser-package-wordpress wp-parser-since-2-1-0">

	
	
	<h1>Custom_Image_Header</h1>

	<section class="summary">
		<p>The custom header image class.</p>
	</section>


	
	<div class="content-toc"><style> .toc-jump { text-align: right; font-size: 12px; } .page .toc-heading { margin-top: -50px; padding-top: 50px !important; }</style><div class="table-of-contents"><h2>Contents</h2><ul class="items"><li><a href="#source">Source</a></li>
<li><a href="#methods">Methods</a></li>
<li><a href="#changelog">Changelog</a></li>
<li><a href="#user-contributed-notes">User Contributed Notes</a></ul>
</div>
	<hr />
	<section class="source-content">
		<h2 class="toc-heading" id="source" tabindex="-1">Source <a href="#source" class="anchor"><span aria-hidden="true">#</span><span class="screen-reader-text">Source</span></a></h2>
		<p>
			File: <a href="../../files/wp-admin/includes/class-custom-image-header.php/index.html">wp-admin/includes/class-custom-image-header.php</a>		</p>

					<div class="source-code-container">
				<pre class="brush: php; toolbar: false; first-line: 14">class Custom_Image_Header {

	/**
	 * Callback for administration header.
	 *
	 * @var callable
	 * @since 2.1.0
	 */
	public $admin_header_callback;

	/**
	 * Callback for header div.
	 *
	 * @var callable
	 * @since 3.0.0
	 */
	public $admin_image_div_callback;

	/**
	 * Holds default headers.
	 *
	 * @var array
	 * @since 3.0.0
	 */
	public $default_headers = array();

	/**
	 * Used to trigger a success message when settings updated and set to true.
	 *
	 * @since 3.0.0
	 * @var bool
	 */
	private $updated;

	/**
	 * Constructor - Register administration header callback.
	 *
	 * @since 2.1.0
	 * @param callable $admin_header_callback
	 * @param callable $admin_image_div_callback Optional custom image div output callback.
	 */
	public function __construct( $admin_header_callback, $admin_image_div_callback = '' ) {
		$this-&gt;admin_header_callback    = $admin_header_callback;
		$this-&gt;admin_image_div_callback = $admin_image_div_callback;

		add_action( 'admin_menu', array( $this, 'init' ) );

		add_action( 'customize_save_after', array( $this, 'customize_set_last_used' ) );
		add_action( 'wp_ajax_custom-header-crop', array( $this, 'ajax_header_crop' ) );
		add_action( 'wp_ajax_custom-header-add', array( $this, 'ajax_header_add' ) );
		add_action( 'wp_ajax_custom-header-remove', array( $this, 'ajax_header_remove' ) );
	}

	/**
	 * Set up the hooks for the Custom Header admin page.
	 *
	 * @since 2.1.0
	 */
	public function init() {
		$page = add_theme_page( __( 'Header' ), __( 'Header' ), 'edit_theme_options', 'custom-header', array( $this, 'admin_page' ) );

		if ( ! $page ) {
			return;
		}

		add_action( &quot;admin_print_scripts-{$page}&quot;, array( $this, 'js_includes' ) );
		add_action( &quot;admin_print_styles-{$page}&quot;, array( $this, 'css_includes' ) );
		add_action( &quot;admin_head-{$page}&quot;, array( $this, 'help' ) );
		add_action( &quot;admin_head-{$page}&quot;, array( $this, 'take_action' ), 50 );
		add_action( &quot;admin_head-{$page}&quot;, array( $this, 'js' ), 50 );

		if ( $this-&gt;admin_header_callback ) {
			add_action( &quot;admin_head-{$page}&quot;, $this-&gt;admin_header_callback, 51 );
		}
	}

	/**
	 * Adds contextual help.
	 *
	 * @since 3.0.0
	 */
	public function help() {
		get_current_screen()-&gt;add_help_tab(
			array(
				'id'      =&gt; 'overview',
				'title'   =&gt; __( 'Overview' ),
				'content' =&gt;
					'&lt;p&gt;' . __( 'This screen is used to customize the header section of your theme.' ) . '&lt;/p&gt;' .
					'&lt;p&gt;' . __( 'You can choose from the theme&amp;#8217;s default header images, or use one of your own. You can also customize how your Site Title and Tagline are displayed.' ) . '&lt;p&gt;',
			)
		);

		get_current_screen()-&gt;add_help_tab(
			array(
				'id'      =&gt; 'set-header-image',
				'title'   =&gt; __( 'Header Image' ),
				'content' =&gt;
					'&lt;p&gt;' . __( 'You can set a custom image header for your site. Simply upload the image and crop it, and the new header will go live immediately. Alternatively, you can use an image that has already been uploaded to your Media Library by clicking the &amp;#8220;Choose Image&amp;#8221; button.' ) . '&lt;/p&gt;' .
					'&lt;p&gt;' . __( 'Some themes come with additional header images bundled. If you see multiple images displayed, select the one you&amp;#8217;d like and click the &amp;#8220;Save Changes&amp;#8221; button.' ) . '&lt;/p&gt;' .
					'&lt;p&gt;' . __( 'If your theme has more than one default header image, or you have uploaded more than one custom header image, you have the option of having WordPress display a randomly different image on each page of your site. Click the &amp;#8220;Random&amp;#8221; radio button next to the Uploaded Images or Default Images section to enable this feature.' ) . '&lt;/p&gt;' .
					'&lt;p&gt;' . __( 'If you don&amp;#8217;t want a header image to be displayed on your site at all, click the &amp;#8220;Remove Header Image&amp;#8221; button at the bottom of the Header Image section of this page. If you want to re-enable the header image later, you just have to select one of the other image options and click &amp;#8220;Save Changes&amp;#8221;.' ) . '&lt;/p&gt;',
			)
		);

		get_current_screen()-&gt;add_help_tab(
			array(
				'id'      =&gt; 'set-header-text',
				'title'   =&gt; __( 'Header Text' ),
				'content' =&gt;
					'&lt;p&gt;' . sprintf(
						/* translators: %s: URL to General Settings screen. */
						__( 'For most themes, the header text is your Site Title and Tagline, as defined in the &lt;a href=&quot;%s&quot;&gt;General Settings&lt;/a&gt; section.' ),
						admin_url( 'options-general.php' )
					) .
					'&lt;/p&gt;' .
					'&lt;p&gt;' . __( 'In the Header Text section of this page, you can choose whether to display this text or hide it. You can also choose a color for the text by clicking the Select Color button and either typing in a legitimate HTML hex value, e.g. &amp;#8220;#ff0000&amp;#8221; for red, or by choosing a color using the color picker.' ) . '&lt;/p&gt;' .
					'&lt;p&gt;' . __( 'Don&amp;#8217;t forget to click &amp;#8220;Save Changes&amp;#8221; when you&amp;#8217;re done!' ) . '&lt;/p&gt;',
			)
		);

		get_current_screen()-&gt;set_help_sidebar(
			'&lt;p&gt;&lt;strong&gt;' . __( 'For more information:' ) . '&lt;/strong&gt;&lt;/p&gt;' .
			'&lt;p&gt;' . __( '&lt;a href=&quot;https://codex.wordpress.org/Appearance_Header_Screen&quot;&gt;Documentation on Custom Header&lt;/a&gt;' ) . '&lt;/p&gt;' .
			'&lt;p&gt;' . __( '&lt;a href=&quot;https://wordpress.org/support/&quot;&gt;Support&lt;/a&gt;' ) . '&lt;/p&gt;'
		);
	}

	/**
	 * Get the current step.
	 *
	 * @since 2.6.0
	 *
	 * @return int Current step.
	 */
	public function step() {
		if ( ! isset( $_GET['step'] ) ) {
			return 1;
		}

		$step = (int) $_GET['step'];
		if ( $step &lt; 1 || 3 &lt; $step ||
			( 2 === $step &amp;&amp; ! wp_verify_nonce( $_REQUEST['_wpnonce-custom-header-upload'], 'custom-header-upload' ) ) ||
			( 3 === $step &amp;&amp; ! wp_verify_nonce( $_REQUEST['_wpnonce'], 'custom-header-crop-image' ) )
		) {
			return 1;
		}

		return $step;
	}

	/**
	 * Set up the enqueue for the JavaScript files.
	 *
	 * @since 2.1.0
	 */
	public function js_includes() {
		$step = $this-&gt;step();

		if ( ( 1 === $step || 3 === $step ) ) {
			wp_enqueue_media();
			wp_enqueue_script( 'custom-header' );
			if ( current_theme_supports( 'custom-header', 'header-text' ) ) {
				wp_enqueue_script( 'wp-color-picker' );
			}
		} elseif ( 2 === $step ) {
			wp_enqueue_script( 'imgareaselect' );
		}
	}

	/**
	 * Set up the enqueue for the CSS files
	 *
	 * @since 2.7.0
	 */
	public function css_includes() {
		$step = $this-&gt;step();

		if ( ( 1 === $step || 3 === $step ) &amp;&amp; current_theme_supports( 'custom-header', 'header-text' ) ) {
			wp_enqueue_style( 'wp-color-picker' );
		} elseif ( 2 === $step ) {
			wp_enqueue_style( 'imgareaselect' );
		}
	}

	/**
	 * Execute custom header modification.
	 *
	 * @since 2.6.0
	 */
	public function take_action() {
		if ( ! current_user_can( 'edit_theme_options' ) ) {
			return;
		}

		if ( empty( $_POST ) ) {
			return;
		}

		$this-&gt;updated = true;

		if ( isset( $_POST['resetheader'] ) ) {
			check_admin_referer( 'custom-header-options', '_wpnonce-custom-header-options' );

			$this-&gt;reset_header_image();

			return;
		}

		if ( isset( $_POST['removeheader'] ) ) {
			check_admin_referer( 'custom-header-options', '_wpnonce-custom-header-options' );

			$this-&gt;remove_header_image();

			return;
		}

		if ( isset( $_POST['text-color'] ) &amp;&amp; ! isset( $_POST['display-header-text'] ) ) {
			check_admin_referer( 'custom-header-options', '_wpnonce-custom-header-options' );

			set_theme_mod( 'header_textcolor', 'blank' );
		} elseif ( isset( $_POST['text-color'] ) ) {
			check_admin_referer( 'custom-header-options', '_wpnonce-custom-header-options' );

			$_POST['text-color'] = str_replace( '#', '', $_POST['text-color'] );

			$color = preg_replace( '/[^0-9a-fA-F]/', '', $_POST['text-color'] );

			if ( strlen( $color ) === 6 || strlen( $color ) === 3 ) {
				set_theme_mod( 'header_textcolor', $color );
			} elseif ( ! $color ) {
				set_theme_mod( 'header_textcolor', 'blank' );
			}
		}

		if ( isset( $_POST['default-header'] ) ) {
			check_admin_referer( 'custom-header-options', '_wpnonce-custom-header-options' );

			$this-&gt;set_header_image( $_POST['default-header'] );

			return;
		}
	}

	/**
	 * Process the default headers
	 *
	 * @since 3.0.0
	 *
	 * @global array $_wp_default_headers
	 */
	public function process_default_headers() {
		global $_wp_default_headers;

		if ( ! isset( $_wp_default_headers ) ) {
			return;
		}

		if ( ! empty( $this-&gt;default_headers ) ) {
			return;
		}

		$this-&gt;default_headers    = $_wp_default_headers;
		$template_directory_uri   = get_template_directory_uri();
		$stylesheet_directory_uri = get_stylesheet_directory_uri();

		foreach ( array_keys( $this-&gt;default_headers ) as $header ) {
			$this-&gt;default_headers[ $header ]['url'] = sprintf(
				$this-&gt;default_headers[ $header ]['url'],
				$template_directory_uri,
				$stylesheet_directory_uri
			);

			$this-&gt;default_headers[ $header ]['thumbnail_url'] = sprintf(
				$this-&gt;default_headers[ $header ]['thumbnail_url'],
				$template_directory_uri,
				$stylesheet_directory_uri
			);
		}
	}

	/**
	 * Display UI for selecting one of several default headers.
	 *
	 * Show the random image option if this theme has multiple header images.
	 * Random image option is on by default if no header has been set.
	 *
	 * @since 3.0.0
	 *
	 * @param string $type The header type. One of 'default' (for the Uploaded Images control)
	 *                     or 'uploaded' (for the Uploaded Images control).
	 */
	public function show_header_selector( $type = 'default' ) {
		if ( 'default' === $type ) {
			$headers = $this-&gt;default_headers;
		} else {
			$headers = get_uploaded_header_images();
			$type    = 'uploaded';
		}

		if ( 1 &lt; count( $headers ) ) {
			echo '&lt;div class=&quot;random-header&quot;&gt;';
			echo '&lt;label&gt;&lt;input name=&quot;default-header&quot; type=&quot;radio&quot; value=&quot;random-' . $type . '-image&quot;' . checked( is_random_header_image( $type ), true, false ) . ' /&gt;';
			_e( '&lt;strong&gt;Random:&lt;/strong&gt; Show a different image on each page.' );
			echo '&lt;/label&gt;';
			echo '&lt;/div&gt;';
		}

		echo '&lt;div class=&quot;available-headers&quot;&gt;';

		foreach ( $headers as $header_key =&gt; $header ) {
			$header_thumbnail = $header['thumbnail_url'];
			$header_url       = $header['url'];
			$header_alt_text  = empty( $header['alt_text'] ) ? '' : $header['alt_text'];

			echo '&lt;div class=&quot;default-header&quot;&gt;';
			echo '&lt;label&gt;&lt;input name=&quot;default-header&quot; type=&quot;radio&quot; value=&quot;' . esc_attr( $header_key ) . '&quot; ' . checked( $header_url, get_theme_mod( 'header_image' ), false ) . ' /&gt;';
			$width = '';
			if ( ! empty( $header['attachment_id'] ) ) {
				$width = ' width=&quot;230&quot;';
			}
			echo '&lt;img src=&quot;' . set_url_scheme( $header_thumbnail ) . '&quot; alt=&quot;' . esc_attr( $header_alt_text ) . '&quot;' . $width . ' /&gt;&lt;/label&gt;';
			echo '&lt;/div&gt;';
		}

		echo '&lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;&lt;/div&gt;';
	}

	/**
	 * Execute JavaScript depending on step.
	 *
	 * @since 2.1.0
	 */
	public function js() {
		$step = $this-&gt;step();

		if ( ( 1 === $step || 3 === $step ) &amp;&amp; current_theme_supports( 'custom-header', 'header-text' ) ) {
			$this-&gt;js_1();
		} elseif ( 2 === $step ) {
			$this-&gt;js_2();
		}
	}

	/**
	 * Display JavaScript based on Step 1 and 3.
	 *
	 * @since 2.6.0
	 */
	public function js_1() {
		$default_color = '';
		if ( current_theme_supports( 'custom-header', 'default-text-color' ) ) {
			$default_color = get_theme_support( 'custom-header', 'default-text-color' );
			if ( $default_color &amp;&amp; false === strpos( $default_color, '#' ) ) {
				$default_color = '#' . $default_color;
			}
		}
		?&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
(function($){
	var default_color = '&lt;?php echo esc_js( $default_color ); ?&gt;',
		header_text_fields;

	function pickColor(color) {
		$('#name').css('color', color);
		$('#desc').css('color', color);
		$('#text-color').val(color);
	}

	function toggle_text() {
		var checked = $('#display-header-text').prop('checked'),
			text_color;
		header_text_fields.toggle( checked );
		if ( ! checked )
			return;
		text_color = $('#text-color');
		if ( '' === text_color.val().replace('#', '') ) {
			text_color.val( default_color );
			pickColor( default_color );
		} else {
			pickColor( text_color.val() );
		}
	}

	$(document).ready(function() {
		var text_color = $('#text-color');
		header_text_fields = $('.displaying-header-text');
		text_color.wpColorPicker({
			change: function( event, ui ) {
				pickColor( text_color.wpColorPicker('color') );
			},
			clear: function() {
				pickColor( '' );
			}
		});
		$('#display-header-text').click( toggle_text );
		&lt;?php if ( ! display_header_text() ) : ?&gt;
		toggle_text();
		&lt;?php endif; ?&gt;
	});
})(jQuery);
&lt;/script&gt;
		&lt;?php
	}

	/**
	 * Display JavaScript based on Step 2.
	 *
	 * @since 2.6.0
	 */
	public function js_2() {

		?&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
	function onEndCrop( coords ) {
		jQuery( '#x1' ).val(coords.x);
		jQuery( '#y1' ).val(coords.y);
		jQuery( '#width' ).val(coords.w);
		jQuery( '#height' ).val(coords.h);
	}

	jQuery(document).ready(function() {
		var xinit = &lt;?php echo absint( get_theme_support( 'custom-header', 'width' ) ); ?&gt;;
		var yinit = &lt;?php echo absint( get_theme_support( 'custom-header', 'height' ) ); ?&gt;;
		var ratio = xinit / yinit;
		var ximg = jQuery('img#upload').width();
		var yimg = jQuery('img#upload').height();

		if ( yimg &lt; yinit || ximg &lt; xinit ) {
			if ( ximg / yimg &gt; ratio ) {
				yinit = yimg;
				xinit = yinit * ratio;
			} else {
				xinit = ximg;
				yinit = xinit / ratio;
			}
		}

		jQuery('img#upload').imgAreaSelect({
			handles: true,
			keys: true,
			show: true,
			x1: 0,
			y1: 0,
			x2: xinit,
			y2: yinit,
			&lt;?php
			if ( ! current_theme_supports( 'custom-header', 'flex-height' )
				&amp;&amp; ! current_theme_supports( 'custom-header', 'flex-width' )
			) {
				?&gt;
			aspectRatio: xinit + ':' + yinit,
				&lt;?php
			}
			if ( ! current_theme_supports( 'custom-header', 'flex-height' ) ) {
				?&gt;
			maxHeight: &lt;?php echo get_theme_support( 'custom-header', 'height' ); ?&gt;,
				&lt;?php
			}
			if ( ! current_theme_supports( 'custom-header', 'flex-width' ) ) {
				?&gt;
			maxWidth: &lt;?php echo get_theme_support( 'custom-header', 'width' ); ?&gt;,
				&lt;?php
			}
			?&gt;
			onInit: function () {
				jQuery('#width').val(xinit);
				jQuery('#height').val(yinit);
			},
			onSelectChange: function(img, c) {
				jQuery('#x1').val(c.x1);
				jQuery('#y1').val(c.y1);
				jQuery('#width').val(c.width);
				jQuery('#height').val(c.height);
			}
		});
	});
&lt;/script&gt;
		&lt;?php
	}

	/**
	 * Display first step of custom header image page.
	 *
	 * @since 2.1.0
	 */
	public function step_1() {
		$this-&gt;process_default_headers();
		?&gt;

&lt;div class=&quot;wrap&quot;&gt;
&lt;h1&gt;&lt;?php _e( 'Custom Header' ); ?&gt;&lt;/h1&gt;

		&lt;?php if ( current_user_can( 'customize' ) ) { ?&gt;
&lt;div class=&quot;notice notice-info hide-if-no-customize&quot;&gt;
	&lt;p&gt;
			&lt;?php
			printf(
				/* translators: %s: URL to header image configuration in Customizer. */
				__( 'You can now manage and live-preview Custom Header in the &lt;a href=&quot;%s&quot;&gt;Customizer&lt;/a&gt;.' ),
				admin_url( 'customize.php?autofocus[control]=header_image' )
			);
			?&gt;
	&lt;/p&gt;
&lt;/div&gt;
		&lt;?php } ?&gt;

		&lt;?php if ( ! empty( $this-&gt;updated ) ) { ?&gt;
&lt;div id=&quot;message&quot; class=&quot;updated&quot;&gt;
	&lt;p&gt;
			&lt;?php
			/* translators: %s: Home URL. */
			printf( __( 'Header updated. &lt;a href=&quot;%s&quot;&gt;Visit your site&lt;/a&gt; to see how it looks.' ), home_url( '/' ) );
			?&gt;
	&lt;/p&gt;
&lt;/div&gt;
		&lt;?php } ?&gt;

&lt;h2&gt;&lt;?php _e( 'Header Image' ); ?&gt;&lt;/h2&gt;

&lt;table class=&quot;form-table&quot; role=&quot;presentation&quot;&gt;
&lt;tbody&gt;

		&lt;?php if ( get_custom_header() || display_header_text() ) : ?&gt;
&lt;tr&gt;
&lt;th scope=&quot;row&quot;&gt;&lt;?php _e( 'Preview' ); ?&gt;&lt;/th&gt;
&lt;td&gt;
			&lt;?php
			if ( $this-&gt;admin_image_div_callback ) {
				call_user_func( $this-&gt;admin_image_div_callback );
			} else {
				$custom_header = get_custom_header();
				$header_image  = get_header_image();

				if ( $header_image ) {
					$header_image_style = 'background-image:url(' . esc_url( $header_image ) . ');';
				} else {
					$header_image_style = '';
				}

				if ( $custom_header-&gt;width ) {
					$header_image_style .= 'max-width:' . $custom_header-&gt;width . 'px;';
				}
				if ( $custom_header-&gt;height ) {
					$header_image_style .= 'height:' . $custom_header-&gt;height . 'px;';
				}
				?&gt;
	&lt;div id=&quot;headimg&quot; style=&quot;&lt;?php echo $header_image_style; ?&gt;&quot;&gt;
				&lt;?php
				if ( display_header_text() ) {
					$style = ' style=&quot;color:#' . get_header_textcolor() . ';&quot;';
				} else {
					$style = ' style=&quot;display:none;&quot;';
				}
				?&gt;
		&lt;h1&gt;&lt;a id=&quot;name&quot; class=&quot;displaying-header-text&quot; &lt;?php echo $style; ?&gt; onclick=&quot;return false;&quot; href=&quot;&lt;?php bloginfo( 'url' ); ?&gt;&quot; tabindex=&quot;-1&quot;&gt;&lt;?php bloginfo( 'name' ); ?&gt;&lt;/a&gt;&lt;/h1&gt;
		&lt;div id=&quot;desc&quot; class=&quot;displaying-header-text&quot; &lt;?php echo $style; ?&gt;&gt;&lt;?php bloginfo( 'description' ); ?&gt;&lt;/div&gt;
	&lt;/div&gt;
			&lt;?php } ?&gt;
&lt;/td&gt;
&lt;/tr&gt;
		&lt;?php endif; ?&gt;

		&lt;?php if ( current_user_can( 'upload_files' ) &amp;&amp; current_theme_supports( 'custom-header', 'uploads' ) ) : ?&gt;
&lt;tr&gt;
&lt;th scope=&quot;row&quot;&gt;&lt;?php _e( 'Select Image' ); ?&gt;&lt;/th&gt;
&lt;td&gt;
	&lt;p&gt;&lt;?php _e( 'You can select an image to be shown at the top of your site by uploading from your computer or choosing from your media library. After selecting an image you will be able to crop it.' ); ?&gt;&lt;br /&gt;
			&lt;?php
			if ( ! current_theme_supports( 'custom-header', 'flex-height' )
				&amp;&amp; ! current_theme_supports( 'custom-header', 'flex-width' )
			) {
				printf(
					/* translators: 1: Image width in pixels, 2: Image height in pixels. */
					__( 'Images of exactly &lt;strong&gt;%1$d &amp;times; %2$d pixels&lt;/strong&gt; will be used as-is.' ) . '&lt;br /&gt;',
					get_theme_support( 'custom-header', 'width' ),
					get_theme_support( 'custom-header', 'height' )
				);
			} elseif ( current_theme_supports( 'custom-header', 'flex-height' ) ) {
				if ( ! current_theme_supports( 'custom-header', 'flex-width' ) ) {
					printf(
						/* translators: %s: Size in pixels. */
						__( 'Images should be at least %s wide.' ) . ' ',
						sprintf(
							/* translators: %d: Custom header width. */
							'&lt;strong&gt;' . __( '%d pixels' ) . '&lt;/strong&gt;',
							get_theme_support( 'custom-header', 'width' )
						)
					);
				}
			} elseif ( current_theme_supports( 'custom-header', 'flex-width' ) ) {
				if ( ! current_theme_supports( 'custom-header', 'flex-height' ) ) {
					printf(
						/* translators: %s: Size in pixels. */
						__( 'Images should be at least %s tall.' ) . ' ',
						sprintf(
							/* translators: %d: Custom header height. */
							'&lt;strong&gt;' . __( '%d pixels' ) . '&lt;/strong&gt;',
							get_theme_support( 'custom-header', 'height' )
						)
					);
				}
			}

			if ( current_theme_supports( 'custom-header', 'flex-height' )
				|| current_theme_supports( 'custom-header', 'flex-width' )
			) {
				if ( current_theme_supports( 'custom-header', 'width' ) ) {
					printf(
						/* translators: %s: Size in pixels. */
						__( 'Suggested width is %s.' ) . ' ',
						sprintf(
							/* translators: %d: Custom header width. */
							'&lt;strong&gt;' . __( '%d pixels' ) . '&lt;/strong&gt;',
							get_theme_support( 'custom-header', 'width' )
						)
					);
				}

				if ( current_theme_supports( 'custom-header', 'height' ) ) {
					printf(
						/* translators: %s: Size in pixels. */
						__( 'Suggested height is %s.' ) . ' ',
						sprintf(
							/* translators: %d: Custom header height. */
							'&lt;strong&gt;' . __( '%d pixels' ) . '&lt;/strong&gt;',
							get_theme_support( 'custom-header', 'height' )
						)
					);
				}
			}
			?&gt;
	&lt;/p&gt;
	&lt;form enctype=&quot;multipart/form-data&quot; id=&quot;upload-form&quot; class=&quot;wp-upload-form&quot; method=&quot;post&quot; action=&quot;&lt;?php echo esc_url( add_query_arg( 'step', 2 ) ); ?&gt;&quot;&gt;
	&lt;p&gt;
		&lt;label for=&quot;upload&quot;&gt;&lt;?php _e( 'Choose an image from your computer:' ); ?&gt;&lt;/label&gt;&lt;br /&gt;
		&lt;input type=&quot;file&quot; id=&quot;upload&quot; name=&quot;import&quot; /&gt;
		&lt;input type=&quot;hidden&quot; name=&quot;action&quot; value=&quot;save&quot; /&gt;
			&lt;?php wp_nonce_field( 'custom-header-upload', '_wpnonce-custom-header-upload' ); ?&gt;
			&lt;?php submit_button( __( 'Upload' ), '', 'submit', false ); ?&gt;
	&lt;/p&gt;
			&lt;?php
				$modal_update_href = esc_url(
					add_query_arg(
						array(
							'page' =&gt; 'custom-header',
							'step' =&gt; 2,
							'_wpnonce-custom-header-upload' =&gt; wp_create_nonce( 'custom-header-upload' ),
						),
						admin_url( 'themes.php' )
					)
				);
			?&gt;
	&lt;p&gt;
		&lt;label for=&quot;choose-from-library-link&quot;&gt;&lt;?php _e( 'Or choose an image from your media library:' ); ?&gt;&lt;/label&gt;&lt;br /&gt;
		&lt;button id=&quot;choose-from-library-link&quot; class=&quot;button&quot;
			data-update-link=&quot;&lt;?php echo esc_attr( $modal_update_href ); ?&gt;&quot;
			data-choose=&quot;&lt;?php esc_attr_e( 'Choose a Custom Header' ); ?&gt;&quot;
			data-update=&quot;&lt;?php esc_attr_e( 'Set as header' ); ?&gt;&quot;&gt;&lt;?php _e( 'Choose Image' ); ?&gt;&lt;/button&gt;
	&lt;/p&gt;
	&lt;/form&gt;
&lt;/td&gt;
&lt;/tr&gt;
		&lt;?php endif; ?&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;form method=&quot;post&quot; action=&quot;&lt;?php echo esc_url( add_query_arg( 'step', 1 ) ); ?&gt;&quot;&gt;
		&lt;?php submit_button( null, 'screen-reader-text', 'save-header-options', false ); ?&gt;
&lt;table class=&quot;form-table&quot; role=&quot;presentation&quot;&gt;
&lt;tbody&gt;
		&lt;?php if ( get_uploaded_header_images() ) : ?&gt;
&lt;tr&gt;
&lt;th scope=&quot;row&quot;&gt;&lt;?php _e( 'Uploaded Images' ); ?&gt;&lt;/th&gt;
&lt;td&gt;
	&lt;p&gt;&lt;?php _e( 'You can choose one of your previously uploaded headers, or show a random one.' ); ?&gt;&lt;/p&gt;
			&lt;?php
			$this-&gt;show_header_selector( 'uploaded' );
			?&gt;
&lt;/td&gt;
&lt;/tr&gt;
			&lt;?php
	endif;
		if ( ! empty( $this-&gt;default_headers ) ) :
			?&gt;
&lt;tr&gt;
&lt;th scope=&quot;row&quot;&gt;&lt;?php _e( 'Default Images' ); ?&gt;&lt;/th&gt;
&lt;td&gt;
			&lt;?php if ( current_theme_supports( 'custom-header', 'uploads' ) ) : ?&gt;
	&lt;p&gt;&lt;?php _e( 'If you don&amp;lsquo;t want to upload your own image, you can use one of these cool headers, or show a random one.' ); ?&gt;&lt;/p&gt;
	&lt;?php else : ?&gt;
	&lt;p&gt;&lt;?php _e( 'You can use one of these cool headers or show a random one on each page.' ); ?&gt;&lt;/p&gt;
	&lt;?php endif; ?&gt;
			&lt;?php
			$this-&gt;show_header_selector( 'default' );
			?&gt;
&lt;/td&gt;
&lt;/tr&gt;
			&lt;?php
	endif;
		if ( get_header_image() ) :
			?&gt;
&lt;tr&gt;
&lt;th scope=&quot;row&quot;&gt;&lt;?php _e( 'Remove Image' ); ?&gt;&lt;/th&gt;
&lt;td&gt;
	&lt;p&gt;&lt;?php _e( 'This will remove the header image. You will not be able to restore any customizations.' ); ?&gt;&lt;/p&gt;
			&lt;?php submit_button( __( 'Remove Header Image' ), '', 'removeheader', false ); ?&gt;
&lt;/td&gt;
&lt;/tr&gt;
			&lt;?php
	endif;

		$default_image = sprintf(
			get_theme_support( 'custom-header', 'default-image' ),
			get_template_directory_uri(),
			get_stylesheet_directory_uri()
		);

		if ( $default_image &amp;&amp; get_header_image() !== $default_image ) :
			?&gt;
&lt;tr&gt;
&lt;th scope=&quot;row&quot;&gt;&lt;?php _e( 'Reset Image' ); ?&gt;&lt;/th&gt;
&lt;td&gt;
	&lt;p&gt;&lt;?php _e( 'This will restore the original header image. You will not be able to restore any customizations.' ); ?&gt;&lt;/p&gt;
			&lt;?php submit_button( __( 'Restore Original Header Image' ), '', 'resetheader', false ); ?&gt;
&lt;/td&gt;
&lt;/tr&gt;
	&lt;?php endif; ?&gt;
&lt;/tbody&gt;
&lt;/table&gt;

		&lt;?php if ( current_theme_supports( 'custom-header', 'header-text' ) ) : ?&gt;

&lt;h2&gt;&lt;?php _e( 'Header Text' ); ?&gt;&lt;/h2&gt;

&lt;table class=&quot;form-table&quot; role=&quot;presentation&quot;&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;th scope=&quot;row&quot;&gt;&lt;?php _e( 'Header Text' ); ?&gt;&lt;/th&gt;
&lt;td&gt;
	&lt;p&gt;
	&lt;label&gt;&lt;input type=&quot;checkbox&quot; name=&quot;display-header-text&quot; id=&quot;display-header-text&quot;&lt;?php checked( display_header_text() ); ?&gt; /&gt; &lt;?php _e( 'Show header text with your image.' ); ?&gt;&lt;/label&gt;
	&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;

&lt;tr class=&quot;displaying-header-text&quot;&gt;
&lt;th scope=&quot;row&quot;&gt;&lt;?php _e( 'Text Color' ); ?&gt;&lt;/th&gt;
&lt;td&gt;
	&lt;p&gt;
			&lt;?php
			$default_color = '';
			if ( current_theme_supports( 'custom-header', 'default-text-color' ) ) {
				$default_color = get_theme_support( 'custom-header', 'default-text-color' );
				if ( $default_color &amp;&amp; false === strpos( $default_color, '#' ) ) {
					$default_color = '#' . $default_color;
				}
			}

			$default_color_attr = $default_color ? ' data-default-color=&quot;' . esc_attr( $default_color ) . '&quot;' : '';

			$header_textcolor = display_header_text() ? get_header_textcolor() : get_theme_support( 'custom-header', 'default-text-color' );
			if ( $header_textcolor &amp;&amp; false === strpos( $header_textcolor, '#' ) ) {
				$header_textcolor = '#' . $header_textcolor;
			}

			echo '&lt;input type=&quot;text&quot; name=&quot;text-color&quot; id=&quot;text-color&quot; value=&quot;' . esc_attr( $header_textcolor ) . '&quot;' . $default_color_attr . ' /&gt;';
			if ( $default_color ) {
				/* translators: %s: Default text color. */
				echo ' &lt;span class=&quot;description hide-if-js&quot;&gt;' . sprintf( _x( 'Default: %s', 'color' ), esc_html( $default_color ) ) . '&lt;/span&gt;';
			}
			?&gt;
	&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
			&lt;?php
endif;

		/**
		 * Fires just before the submit button in the custom header options form.
		 *
		 * @since 3.1.0
		 */
		do_action( 'custom_header_options' );

		wp_nonce_field( 'custom-header-options', '_wpnonce-custom-header-options' );
		?&gt;

		&lt;?php submit_button( null, 'primary', 'save-header-options' ); ?&gt;
&lt;/form&gt;
&lt;/div&gt;

		&lt;?php
	}

	/**
	 * Display second step of custom header image page.
	 *
	 * @since 2.1.0
	 */
	public function step_2() {
		check_admin_referer( 'custom-header-upload', '_wpnonce-custom-header-upload' );

		if ( ! current_theme_supports( 'custom-header', 'uploads' ) ) {
			wp_die(
				'&lt;h1&gt;' . __( 'Something went wrong.' ) . '&lt;/h1&gt;' .
				'&lt;p&gt;' . __( 'The current theme does not support uploading a custom header image.' ) . '&lt;/p&gt;',
				403
			);
		}

		if ( empty( $_POST ) &amp;&amp; isset( $_GET['file'] ) ) {
			$attachment_id = absint( $_GET['file'] );
			$file          = get_attached_file( $attachment_id, true );
			$url           = wp_get_attachment_image_src( $attachment_id, 'full' );
			$url           = $url[0];
		} elseif ( isset( $_POST ) ) {
			$data          = $this-&gt;step_2_manage_upload();
			$attachment_id = $data['attachment_id'];
			$file          = $data['file'];
			$url           = $data['url'];
		}

		if ( file_exists( $file ) ) {
			list( $width, $height, $type, $attr ) = wp_getimagesize( $file );
		} else {
			$data   = wp_get_attachment_metadata( $attachment_id );
			$height = isset( $data['height'] ) ? (int) $data['height'] : 0;
			$width  = isset( $data['width'] ) ? (int) $data['width'] : 0;
			unset( $data );
		}

		$max_width = 0;

		// For flex, limit size of image displayed to 1500px unless theme says otherwise.
		if ( current_theme_supports( 'custom-header', 'flex-width' ) ) {
			$max_width = 1500;
		}

		if ( current_theme_supports( 'custom-header', 'max-width' ) ) {
			$max_width = max( $max_width, get_theme_support( 'custom-header', 'max-width' ) );
		}

		$max_width = max( $max_width, get_theme_support( 'custom-header', 'width' ) );

		// If flexible height isn't supported and the image is the exact right size.
		if ( ! current_theme_supports( 'custom-header', 'flex-height' )
			&amp;&amp; ! current_theme_supports( 'custom-header', 'flex-width' )
			&amp;&amp; (int) get_theme_support( 'custom-header', 'width' ) === $width
			&amp;&amp; (int) get_theme_support( 'custom-header', 'height' ) === $height
		) {
			// Add the metadata.
			if ( file_exists( $file ) ) {
				wp_update_attachment_metadata( $attachment_id, wp_generate_attachment_metadata( $attachment_id, $file ) );
			}

			$this-&gt;set_header_image( compact( 'url', 'attachment_id', 'width', 'height' ) );

			/**
			 * Fires after the header image is set or an error is returned.
			 *
			 * @since 2.1.0
			 *
			 * @param string $file          Path to the file.
			 * @param int    $attachment_id Attachment ID.
			 */
			do_action( 'wp_create_file_in_uploads', $file, $attachment_id ); // For replication.

			return $this-&gt;finished();
		} elseif ( $width &gt; $max_width ) {
			$oitar = $width / $max_width;

			$image = wp_crop_image(
				$attachment_id,
				0,
				0,
				$width,
				$height,
				$max_width,
				$height / $oitar,
				false,
				str_replace( wp_basename( $file ), 'midsize-' . wp_basename( $file ), $file )
			);

			if ( ! $image || is_wp_error( $image ) ) {
				wp_die( __( 'Image could not be processed. Please go back and try again.' ), __( 'Image Processing Error' ) );
			}

			/** This filter is documented in wp-admin/includes/class-custom-image-header.php */
			$image = apply_filters( 'wp_create_file_in_uploads', $image, $attachment_id ); // For replication.

			$url    = str_replace( wp_basename( $url ), wp_basename( $image ), $url );
			$width  = $width / $oitar;
			$height = $height / $oitar;
		} else {
			$oitar = 1;
		}
		?&gt;

&lt;div class=&quot;wrap&quot;&gt;
&lt;h1&gt;&lt;?php _e( 'Crop Header Image' ); ?&gt;&lt;/h1&gt;

&lt;form method=&quot;post&quot; action=&quot;&lt;?php echo esc_url( add_query_arg( 'step', 3 ) ); ?&gt;&quot;&gt;
	&lt;p class=&quot;hide-if-no-js&quot;&gt;&lt;?php _e( 'Choose the part of the image you want to use as your header.' ); ?&gt;&lt;/p&gt;
	&lt;p class=&quot;hide-if-js&quot;&gt;&lt;strong&gt;&lt;?php _e( 'You need JavaScript to choose a part of the image.' ); ?&gt;&lt;/strong&gt;&lt;/p&gt;

	&lt;div id=&quot;crop_image&quot; style=&quot;position: relative&quot;&gt;
		&lt;img src=&quot;&lt;?php echo esc_url( $url ); ?&gt;&quot; id=&quot;upload&quot; width=&quot;&lt;?php echo $width; ?&gt;&quot; height=&quot;&lt;?php echo $height; ?&gt;&quot; alt=&quot;&quot; /&gt;
	&lt;/div&gt;

	&lt;input type=&quot;hidden&quot; name=&quot;x1&quot; id=&quot;x1&quot; value=&quot;0&quot; /&gt;
	&lt;input type=&quot;hidden&quot; name=&quot;y1&quot; id=&quot;y1&quot; value=&quot;0&quot; /&gt;
	&lt;input type=&quot;hidden&quot; name=&quot;width&quot; id=&quot;width&quot; value=&quot;&lt;?php echo esc_attr( $width ); ?&gt;&quot; /&gt;
	&lt;input type=&quot;hidden&quot; name=&quot;height&quot; id=&quot;height&quot; value=&quot;&lt;?php echo esc_attr( $height ); ?&gt;&quot; /&gt;
	&lt;input type=&quot;hidden&quot; name=&quot;attachment_id&quot; id=&quot;attachment_id&quot; value=&quot;&lt;?php echo esc_attr( $attachment_id ); ?&gt;&quot; /&gt;
	&lt;input type=&quot;hidden&quot; name=&quot;oitar&quot; id=&quot;oitar&quot; value=&quot;&lt;?php echo esc_attr( $oitar ); ?&gt;&quot; /&gt;
		&lt;?php if ( empty( $_POST ) &amp;&amp; isset( $_GET['file'] ) ) { ?&gt;
	&lt;input type=&quot;hidden&quot; name=&quot;create-new-attachment&quot; value=&quot;true&quot; /&gt;
	&lt;?php } ?&gt;
		&lt;?php wp_nonce_field( 'custom-header-crop-image' ); ?&gt;

	&lt;p class=&quot;submit&quot;&gt;
		&lt;?php submit_button( __( 'Crop and Publish' ), 'primary', 'submit', false ); ?&gt;
		&lt;?php
		if ( isset( $oitar ) &amp;&amp; 1 === $oitar
			&amp;&amp; ( current_theme_supports( 'custom-header', 'flex-height' )
				|| current_theme_supports( 'custom-header', 'flex-width' ) )
		) {
			submit_button( __( 'Skip Cropping, Publish Image as Is' ), '', 'skip-cropping', false );
		}
		?&gt;
	&lt;/p&gt;
&lt;/form&gt;
&lt;/div&gt;
		&lt;?php
	}


	/**
	 * Upload the file to be cropped in the second step.
	 *
	 * @since 3.4.0
	 */
	public function step_2_manage_upload() {
		$overrides = array( 'test_form' =&gt; false );

		$uploaded_file = $_FILES['import'];
		$wp_filetype   = wp_check_filetype_and_ext( $uploaded_file['tmp_name'], $uploaded_file['name'] );

		if ( ! wp_match_mime_types( 'image', $wp_filetype['type'] ) ) {
			wp_die( __( 'The uploaded file is not a valid image. Please try again.' ) );
		}

		$file = wp_handle_upload( $uploaded_file, $overrides );

		if ( isset( $file['error'] ) ) {
			wp_die( $file['error'], __( 'Image Upload Error' ) );
		}

		$url      = $file['url'];
		$type     = $file['type'];
		$file     = $file['file'];
		$filename = wp_basename( $file );

		// Construct the object array.
		$object = array(
			'post_title'     =&gt; $filename,
			'post_content'   =&gt; $url,
			'post_mime_type' =&gt; $type,
			'guid'           =&gt; $url,
			'context'        =&gt; 'custom-header',
		);

		// Save the data.
		$attachment_id = wp_insert_attachment( $object, $file );

		return compact( 'attachment_id', 'file', 'filename', 'url', 'type' );
	}

	/**
	 * Display third step of custom header image page.
	 *
	 * @since 2.1.0
	 * @since 4.4.0 Switched to using wp_get_attachment_url() instead of the guid
	 *              for retrieving the header image URL.
	 */
	public function step_3() {
		check_admin_referer( 'custom-header-crop-image' );

		if ( ! current_theme_supports( 'custom-header', 'uploads' ) ) {
			wp_die(
				'&lt;h1&gt;' . __( 'Something went wrong.' ) . '&lt;/h1&gt;' .
				'&lt;p&gt;' . __( 'The current theme does not support uploading a custom header image.' ) . '&lt;/p&gt;',
				403
			);
		}

		if ( ! empty( $_POST['skip-cropping'] )
			&amp;&amp; ! current_theme_supports( 'custom-header', 'flex-height' )
			&amp;&amp; ! current_theme_supports( 'custom-header', 'flex-width' )
		) {
			wp_die(
				'&lt;h1&gt;' . __( 'Something went wrong.' ) . '&lt;/h1&gt;' .
				'&lt;p&gt;' . __( 'The current theme does not support a flexible sized header image.' ) . '&lt;/p&gt;',
				403
			);
		}

		if ( $_POST['oitar'] &gt; 1 ) {
			$_POST['x1']     = $_POST['x1'] * $_POST['oitar'];
			$_POST['y1']     = $_POST['y1'] * $_POST['oitar'];
			$_POST['width']  = $_POST['width'] * $_POST['oitar'];
			$_POST['height'] = $_POST['height'] * $_POST['oitar'];
		}

		$attachment_id = absint( $_POST['attachment_id'] );
		$original      = get_attached_file( $attachment_id );

		$dimensions = $this-&gt;get_header_dimensions(
			array(
				'height' =&gt; $_POST['height'],
				'width'  =&gt; $_POST['width'],
			)
		);
		$height     = $dimensions['dst_height'];
		$width      = $dimensions['dst_width'];

		if ( empty( $_POST['skip-cropping'] ) ) {
			$cropped = wp_crop_image(
				$attachment_id,
				(int) $_POST['x1'],
				(int) $_POST['y1'],
				(int) $_POST['width'],
				(int) $_POST['height'],
				$width,
				$height
			);
		} elseif ( ! empty( $_POST['create-new-attachment'] ) ) {
			$cropped = _copy_image_file( $attachment_id );
		} else {
			$cropped = get_attached_file( $attachment_id );
		}

		if ( ! $cropped || is_wp_error( $cropped ) ) {
			wp_die( __( 'Image could not be processed. Please go back and try again.' ), __( 'Image Processing Error' ) );
		}

		/** This filter is documented in wp-admin/includes/class-custom-image-header.php */
		$cropped = apply_filters( 'wp_create_file_in_uploads', $cropped, $attachment_id ); // For replication.

		$object = $this-&gt;create_attachment_object( $cropped, $attachment_id );

		if ( ! empty( $_POST['create-new-attachment'] ) ) {
			unset( $object['ID'] );
		}

		// Update the attachment.
		$attachment_id = $this-&gt;insert_attachment( $object, $cropped );

		$url = wp_get_attachment_url( $attachment_id );
		$this-&gt;set_header_image( compact( 'url', 'attachment_id', 'width', 'height' ) );

		// Cleanup.
		$medium = str_replace( wp_basename( $original ), 'midsize-' . wp_basename( $original ), $original );
		if ( file_exists( $medium ) ) {
			wp_delete_file( $medium );
		}

		if ( empty( $_POST['create-new-attachment'] ) &amp;&amp; empty( $_POST['skip-cropping'] ) ) {
			wp_delete_file( $original );
		}

		return $this-&gt;finished();
	}

	/**
	 * Display last step of custom header image page.
	 *
	 * @since 2.1.0
	 */
	public function finished() {
		$this-&gt;updated = true;
		$this-&gt;step_1();
	}

	/**
	 * Display the page based on the current step.
	 *
	 * @since 2.1.0
	 */
	public function admin_page() {
		if ( ! current_user_can( 'edit_theme_options' ) ) {
			wp_die( __( 'Sorry, you are not allowed to customize headers.' ) );
		}

		$step = $this-&gt;step();

		if ( 2 === $step ) {
			$this-&gt;step_2();
		} elseif ( 3 === $step ) {
			$this-&gt;step_3();
		} else {
			$this-&gt;step_1();
		}
	}

	/**
	 * Unused since 3.5.0.
	 *
	 * @since 3.4.0
	 *
	 * @param array $form_fields
	 * @return array $form_fields
	 */
	public function attachment_fields_to_edit( $form_fields ) {
		return $form_fields;
	}

	/**
	 * Unused since 3.5.0.
	 *
	 * @since 3.4.0
	 *
	 * @param array $tabs
	 * @return array $tabs
	 */
	public function filter_upload_tabs( $tabs ) {
		return $tabs;
	}

	/**
	 * Choose a header image, selected from existing uploaded and default headers,
	 * or provide an array of uploaded header data (either new, or from media library).
	 *
	 * @since 3.4.0
	 *
	 * @param mixed $choice Which header image to select. Allows for values of 'random-default-image',
	 *  for randomly cycling among the default images; 'random-uploaded-image', for randomly cycling
	 *  among the uploaded images; the key of a default image registered for that theme; and
	 *  the key of an image uploaded for that theme (the attachment ID of the image).
	 *  Or an array of arguments: attachment_id, url, width, height. All are required.
	 */
	final public function set_header_image( $choice ) {
		if ( is_array( $choice ) || is_object( $choice ) ) {
			$choice = (array) $choice;

			if ( ! isset( $choice['attachment_id'] ) || ! isset( $choice['url'] ) ) {
				return;
			}

			$choice['url'] = esc_url_raw( $choice['url'] );

			$header_image_data = (object) array(
				'attachment_id' =&gt; $choice['attachment_id'],
				'url'           =&gt; $choice['url'],
				'thumbnail_url' =&gt; $choice['url'],
				'height'        =&gt; $choice['height'],
				'width'         =&gt; $choice['width'],
			);

			update_post_meta( $choice['attachment_id'], '_wp_attachment_is_custom_header', get_stylesheet() );

			set_theme_mod( 'header_image', $choice['url'] );
			set_theme_mod( 'header_image_data', $header_image_data );

			return;
		}

		if ( in_array( $choice, array( 'remove-header', 'random-default-image', 'random-uploaded-image' ), true ) ) {
			set_theme_mod( 'header_image', $choice );
			remove_theme_mod( 'header_image_data' );

			return;
		}

		$uploaded = get_uploaded_header_images();

		if ( $uploaded &amp;&amp; isset( $uploaded[ $choice ] ) ) {
			$header_image_data = $uploaded[ $choice ];
		} else {
			$this-&gt;process_default_headers();
			if ( isset( $this-&gt;default_headers[ $choice ] ) ) {
				$header_image_data = $this-&gt;default_headers[ $choice ];
			} else {
				return;
			}
		}

		set_theme_mod( 'header_image', esc_url_raw( $header_image_data['url'] ) );
		set_theme_mod( 'header_image_data', $header_image_data );
	}

	/**
	 * Remove a header image.
	 *
	 * @since 3.4.0
	 */
	final public function remove_header_image() {
		$this-&gt;set_header_image( 'remove-header' );
	}

	/**
	 * Reset a header image to the default image for the theme.
	 *
	 * This method does not do anything if the theme does not have a default header image.
	 *
	 * @since 3.4.0
	 */
	final public function reset_header_image() {
		$this-&gt;process_default_headers();
		$default = get_theme_support( 'custom-header', 'default-image' );

		if ( ! $default ) {
			$this-&gt;remove_header_image();
			return;
		}

		$default = sprintf( $default, get_template_directory_uri(), get_stylesheet_directory_uri() );

		$default_data = array();
		foreach ( $this-&gt;default_headers as $header =&gt; $details ) {
			if ( $details['url'] === $default ) {
				$default_data = $details;
				break;
			}
		}

		set_theme_mod( 'header_image', $default );
		set_theme_mod( 'header_image_data', (object) $default_data );
	}

	/**
	 * Calculate width and height based on what the currently selected theme supports.
	 *
	 * @since 3.9.0
	 *
	 * @param array $dimensions
	 * @return array dst_height and dst_width of header image.
	 */
	final public function get_header_dimensions( $dimensions ) {
		$max_width       = 0;
		$width           = absint( $dimensions['width'] );
		$height          = absint( $dimensions['height'] );
		$theme_height    = get_theme_support( 'custom-header', 'height' );
		$theme_width     = get_theme_support( 'custom-header', 'width' );
		$has_flex_width  = current_theme_supports( 'custom-header', 'flex-width' );
		$has_flex_height = current_theme_supports( 'custom-header', 'flex-height' );
		$has_max_width   = current_theme_supports( 'custom-header', 'max-width' );
		$dst             = array(
			'dst_height' =&gt; null,
			'dst_width'  =&gt; null,
		);

		// For flex, limit size of image displayed to 1500px unless theme says otherwise.
		if ( $has_flex_width ) {
			$max_width = 1500;
		}

		if ( $has_max_width ) {
			$max_width = max( $max_width, get_theme_support( 'custom-header', 'max-width' ) );
		}
		$max_width = max( $max_width, $theme_width );

		if ( $has_flex_height &amp;&amp; ( ! $has_flex_width || $width &gt; $max_width ) ) {
			$dst['dst_height'] = absint( $height * ( $max_width / $width ) );
		} elseif ( $has_flex_height &amp;&amp; $has_flex_width ) {
			$dst['dst_height'] = $height;
		} else {
			$dst['dst_height'] = $theme_height;
		}

		if ( $has_flex_width &amp;&amp; ( ! $has_flex_height || $width &gt; $max_width ) ) {
			$dst['dst_width'] = absint( $width * ( $max_width / $width ) );
		} elseif ( $has_flex_width &amp;&amp; $has_flex_height ) {
			$dst['dst_width'] = $width;
		} else {
			$dst['dst_width'] = $theme_width;
		}

		return $dst;
	}

	/**
	 * Create an attachment 'object'.
	 *
	 * @since 3.9.0
	 *
	 * @param string $cropped              Cropped image URL.
	 * @param int    $parent_attachment_id Attachment ID of parent image.
	 * @return array Attachment object.
	 */
	final public function create_attachment_object( $cropped, $parent_attachment_id ) {
		$parent     = get_post( $parent_attachment_id );
		$parent_url = wp_get_attachment_url( $parent-&gt;ID );
		$url        = str_replace( wp_basename( $parent_url ), wp_basename( $cropped ), $parent_url );

		$size       = wp_getimagesize( $cropped );
		$image_type = ( $size ) ? $size['mime'] : 'image/jpeg';

		$object = array(
			'ID'             =&gt; $parent_attachment_id,
			'post_title'     =&gt; wp_basename( $cropped ),
			'post_mime_type' =&gt; $image_type,
			'guid'           =&gt; $url,
			'context'        =&gt; 'custom-header',
			'post_parent'    =&gt; $parent_attachment_id,
		);

		return $object;
	}

	/**
	 * Insert an attachment and its metadata.
	 *
	 * @since 3.9.0
	 *
	 * @param array  $object  Attachment object.
	 * @param string $cropped File path to cropped image.
	 * @return int Attachment ID.
	 */
	final public function insert_attachment( $object, $cropped ) {
		$parent_id = isset( $object['post_parent'] ) ? $object['post_parent'] : null;
		unset( $object['post_parent'] );

		$attachment_id = wp_insert_attachment( $object, $cropped );
		$metadata      = wp_generate_attachment_metadata( $attachment_id, $cropped );

		// If this is a crop, save the original attachment ID as metadata.
		if ( $parent_id ) {
			$metadata['attachment_parent'] = $parent_id;
		}

		/**
		 * Filters the header image attachment metadata.
		 *
		 * @since 3.9.0
		 *
		 * @see wp_generate_attachment_metadata()
		 *
		 * @param array $metadata Attachment metadata.
		 */
		$metadata = apply_filters( 'wp_header_image_attachment_metadata', $metadata );

		wp_update_attachment_metadata( $attachment_id, $metadata );

		return $attachment_id;
	}

	/**
	 * Gets attachment uploaded by Media Manager, crops it, then saves it as a
	 * new object. Returns JSON-encoded object details.
	 *
	 * @since 3.9.0
	 */
	public function ajax_header_crop() {
		check_ajax_referer( 'image_editor-' . $_POST['id'], 'nonce' );

		if ( ! current_user_can( 'edit_theme_options' ) ) {
			wp_send_json_error();
		}

		if ( ! current_theme_supports( 'custom-header', 'uploads' ) ) {
			wp_send_json_error();
		}

		$crop_details = $_POST['cropDetails'];

		$dimensions = $this-&gt;get_header_dimensions(
			array(
				'height' =&gt; $crop_details['height'],
				'width'  =&gt; $crop_details['width'],
			)
		);

		$attachment_id = absint( $_POST['id'] );

		$cropped = wp_crop_image(
			$attachment_id,
			(int) $crop_details['x1'],
			(int) $crop_details['y1'],
			(int) $crop_details['width'],
			(int) $crop_details['height'],
			(int) $dimensions['dst_width'],
			(int) $dimensions['dst_height']
		);

		if ( ! $cropped || is_wp_error( $cropped ) ) {
			wp_send_json_error( array( 'message' =&gt; __( 'Image could not be processed. Please go back and try again.' ) ) );
		}

		/** This filter is documented in wp-admin/includes/class-custom-image-header.php */
		$cropped = apply_filters( 'wp_create_file_in_uploads', $cropped, $attachment_id ); // For replication.

		$object = $this-&gt;create_attachment_object( $cropped, $attachment_id );

		$previous = $this-&gt;get_previous_crop( $object );

		if ( $previous ) {
			$object['ID'] = $previous;
		} else {
			unset( $object['ID'] );
		}

		$new_attachment_id = $this-&gt;insert_attachment( $object, $cropped );

		$object['attachment_id'] = $new_attachment_id;
		$object['url']           = wp_get_attachment_url( $new_attachment_id );

		$object['width']  = $dimensions['dst_width'];
		$object['height'] = $dimensions['dst_height'];

		wp_send_json_success( $object );
	}

	/**
	 * Given an attachment ID for a header image, updates its &quot;last used&quot;
	 * timestamp to now.
	 *
	 * Triggered when the user tries adds a new header image from the
	 * Media Manager, even if s/he doesn't save that change.
	 *
	 * @since 3.9.0
	 */
	public function ajax_header_add() {
		check_ajax_referer( 'header-add', 'nonce' );

		if ( ! current_user_can( 'edit_theme_options' ) ) {
			wp_send_json_error();
		}

		$attachment_id = absint( $_POST['attachment_id'] );
		if ( $attachment_id &lt; 1 ) {
			wp_send_json_error();
		}

		$key = '_wp_attachment_custom_header_last_used_' . get_stylesheet();
		update_post_meta( $attachment_id, $key, time() );
		update_post_meta( $attachment_id, '_wp_attachment_is_custom_header', get_stylesheet() );

		wp_send_json_success();
	}

	/**
	 * Given an attachment ID for a header image, unsets it as a user-uploaded
	 * header image for the current theme.
	 *
	 * Triggered when the user clicks the overlay &quot;X&quot; button next to each image
	 * choice in the Customizer's Header tool.
	 *
	 * @since 3.9.0
	 */
	public function ajax_header_remove() {
		check_ajax_referer( 'header-remove', 'nonce' );

		if ( ! current_user_can( 'edit_theme_options' ) ) {
			wp_send_json_error();
		}

		$attachment_id = absint( $_POST['attachment_id'] );
		if ( $attachment_id &lt; 1 ) {
			wp_send_json_error();
		}

		$key = '_wp_attachment_custom_header_last_used_' . get_stylesheet();
		delete_post_meta( $attachment_id, $key );
		delete_post_meta( $attachment_id, '_wp_attachment_is_custom_header', get_stylesheet() );

		wp_send_json_success();
	}

	/**
	 * Updates the last-used postmeta on a header image attachment after saving a new header image via the Customizer.
	 *
	 * @since 3.9.0
	 *
	 * @param WP_Customize_Manager $wp_customize Customize manager.
	 */
	public function customize_set_last_used( $wp_customize ) {

		$header_image_data_setting = $wp_customize-&gt;get_setting( 'header_image_data' );

		if ( ! $header_image_data_setting ) {
			return;
		}

		$data = $header_image_data_setting-&gt;post_value();

		if ( ! isset( $data['attachment_id'] ) ) {
			return;
		}

		$attachment_id = $data['attachment_id'];
		$key           = '_wp_attachment_custom_header_last_used_' . get_stylesheet();
		update_post_meta( $attachment_id, $key, time() );
	}

	/**
	 * Gets the details of default header images if defined.
	 *
	 * @since 3.9.0
	 *
	 * @return array Default header images.
	 */
	public function get_default_header_images() {
		$this-&gt;process_default_headers();

		// Get the default image if there is one.
		$default = get_theme_support( 'custom-header', 'default-image' );

		if ( ! $default ) { // If not, easy peasy.
			return $this-&gt;default_headers;
		}

		$default = sprintf( $default, get_template_directory_uri(), get_stylesheet_directory_uri() );

		$already_has_default = false;

		foreach ( $this-&gt;default_headers as $k =&gt; $h ) {
			if ( $h['url'] === $default ) {
				$already_has_default = true;
				break;
			}
		}

		if ( $already_has_default ) {
			return $this-&gt;default_headers;
		}

		// If the one true image isn't included in the default set, prepend it.
		$header_images            = array();
		$header_images['default'] = array(
			'url'           =&gt; $default,
			'thumbnail_url' =&gt; $default,
			'description'   =&gt; 'Default',
		);

		// The rest of the set comes after.
		return array_merge( $header_images, $this-&gt;default_headers );
	}

	/**
	 * Gets the previously uploaded header images.
	 *
	 * @since 3.9.0
	 *
	 * @return array Uploaded header images.
	 */
	public function get_uploaded_header_images() {
		$header_images = get_uploaded_header_images();
		$timestamp_key = '_wp_attachment_custom_header_last_used_' . get_stylesheet();
		$alt_text_key  = '_wp_attachment_image_alt';

		foreach ( $header_images as &amp;$header_image ) {
			$header_meta               = get_post_meta( $header_image['attachment_id'] );
			$header_image['timestamp'] = isset( $header_meta[ $timestamp_key ] ) ? $header_meta[ $timestamp_key ] : '';
			$header_image['alt_text']  = isset( $header_meta[ $alt_text_key ] ) ? $header_meta[ $alt_text_key ] : '';
		}

		return $header_images;
	}

	/**
	 * Get the ID of a previous crop from the same base image.
	 *
	 * @since 4.9.0
	 *
	 * @param array $object A crop attachment object.
	 * @return int|false An attachment ID if one exists. False if none.
	 */
	public function get_previous_crop( $object ) {
		$header_images = $this-&gt;get_uploaded_header_images();

		// Bail early if there are no header images.
		if ( empty( $header_images ) ) {
			return false;
		}

		$previous = false;

		foreach ( $header_images as $image ) {
			if ( $image['attachment_parent'] === $object['post_parent'] ) {
				$previous = $image['attachment_id'];
				break;
			}
		}

		return $previous;
	}
}
</pre>
			</div>
			<p class="source-code-links">
				<span>
					<a href="#" class="show-complete-source">Expand full source code</a>
					<a href="#" class="less-complete-source">Collapse full source code</a>
				</span>
				<span><a href="https://core.trac.wordpress.org/browser/tags/5.8/src/wp-admin/includes/class-custom-image-header.php#L14">View on Trac</a></span>
			</p>
			</section>
		<hr />
		<section class="class-methods">
			<p class="toc-jump"><a href="#top">Top &uarr;</a></p><h2 class="toc-heading" id="methods" tabindex="-1">Methods <a href="#methods" class="anchor"><span aria-hidden="true">#</span><span class="screen-reader-text">Methods</span></a></h2>
			<ul>
									<li><a href="__construct/index.html">
							__construct</a>
						&mdash; Constructor - Register administration header callback.											</li>
									<li><a href="__get/index.html">
							__get</a>
						&mdash; Make private properties readable for backwards compatibility.											</li>
									<li><a href="__isset/index.html">
							__isset</a>
						&mdash; Make private properties checkable for backwards compatibility.											</li>
									<li><a href="__set/index.html">
							__set</a>
						&mdash; Make private properties settable for backwards compatibility.											</li>
									<li><a href="__unset/index.html">
							__unset</a>
						&mdash; Make private properties un-settable for backwards compatibility.											</li>
									<li><a href="admin_page/index.html">
							admin_page</a>
						&mdash; Display the page based on the current step.											</li>
									<li><a href="ajax_header_add/index.html">
							ajax_header_add</a>
						&mdash; Given an attachment ID for a header image, updates its "last used" timestamp to now.											</li>
									<li><a href="ajax_header_crop/index.html">
							ajax_header_crop</a>
						&mdash; Gets attachment uploaded by Media Manager, crops it, then saves it as a new object. Returns JSON-encoded object details.											</li>
									<li><a href="ajax_header_remove/index.html">
							ajax_header_remove</a>
						&mdash; Given an attachment ID for a header image, unsets it as a user-uploaded header image for the current theme.											</li>
									<li><a href="attachment_fields_to_edit/index.html">
							attachment_fields_to_edit</a>
						&mdash; Unused since 3.5.0.											</li>
									<li><a href="create_attachment_object/index.html">
							create_attachment_object</a>
						&mdash; Create an attachment 'object'.											</li>
									<li><a href="css_includes/index.html">
							css_includes</a>
						&mdash; Set up the enqueue for the CSS files											</li>
									<li><a href="customize_set_last_used/index.html">
							customize_set_last_used</a>
						&mdash; Updates the last-used postmeta on a header image attachment after saving a new header image via the Customizer.											</li>
									<li><a href="filter_upload_tabs/index.html">
							filter_upload_tabs</a>
						&mdash; Unused since 3.5.0.											</li>
									<li><a href="finished/index.html">
							finished</a>
						&mdash; Display last step of custom header image page.											</li>
									<li><a href="get_default_header_images/index.html">
							get_default_header_images</a>
						&mdash; Gets the details of default header images if defined.											</li>
									<li><a href="get_header_dimensions/index.html">
							get_header_dimensions</a>
						&mdash; Calculate width and height based on what the currently selected theme supports.											</li>
									<li><a href="get_previous_crop/index.html">
							get_previous_crop</a>
						&mdash; Get the ID of a previous crop from the same base image.											</li>
									<li><a href="get_uploaded_header_images/index.html">
							get_uploaded_header_images</a>
						&mdash; Gets the previously uploaded header images.											</li>
									<li><a href="help/index.html">
							help</a>
						&mdash; Adds contextual help.											</li>
									<li><a href="init/index.html">
							init</a>
						&mdash; Set up the hooks for the Custom Header admin page.											</li>
									<li><a href="insert_attachment/index.html">
							insert_attachment</a>
						&mdash; Insert an attachment and its metadata.											</li>
									<li><a href="js/index.html">
							js</a>
						&mdash; Execute JavaScript depending on step.											</li>
									<li><a href="js_1/index.html">
							js_1</a>
						&mdash; Display JavaScript based on Step 1 and 3.											</li>
									<li><a href="js_2/index.html">
							js_2</a>
						&mdash; Display JavaScript based on Step 2.											</li>
									<li><a href="js_includes/index.html">
							js_includes</a>
						&mdash; Set up the enqueue for the JavaScript files.											</li>
									<li><a href="process_default_headers/index.html">
							process_default_headers</a>
						&mdash; Process the default headers											</li>
									<li><a href="remove_header_image/index.html">
							remove_header_image</a>
						&mdash; Remove a header image.											</li>
									<li><a href="reset_header_image/index.html">
							reset_header_image</a>
						&mdash; Reset a header image to the default image for the theme.											</li>
									<li><a href="set_header_image/index.html">
							set_header_image</a>
						&mdash; Choose a header image, selected from existing uploaded and default headers, or provide an array of uploaded header data (either new, or from media library).											</li>
									<li><a href="show_header_selector/index.html">
							show_header_selector</a>
						&mdash; Display UI for selecting one of several default headers.											</li>
									<li><a href="step/index.html">
							step</a>
						&mdash; Get the current step.											</li>
									<li><a href="step_1/index.html">
							step_1</a>
						&mdash; Display first step of custom header image page.											</li>
									<li><a href="step_2/index.html">
							step_2</a>
						&mdash; Display second step of custom header image page.											</li>
									<li><a href="step_2_manage_upload/index.html">
							step_2_manage_upload</a>
						&mdash; Upload the file to be cropped in the second step.											</li>
									<li><a href="step_3/index.html">
							step_3</a>
						&mdash; Display third step of custom header image page.											</li>
									<li><a href="take_action/index.html">
							take_action</a>
						&mdash; Execute custom header modification.											</li>
							</ul>
		</section>
		<hr />
	<section class="changelog">
		<p class="toc-jump"><a href="#top">Top &uarr;</a></p><h2 class="toc-heading" id="changelog" tabindex="-1">Changelog <a href="#changelog" class="anchor"><span aria-hidden="true">#</span><span class="screen-reader-text">Changelog</span></a></h2>

		<table>
			<caption class="screen-reader-text">Changelog</caption>
			<thead>
				<tr>
					<th class="changelog-version">Version</th>
					<th class="changelog-desc">Description</th>
				</tr>
			</thead>

			<tbody>
									
					<tr>
						<td><a href="../../since/2.1.0/index.html" alt="WordPress 2.1.0">2.1.0</a></td>
						<td>Introduced.</td>
					</tr>
							</tbody>
		</table>
	</section>

	<hr />
	<section class="user-notes">
		<p class="toc-jump"><a href="#top">Top &uarr;</a></p><h2 class="toc-heading" id="user-contributed-notes" tabindex="-1">User Contributed Notes <a href="#user-contributed-notes" class="anchor"><span aria-hidden="true">#</span><span class="screen-reader-text">User Contributed Notes</span></a></h2>
		
<div id="comments" class="comments-area">

	
	
			<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title"> <small></small></h3><p>You must <a href="https://login.wordpress.org/?redirect_to=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Fclasses%2Fcustom_image_header%2F%23respond">log in</a> before being able to contribute a note or feedback.</p>	</div><!-- #respond -->
		
	
</div><!-- #comments -->
	</section>
</div>

</article>

			
		
		</main><!-- #main -->
	</div><!-- #primary -->
	</div><!-- #content -->

</div><!-- #page -->


<div id="wporg-footer">
	<div class="wrapper">
		<ul>
			<li><a href="http://wordpress.org/about/" title="An introduction to the WordPress project">About</a></li>
			<li><a href="http://wordpress.org/news/" title="News and Updates">Blog</a></li>
			<li><a href="http://wordpress.org/hosting/" title="Recommended web hosting providers">Hosting</a></li>
			<li><a href="https://wordpressfoundation.org/donate/" title="Donate to the WordPress Foundation">Donate</a></li>
		</ul>

		<ul>
			<li><a href="http://wordpress.org/support/" title="Forums, documentation, and other resources">Support</a></li>
			<li><a href="../../../index.html" title="Resources for WordPress developers">Developers</a></li>
			<li><a href="http://make.wordpress.org/" title="Give back to WordPress through code, support, translation and more">Get Involved</a></li>
			<li><a href="http://learn.wordpress.org/" title="Workshops and training materials">Learn</a></li>
		</ul>

		<ul>
			<li><a href="http://wordpress.org/showcase/" title="Some of the best WordPress sites on the Web">Showcase</a></li>
			<li><a href="http://wordpress.org/plugins/" title="Add extra functionality to WordPress">Plugins</a></li>
			<li><a href="http://wordpress.org/themes/" title="Make your WordPress pretty">Themes</a></li>
		</ul>

		<ul>
			<li><a href="http://central.wordcamp.org/" title="Find a WordPress event near you">WordCamp</a></li>
			<li><a href="http://wordpress.tv/" title="Videos, tutorials, and WordCamp sessions">WordPress.TV</a></li>
			<li><a href="http://buddypress.org/" title="A set of plugins to transform your WordPress into a social network">BuddyPress</a></li>
			<li><a href="http://bbpress.org/" title="Fast, slick forums built on WordPress">bbPress</a></li>
		</ul>

		<ul>
			<li><a href="http://wordpress.com/?ref=wporg-footer" title="Hassle-free WordPress hosting">WordPress.com</a></li>
			<li><a href="http://ma.tt/" title="Co-founder of WordPress, an example of what WordPress can do">Matt</a></li>
			<li><a href="http://wordpress.org/about/privacy/" title="WordPress.org Privacy Policy">Privacy</a></li>
			<li><a href="https://publiccode.eu/" target="_blank">Public Code</a></li>
		</ul>

		<ul class="social-media-links">
			<li><span class="dashicons dashicons-twitter"></span><a href="https://twitter.com/WordPress" title="Follow @WordPress on Twitter">@WordPress</a></li>
			<li><span class="dashicons dashicons-facebook"></span><a href="https://www.facebook.com/WordPress/" title="Like WordPress on Facebook">WordPress</a></li>
		</ul>
	</div>

		<p class="cip cip-image">Code is Poetry.</p>
</div>

<script src="../../../../s.w.org/style/js/navigation.min.js?20190128"></script>

<link rel='stylesheet' id='buttons-css'  href='../../../wp-includes/css/buttons.min.css?ver=5.9-alpha-51701' type='text/css' media='all' />
<script type='text/javascript' src='../../../wp-includes/js/hoverintent-js.min.js?ver=2.2.1' id='hoverintent-js-js'></script>
<script type='text/javascript' src='../../../wp-includes/js/admin-bar.min.js?ver=5.9-alpha-51701' id='admin-bar-js'></script>
<script type='text/javascript' src='../../../wp-content/themes/pub/wporg-developer/js/navigation.js?ver=20181209' id='wporg-developer-navigation-js'></script>
<script type='text/javascript' src='../../../wp-content/themes/pub/wporg-developer/js/skip-link-focus-fix.js?ver=20130115' id='wporg-developer-skip-link-focus-fix-js'></script>
<script type='text/javascript' src='../../../wp-content/themes/pub/wporg-developer/js/search.js?ver=20150430' id='wporg-developer-search-js'></script>
<script type='text/javascript' src='../../../wp-content/themes/pub/wporg-developer/js/menu.js?ver=20180201' id='wporg-developer-menu-js'></script>
<script type='text/javascript' src='../../../wp-content/themes/pub/wporg-developer/js/awesomplete.min.js?ver=20160322' id='awesomplete-js'></script>
<script type='text/javascript' id='autocomplete-js-extra'>
/* <![CDATA[ */
var autocomplete = {"ajaxurl":"https:\/\/developer.wordpress.org\/wp-admin\/admin-ajax.php","nonce":"8a60f70c4b"};
/* ]]> */
</script>
<script type='text/javascript' src='../../../wp-content/themes/pub/wporg-developer/js/autocomplete.js?ver=20160524' id='autocomplete-js'></script>
<script type='text/javascript' src='../../../wp-content/themes/pub/wporg-developer/js/function-reference.js?ver=20180724' id='wporg-developer-function-reference-js'></script>
<script type='text/javascript' id='quicktags-js-extra'>
/* <![CDATA[ */
var quicktagsL10n = {"closeAllOpenTags":"Close all open tags","closeTags":"close tags","enterURL":"Enter the URL","enterImageURL":"Enter the URL of the image","enterImageDescription":"Enter a description of the image","textdirection":"text direction","toggleTextdirection":"Toggle Editor Text Direction","dfw":"Distraction-free writing mode","strong":"Bold","strongClose":"Close bold tag","em":"Italic","emClose":"Close italic tag","link":"Insert link","blockquote":"Blockquote","blockquoteClose":"Close blockquote tag","del":"Deleted text (strikethrough)","delClose":"Close deleted text tag","ins":"Inserted text","insClose":"Close inserted text tag","image":"Insert image","ul":"Bulleted list","ulClose":"Close bulleted list tag","ol":"Numbered list","olClose":"Close numbered list tag","li":"List item","liClose":"Close list item tag","code":"Code","codeClose":"Close code tag","more":"Insert Read More tag"};
/* ]]> */
</script>
<script type='text/javascript' src='../../../wp-includes/js/quicktags.min.js?ver=5.9-alpha-51701' id='quicktags-js'></script>
<script type='text/javascript' src='../../../wp-content/themes/pub/wporg-developer/js/user-notes.js?ver=20200110' id='wporg-developer-user-notes-js'></script>
<script type='text/javascript' id='wporg-developer-user-notes-feedback-js-extra'>
/* <![CDATA[ */
var wporg_note_feedback = {"show":"Show Feedback","hide":"Hide Feedback"};
/* ]]> */
</script>
<script type='text/javascript' src='../../../wp-content/themes/pub/wporg-developer/js/user-notes-feedback.js?ver=20181023' id='wporg-developer-user-notes-feedback-js'></script>
<script type='text/javascript' src='../../../wp-content/themes/pub/wporg-developer/js/tabs.js?ver=20160824' id='wporg-developer-tabs-js'></script>
<script type='text/javascript' id='wporg-developer-preview-js-extra'>
/* <![CDATA[ */
var wporg_note_preview = {"ajaxurl":"https:\/\/developer.wordpress.org\/wp-admin\/admin-ajax.php","nonce":"504933b60e","preview":"preview note","preview_empty":"Nothing to preview","is_admin":""};
/* ]]> */
</script>
<script type='text/javascript' src='../../../wp-content/themes/pub/wporg-developer/js/user-notes-preview.js?ver=20200111' id='wporg-developer-preview-js'></script>
<script type='text/javascript' src='../../../wp-includes/js/wp-embed.min.js?ver=5.9-alpha-51701' id='wp-embed-js'></script>
<script type='text/javascript' src='../../../wp-includes/js/dist/vendor/regenerator-runtime.min.js?ver=0.13.7' id='regenerator-runtime-js'></script>
<script type='text/javascript' src='../../../wp-includes/js/dist/vendor/wp-polyfill.min.js?ver=3.15.0' id='wp-polyfill-js'></script>
<script type='text/javascript' src='../../../wp-includes/js/dist/dom-ready.min.js?ver=71883072590656bf22c74c7b887df3dd' id='wp-dom-ready-js'></script>
<script type='text/javascript' src='../../../wp-includes/js/dist/hooks.min.js?ver=a7edae857aab69d69fa10d5aef23a5de' id='wp-hooks-js'></script>
<script type='text/javascript' src='../../../wp-includes/js/dist/i18n.min.js?ver=5f1269854226b4dd90450db411a12b79' id='wp-i18n-js'></script>
<script type='text/javascript' id='wp-i18n-js-after'>
wp.i18n.setLocaleData( { 'text direction\u0004ltr': [ 'ltr' ] } );
</script>
<script type='text/javascript' id='wp-a11y-js-translations'>
( function( domain, translations ) {
	var localeData = translations.locale_data[ domain ] || translations.locale_data.messages;
	localeData[""].domain = domain;
	wp.i18n.setLocaleData( localeData, domain );
} )( "default", { "locale_data": { "messages": { "": {} } } } );
</script>
<script type='text/javascript' src='../../../wp-includes/js/dist/a11y.min.js?ver=0ac8327cc1c40dcfdf29716affd7ac63' id='wp-a11y-js'></script>
<script type='text/javascript' id='wplink-js-extra'>
/* <![CDATA[ */
var wpLinkL10n = {"title":"Insert\/edit link","update":"Update","save":"Add Link","noTitle":"(no title)","noMatchesFound":"No results found.","linkSelected":"Link selected.","linkInserted":"Link inserted.","minInputLength":"3"};
/* ]]> */
</script>
<script type='text/javascript' src='../../../wp-includes/js/wplink.min.js?ver=5.9-alpha-51701' id='wplink-js'></script>
<script type='text/javascript' src='../../../wp-includes/js/jquery/ui/core.min.js?ver=1.12.1' id='jquery-ui-core-js'></script>
<script type='text/javascript' src='../../../wp-includes/js/jquery/ui/menu.min.js?ver=1.12.1' id='jquery-ui-menu-js'></script>
<script type='text/javascript' id='jquery-ui-autocomplete-js-extra'>
/* <![CDATA[ */
var uiAutocompleteL10n = {"noResults":"No results found.","oneResult":"1 result found. Use up and down arrow keys to navigate.","manyResults":"%d results found. Use up and down arrow keys to navigate.","itemSelected":"Item selected."};
/* ]]> */
</script>
<script type='text/javascript' src='../../../wp-includes/js/jquery/ui/autocomplete.min.js?ver=1.12.1' id='jquery-ui-autocomplete-js'></script>

		<script type="text/javascript">
		tinyMCEPreInit = {
			baseURL: "https://developer.wordpress.org/wp-includes/js/tinymce",
			suffix: ".min",
						mceInit: {},
			qtInit: {'comment':{id:"comment",buttons:"strong,em,ul,ol,li,link"}},
			ref: {plugins:"",theme:"modern",language:""},
			load_ext: function(url,lang){var sl=tinymce.ScriptLoader;sl.markDone(url+'/langs/'+lang+'.js');sl.markDone(url+'/langs/'+lang+'_dlg.js');}
		};
		</script>
				<script type="text/javascript">
		var ajaxurl = "../../../wp-admin/admin-ajax.html";
		( function() {
			var initialized = [];
			var initialize  = function() {
				var init, id, inPostbox, $wrap;
				var readyState = document.readyState;

				if ( readyState !== 'complete' && readyState !== 'interactive' ) {
					return;
				}

				for ( id in tinyMCEPreInit.mceInit ) {
					if ( initialized.indexOf( id ) > -1 ) {
						continue;
					}

					init      = tinyMCEPreInit.mceInit[id];
					$wrap     = tinymce.$( '#wp-' + id + '-wrap' );
					inPostbox = $wrap.parents( '.postbox' ).length > 0;

					if (
						! init.wp_skip_init &&
						( $wrap.hasClass( 'tmce-active' ) || ! tinyMCEPreInit.qtInit.hasOwnProperty( id ) ) &&
						( readyState === 'complete' || ( ! inPostbox && readyState === 'interactive' ) )
					) {
						tinymce.init( init );
						initialized.push( id );

						if ( ! window.wpActiveEditor ) {
							window.wpActiveEditor = id;
						}
					}
				}
			}

			if ( typeof tinymce !== 'undefined' ) {
				if ( tinymce.Env.ie && tinymce.Env.ie < 11 ) {
					tinymce.$( '.wp-editor-wrap ' ).removeClass( 'tmce-active' ).addClass( 'html-active' );
				} else {
					if ( document.readyState === 'complete' ) {
						initialize();
					} else {
						document.addEventListener( 'readystatechange', initialize );
					}
				}
			}

			if ( typeof quicktags !== 'undefined' ) {
				for ( id in tinyMCEPreInit.qtInit ) {
					quicktags( tinyMCEPreInit.qtInit[id] );

					if ( ! window.wpActiveEditor ) {
						window.wpActiveEditor = id;
					}
				}
			}
		}());
		</script>
				<div id="wp-link-backdrop" style="display: none"></div>
		<div id="wp-link-wrap" class="wp-core-ui" style="display: none" role="dialog" aria-labelledby="link-modal-title">
		<form id="wp-link" tabindex="-1">
		<input type="hidden" id="_ajax_linking_nonce" name="_ajax_linking_nonce" value="86f5a0a85d" />		<h1 id="link-modal-title">Insert/edit link</h1>
		<button type="button" id="wp-link-close"><span class="screen-reader-text">Close</span></button>
		<div id="link-selector">
			<div id="link-options">
				<p class="howto" id="wplink-enter-url">Enter the destination URL</p>
				<div>
					<label><span>URL</span>
					<input id="wp-link-url" type="text" aria-describedby="wplink-enter-url" /></label>
				</div>
				<div class="wp-link-text-field">
					<label><span>Link Text</span>
					<input id="wp-link-text" type="text" /></label>
				</div>
				<div class="link-target">
					<label><span></span>
					<input type="checkbox" id="wp-link-target" /> Open link in a new tab</label>
				</div>
			</div>
			<p class="howto" id="wplink-link-existing-content">Or link to existing content</p>
			<div id="search-panel">
				<div class="link-search-wrapper">
					<label>
						<span class="search-label">Search</span>
						<input type="search" id="wp-link-search" class="link-search-field" autocomplete="off" aria-describedby="wplink-link-existing-content" />
						<span class="spinner"></span>
					</label>
				</div>
				<div id="search-results" class="query-results" tabindex="0">
					<ul></ul>
					<div class="river-waiting">
						<span class="spinner"></span>
					</div>
				</div>
				<div id="most-recent-results" class="query-results" tabindex="0">
					<div class="query-notice" id="query-notice-message">
						<em class="query-notice-default">No search term specified. Showing recent items.</em>
						<em class="query-notice-hint screen-reader-text">Search or use up and down arrow keys to select an item.</em>
					</div>
					<ul></ul>
					<div class="river-waiting">
						<span class="spinner"></span>
					</div>
				</div>
			</div>
		</div>
		<div class="submitbox">
			<div id="wp-link-cancel">
				<button type="button" class="button">Cancel</button>
			</div>
			<div id="wp-link-update">
				<input type="submit" value="Add Link" class="button button-primary" id="wp-link-submit" name="wp-link-submit">
			</div>
		</div>
		</form>
		</div>
		</body>

<!-- Mirrored from developer.wordpress.org/reference/classes/custom_image_header/ by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 31 Aug 2021 16:49:10 GMT -->
</html>
