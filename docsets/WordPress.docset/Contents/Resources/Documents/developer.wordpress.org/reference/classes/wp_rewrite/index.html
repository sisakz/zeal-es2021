<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">

<!-- Mirrored from developer.wordpress.org/reference/classes/wp_rewrite/ by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 31 Aug 2021 16:55:01 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<!--
<meta property="fb:page_id" content="6427302910" />
-->
<meta name="google-site-verification" content="7VWES_-rcHBcmaQis9mSYamPfNwE03f4vyTj4pfuAw0" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>WP_Rewrite</title>
<meta name="referrer" content="always">

		<link href='../../../../fonts.googleapis.com/css.css?family=Open+Sans:300italic,400italic,600italic,400,300,600&amp;subset=latin,cyrillic-ext,greek-ext,greek,vietnamese,latin-ext,cyrillic' rel='stylesheet' type='text/css'>

		<link rel="stylesheet" href="../../../../s.w.org/style/wp4.css?95" />

<link rel="shortcut icon" href="../../../../s.w.org/favicon.ico?2" type="image/x-icon" />
<link rel="pingback" href="../../../xmlrpc.php" /><meta name='robots' content='max-image-preview:large' />
<link rel='dns-prefetch' href='../../../../fonts.googleapis.com/index.html' />
<link rel='dns-prefetch' href='http://s.w.org/' />
<link rel='dns-prefetch' href='http://www.googletagmanager.com/' />
<link rel='dns-prefetch' href='http://fonts.gstatic.com/' />
<link rel="alternate" type="application/rss+xml" title="WordPress Developer Resources &raquo; Feed" href="../../../feed/index.html" />
<link rel="alternate" type="application/rss+xml" title="WordPress Developer Resources &raquo; Comments Feed" href="../../../comments/feed/index.html" />
<meta property="og:title" content="WP_Rewrite | Class | WordPress Developer Resources" />
<meta property="og:site_name" content="WordPress Developer Resources" />
<meta property="og:type" content="website" />
<meta property="og:url" content="../../../index.html" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@WordPress" />
<meta name="description" content="Core class used to implement a rewrite component API." />
<meta property="og:description" content="Core class used to implement a rewrite component API." />
<link rel="alternate" type="application/rss+xml" title="WordPress Developer Resources &raquo; WP_Rewrite Comments Feed" href="https://developer.wordpress.org/reference/classes/wp_rewrite/feed/" />
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'../../../../www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-P24PF4B');</script>
			<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.1.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.1.0\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/developer.wordpress.org\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.9-alpha-51701"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([10084,65039,8205,55357,56613],[10084,65039,8203,55357,56613])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='dashicons-css'  href='../../../wp-includes/css/dashicons.min.css?ver=5.9-alpha-51701' type='text/css' media='all' />
<link rel='stylesheet' id='admin-bar-css'  href='../../../wp-includes/css/admin-bar.min.css?ver=5.9-alpha-51701' type='text/css' media='all' />
<link rel='stylesheet' id='wp-block-library-css'  href='../../../wp-includes/css/dist/block-library/style.min.css?ver=5.9-alpha-51701' type='text/css' media='all' />
<link rel='stylesheet' id='wporg-handbook-css-css'  href='../../../wp-content/plugins/handbook/stylesheets/callout-boxes.css?ver=20200121' type='text/css' media='all' />
<link rel='stylesheet' id='open-sans-css'  href='../../../../fonts.googleapis.com/css-2.css?family=Open+Sans%3A300italic%2C400italic%2C600italic%2C300%2C400%2C600&amp;subset=latin%2Clatin-ext&amp;display=fallback&amp;ver=5.9-alpha-51701' type='text/css' media='all' />
<link rel='stylesheet' id='wporg-developer-style-css'  href='../../../wp-content/themes/pub/wporg-developer/style.css?ver=3' type='text/css' media='all' />
<link rel='stylesheet' id='wp-dev-sass-compiled-css'  href='../../../wp-content/themes/pub/wporg-developer/stylesheets/main.css?ver=20200713' type='text/css' media='all' />
<link rel='stylesheet' id='awesomplete-css-css'  href='../../../wp-content/themes/pub/wporg-developer/stylesheets/awesomplete.css?ver=20160114' type='text/css' media='all' />
<link rel='stylesheet' id='autocomplete-css-css'  href='../../../wp-content/themes/pub/wporg-developer/stylesheets/autocomplete.css?ver=20171220' type='text/css' media='all' />
<link rel='stylesheet' id='syntaxhighlighter-core-css'  href='../../../wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.9b' type='text/css' media='all' />
<link rel='stylesheet' id='syntaxhighlighter-theme-default-css'  href='../../../wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.9b' type='text/css' media='all' />
<script type='text/javascript' src='../../../wp-includes/js/jquery/jquery.min.js?ver=3.6.0' id='jquery-core-js'></script>
<script type='text/javascript' src='../../../wp-includes/js/jquery/jquery-migrate.min.js?ver=3.3.2' id='jquery-migrate-js'></script>
<script type='text/javascript' src='../../../wp-content/plugins/handbook/scripts/handbook.js?ver=20150930' id='wporg-handbook-js'></script>
<script type='text/javascript' src='../../../wp-content/themes/pub/wporg-developer/js/chapters.js?ver=20190603' id='wporg-developer-chapters-js'></script>
<script type='text/javascript' src='../../../wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.9b' id='syntaxhighlighter-core-js'></script>
<script type='text/javascript' src='../../../wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushPhp.js?ver=3.0.9b' id='syntaxhighlighter-brush-php-js'></script>
<link rel="https://api.w.org/" href="https://developer.wordpress.org/wp-json/" /><link rel="alternate" type="application/json" href="https://developer.wordpress.org/wp-json/wp/v2/wp-parser-class/1028" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../../xmlrpc-2.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../../../wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.9-alpha-51701" />
<link rel='shortlink' href='https://developer.wordpress.org/?p=1028' />
<link rel="alternate" type="application/json+oembed" href="https://developer.wordpress.org/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Fclasses%2Fwp_rewrite%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://developer.wordpress.org/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Fclasses%2Fwp_rewrite%2F&amp;format=xml" />
<link rel="canonical" href="index.html">
<!-- Stream WordPress user activity plugin v3.6.2 -->
	<style>
		@media screen and (max-width: 782px) {
			#wpadminbar li#wp-admin-bar-log-in,
			#wpadminbar li#wp-admin-bar-register {
				display: block;
			}

			#wpadminbar li#wp-admin-bar-log-in a,
			#wpadminbar li#wp-admin-bar-register a {
				padding: 0 8px;
			}
		}
	</style>
		<style>
			a.github-edit {
				margin-left: .5em;
				font-size: .5em;
				vertical-align: top;
				display: inline-block;
				border: 1px solid #eeeeee;
				border-radius: 2px;
				background: #eeeeee;
				padding: .5em .6em .4em;
				color: black;
				margin-top: 0.1em;
			}
			a.github-edit > * {
				opacity: 0.6;
			}
			a.github-edit:hover > * {
				opacity: 1;
				color: black;
			}
			a.github-edit img {
				height: .8em;
			}
		</style>
		
	<script type="text/javascript">
		jQuery( '<style>.hide-if-js { display: none; }</style>' ).appendTo( 'head' );
		jQuery( function($) {
			$( 'body' ).addClass('js');
		} );
	</script>
<style type="text/css" media="print">#wpadminbar { display:none; }</style>
	<style type="text/css" media="screen">
	</style>
	<script>document.cookie='devicePixelRatio='+((window.devicePixelRatio === undefined) ? 1 : window.devicePixelRatio)+'; path=/';</script>

</head>


<body id="wordpress-org" class="wp-parser-class-template-default single single-wp-parser-class postid-1028 admin-bar no-customize-support">
		<div id="wpadminbar" class="nojq nojs">
						<div class="quicklinks" id="wp-toolbar" role="navigation" aria-label="Toolbar">
				<ul id='wp-admin-bar-root-default' class="ab-top-menu"><li id='wp-admin-bar-wp-logo' class="menupop"><a class='ab-item' aria-haspopup="true" href='https://wordpress.org/about/'><span class="ab-icon" aria-hidden="true"></span><span class="screen-reader-text">About WordPress</span></a><div class="ab-sub-wrapper"><ul id='wp-admin-bar-wp-logo-default' class="ab-submenu"><li id='wp-admin-bar-about'><a class='ab-item' href='https://wordpress.org/about/'>About WordPress</a></li></ul><ul id='wp-admin-bar-wp-logo-external' class="ab-sub-secondary ab-submenu"><li id='wp-admin-bar-wporg'><a class='ab-item' href='https://wordpress.org/'>WordPress.org</a></li><li id='wp-admin-bar-documentation'><a class='ab-item' href='https://wordpress.org/support/'>Documentation</a></li><li id='wp-admin-bar-support-forums'><a class='ab-item' href='https://wordpress.org/support/forums/'>Support</a></li><li id='wp-admin-bar-feedback'><a class='ab-item' href='https://wordpress.org/support/forum/requests-and-feedback'>Feedback</a></li></ul></div></li></ul><ul id='wp-admin-bar-top-secondary' class="ab-top-secondary ab-top-menu"><li id='wp-admin-bar-search' class="admin-bar-search"><div class="ab-item ab-empty-item" tabindex="-1"><form action="https://developer.wordpress.org/" method="get" id="adminbarsearch"><input class="adminbar-input" name="s" id="adminbar-search" type="text" value="" maxlength="150" /><label for="adminbar-search" class="screen-reader-text">Search</label><input type="submit" class="adminbar-button" value="Search" /></form></div></li><li id='wp-admin-bar-log-in'><a class='ab-item' href='https://login.wordpress.org/?locale=en_US'>Log In</a></li><li id='wp-admin-bar-register'><a class='ab-item' href='https://login.wordpress.org/register?locale=en_US'>Register</a></li></ul>			</div>
					</div>

		<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P24PF4B" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
	<div id="wporg-header">
	<div class="wrapper">
	<h1><a href="http://wordpress.org/">WordPress.org</a></h1>				<div id="head-search">
		<form action="http://wordpress.org/search/do-search.php" method="get">
			<label for="global-search" class="screen-reader-text">Search WordPress.org for:</label>
			<input id="global-search" class="text" name="search" type="text" value="" maxlength="150" placeholder="Search WordPress.org" />
			<button type="submit" class="button"><span class="screen-reader-text">Submit</span></button>
		</form>
		</div>
				<div style="clear:both"></div>
		<button id="mobile-menu-button" aria-expanded="false"><span class="screen-reader-text">Toggle Menu</span></button>
		
<nav aria-label="Main Menu">
<ul id="wporg-header-menu">
<li class="menu-item"><a href='http://wordpress.org/showcase/' data-title='See some of the sites built on WordPress.'>Showcase</a></li>
<li class="menu-item"><a href='http://learn.wordpress.org/' data-title='Resources to help you learn more about WordPress and teach it to others.'>Learn</a></li>
<li class="menu-item"><a href='http://wordpress.org/themes/' data-title='Find just the right look for your website.'>Themes</a></li>
<li class="menu-item"><a href='http://wordpress.org/plugins/' data-title='Plugins can extend WordPress to do almost anything you can imagine.'>Plugins</a></li>
<li class="menu-item"><a href='http://wordpress.org/mobile/' data-title='Take your website on the go!'>Mobile</a></li>
<li class="menu-item"><a href='http://wordpress.org/support/' data-title='Forums, documentation, help.'>Support</a><ul class="nav-submenu"><li><a href='http://wordpress.org/support/' title='Documentation, tutorials, best practices.'>Documentation</a></li><li><a href='http://wordpress.org/support/forums/' title='Support and discussion forums.'>Forums</a></li></ul><div class="uparrow"></div></li>
<li class="menu-item"><a href='http://make.wordpress.org/' data-title='Contribute your knowledge.'>Get Involved</a><ul class="nav-submenu"><li><a href='http://wordpress.org/five-for-the-future/' title='How five percent is powering the next generation of the web'>Five for the Future</a></li></ul><div class="uparrow"></div></li>
<li class="menu-item"><a href='http://wordpress.org/about/' data-title='About the WordPress Organization, and where we&#039;re going.'>About</a></li>
<li class="menu-item"><a href='http://wordpress.org/news/' data-title='Come here for the latest scoop.'>Blog</a></li>
<li class="menu-item"><a href='http://wordpress.org/hosting/' data-title='Find a home for your blog.'>Hosting</a></li>
<li id="download" class="button download-button menu-item"><a href='http://wordpress.org/download/' data-title='Get it. Got it? Good.'>Get WordPress</a></li>
</ul>
</nav>
		<div style="clear:both"></div>
	</div>
</div>



<header id="masthead" class="site-header" role="banner">
		<div class="site-branding">
		<h1 class="site-title">
			<a href="../../index.html" rel="home">Code Reference</a>
		</h1>

		
		<nav id="site-navigation" class="main-navigation" role="navigation">
			<button class="menu-toggle dashicons dashicons-arrow-down-alt2" aria-controls="primary-menu" aria-expanded="false" aria-label="Primary Menu"></button>
					</nav>
	</div>
</header><!-- #masthead -->

<div id="page" class="hfeed site devhub-wrap">
	<a href="#main" class="screen-reader-text">Skip to content</a>

				<div id="inner-search">
			<div class="search-section section clear hide-if-js">


	
	<form role="search" method="get" class="searchform searchform-filtered" action="https://developer.wordpress.org/">
		<label for="search-field" class="screen-reader-text">Search for:</label>
		<input type="text" id="search-field" class="search-field" placeholder="Search &hellip;" value="" name="s">
		<button class="button button-primary button-search"><i class="dashicons dashicons-search"></i><span class="screen-reader-text">Search plugins</span></button>
	
		<div class="search-post-type">
			<span>Filter by type:</span>
									<label><input type="checkbox" name="post_type[]" value="wp-parser-function"
						 /> Functions</label>
									<label><input type="checkbox" name="post_type[]" value="wp-parser-hook"
						 /> Hooks</label>
									<label><input type="checkbox" name="post_type[]" value="wp-parser-class"
						 /> Classes</label>
									<label><input type="checkbox" name="post_type[]" value="wp-parser-method"
						 /> Methods</label>
					</div>

	
	</form>

</div><!-- /search-guide -->
			<div id="inner-search-icon-container">
				<div id="inner-search-icon">
					<div class="dashicons dashicons-search"><span class="screen-reader-text">Search</span></div>
				</div>
			</div>
		</div>

		<div id="content" class="site-content">

	<div id="content-area" class="wp-parser-class-template-default single single-wp-parser-class postid-1028 admin-bar no-customize-support code-reference">

		
		<div class="breadcrumb-trail breadcrumbs" itemprop="breadcrumb">
			<span class="trail-browse">Browse:</span> 
			<span class="trail-begin"><a href="../../../index.html" title="WordPress Developer Resources" rel="home">Home</a></span> <span class="sep">&#47;</span> 
			<span class="trail-inner"><a href="../../index.html" title="Reference">Reference</a></span> <span class="sep">&#47;</span> 
			<span class="trail-inner"><a href="../index.html">Classes</a></span> <span class="sep">&#47;</span> <span class="trail-end">WP_Rewrite</span>
		</div>
		<main id="main" class="site-main" role="main">

		
			
<article id="post-1028" class="post-1028 wp-parser-class type-wp-parser-class status-publish hentry wp-parser-source-file-wp-includes_class-wp-rewrite-php wp-parser-package-rewrite wp-parser-package-wordpress wp-parser-since-1-5-0">

	
	
	<h1>WP_Rewrite</h1>

	<section class="summary">
		<p>Core class used to implement a rewrite component API.</p>
	</section>


	
	<div class="content-toc"><style> .toc-jump { text-align: right; font-size: 12px; } .page .toc-heading { margin-top: -50px; padding-top: 50px !important; }</style><div class="table-of-contents"><h2>Contents</h2><ul class="items"><li><a href="#description">Description</a></li>
<li><a href="#more-information">More Information</a></li>
<li><a href="#role-of-wp_rewrite"><span id="Role_of_WP_Rewrite" class="mw-headline">Role of <a href="index.html">WP_Rewrite</a></span></a></li>
<li><a href="#properties"><span id="Methods_and_Properties" class="mw-headline">Properties</span></a></li>
<li><a href="#plugin-hooks"><span id="Plugin_Hooks" class="mw-headline">Plugin Hooks</span></a></li>
<li><a href="#source">Source</a></li>
<li><a href="#methods">Methods</a></li>
<li><a href="#changelog">Changelog</a></li>
<li><a href="#user-contributed-notes">User Contributed Notes</a></ul>
</div>

<hr />
<section class="description">
	<h2 class="toc-heading" id="description" tabindex="-1">Description <a href="#description" class="anchor"><span aria-hidden="true">#</span><span class="screen-reader-text">Description</span></a></h2>
	<p>The WordPress Rewrite class writes the rewrite module rules to the .htaccess file. It also handles parsing the request to get the correct setup for the WordPress Query class.</p>
<p>The Rewrite along with WP class function as a front controller for WordPress. You can add rules to trigger your page view and processing using this component. The full functionality of a front controller does not exist, meaning you can&#8217;t define how the template files load based on the rewrite rules.</p>

	</section>

	<hr />
	<section class="explanation">
		<p class="toc-jump"><a href="#top">Top &uarr;</a></p><h2 class="toc-heading" id="more-information" tabindex="-1">More Information <a href="#more-information" class="anchor"><span aria-hidden="true">#</span><span class="screen-reader-text">More Information</span></a></h2>

		<p>This document assumes familiarity with <a class="external text" href="http://httpd.apache.org/" rel="nofollow">Apache</a>&#8216;s <a class="external text" href="http://httpd.apache.org/docs/2.0/mod/mod_rewrite.html" rel="nofollow">mod_rewrite</a>. If you&#8217;ve never heard of this before, try reading Sitepoint&#8217;s <a class="external text" href="http://www.sitepoint.com/article/guide-url-rewriting" rel="nofollow">Beginner&#8217;s Guide to URL Rewriting</a>. Also see Otto&#8217;s explanation of <a class="external text" href="http://lists.automattic.com/pipermail/wp-testers/2009-January/011110.html" rel="nofollow">hierarchy of rewrite rules</a> in the wp-hackers email list.</p>
<div id="toc" class="toc">
<div id="toctitle"></div>
</div>
<p class="toc-jump"><a href="#top">Top &uarr;</a></p><h2 class="toc-heading" id="role-of-wp_rewrite" tabindex="-1"><span id="Role_of_WP_Rewrite" class="mw-headline">Role of <a href="index.html">WP_Rewrite</a></span> <a href="#role-of-wp_rewrite" class="anchor"><span aria-hidden="true">#</span><span class="screen-reader-text"><span id="Role_of_WP_Rewrite" class="mw-headline">Role of <a href="index.html">WP_Rewrite</a></span></span></a></h2>
<p><tt><a href="index.html">WP_Rewrite</a></tt> is WordPress&#8217; class for managing the rewrite rules that allow you to use <a title="Introduction to Blogging" href="https://wordpress.org/support/article/introduction-to-blogging/">Pretty Permalinks</a> feature. It has several methods that generate the rewrite rules from values in the database. It is used internally when updating the rewrite rules, and also to find the URL of a specific post, Page, category archive, etc.. It&#8217;s defined in <tt>wp-includes/rewrite.php</tt> as a single instance global variable, <tt>$wp_rewrite</tt>, is initialised in <tt>wp-settings.php</tt>.</p>
<p class="toc-jump"><a href="#top">Top &uarr;</a></p><h2 class="toc-heading" id="properties" tabindex="-1"><span id="Methods_and_Properties" class="mw-headline">Properties</span> <a href="#properties" class="anchor"><span aria-hidden="true">#</span><span class="screen-reader-text"><span id="Methods_and_Properties" class="mw-headline">Properties</span></span></a></h2>
<p>Try not to access or set the properties directly, instead use the methods to interact with the <tt>$wp_rewrite</tt> object. See also <a title="Rewrite API" href="../../../../codex.wordpress.org/Rewrite_API.html">Rewrite_API</a>.</p>
<dl>
<dt><tt>$permalink_structure</tt></dt>
<dd>The permalink structure as in the database. This is what you set on the Permalink Options page, and includes &#8216;tags&#8217; like %year%, %month% and %post_id%.</dd>
<dt><tt>$category_base</tt></dt>
<dd>Anything to be inserted before category archive URLs. Defaults to &#8216;category/&#8217;.</dd>
<dt><tt>$category_structure</tt></dt>
<dd>Structure for category archive URLs. This is just the <tt>$category_base</tt> plus &#8216;%category%&#8217;.</dd>
<dt><tt>$author_base</tt></dt>
<dd>Anything to be inserted before author archive URLs. Defaults to &#8216;author/&#8217;.</dd>
<dt><tt>$author_structure</tt></dt>
<dd>Structure for author archive URLs. This is just the <tt>$author_base</tt> plus &#8216;%author%&#8217;.</dd>
<dt><tt>$pagination_base</tt></dt>
<dd>Anything to be inserted before pagination indices. Defaults to &#8216;page/&#8217;.</dd>
<dt><tt>$feeds</tt></dt>
<dd>Supported feeds names (rdf, rss, atom) Use <a title="Rewrite API/add feed" href="../../functions/add_feed/index.html">add_feed</a> to override or add.</dd>
<dt><tt>$feed_base</tt></dt>
<dd>Anything to be inserted before feed URLs. Defaults to &#8216;feed/&#8217;.</dd>
<dt><tt>$feed_structure</tt></dt>
<dd>Structure for feed URLs. This is just the <tt>$feed_base</tt> plus &#8216;%feed%&#8217;.</dd>
<dt><tt>$search_base</tt></dt>
<dd>Anything to be inserted before searches. Defaults to &#8216;search/&#8217;.</dd>
<dt><tt>$search_structure</tt></dt>
<dd>Structure for search URLs. This is just the <tt>$search_base</tt> plus &#8216;%search%&#8217;.</dd>
<dt><tt>$comments_base</tt></dt>
<dd>Anything to be inserted just before the <tt>$feed_structure</tt> to get the latest comments feed. Defaults to &#8216;comments&#8217;.</dd>
<dt><tt>$comments_feed_structure</tt></dt>
<dd>The structure for the latest comments feed. This is just <tt>$comments_base</tt> plus <tt>$feed_base</tt> plus &#8216;%feed%&#8217;.</dd>
<dt><tt>$date_structure</tt></dt>
<dd>Structure for dated archive URLs. Tries to be &#8216;%year%/%monthnum%/%day%&#8217;, &#8216;%day%/%monthnum%/%year%&#8217; or &#8216;%monthnum%/%day%/%year%&#8217;, but if none of these are detected in your <tt>$permalink_structure</tt>, defaults to &#8216;%year%/%monthnum%/%day%&#8217;. Various functions use this structure to obtain less specific structures: for example, <tt>get_year_permastruct()</tt> simply removes the &#8216;%monthnum%&#8217; and &#8216;%day%&#8217; tags from <tt>$date_structure</tt>.</dd>
<dt><tt>$page_structure</tt></dt>
<dd>Structure for Pages. Just &#8216;%pagename%&#8217;.</dd>
<dt><tt>$front</tt></dt>
<dd>Anything up to the start of the first tag in your <tt>$permalink_structure</tt>.</dd>
<dt><tt>$root</tt></dt>
<dd>The root of your WordPress install. Prepended to all structures.</dd>
<dt><tt>$matches</tt></dt>
<dd>Used internally when calculating back references for the redirect part of the rewrite rules.</dd>
<dt><tt>$rules</tt></dt>
<dd>The rewrite rules. Set when <tt>rewrite_rules()</tt> is called.</dd>
<dt><tt>$non_wp_rules</tt></dt>
<dd>Associative array of &#8220;rules that don&#8217;t redirect to WP&#8217;s index.php (and thus shouldn&#8217;t be handled by WP at all)&#8221; roughly in the form <code>'Pattern' =&gt; 'Substitution'</code> (see below).</dd>
<dt><tt>$rewritecode</tt></dt>
<dd>An array of all the tags available for the permalink structure. See <a title="Using Permalinks" href="https://wordpress.org/support/article/using-permalinks/">Using Permalinks</a> for a list.</dd>
<dt><tt>$rewritereplace</tt></dt>
<dd>What each tag will be replaced with for the regex part of the rewrite rule. The first element in <tt>$rewritereplace</tt> is the regex for the first element in <tt>$rewritecode</tt>, the second corresponds to the second, and so on.</dd>
<dt><tt>$queryreplace</tt></dt>
<dd>What each tag will be replaced with in the rewrite part of the rewrite rule. The same correspondance applies here as with <tt>$rewritereplace</tt>.</dd>
</dl>
<dl>
<dd></dd>
</dl>
<p class="toc-jump"><a href="#top">Top &uarr;</a></p><h2 class="toc-heading" id="plugin-hooks" tabindex="-1"><span id="Plugin_Hooks" class="mw-headline">Plugin Hooks</span> <a href="#plugin-hooks" class="anchor"><span aria-hidden="true">#</span><span class="screen-reader-text"><span id="Plugin_Hooks" class="mw-headline">Plugin Hooks</span></span></a></h2>
<p>As the rewrite rules are a crucial part of your website&#8217;s functionality, WordPress allows plugins to hook into the generation process at several points. <tt>rewrite_rules()</tt>, specifically, contains nine filters and one hook for really precise control over the rewrite rules process. Here&#8217;s what you can filter in <tt>rewrite_rules()</tt>:</p>
<ul>
<li><tt><a title="Plugin API/Filter Reference/post rewrite rules" href="../../hooks/post_rewrite_rules/index.html">post_rewrite_rules</a></tt> &#8211; Used to filter the rewrite rules generated for permalink URLs.</li>
<li><tt><a title="Plugin API/Filter Reference/date rewrite rules" href="../../hooks/date_rewrite_rules/index.html">date_rewrite_rules</a></tt> &#8211; Used to filter the rewrite rules generated for dated archive URLs.</li>
<li><tt><a title="Plugin API/Filter Reference/$permastruct rewrite rules" href="../../hooks/permastructname_rewrite_rules/index.html">{$permastruct}_rewrite_rules</a></tt> &#8211; Can be used to filter permastructs like &#8216;category&#8217; or other taxonomies.</li>
<li><tt><a title="Plugin API/Filter Reference/search rewrite rules" href="../../hooks/search_rewrite_rules/index.html">search_rewrite_rules</a></tt> &#8211; Used to filter the rewrite rules generated for search URLs.</li>
<li><tt><a title="Plugin API/Filter Reference/comments rewrite rules" href="../../hooks/comments_rewrite_rules/index.html">comments_rewrite_rules</a></tt> &#8211; Used to filter the rewrite rules generated for the latest comment feed URLs.</li>
<li><tt><a title="Plugin API/Filter Reference/author rewrite rules" href="../../hooks/author_rewrite_rules/index.html">author_rewrite_rules</a></tt> &#8211; Used to filter the rewrite rules generated for author archive URLs.</li>
<li><tt><a title="Plugin API/Filter Reference/page rewrite rules" href="../../hooks/page_rewrite_rules/index.html">page_rewrite_rules</a></tt> &#8211; Used to filter the rewrite rules generated for your Pages.</li>
<li><tt><a title="Plugin API/Filter Reference/root rewrite rules" href="../../hooks/root_rewrite_rules/index.html">root_rewrite_rules</a></tt> &#8211; Used to filter the rewrite rules generated for the root of your weblog.</li>
<li><tt><a title="Plugin API/Filter Reference/rewrite rules array" href="../../hooks/rewrite_rules_array/index.html">rewrite_rules_array</a></tt> &#8211; Use to filter <i>all</i> the rewrite rules at once.</li>
<li><tt><a title="Plugin API/Action Reference/generate rewrite rules" href="../../hooks/generate_rewrite_rules/index.html">generate_rewrite_rules</a></tt> &#8211; This action hook runs <strong>after</strong> all the rules have been created. If your function takes a parameter, it will be passed a <a class="external text" href="http://www.php.net/manual/en/language.references.php" rel="nofollow">reference</a> to the entire <tt>$wp_rewrite</tt> object.</li>
</ul>
<p><tt>mod_rewrite_rules()</tt> is the function that takes the array generated by <tt>rewrite_rules()</tt> and actually turns it into a set of rewrite rules for the .htaccess file. This function also has a filter, <tt>mod_rewrite_rules</tt>, which will pass functions the string of all the rules to be written out to .htaccess, including the <tt>&lt;IfModule&gt;</tt> surrounding section. (Note: you may also see plugins using the <tt>rewrite_rules</tt> hook, but this is deprecated).</p>
	</section>
	<hr />
	<section class="source-content">
		<p class="toc-jump"><a href="#top">Top &uarr;</a></p><h2 class="toc-heading" id="source" tabindex="-1">Source <a href="#source" class="anchor"><span aria-hidden="true">#</span><span class="screen-reader-text">Source</span></a></h2>
		<p>
			File: <a href="../../files/wp-includes/class-wp-rewrite.php/index.html">wp-includes/class-wp-rewrite.php</a>		</p>

					<div class="source-code-container">
				<pre class="brush: php; toolbar: false; first-line: 25">class WP_Rewrite {
	/**
	 * Permalink structure for posts.
	 *
	 * @since 1.5.0
	 * @var string
	 */
	public $permalink_structure;

	/**
	 * Whether to add trailing slashes.
	 *
	 * @since 2.2.0
	 * @var bool
	 */
	public $use_trailing_slashes;

	/**
	 * Base for the author permalink structure (example.com/$author_base/authorname).
	 *
	 * @since 1.5.0
	 * @var string
	 */
	public $author_base = 'author';

	/**
	 * Permalink structure for author archives.
	 *
	 * @since 1.5.0
	 * @var string
	 */
	public $author_structure;

	/**
	 * Permalink structure for date archives.
	 *
	 * @since 1.5.0
	 * @var string
	 */
	public $date_structure;

	/**
	 * Permalink structure for pages.
	 *
	 * @since 1.5.0
	 * @var string
	 */
	public $page_structure;

	/**
	 * Base of the search permalink structure (example.com/$search_base/query).
	 *
	 * @since 1.5.0
	 * @var string
	 */
	public $search_base = 'search';

	/**
	 * Permalink structure for searches.
	 *
	 * @since 1.5.0
	 * @var string
	 */
	public $search_structure;

	/**
	 * Comments permalink base.
	 *
	 * @since 1.5.0
	 * @var string
	 */
	public $comments_base = 'comments';

	/**
	 * Pagination permalink base.
	 *
	 * @since 3.1.0
	 * @var string
	 */
	public $pagination_base = 'page';

	/**
	 * Comments pagination permalink base.
	 *
	 * @since 4.2.0
	 * @var string
	 */
	public $comments_pagination_base = 'comment-page';

	/**
	 * Feed permalink base.
	 *
	 * @since 1.5.0
	 * @var string
	 */
	public $feed_base = 'feed';

	/**
	 * Comments feed permalink structure.
	 *
	 * @since 1.5.0
	 * @var string
	 */
	public $comment_feed_structure;

	/**
	 * Feed request permalink structure.
	 *
	 * @since 1.5.0
	 * @var string
	 */
	public $feed_structure;

	/**
	 * The static portion of the post permalink structure.
	 *
	 * If the permalink structure is &quot;/archive/%post_id%&quot; then the front
	 * is &quot;/archive/&quot;. If the permalink structure is &quot;/%year%/%postname%/&quot;
	 * then the front is &quot;/&quot;.
	 *
	 * @since 1.5.0
	 * @var string
	 *
	 * @see WP_Rewrite::init()
	 */
	public $front;

	/**
	 * The prefix for all permalink structures.
	 *
	 * If PATHINFO/index permalinks are in use then the root is the value of
	 * `WP_Rewrite::$index` with a trailing slash appended. Otherwise the root
	 * will be empty.
	 *
	 * @since 1.5.0
	 * @var string
	 *
	 * @see WP_Rewrite::init()
	 * @see WP_Rewrite::using_index_permalinks()
	 */
	public $root = '';

	/**
	 * The name of the index file which is the entry point to all requests.
	 *
	 * @since 1.5.0
	 * @var string
	 */
	public $index = 'index.php';

	/**
	 * Variable name to use for regex matches in the rewritten query.
	 *
	 * @since 1.5.0
	 * @var string
	 */
	public $matches = '';

	/**
	 * Rewrite rules to match against the request to find the redirect or query.
	 *
	 * @since 1.5.0
	 * @var array
	 */
	public $rules;

	/**
	 * Additional rules added external to the rewrite class.
	 *
	 * Those not generated by the class, see add_rewrite_rule().
	 *
	 * @since 2.1.0
	 * @var array
	 */
	public $extra_rules = array();

	/**
	 * Additional rules that belong at the beginning to match first.
	 *
	 * Those not generated by the class, see add_rewrite_rule().
	 *
	 * @since 2.3.0
	 * @var array
	 */
	public $extra_rules_top = array();

	/**
	 * Rules that don't redirect to WordPress' index.php.
	 *
	 * These rules are written to the mod_rewrite portion of the .htaccess,
	 * and are added by add_external_rule().
	 *
	 * @since 2.1.0
	 * @var array
	 */
	public $non_wp_rules = array();

	/**
	 * Extra permalink structures, e.g. categories, added by add_permastruct().
	 *
	 * @since 2.1.0
	 * @var array
	 */
	public $extra_permastructs = array();

	/**
	 * Endpoints (like /trackback/) added by add_rewrite_endpoint().
	 *
	 * @since 2.1.0
	 * @var array
	 */
	public $endpoints;

	/**
	 * Whether to write every mod_rewrite rule for WordPress into the .htaccess file.
	 *
	 * This is off by default, turning it on might print a lot of rewrite rules
	 * to the .htaccess file.
	 *
	 * @since 2.0.0
	 * @var bool
	 *
	 * @see WP_Rewrite::mod_rewrite_rules()
	 */
	public $use_verbose_rules = false;

	/**
	 * Could post permalinks be confused with those of pages?
	 *
	 * If the first rewrite tag in the post permalink structure is one that could
	 * also match a page name (e.g. %postname% or %author%) then this flag is
	 * set to true. Prior to WordPress 3.3 this flag indicated that every page
	 * would have a set of rules added to the top of the rewrite rules array.
	 * Now it tells WP::parse_request() to check if a URL matching the page
	 * permastruct is actually a page before accepting it.
	 *
	 * @since 2.5.0
	 * @var bool
	 *
	 * @see WP_Rewrite::init()
	 */
	public $use_verbose_page_rules = true;

	/**
	 * Rewrite tags that can be used in permalink structures.
	 *
	 * These are translated into the regular expressions stored in
	 * `WP_Rewrite::$rewritereplace` and are rewritten to the query
	 * variables listed in WP_Rewrite::$queryreplace.
	 *
	 * Additional tags can be added with add_rewrite_tag().
	 *
	 * @since 1.5.0
	 * @var array
	 */
	public $rewritecode = array(
		'%year%',
		'%monthnum%',
		'%day%',
		'%hour%',
		'%minute%',
		'%second%',
		'%postname%',
		'%post_id%',
		'%author%',
		'%pagename%',
		'%search%',
	);

	/**
	 * Regular expressions to be substituted into rewrite rules in place
	 * of rewrite tags, see WP_Rewrite::$rewritecode.
	 *
	 * @since 1.5.0
	 * @var array
	 */
	public $rewritereplace = array(
		'([0-9]{4})',
		'([0-9]{1,2})',
		'([0-9]{1,2})',
		'([0-9]{1,2})',
		'([0-9]{1,2})',
		'([0-9]{1,2})',
		'([^/]+)',
		'([0-9]+)',
		'([^/]+)',
		'([^/]+?)',
		'(.+)',
	);

	/**
	 * Query variables that rewrite tags map to, see WP_Rewrite::$rewritecode.
	 *
	 * @since 1.5.0
	 * @var array
	 */
	public $queryreplace = array(
		'year=',
		'monthnum=',
		'day=',
		'hour=',
		'minute=',
		'second=',
		'name=',
		'p=',
		'author_name=',
		'pagename=',
		's=',
	);

	/**
	 * Supported default feeds.
	 *
	 * @since 1.5.0
	 * @var array
	 */
	public $feeds = array( 'feed', 'rdf', 'rss', 'rss2', 'atom' );

	/**
	 * Determines whether permalinks are being used.
	 *
	 * This can be either rewrite module or permalink in the HTTP query string.
	 *
	 * @since 1.5.0
	 *
	 * @return bool True, if permalinks are enabled.
	 */
	public function using_permalinks() {
		return ! empty( $this-&gt;permalink_structure );
	}

	/**
	 * Determines whether permalinks are being used and rewrite module is not enabled.
	 *
	 * Means that permalink links are enabled and index.php is in the URL.
	 *
	 * @since 1.5.0
	 *
	 * @return bool Whether permalink links are enabled and index.php is in the URL.
	 */
	public function using_index_permalinks() {
		if ( empty( $this-&gt;permalink_structure ) ) {
			return false;
		}

		// If the index is not in the permalink, we're using mod_rewrite.
		return preg_match( '#^/*' . $this-&gt;index . '#', $this-&gt;permalink_structure );
	}

	/**
	 * Determines whether permalinks are being used and rewrite module is enabled.
	 *
	 * Using permalinks and index.php is not in the URL.
	 *
	 * @since 1.5.0
	 *
	 * @return bool Whether permalink links are enabled and index.php is NOT in the URL.
	 */
	public function using_mod_rewrite_permalinks() {
		return $this-&gt;using_permalinks() &amp;&amp; ! $this-&gt;using_index_permalinks();
	}

	/**
	 * Indexes for matches for usage in preg_*() functions.
	 *
	 * The format of the string is, with empty matches property value, '$NUM'.
	 * The 'NUM' will be replaced with the value in the $number parameter. With
	 * the matches property not empty, the value of the returned string will
	 * contain that value of the matches property. The format then will be
	 * '$MATCHES[NUM]', with MATCHES as the value in the property and NUM the
	 * value of the $number parameter.
	 *
	 * @since 1.5.0
	 *
	 * @param int $number Index number.
	 * @return string
	 */
	public function preg_index( $number ) {
		$match_prefix = '$';
		$match_suffix = '';

		if ( ! empty( $this-&gt;matches ) ) {
			$match_prefix = '$' . $this-&gt;matches . '[';
			$match_suffix = ']';
		}

		return &quot;$match_prefix$number$match_suffix&quot;;
	}

	/**
	 * Retrieves all page and attachments for pages URIs.
	 *
	 * The attachments are for those that have pages as parents and will be
	 * retrieved.
	 *
	 * @since 2.5.0
	 *
	 * @global wpdb $wpdb WordPress database abstraction object.
	 *
	 * @return array Array of page URIs as first element and attachment URIs as second element.
	 */
	public function page_uri_index() {
		global $wpdb;

		// Get pages in order of hierarchy, i.e. children after parents.
		$pages = $wpdb-&gt;get_results( &quot;SELECT ID, post_name, post_parent FROM $wpdb-&gt;posts WHERE post_type = 'page' AND post_status != 'auto-draft'&quot; );
		$posts = get_page_hierarchy( $pages );

		// If we have no pages get out quick.
		if ( ! $posts ) {
			return array( array(), array() );
		}

		// Now reverse it, because we need parents after children for rewrite rules to work properly.
		$posts = array_reverse( $posts, true );

		$page_uris            = array();
		$page_attachment_uris = array();

		foreach ( $posts as $id =&gt; $post ) {
			// URL =&gt; page name.
			$uri         = get_page_uri( $id );
			$attachments = $wpdb-&gt;get_results( $wpdb-&gt;prepare( &quot;SELECT ID, post_name, post_parent FROM $wpdb-&gt;posts WHERE post_type = 'attachment' AND post_parent = %d&quot;, $id ) );
			if ( ! empty( $attachments ) ) {
				foreach ( $attachments as $attachment ) {
					$attach_uri                          = get_page_uri( $attachment-&gt;ID );
					$page_attachment_uris[ $attach_uri ] = $attachment-&gt;ID;
				}
			}

			$page_uris[ $uri ] = $id;
		}

		return array( $page_uris, $page_attachment_uris );
	}

	/**
	 * Retrieves all of the rewrite rules for pages.
	 *
	 * @since 1.5.0
	 *
	 * @return string[] Page rewrite rules.
	 */
	public function page_rewrite_rules() {
		// The extra .? at the beginning prevents clashes with other regular expressions in the rules array.
		$this-&gt;add_rewrite_tag( '%pagename%', '(.?.+?)', 'pagename=' );

		return $this-&gt;generate_rewrite_rules( $this-&gt;get_page_permastruct(), EP_PAGES, true, true, false, false );
	}

	/**
	 * Retrieves date permalink structure, with year, month, and day.
	 *
	 * The permalink structure for the date, if not set already depends on the
	 * permalink structure. It can be one of three formats. The first is year,
	 * month, day; the second is day, month, year; and the last format is month,
	 * day, year. These are matched against the permalink structure for which
	 * one is used. If none matches, then the default will be used, which is
	 * year, month, day.
	 *
	 * Prevents post ID and date permalinks from overlapping. In the case of
	 * post_id, the date permalink will be prepended with front permalink with
	 * 'date/' before the actual permalink to form the complete date permalink
	 * structure.
	 *
	 * @since 1.5.0
	 *
	 * @return string|false Date permalink structure on success, false on failure.
	 */
	public function get_date_permastruct() {
		if ( isset( $this-&gt;date_structure ) ) {
			return $this-&gt;date_structure;
		}

		if ( empty( $this-&gt;permalink_structure ) ) {
			$this-&gt;date_structure = '';
			return false;
		}

		// The date permalink must have year, month, and day separated by slashes.
		$endians = array( '%year%/%monthnum%/%day%', '%day%/%monthnum%/%year%', '%monthnum%/%day%/%year%' );

		$this-&gt;date_structure = '';
		$date_endian          = '';

		foreach ( $endians as $endian ) {
			if ( false !== strpos( $this-&gt;permalink_structure, $endian ) ) {
				$date_endian = $endian;
				break;
			}
		}

		if ( empty( $date_endian ) ) {
			$date_endian = '%year%/%monthnum%/%day%';
		}

		/*
		 * Do not allow the date tags and %post_id% to overlap in the permalink
		 * structure. If they do, move the date tags to $front/date/.
		 */
		$front = $this-&gt;front;
		preg_match_all( '/%.+?%/', $this-&gt;permalink_structure, $tokens );
		$tok_index = 1;
		foreach ( (array) $tokens[0] as $token ) {
			if ( '%post_id%' === $token &amp;&amp; ( $tok_index &lt;= 3 ) ) {
				$front = $front . 'date/';
				break;
			}
			$tok_index++;
		}

		$this-&gt;date_structure = $front . $date_endian;

		return $this-&gt;date_structure;
	}

	/**
	 * Retrieves the year permalink structure without month and day.
	 *
	 * Gets the date permalink structure and strips out the month and day
	 * permalink structures.
	 *
	 * @since 1.5.0
	 *
	 * @return string|false Year permalink structure on success, false on failure.
	 */
	public function get_year_permastruct() {
		$structure = $this-&gt;get_date_permastruct();

		if ( empty( $structure ) ) {
			return false;
		}

		$structure = str_replace( '%monthnum%', '', $structure );
		$structure = str_replace( '%day%', '', $structure );
		$structure = preg_replace( '#/+#', '/', $structure );

		return $structure;
	}

	/**
	 * Retrieves the month permalink structure without day and with year.
	 *
	 * Gets the date permalink structure and strips out the day permalink
	 * structures. Keeps the year permalink structure.
	 *
	 * @since 1.5.0
	 *
	 * @return string|false Year/Month permalink structure on success, false on failure.
	 */
	public function get_month_permastruct() {
		$structure = $this-&gt;get_date_permastruct();

		if ( empty( $structure ) ) {
			return false;
		}

		$structure = str_replace( '%day%', '', $structure );
		$structure = preg_replace( '#/+#', '/', $structure );

		return $structure;
	}

	/**
	 * Retrieves the day permalink structure with month and year.
	 *
	 * Keeps date permalink structure with all year, month, and day.
	 *
	 * @since 1.5.0
	 *
	 * @return string|false Year/Month/Day permalink structure on success, false on failure.
	 */
	public function get_day_permastruct() {
		return $this-&gt;get_date_permastruct();
	}

	/**
	 * Retrieves the permalink structure for categories.
	 *
	 * If the category_base property has no value, then the category structure
	 * will have the front property value, followed by 'category', and finally
	 * '%category%'. If it does, then the root property will be used, along with
	 * the category_base property value.
	 *
	 * @since 1.5.0
	 *
	 * @return string|false Category permalink structure on success, false on failure.
	 */
	public function get_category_permastruct() {
		return $this-&gt;get_extra_permastruct( 'category' );
	}

	/**
	 * Retrieve the permalink structure for tags.
	 *
	 * If the tag_base property has no value, then the tag structure will have
	 * the front property value, followed by 'tag', and finally '%tag%'. If it
	 * does, then the root property will be used, along with the tag_base
	 * property value.
	 *
	 * @since 2.3.0
	 *
	 * @return string|false Tag permalink structure on success, false on failure.
	 */
	public function get_tag_permastruct() {
		return $this-&gt;get_extra_permastruct( 'post_tag' );
	}

	/**
	 * Retrieves an extra permalink structure by name.
	 *
	 * @since 2.5.0
	 *
	 * @param string $name Permalink structure name.
	 * @return string|false Permalink structure string on success, false on failure.
	 */
	public function get_extra_permastruct( $name ) {
		if ( empty( $this-&gt;permalink_structure ) ) {
			return false;
		}

		if ( isset( $this-&gt;extra_permastructs[ $name ] ) ) {
			return $this-&gt;extra_permastructs[ $name ]['struct'];
		}

		return false;
	}

	/**
	 * Retrieves the author permalink structure.
	 *
	 * The permalink structure is front property, author base, and finally
	 * '/%author%'. Will set the author_structure property and then return it
	 * without attempting to set the value again.
	 *
	 * @since 1.5.0
	 *
	 * @return string|false Author permalink structure on success, false on failure.
	 */
	public function get_author_permastruct() {
		if ( isset( $this-&gt;author_structure ) ) {
			return $this-&gt;author_structure;
		}

		if ( empty( $this-&gt;permalink_structure ) ) {
			$this-&gt;author_structure = '';
			return false;
		}

		$this-&gt;author_structure = $this-&gt;front . $this-&gt;author_base . '/%author%';

		return $this-&gt;author_structure;
	}

	/**
	 * Retrieves the search permalink structure.
	 *
	 * The permalink structure is root property, search base, and finally
	 * '/%search%'. Will set the search_structure property and then return it
	 * without attempting to set the value again.
	 *
	 * @since 1.5.0
	 *
	 * @return string|false Search permalink structure on success, false on failure.
	 */
	public function get_search_permastruct() {
		if ( isset( $this-&gt;search_structure ) ) {
			return $this-&gt;search_structure;
		}

		if ( empty( $this-&gt;permalink_structure ) ) {
			$this-&gt;search_structure = '';
			return false;
		}

		$this-&gt;search_structure = $this-&gt;root . $this-&gt;search_base . '/%search%';

		return $this-&gt;search_structure;
	}

	/**
	 * Retrieves the page permalink structure.
	 *
	 * The permalink structure is root property, and '%pagename%'. Will set the
	 * page_structure property and then return it without attempting to set the
	 * value again.
	 *
	 * @since 1.5.0
	 *
	 * @return string|false Page permalink structure on success, false on failure.
	 */
	public function get_page_permastruct() {
		if ( isset( $this-&gt;page_structure ) ) {
			return $this-&gt;page_structure;
		}

		if ( empty( $this-&gt;permalink_structure ) ) {
			$this-&gt;page_structure = '';
			return false;
		}

		$this-&gt;page_structure = $this-&gt;root . '%pagename%';

		return $this-&gt;page_structure;
	}

	/**
	 * Retrieves the feed permalink structure.
	 *
	 * The permalink structure is root property, feed base, and finally
	 * '/%feed%'. Will set the feed_structure property and then return it
	 * without attempting to set the value again.
	 *
	 * @since 1.5.0
	 *
	 * @return string|false Feed permalink structure on success, false on failure.
	 */
	public function get_feed_permastruct() {
		if ( isset( $this-&gt;feed_structure ) ) {
			return $this-&gt;feed_structure;
		}

		if ( empty( $this-&gt;permalink_structure ) ) {
			$this-&gt;feed_structure = '';
			return false;
		}

		$this-&gt;feed_structure = $this-&gt;root . $this-&gt;feed_base . '/%feed%';

		return $this-&gt;feed_structure;
	}

	/**
	 * Retrieves the comment feed permalink structure.
	 *
	 * The permalink structure is root property, comment base property, feed
	 * base and finally '/%feed%'. Will set the comment_feed_structure property
	 * and then return it without attempting to set the value again.
	 *
	 * @since 1.5.0
	 *
	 * @return string|false Comment feed permalink structure on success, false on failure.
	 */
	public function get_comment_feed_permastruct() {
		if ( isset( $this-&gt;comment_feed_structure ) ) {
			return $this-&gt;comment_feed_structure;
		}

		if ( empty( $this-&gt;permalink_structure ) ) {
			$this-&gt;comment_feed_structure = '';
			return false;
		}

		$this-&gt;comment_feed_structure = $this-&gt;root . $this-&gt;comments_base . '/' . $this-&gt;feed_base . '/%feed%';

		return $this-&gt;comment_feed_structure;
	}

	/**
	 * Adds or updates existing rewrite tags (e.g. %postname%).
	 *
	 * If the tag already exists, replace the existing pattern and query for
	 * that tag, otherwise add the new tag.
	 *
	 * @since 1.5.0
	 *
	 * @see WP_Rewrite::$rewritecode
	 * @see WP_Rewrite::$rewritereplace
	 * @see WP_Rewrite::$queryreplace
	 *
	 * @param string $tag   Name of the rewrite tag to add or update.
	 * @param string $regex Regular expression to substitute the tag for in rewrite rules.
	 * @param string $query String to append to the rewritten query. Must end in '='.
	 */
	public function add_rewrite_tag( $tag, $regex, $query ) {
		$position = array_search( $tag, $this-&gt;rewritecode, true );
		if ( false !== $position &amp;&amp; null !== $position ) {
			$this-&gt;rewritereplace[ $position ] = $regex;
			$this-&gt;queryreplace[ $position ]   = $query;
		} else {
			$this-&gt;rewritecode[]    = $tag;
			$this-&gt;rewritereplace[] = $regex;
			$this-&gt;queryreplace[]   = $query;
		}
	}


	/**
	 * Removes an existing rewrite tag.
	 *
	 * @since 4.5.0
	 *
	 * @see WP_Rewrite::$rewritecode
	 * @see WP_Rewrite::$rewritereplace
	 * @see WP_Rewrite::$queryreplace
	 *
	 * @param string $tag Name of the rewrite tag to remove.
	 */
	public function remove_rewrite_tag( $tag ) {
		$position = array_search( $tag, $this-&gt;rewritecode, true );
		if ( false !== $position &amp;&amp; null !== $position ) {
			unset( $this-&gt;rewritecode[ $position ] );
			unset( $this-&gt;rewritereplace[ $position ] );
			unset( $this-&gt;queryreplace[ $position ] );
		}
	}

	/**
	 * Generates rewrite rules from a permalink structure.
	 *
	 * The main WP_Rewrite function for building the rewrite rule list. The
	 * contents of the function is a mix of black magic and regular expressions,
	 * so best just ignore the contents and move to the parameters.
	 *
	 * @since 1.5.0
	 *
	 * @param string $permalink_structure The permalink structure.
	 * @param int    $ep_mask             Optional. Endpoint mask defining what endpoints are added to the structure.
	 *                                    Accepts a mask of:
	 *                                    - `EP_ALL`
	 *                                    - `EP_NONE`
	 *                                    - `EP_ALL_ARCHIVES`
	 *                                    - `EP_ATTACHMENT`
	 *                                    - `EP_AUTHORS`
	 *                                    - `EP_CATEGORIES`
	 *                                    - `EP_COMMENTS`
	 *                                    - `EP_DATE`
	 *                                    - `EP_DAY`
	 *                                    - `EP_MONTH`
	 *                                    - `EP_PAGES`
	 *                                    - `EP_PERMALINK`
	 *                                    - `EP_ROOT`
	 *                                    - `EP_SEARCH`
	 *                                    - `EP_TAGS`
	 *                                    - `EP_YEAR`
	 *                                    Default `EP_NONE`.
	 * @param bool   $paged               Optional. Whether archive pagination rules should be added for the structure.
	 *                                    Default true.
	 * @param bool   $feed                Optional Whether feed rewrite rules should be added for the structure.
	 *                                    Default true.
	 * @param bool   $forcomments         Optional. Whether the feed rules should be a query for a comments feed.
	 *                                    Default false.
	 * @param bool   $walk_dirs           Optional. Whether the 'directories' making up the structure should be walked
	 *                                    over and rewrite rules built for each in-turn. Default true.
	 * @param bool   $endpoints           Optional. Whether endpoints should be applied to the generated rewrite rules.
	 *                                    Default true.
	 * @return string[] Array of rewrite rules keyed by their regex pattern.
	 */
	public function generate_rewrite_rules( $permalink_structure, $ep_mask = EP_NONE, $paged = true, $feed = true, $forcomments = false, $walk_dirs = true, $endpoints = true ) {
		// Build a regex to match the feed section of URLs, something like (feed|atom|rss|rss2)/?
		$feedregex2 = '';
		foreach ( (array) $this-&gt;feeds as $feed_name ) {
			$feedregex2 .= $feed_name . '|';
		}
		$feedregex2 = '(' . trim( $feedregex2, '|' ) . ')/?$';

		/*
		 * $feedregex is identical but with /feed/ added on as well, so URLs like &lt;permalink&gt;/feed/atom
		 * and &lt;permalink&gt;/atom are both possible
		 */
		$feedregex = $this-&gt;feed_base . '/' . $feedregex2;

		// Build a regex to match the trackback and page/xx parts of URLs.
		$trackbackregex = 'trackback/?$';
		$pageregex      = $this-&gt;pagination_base . '/?([0-9]{1,})/?$';
		$commentregex   = $this-&gt;comments_pagination_base . '-([0-9]{1,})/?$';
		$embedregex     = 'embed/?$';

		// Build up an array of endpoint regexes to append =&gt; queries to append.
		if ( $endpoints ) {
			$ep_query_append = array();
			foreach ( (array) $this-&gt;endpoints as $endpoint ) {
				// Match everything after the endpoint name, but allow for nothing to appear there.
				$epmatch = $endpoint[1] . '(/(.*))?/?$';

				// This will be appended on to the rest of the query for each dir.
				$epquery                     = '&amp;' . $endpoint[2] . '=';
				$ep_query_append[ $epmatch ] = array( $endpoint[0], $epquery );
			}
		}

		// Get everything up to the first rewrite tag.
		$front = substr( $permalink_structure, 0, strpos( $permalink_structure, '%' ) );

		// Build an array of the tags (note that said array ends up being in $tokens[0]).
		preg_match_all( '/%.+?%/', $permalink_structure, $tokens );

		$num_tokens = count( $tokens[0] );

		$index          = $this-&gt;index; // Probably 'index.php'.
		$feedindex      = $index;
		$trackbackindex = $index;
		$embedindex     = $index;

		/*
		 * Build a list from the rewritecode and queryreplace arrays, that will look something
		 * like tagname=$matches[i] where i is the current $i.
		 */
		$queries = array();
		for ( $i = 0; $i &lt; $num_tokens; ++$i ) {
			if ( 0 &lt; $i ) {
				$queries[ $i ] = $queries[ $i - 1 ] . '&amp;';
			} else {
				$queries[ $i ] = '';
			}

			$query_token    = str_replace( $this-&gt;rewritecode, $this-&gt;queryreplace, $tokens[0][ $i ] ) . $this-&gt;preg_index( $i + 1 );
			$queries[ $i ] .= $query_token;
		}

		// Get the structure, minus any cruft (stuff that isn't tags) at the front.
		$structure = $permalink_structure;
		if ( '/' !== $front ) {
			$structure = str_replace( $front, '', $structure );
		}

		/*
		 * Create a list of dirs to walk over, making rewrite rules for each level
		 * so for example, a $structure of /%year%/%monthnum%/%postname% would create
		 * rewrite rules for /%year%/, /%year%/%monthnum%/ and /%year%/%monthnum%/%postname%
		 */
		$structure = trim( $structure, '/' );
		$dirs      = $walk_dirs ? explode( '/', $structure ) : array( $structure );
		$num_dirs  = count( $dirs );

		// Strip slashes from the front of $front.
		$front = preg_replace( '|^/+|', '', $front );

		// The main workhorse loop.
		$post_rewrite = array();
		$struct       = $front;
		for ( $j = 0; $j &lt; $num_dirs; ++$j ) {
			// Get the struct for this dir, and trim slashes off the front.
			$struct .= $dirs[ $j ] . '/'; // Accumulate. see comment near explode('/', $structure) above.
			$struct  = ltrim( $struct, '/' );

			// Replace tags with regexes.
			$match = str_replace( $this-&gt;rewritecode, $this-&gt;rewritereplace, $struct );

			// Make a list of tags, and store how many there are in $num_toks.
			$num_toks = preg_match_all( '/%.+?%/', $struct, $toks );

			// Get the 'tagname=$matches[i]'.
			$query = ( ! empty( $num_toks ) &amp;&amp; isset( $queries[ $num_toks - 1 ] ) ) ? $queries[ $num_toks - 1 ] : '';

			// Set up $ep_mask_specific which is used to match more specific URL types.
			switch ( $dirs[ $j ] ) {
				case '%year%':
					$ep_mask_specific = EP_YEAR;
					break;
				case '%monthnum%':
					$ep_mask_specific = EP_MONTH;
					break;
				case '%day%':
					$ep_mask_specific = EP_DAY;
					break;
				default:
					$ep_mask_specific = EP_NONE;
			}

			// Create query for /page/xx.
			$pagematch = $match . $pageregex;
			$pagequery = $index . '?' . $query . '&amp;paged=' . $this-&gt;preg_index( $num_toks + 1 );

			// Create query for /comment-page-xx.
			$commentmatch = $match . $commentregex;
			$commentquery = $index . '?' . $query . '&amp;cpage=' . $this-&gt;preg_index( $num_toks + 1 );

			if ( get_option( 'page_on_front' ) ) {
				// Create query for Root /comment-page-xx.
				$rootcommentmatch = $match . $commentregex;
				$rootcommentquery = $index . '?' . $query . '&amp;page_id=' . get_option( 'page_on_front' ) . '&amp;cpage=' . $this-&gt;preg_index( $num_toks + 1 );
			}

			// Create query for /feed/(feed|atom|rss|rss2|rdf).
			$feedmatch = $match . $feedregex;
			$feedquery = $feedindex . '?' . $query . '&amp;feed=' . $this-&gt;preg_index( $num_toks + 1 );

			// Create query for /(feed|atom|rss|rss2|rdf) (see comment near creation of $feedregex).
			$feedmatch2 = $match . $feedregex2;
			$feedquery2 = $feedindex . '?' . $query . '&amp;feed=' . $this-&gt;preg_index( $num_toks + 1 );

			// Create query and regex for embeds.
			$embedmatch = $match . $embedregex;
			$embedquery = $embedindex . '?' . $query . '&amp;embed=true';

			// If asked to, turn the feed queries into comment feed ones.
			if ( $forcomments ) {
				$feedquery  .= '&amp;withcomments=1';
				$feedquery2 .= '&amp;withcomments=1';
			}

			// Start creating the array of rewrites for this dir.
			$rewrite = array();

			// ...adding on /feed/ regexes =&gt; queries.
			if ( $feed ) {
				$rewrite = array(
					$feedmatch  =&gt; $feedquery,
					$feedmatch2 =&gt; $feedquery2,
					$embedmatch =&gt; $embedquery,
				);
			}

			// ...and /page/xx ones.
			if ( $paged ) {
				$rewrite = array_merge( $rewrite, array( $pagematch =&gt; $pagequery ) );
			}

			// Only on pages with comments add ../comment-page-xx/.
			if ( EP_PAGES &amp; $ep_mask || EP_PERMALINK &amp; $ep_mask ) {
				$rewrite = array_merge( $rewrite, array( $commentmatch =&gt; $commentquery ) );
			} elseif ( EP_ROOT &amp; $ep_mask &amp;&amp; get_option( 'page_on_front' ) ) {
				$rewrite = array_merge( $rewrite, array( $rootcommentmatch =&gt; $rootcommentquery ) );
			}

			// Do endpoints.
			if ( $endpoints ) {
				foreach ( (array) $ep_query_append as $regex =&gt; $ep ) {
					// Add the endpoints on if the mask fits.
					if ( $ep[0] &amp; $ep_mask || $ep[0] &amp; $ep_mask_specific ) {
						$rewrite[ $match . $regex ] = $index . '?' . $query . $ep[1] . $this-&gt;preg_index( $num_toks + 2 );
					}
				}
			}

			// If we've got some tags in this dir.
			if ( $num_toks ) {
				$post = false;
				$page = false;

				/*
				 * Check to see if this dir is permalink-level: i.e. the structure specifies an
				 * individual post. Do this by checking it contains at least one of 1) post name,
				 * 2) post ID, 3) page name, 4) timestamp (year, month, day, hour, second and
				 * minute all present). Set these flags now as we need them for the endpoints.
				 */
				if ( strpos( $struct, '%postname%' ) !== false
						|| strpos( $struct, '%post_id%' ) !== false
						|| strpos( $struct, '%pagename%' ) !== false
						|| ( strpos( $struct, '%year%' ) !== false &amp;&amp; strpos( $struct, '%monthnum%' ) !== false &amp;&amp; strpos( $struct, '%day%' ) !== false &amp;&amp; strpos( $struct, '%hour%' ) !== false &amp;&amp; strpos( $struct, '%minute%' ) !== false &amp;&amp; strpos( $struct, '%second%' ) !== false )
						) {
					$post = true;
					if ( strpos( $struct, '%pagename%' ) !== false ) {
						$page = true;
					}
				}

				if ( ! $post ) {
					// For custom post types, we need to add on endpoints as well.
					foreach ( get_post_types( array( '_builtin' =&gt; false ) ) as $ptype ) {
						if ( strpos( $struct, &quot;%$ptype%&quot; ) !== false ) {
							$post = true;

							// This is for page style attachment URLs.
							$page = is_post_type_hierarchical( $ptype );
							break;
						}
					}
				}

				// If creating rules for a permalink, do all the endpoints like attachments etc.
				if ( $post ) {
					// Create query and regex for trackback.
					$trackbackmatch = $match . $trackbackregex;
					$trackbackquery = $trackbackindex . '?' . $query . '&amp;tb=1';

					// Create query and regex for embeds.
					$embedmatch = $match . $embedregex;
					$embedquery = $embedindex . '?' . $query . '&amp;embed=true';

					// Trim slashes from the end of the regex for this dir.
					$match = rtrim( $match, '/' );

					// Get rid of brackets.
					$submatchbase = str_replace( array( '(', ')' ), '', $match );

					// Add a rule for at attachments, which take the form of &lt;permalink&gt;/some-text.
					$sub1 = $submatchbase . '/([^/]+)/';

					// Add trackback regex &lt;permalink&gt;/trackback/...
					$sub1tb = $sub1 . $trackbackregex;

					// And &lt;permalink&gt;/feed/(atom|...)
					$sub1feed = $sub1 . $feedregex;

					// And &lt;permalink&gt;/(feed|atom...)
					$sub1feed2 = $sub1 . $feedregex2;

					// And &lt;permalink&gt;/comment-page-xx
					$sub1comment = $sub1 . $commentregex;

					// And &lt;permalink&gt;/embed/...
					$sub1embed = $sub1 . $embedregex;

					/*
					 * Add another rule to match attachments in the explicit form:
					 * &lt;permalink&gt;/attachment/some-text
					 */
					$sub2 = $submatchbase . '/attachment/([^/]+)/';

					// And add trackbacks &lt;permalink&gt;/attachment/trackback.
					$sub2tb = $sub2 . $trackbackregex;

					// Feeds, &lt;permalink&gt;/attachment/feed/(atom|...)
					$sub2feed = $sub2 . $feedregex;

					// And feeds again on to this &lt;permalink&gt;/attachment/(feed|atom...)
					$sub2feed2 = $sub2 . $feedregex2;

					// And &lt;permalink&gt;/comment-page-xx
					$sub2comment = $sub2 . $commentregex;

					// And &lt;permalink&gt;/embed/...
					$sub2embed = $sub2 . $embedregex;

					// Create queries for these extra tag-ons we've just dealt with.
					$subquery        = $index . '?attachment=' . $this-&gt;preg_index( 1 );
					$subtbquery      = $subquery . '&amp;tb=1';
					$subfeedquery    = $subquery . '&amp;feed=' . $this-&gt;preg_index( 2 );
					$subcommentquery = $subquery . '&amp;cpage=' . $this-&gt;preg_index( 2 );
					$subembedquery   = $subquery . '&amp;embed=true';

					// Do endpoints for attachments.
					if ( ! empty( $endpoints ) ) {
						foreach ( (array) $ep_query_append as $regex =&gt; $ep ) {
							if ( $ep[0] &amp; EP_ATTACHMENT ) {
								$rewrite[ $sub1 . $regex ] = $subquery . $ep[1] . $this-&gt;preg_index( 3 );
								$rewrite[ $sub2 . $regex ] = $subquery . $ep[1] . $this-&gt;preg_index( 3 );
							}
						}
					}

					/*
					 * Now we've finished with endpoints, finish off the $sub1 and $sub2 matches
					 * add a ? as we don't have to match that last slash, and finally a $ so we
					 * match to the end of the URL
					 */
					$sub1 .= '?$';
					$sub2 .= '?$';

					/*
					 * Post pagination, e.g. &lt;permalink&gt;/2/
					 * Previously: '(/[0-9]+)?/?$', which produced '/2' for page.
					 * When cast to int, returned 0.
					 */
					$match = $match . '(?:/([0-9]+))?/?$';
					$query = $index . '?' . $query . '&amp;page=' . $this-&gt;preg_index( $num_toks + 1 );

					// Not matching a permalink so this is a lot simpler.
				} else {
					// Close the match and finalise the query.
					$match .= '?$';
					$query  = $index . '?' . $query;
				}

				/*
				 * Create the final array for this dir by joining the $rewrite array (which currently
				 * only contains rules/queries for trackback, pages etc) to the main regex/query for
				 * this dir
				 */
				$rewrite = array_merge( $rewrite, array( $match =&gt; $query ) );

				// If we're matching a permalink, add those extras (attachments etc) on.
				if ( $post ) {
					// Add trackback.
					$rewrite = array_merge( array( $trackbackmatch =&gt; $trackbackquery ), $rewrite );

					// Add embed.
					$rewrite = array_merge( array( $embedmatch =&gt; $embedquery ), $rewrite );

					// Add regexes/queries for attachments, attachment trackbacks and so on.
					if ( ! $page ) {
						// Require &lt;permalink&gt;/attachment/stuff form for pages because of confusion with subpages.
						$rewrite = array_merge(
							$rewrite,
							array(
								$sub1        =&gt; $subquery,
								$sub1tb      =&gt; $subtbquery,
								$sub1feed    =&gt; $subfeedquery,
								$sub1feed2   =&gt; $subfeedquery,
								$sub1comment =&gt; $subcommentquery,
								$sub1embed   =&gt; $subembedquery,
							)
						);
					}

					$rewrite = array_merge(
						array(
							$sub2        =&gt; $subquery,
							$sub2tb      =&gt; $subtbquery,
							$sub2feed    =&gt; $subfeedquery,
							$sub2feed2   =&gt; $subfeedquery,
							$sub2comment =&gt; $subcommentquery,
							$sub2embed   =&gt; $subembedquery,
						),
						$rewrite
					);
				}
			}
			// Add the rules for this dir to the accumulating $post_rewrite.
			$post_rewrite = array_merge( $rewrite, $post_rewrite );
		}

		// The finished rules. phew!
		return $post_rewrite;
	}

	/**
	 * Generates rewrite rules with permalink structure and walking directory only.
	 *
	 * Shorten version of WP_Rewrite::generate_rewrite_rules() that allows for shorter
	 * list of parameters. See the method for longer description of what generating
	 * rewrite rules does.
	 *
	 * @since 1.5.0
	 *
	 * @see WP_Rewrite::generate_rewrite_rules() See for long description and rest of parameters.
	 *
	 * @param string $permalink_structure The permalink structure to generate rules.
	 * @param bool   $walk_dirs           Optional. Whether to create list of directories to walk over.
	 *                                    Default false.
	 * @return array
	 */
	public function generate_rewrite_rule( $permalink_structure, $walk_dirs = false ) {
		return $this-&gt;generate_rewrite_rules( $permalink_structure, EP_NONE, false, false, false, $walk_dirs );
	}

	/**
	 * Constructs rewrite matches and queries from permalink structure.
	 *
	 * Runs the action {@see 'generate_rewrite_rules'} with the parameter that is an
	 * reference to the current WP_Rewrite instance to further manipulate the
	 * permalink structures and rewrite rules. Runs the {@see 'rewrite_rules_array'}
	 * filter on the full rewrite rule array.
	 *
	 * There are two ways to manipulate the rewrite rules, one by hooking into
	 * the {@see 'generate_rewrite_rules'} action and gaining full control of the
	 * object or just manipulating the rewrite rule array before it is passed
	 * from the function.
	 *
	 * @since 1.5.0
	 *
	 * @return string[] An associative array of matches and queries.
	 */
	public function rewrite_rules() {
		$rewrite = array();

		if ( empty( $this-&gt;permalink_structure ) ) {
			return $rewrite;
		}

		// robots.txt -- only if installed at the root.
		$home_path      = parse_url( home_url() );
		$robots_rewrite = ( empty( $home_path['path'] ) || '/' === $home_path['path'] ) ? array( 'robots\.txt$' =&gt; $this-&gt;index . '?robots=1' ) : array();

		// favicon.ico -- only if installed at the root.
		$favicon_rewrite = ( empty( $home_path['path'] ) || '/' === $home_path['path'] ) ? array( 'favicon\.ico$' =&gt; $this-&gt;index . '?favicon=1' ) : array();

		// Old feed and service files.
		$deprecated_files = array(
			'.*wp-(atom|rdf|rss|rss2|feed|commentsrss2)\.php$' =&gt; $this-&gt;index . '?feed=old',
			'.*wp-app\.php(/.*)?$' =&gt; $this-&gt;index . '?error=403',
		);

		// Registration rules.
		$registration_pages = array();
		if ( is_multisite() &amp;&amp; is_main_site() ) {
			$registration_pages['.*wp-signup.php$']   = $this-&gt;index . '?signup=true';
			$registration_pages['.*wp-activate.php$'] = $this-&gt;index . '?activate=true';
		}

		// Deprecated.
		$registration_pages['.*wp-register.php$'] = $this-&gt;index . '?register=true';

		// Post rewrite rules.
		$post_rewrite = $this-&gt;generate_rewrite_rules( $this-&gt;permalink_structure, EP_PERMALINK );

		/**
		 * Filters rewrite rules used for &quot;post&quot; archives.
		 *
		 * @since 1.5.0
		 *
		 * @param string[] $post_rewrite Array of rewrite rules for posts, keyed by their regex pattern.
		 */
		$post_rewrite = apply_filters( 'post_rewrite_rules', $post_rewrite );

		// Date rewrite rules.
		$date_rewrite = $this-&gt;generate_rewrite_rules( $this-&gt;get_date_permastruct(), EP_DATE );

		/**
		 * Filters rewrite rules used for date archives.
		 *
		 * Likely date archives would include /yyyy/, /yyyy/mm/, and /yyyy/mm/dd/.
		 *
		 * @since 1.5.0
		 *
		 * @param string[] $date_rewrite Array of rewrite rules for date archives, keyed by their regex pattern.
		 */
		$date_rewrite = apply_filters( 'date_rewrite_rules', $date_rewrite );

		// Root-level rewrite rules.
		$root_rewrite = $this-&gt;generate_rewrite_rules( $this-&gt;root . '/', EP_ROOT );

		/**
		 * Filters rewrite rules used for root-level archives.
		 *
		 * Likely root-level archives would include pagination rules for the homepage
		 * as well as site-wide post feeds (e.g. /feed/, and /feed/atom/).
		 *
		 * @since 1.5.0
		 *
		 * @param string[] $root_rewrite Array of root-level rewrite rules, keyed by their regex pattern.
		 */
		$root_rewrite = apply_filters( 'root_rewrite_rules', $root_rewrite );

		// Comments rewrite rules.
		$comments_rewrite = $this-&gt;generate_rewrite_rules( $this-&gt;root . $this-&gt;comments_base, EP_COMMENTS, false, true, true, false );

		/**
		 * Filters rewrite rules used for comment feed archives.
		 *
		 * Likely comments feed archives include /comments/feed/, and /comments/feed/atom/.
		 *
		 * @since 1.5.0
		 *
		 * @param string[] $comments_rewrite Array of rewrite rules for the site-wide comments feeds, keyed by their regex pattern.
		 */
		$comments_rewrite = apply_filters( 'comments_rewrite_rules', $comments_rewrite );

		// Search rewrite rules.
		$search_structure = $this-&gt;get_search_permastruct();
		$search_rewrite   = $this-&gt;generate_rewrite_rules( $search_structure, EP_SEARCH );

		/**
		 * Filters rewrite rules used for search archives.
		 *
		 * Likely search-related archives include /search/search+query/ as well as
		 * pagination and feed paths for a search.
		 *
		 * @since 1.5.0
		 *
		 * @param string[] $search_rewrite Array of rewrite rules for search queries, keyed by their regex pattern.
		 */
		$search_rewrite = apply_filters( 'search_rewrite_rules', $search_rewrite );

		// Author rewrite rules.
		$author_rewrite = $this-&gt;generate_rewrite_rules( $this-&gt;get_author_permastruct(), EP_AUTHORS );

		/**
		 * Filters rewrite rules used for author archives.
		 *
		 * Likely author archives would include /author/author-name/, as well as
		 * pagination and feed paths for author archives.
		 *
		 * @since 1.5.0
		 *
		 * @param string[] $author_rewrite Array of rewrite rules for author archives, keyed by their regex pattern.
		 */
		$author_rewrite = apply_filters( 'author_rewrite_rules', $author_rewrite );

		// Pages rewrite rules.
		$page_rewrite = $this-&gt;page_rewrite_rules();

		/**
		 * Filters rewrite rules used for &quot;page&quot; post type archives.
		 *
		 * @since 1.5.0
		 *
		 * @param string[] $page_rewrite Array of rewrite rules for the &quot;page&quot; post type, keyed by their regex pattern.
		 */
		$page_rewrite = apply_filters( 'page_rewrite_rules', $page_rewrite );

		// Extra permastructs.
		foreach ( $this-&gt;extra_permastructs as $permastructname =&gt; $struct ) {
			if ( is_array( $struct ) ) {
				if ( count( $struct ) == 2 ) {
					$rules = $this-&gt;generate_rewrite_rules( $struct[0], $struct[1] );
				} else {
					$rules = $this-&gt;generate_rewrite_rules( $struct['struct'], $struct['ep_mask'], $struct['paged'], $struct['feed'], $struct['forcomments'], $struct['walk_dirs'], $struct['endpoints'] );
				}
			} else {
				$rules = $this-&gt;generate_rewrite_rules( $struct );
			}

			/**
			 * Filters rewrite rules used for individual permastructs.
			 *
			 * The dynamic portion of the hook name, `$permastructname`, refers
			 * to the name of the registered permastruct, e.g. 'post_tag' (tags),
			 * 'category' (categories), etc.
			 *
			 * @since 3.1.0
			 *
			 * @param string[] $rules Array of rewrite rules generated for the current permastruct, keyed by their regex pattern.
			 */
			$rules = apply_filters( &quot;{$permastructname}_rewrite_rules&quot;, $rules );

			if ( 'post_tag' === $permastructname ) {

				/**
				 * Filters rewrite rules used specifically for Tags.
				 *
				 * @since 2.3.0
				 * @deprecated 3.1.0 Use {@see 'post_tag_rewrite_rules'} instead.
				 *
				 * @param string[] $rules Array of rewrite rules generated for tags, keyed by their regex pattern.
				 */
				$rules = apply_filters_deprecated( 'tag_rewrite_rules', array( $rules ), '3.1.0', 'post_tag_rewrite_rules' );
			}

			$this-&gt;extra_rules_top = array_merge( $this-&gt;extra_rules_top, $rules );
		}

		// Put them together.
		if ( $this-&gt;use_verbose_page_rules ) {
			$this-&gt;rules = array_merge( $this-&gt;extra_rules_top, $robots_rewrite, $favicon_rewrite, $deprecated_files, $registration_pages, $root_rewrite, $comments_rewrite, $search_rewrite, $author_rewrite, $date_rewrite, $page_rewrite, $post_rewrite, $this-&gt;extra_rules );
		} else {
			$this-&gt;rules = array_merge( $this-&gt;extra_rules_top, $robots_rewrite, $favicon_rewrite, $deprecated_files, $registration_pages, $root_rewrite, $comments_rewrite, $search_rewrite, $author_rewrite, $date_rewrite, $post_rewrite, $page_rewrite, $this-&gt;extra_rules );
		}

		/**
		 * Fires after the rewrite rules are generated.
		 *
		 * @since 1.5.0
		 *
		 * @param WP_Rewrite $this Current WP_Rewrite instance (passed by reference).
		 */
		do_action_ref_array( 'generate_rewrite_rules', array( &amp;$this ) );

		/**
		 * Filters the full set of generated rewrite rules.
		 *
		 * @since 1.5.0
		 *
		 * @param string[] $rules The compiled array of rewrite rules, keyed by their regex pattern.
		 */
		$this-&gt;rules = apply_filters( 'rewrite_rules_array', $this-&gt;rules );

		return $this-&gt;rules;
	}

	/**
	 * Retrieves the rewrite rules.
	 *
	 * The difference between this method and WP_Rewrite::rewrite_rules() is that
	 * this method stores the rewrite rules in the 'rewrite_rules' option and retrieves
	 * it. This prevents having to process all of the permalinks to get the rewrite rules
	 * in the form of caching.
	 *
	 * @since 1.5.0
	 *
	 * @return string[] Array of rewrite rules keyed by their regex pattern.
	 */
	public function wp_rewrite_rules() {
		$this-&gt;rules = get_option( 'rewrite_rules' );
		if ( empty( $this-&gt;rules ) ) {
			$this-&gt;matches = 'matches';
			$this-&gt;rewrite_rules();
			if ( ! did_action( 'wp_loaded' ) ) {
				add_action( 'wp_loaded', array( $this, 'flush_rules' ) );
				return $this-&gt;rules;
			}
			update_option( 'rewrite_rules', $this-&gt;rules );
		}

		return $this-&gt;rules;
	}

	/**
	 * Retrieves mod_rewrite-formatted rewrite rules to write to .htaccess.
	 *
	 * Does not actually write to the .htaccess file, but creates the rules for
	 * the process that will.
	 *
	 * Will add the non_wp_rules property rules to the .htaccess file before
	 * the WordPress rewrite rules one.
	 *
	 * @since 1.5.0
	 *
	 * @return string
	 */
	public function mod_rewrite_rules() {
		if ( ! $this-&gt;using_permalinks() ) {
			return '';
		}

		$site_root = parse_url( site_url() );
		if ( isset( $site_root['path'] ) ) {
			$site_root = trailingslashit( $site_root['path'] );
		}

		$home_root = parse_url( home_url() );
		if ( isset( $home_root['path'] ) ) {
			$home_root = trailingslashit( $home_root['path'] );
		} else {
			$home_root = '/';
		}

		$rules  = &quot;&lt;IfModule mod_rewrite.c&gt;\n&quot;;
		$rules .= &quot;RewriteEngine On\n&quot;;
		$rules .= &quot;RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]\n&quot;;
		$rules .= &quot;RewriteBase $home_root\n&quot;;

		// Prevent -f checks on index.php.
		$rules .= &quot;RewriteRule ^index\.php$ - [L]\n&quot;;

		// Add in the rules that don't redirect to WP's index.php (and thus shouldn't be handled by WP at all).
		foreach ( (array) $this-&gt;non_wp_rules as $match =&gt; $query ) {
			// Apache 1.3 does not support the reluctant (non-greedy) modifier.
			$match = str_replace( '.+?', '.+', $match );

			$rules .= 'RewriteRule ^' . $match . ' ' . $home_root . $query . &quot; [QSA,L]\n&quot;;
		}

		if ( $this-&gt;use_verbose_rules ) {
			$this-&gt;matches = '';
			$rewrite       = $this-&gt;rewrite_rules();
			$num_rules     = count( $rewrite );
			$rules        .= &quot;RewriteCond %{REQUEST_FILENAME} -f [OR]\n&quot; .
				&quot;RewriteCond %{REQUEST_FILENAME} -d\n&quot; .
				&quot;RewriteRule ^.*$ - [S=$num_rules]\n&quot;;

			foreach ( (array) $rewrite as $match =&gt; $query ) {
				// Apache 1.3 does not support the reluctant (non-greedy) modifier.
				$match = str_replace( '.+?', '.+', $match );

				if ( strpos( $query, $this-&gt;index ) !== false ) {
					$rules .= 'RewriteRule ^' . $match . ' ' . $home_root . $query . &quot; [QSA,L]\n&quot;;
				} else {
					$rules .= 'RewriteRule ^' . $match . ' ' . $site_root . $query . &quot; [QSA,L]\n&quot;;
				}
			}
		} else {
			$rules .= &quot;RewriteCond %{REQUEST_FILENAME} !-f\n&quot; .
				&quot;RewriteCond %{REQUEST_FILENAME} !-d\n&quot; .
				&quot;RewriteRule . {$home_root}{$this-&gt;index} [L]\n&quot;;
		}

		$rules .= &quot;&lt;/IfModule&gt;\n&quot;;

		/**
		 * Filters the list of rewrite rules formatted for output to an .htaccess file.
		 *
		 * @since 1.5.0
		 *
		 * @param string $rules mod_rewrite Rewrite rules formatted for .htaccess.
		 */
		$rules = apply_filters( 'mod_rewrite_rules', $rules );

		/**
		 * Filters the list of rewrite rules formatted for output to an .htaccess file.
		 *
		 * @since 1.5.0
		 * @deprecated 1.5.0 Use the {@see 'mod_rewrite_rules'} filter instead.
		 *
		 * @param string $rules mod_rewrite Rewrite rules formatted for .htaccess.
		 */
		return apply_filters_deprecated( 'rewrite_rules', array( $rules ), '1.5.0', 'mod_rewrite_rules' );
	}

	/**
	 * Retrieves IIS7 URL Rewrite formatted rewrite rules to write to web.config file.
	 *
	 * Does not actually write to the web.config file, but creates the rules for
	 * the process that will.
	 *
	 * @since 2.8.0
	 *
	 * @param bool $add_parent_tags Optional. Whether to add parent tags to the rewrite rule sets.
	 *                              Default false.
	 * @return string IIS7 URL rewrite rule sets.
	 */
	public function iis7_url_rewrite_rules( $add_parent_tags = false ) {
		if ( ! $this-&gt;using_permalinks() ) {
			return '';
		}
		$rules = '';
		if ( $add_parent_tags ) {
			$rules .= '&lt;configuration&gt;
	&lt;system.webServer&gt;
		&lt;rewrite&gt;
			&lt;rules&gt;';
		}

		$rules .= '
			&lt;rule name=&quot;WordPress: ' . esc_attr( home_url() ) . '&quot; patternSyntax=&quot;Wildcard&quot;&gt;
				&lt;match url=&quot;*&quot; /&gt;
					&lt;conditions&gt;
						&lt;add input=&quot;{REQUEST_FILENAME}&quot; matchType=&quot;IsFile&quot; negate=&quot;true&quot; /&gt;
						&lt;add input=&quot;{REQUEST_FILENAME}&quot; matchType=&quot;IsDirectory&quot; negate=&quot;true&quot; /&gt;
					&lt;/conditions&gt;
				&lt;action type=&quot;Rewrite&quot; url=&quot;index.php&quot; /&gt;
			&lt;/rule&gt;';

		if ( $add_parent_tags ) {
			$rules .= '
			&lt;/rules&gt;
		&lt;/rewrite&gt;
	&lt;/system.webServer&gt;
&lt;/configuration&gt;';
		}

		/**
		 * Filters the list of rewrite rules formatted for output to a web.config.
		 *
		 * @since 2.8.0
		 *
		 * @param string $rules Rewrite rules formatted for IIS web.config.
		 */
		return apply_filters( 'iis7_url_rewrite_rules', $rules );
	}

	/**
	 * Adds a rewrite rule that transforms a URL structure to a set of query vars.
	 *
	 * Any value in the $after parameter that isn't 'bottom' will result in the rule
	 * being placed at the top of the rewrite rules.
	 *
	 * @since 2.1.0
	 * @since 4.4.0 Array support was added to the `$query` parameter.
	 *
	 * @param string       $regex Regular expression to match request against.
	 * @param string|array $query The corresponding query vars for this rewrite rule.
	 * @param string       $after Optional. Priority of the new rule. Accepts 'top'
	 *                            or 'bottom'. Default 'bottom'.
	 */
	public function add_rule( $regex, $query, $after = 'bottom' ) {
		if ( is_array( $query ) ) {
			$external = false;
			$query    = add_query_arg( $query, 'index.php' );
		} else {
			$index = false === strpos( $query, '?' ) ? strlen( $query ) : strpos( $query, '?' );
			$front = substr( $query, 0, $index );

			$external = $front != $this-&gt;index;
		}

		// &quot;external&quot; = it doesn't correspond to index.php.
		if ( $external ) {
			$this-&gt;add_external_rule( $regex, $query );
		} else {
			if ( 'bottom' === $after ) {
				$this-&gt;extra_rules = array_merge( $this-&gt;extra_rules, array( $regex =&gt; $query ) );
			} else {
				$this-&gt;extra_rules_top = array_merge( $this-&gt;extra_rules_top, array( $regex =&gt; $query ) );
			}
		}
	}

	/**
	 * Adds a rewrite rule that doesn't correspond to index.php.
	 *
	 * @since 2.1.0
	 *
	 * @param string $regex Regular expression to match request against.
	 * @param string $query The corresponding query vars for this rewrite rule.
	 */
	public function add_external_rule( $regex, $query ) {
		$this-&gt;non_wp_rules[ $regex ] = $query;
	}

	/**
	 * Adds an endpoint, like /trackback/.
	 *
	 * @since 2.1.0
	 * @since 3.9.0 $query_var parameter added.
	 * @since 4.3.0 Added support for skipping query var registration by passing `false` to `$query_var`.
	 *
	 * @see add_rewrite_endpoint() for full documentation.
	 * @global WP $wp Current WordPress environment instance.
	 *
	 * @param string      $name      Name of the endpoint.
	 * @param int         $places    Endpoint mask describing the places the endpoint should be added.
	 *                               Accepts a mask of:
	 *                               - `EP_ALL`
	 *                               - `EP_NONE`
	 *                               - `EP_ALL_ARCHIVES`
	 *                               - `EP_ATTACHMENT`
	 *                               - `EP_AUTHORS`
	 *                               - `EP_CATEGORIES`
	 *                               - `EP_COMMENTS`
	 *                               - `EP_DATE`
	 *                               - `EP_DAY`
	 *                               - `EP_MONTH`
	 *                               - `EP_PAGES`
	 *                               - `EP_PERMALINK`
	 *                               - `EP_ROOT`
	 *                               - `EP_SEARCH`
	 *                               - `EP_TAGS`
	 *                               - `EP_YEAR`
	 * @param string|bool $query_var Optional. Name of the corresponding query variable. Pass `false` to
	 *                               skip registering a query_var for this endpoint. Defaults to the
	 *                               value of `$name`.
	 */
	public function add_endpoint( $name, $places, $query_var = true ) {
		global $wp;

		// For backward compatibility, if null has explicitly been passed as `$query_var`, assume `true`.
		if ( true === $query_var || null === $query_var ) {
			$query_var = $name;
		}
		$this-&gt;endpoints[] = array( $places, $name, $query_var );

		if ( $query_var ) {
			$wp-&gt;add_query_var( $query_var );
		}
	}

	/**
	 * Adds a new permalink structure.
	 *
	 * A permalink structure (permastruct) is an abstract definition of a set of rewrite rules;
	 * it is an easy way of expressing a set of regular expressions that rewrite to a set of
	 * query strings. The new permastruct is added to the WP_Rewrite::$extra_permastructs array.
	 *
	 * When the rewrite rules are built by WP_Rewrite::rewrite_rules(), all of these extra
	 * permastructs are passed to WP_Rewrite::generate_rewrite_rules() which transforms them
	 * into the regular expressions that many love to hate.
	 *
	 * The `$args` parameter gives you control over how WP_Rewrite::generate_rewrite_rules()
	 * works on the new permastruct.
	 *
	 * @since 2.5.0
	 *
	 * @param string $name   Name for permalink structure.
	 * @param string $struct Permalink structure (e.g. category/%category%)
	 * @param array  $args   {
	 *     Optional. Arguments for building rewrite rules based on the permalink structure.
	 *     Default empty array.
	 *
	 *     @type bool $with_front  Whether the structure should be prepended with `WP_Rewrite::$front`.
	 *                             Default true.
	 *     @type int  $ep_mask     The endpoint mask defining which endpoints are added to the structure.
	 *                             Accepts a mask of:
	 *                             - `EP_ALL`
	 *                             - `EP_NONE`
	 *                             - `EP_ALL_ARCHIVES`
	 *                             - `EP_ATTACHMENT`
	 *                             - `EP_AUTHORS`
	 *                             - `EP_CATEGORIES`
	 *                             - `EP_COMMENTS`
	 *                             - `EP_DATE`
	 *                             - `EP_DAY`
	 *                             - `EP_MONTH`
	 *                             - `EP_PAGES`
	 *                             - `EP_PERMALINK`
	 *                             - `EP_ROOT`
	 *                             - `EP_SEARCH`
	 *                             - `EP_TAGS`
	 *                             - `EP_YEAR`
	 *                             Default `EP_NONE`.
	 *     @type bool $paged       Whether archive pagination rules should be added for the structure.
	 *                             Default true.
	 *     @type bool $feed        Whether feed rewrite rules should be added for the structure. Default true.
	 *     @type bool $forcomments Whether the feed rules should be a query for a comments feed. Default false.
	 *     @type bool $walk_dirs   Whether the 'directories' making up the structure should be walked over
	 *                             and rewrite rules built for each in-turn. Default true.
	 *     @type bool $endpoints   Whether endpoints should be applied to the generated rules. Default true.
	 * }
	 */
	public function add_permastruct( $name, $struct, $args = array() ) {
		// Back-compat for the old parameters: $with_front and $ep_mask.
		if ( ! is_array( $args ) ) {
			$args = array( 'with_front' =&gt; $args );
		}
		if ( func_num_args() == 4 ) {
			$args['ep_mask'] = func_get_arg( 3 );
		}

		$defaults = array(
			'with_front'  =&gt; true,
			'ep_mask'     =&gt; EP_NONE,
			'paged'       =&gt; true,
			'feed'        =&gt; true,
			'forcomments' =&gt; false,
			'walk_dirs'   =&gt; true,
			'endpoints'   =&gt; true,
		);
		$args     = array_intersect_key( $args, $defaults );
		$args     = wp_parse_args( $args, $defaults );

		if ( $args['with_front'] ) {
			$struct = $this-&gt;front . $struct;
		} else {
			$struct = $this-&gt;root . $struct;
		}
		$args['struct'] = $struct;

		$this-&gt;extra_permastructs[ $name ] = $args;
	}

	/**
	 * Removes a permalink structure.
	 *
	 * @since 4.5.0
	 *
	 * @param string $name Name for permalink structure.
	 */
	public function remove_permastruct( $name ) {
		unset( $this-&gt;extra_permastructs[ $name ] );
	}

	/**
	 * Removes rewrite rules and then recreate rewrite rules.
	 *
	 * Calls WP_Rewrite::wp_rewrite_rules() after removing the 'rewrite_rules' option.
	 * If the function named 'save_mod_rewrite_rules' exists, it will be called.
	 *
	 * @since 2.0.1
	 *
	 * @param bool $hard Whether to update .htaccess (hard flush) or just update rewrite_rules option (soft flush). Default is true (hard).
	 */
	public function flush_rules( $hard = true ) {
		static $do_hard_later = null;

		// Prevent this action from running before everyone has registered their rewrites.
		if ( ! did_action( 'wp_loaded' ) ) {
			add_action( 'wp_loaded', array( $this, 'flush_rules' ) );
			$do_hard_later = ( isset( $do_hard_later ) ) ? $do_hard_later || $hard : $hard;
			return;
		}

		if ( isset( $do_hard_later ) ) {
			$hard = $do_hard_later;
			unset( $do_hard_later );
		}

		update_option( 'rewrite_rules', '' );
		$this-&gt;wp_rewrite_rules();

		/**
		 * Filters whether a &quot;hard&quot; rewrite rule flush should be performed when requested.
		 *
		 * A &quot;hard&quot; flush updates .htaccess (Apache) or web.config (IIS).
		 *
		 * @since 3.7.0
		 *
		 * @param bool $hard Whether to flush rewrite rules &quot;hard&quot;. Default true.
		 */
		if ( ! $hard || ! apply_filters( 'flush_rewrite_rules_hard', true ) ) {
			return;
		}
		if ( function_exists( 'save_mod_rewrite_rules' ) ) {
			save_mod_rewrite_rules();
		}
		if ( function_exists( 'iis7_save_url_rewrite_rules' ) ) {
			iis7_save_url_rewrite_rules();
		}
	}

	/**
	 * Sets up the object's properties.
	 *
	 * The 'use_verbose_page_rules' object property will be set to true if the
	 * permalink structure begins with one of the following: '%postname%', '%category%',
	 * '%tag%', or '%author%'.
	 *
	 * @since 1.5.0
	 */
	public function init() {
		$this-&gt;extra_rules         = array();
		$this-&gt;non_wp_rules        = array();
		$this-&gt;endpoints           = array();
		$this-&gt;permalink_structure = get_option( 'permalink_structure' );
		$this-&gt;front               = substr( $this-&gt;permalink_structure, 0, strpos( $this-&gt;permalink_structure, '%' ) );
		$this-&gt;root                = '';

		if ( $this-&gt;using_index_permalinks() ) {
			$this-&gt;root = $this-&gt;index . '/';
		}

		unset( $this-&gt;author_structure );
		unset( $this-&gt;date_structure );
		unset( $this-&gt;page_structure );
		unset( $this-&gt;search_structure );
		unset( $this-&gt;feed_structure );
		unset( $this-&gt;comment_feed_structure );

		$this-&gt;use_trailing_slashes = ( '/' === substr( $this-&gt;permalink_structure, -1, 1 ) );

		// Enable generic rules for pages if permalink structure doesn't begin with a wildcard.
		if ( preg_match( '/^[^%]*%(?:postname|category|tag|author)%/', $this-&gt;permalink_structure ) ) {
			$this-&gt;use_verbose_page_rules = true;
		} else {
			$this-&gt;use_verbose_page_rules = false;
		}
	}

	/**
	 * Sets the main permalink structure for the site.
	 *
	 * Will update the 'permalink_structure' option, if there is a difference
	 * between the current permalink structure and the parameter value. Calls
	 * WP_Rewrite::init() after the option is updated.
	 *
	 * Fires the {@see 'permalink_structure_changed'} action once the init call has
	 * processed passing the old and new values
	 *
	 * @since 1.5.0
	 *
	 * @param string $permalink_structure Permalink structure.
	 */
	public function set_permalink_structure( $permalink_structure ) {
		if ( $permalink_structure != $this-&gt;permalink_structure ) {
			$old_permalink_structure = $this-&gt;permalink_structure;
			update_option( 'permalink_structure', $permalink_structure );

			$this-&gt;init();

			/**
			 * Fires after the permalink structure is updated.
			 *
			 * @since 2.8.0
			 *
			 * @param string $old_permalink_structure The previous permalink structure.
			 * @param string $permalink_structure     The new permalink structure.
			 */
			do_action( 'permalink_structure_changed', $old_permalink_structure, $permalink_structure );
		}
	}

	/**
	 * Sets the category base for the category permalink.
	 *
	 * Will update the 'category_base' option, if there is a difference between
	 * the current category base and the parameter value. Calls WP_Rewrite::init()
	 * after the option is updated.
	 *
	 * @since 1.5.0
	 *
	 * @param string $category_base Category permalink structure base.
	 */
	public function set_category_base( $category_base ) {
		if ( get_option( 'category_base' ) !== $category_base ) {
			update_option( 'category_base', $category_base );
			$this-&gt;init();
		}
	}

	/**
	 * Sets the tag base for the tag permalink.
	 *
	 * Will update the 'tag_base' option, if there is a difference between the
	 * current tag base and the parameter value. Calls WP_Rewrite::init() after
	 * the option is updated.
	 *
	 * @since 2.3.0
	 *
	 * @param string $tag_base Tag permalink structure base.
	 */
	public function set_tag_base( $tag_base ) {
		if ( get_option( 'tag_base' ) !== $tag_base ) {
			update_option( 'tag_base', $tag_base );
			$this-&gt;init();
		}
	}

	/**
	 * Constructor - Calls init(), which runs setup.
	 *
	 * @since 1.5.0
	 */
	public function __construct() {
		$this-&gt;init();
	}
}
</pre>
			</div>
			<p class="source-code-links">
				<span>
					<a href="#" class="show-complete-source">Expand full source code</a>
					<a href="#" class="less-complete-source">Collapse full source code</a>
				</span>
				<span><a href="https://core.trac.wordpress.org/browser/tags/5.8/src/wp-includes/class-wp-rewrite.php#L25">View on Trac</a></span>
			</p>
			</section>
		<hr />
		<section class="class-methods">
			<p class="toc-jump"><a href="#top">Top &uarr;</a></p><h2 class="toc-heading" id="methods" tabindex="-1">Methods <a href="#methods" class="anchor"><span aria-hidden="true">#</span><span class="screen-reader-text">Methods</span></a></h2>
			<ul>
									<li><a href="__construct/index.html">
							__construct</a>
						&mdash; Constructor - Calls init(), which runs setup.											</li>
									<li><a href="add_endpoint/index.html">
							add_endpoint</a>
						&mdash; Adds an endpoint, like /trackback/.											</li>
									<li><a href="add_external_rule/index.html">
							add_external_rule</a>
						&mdash; Adds a rewrite rule that doesn't correspond to index.php.											</li>
									<li><a href="add_permastruct/index.html">
							add_permastruct</a>
						&mdash; Adds a new permalink structure.											</li>
									<li><a href="add_rewrite_tag/index.html">
							add_rewrite_tag</a>
						&mdash; Adds or updates existing rewrite tags (e.g. %postname%).											</li>
									<li><a href="add_rule/index.html">
							add_rule</a>
						&mdash; Adds a rewrite rule that transforms a URL structure to a set of query vars.											</li>
									<li><a href="flush_rules/index.html">
							flush_rules</a>
						&mdash; Removes rewrite rules and then recreate rewrite rules.											</li>
									<li><a href="generate_rewrite_rule/index.html">
							generate_rewrite_rule</a>
						&mdash; Generates rewrite rules with permalink structure and walking directory only.											</li>
									<li><a href="generate_rewrite_rules/index.html">
							generate_rewrite_rules</a>
						&mdash; Generates rewrite rules from a permalink structure.											</li>
									<li><a href="get_author_permastruct/index.html">
							get_author_permastruct</a>
						&mdash; Retrieves the author permalink structure.											</li>
									<li><a href="get_category_permastruct/index.html">
							get_category_permastruct</a>
						&mdash; Retrieves the permalink structure for categories.											</li>
									<li><a href="get_comment_feed_permastruct/index.html">
							get_comment_feed_permastruct</a>
						&mdash; Retrieves the comment feed permalink structure.											</li>
									<li><a href="get_date_permastruct/index.html">
							get_date_permastruct</a>
						&mdash; Retrieves date permalink structure, with year, month, and day.											</li>
									<li><a href="get_day_permastruct/index.html">
							get_day_permastruct</a>
						&mdash; Retrieves the day permalink structure with month and year.											</li>
									<li><a href="get_extra_permastruct/index.html">
							get_extra_permastruct</a>
						&mdash; Retrieves an extra permalink structure by name.											</li>
									<li><a href="get_feed_permastruct/index.html">
							get_feed_permastruct</a>
						&mdash; Retrieves the feed permalink structure.											</li>
									<li><a href="get_month_permastruct/index.html">
							get_month_permastruct</a>
						&mdash; Retrieves the month permalink structure without day and with year.											</li>
									<li><a href="get_page_permastruct/index.html">
							get_page_permastruct</a>
						&mdash; Retrieves the page permalink structure.											</li>
									<li><a href="get_search_permastruct/index.html">
							get_search_permastruct</a>
						&mdash; Retrieves the search permalink structure.											</li>
									<li><a href="get_tag_permastruct/index.html">
							get_tag_permastruct</a>
						&mdash; Retrieve the permalink structure for tags.											</li>
									<li><a href="get_year_permastruct/index.html">
							get_year_permastruct</a>
						&mdash; Retrieves the year permalink structure without month and day.											</li>
									<li><a href="iis7_url_rewrite_rules/index.html">
							iis7_url_rewrite_rules</a>
						&mdash; Retrieves IIS7 URL Rewrite formatted rewrite rules to write to web.config file.											</li>
									<li><a href="init/index.html">
							init</a>
						&mdash; Sets up the object's properties.											</li>
									<li><a href="mod_rewrite_rules/index.html">
							mod_rewrite_rules</a>
						&mdash; Retrieves mod_rewrite-formatted rewrite rules to write to .htaccess.											</li>
									<li><a href="page_rewrite_rules/index.html">
							page_rewrite_rules</a>
						&mdash; Retrieves all of the rewrite rules for pages.											</li>
									<li><a href="page_uri_index/index.html">
							page_uri_index</a>
						&mdash; Retrieves all page and attachments for pages URIs.											</li>
									<li><a href="preg_index/index.html">
							preg_index</a>
						&mdash; Indexes for matches for usage in preg_*() functions.											</li>
									<li><a href="remove_permastruct/index.html">
							remove_permastruct</a>
						&mdash; Removes a permalink structure.											</li>
									<li><a href="remove_rewrite_tag/index.html">
							remove_rewrite_tag</a>
						&mdash; Removes an existing rewrite tag.											</li>
									<li><a href="rewrite_rules/index.html">
							rewrite_rules</a>
						&mdash; Constructs rewrite matches and queries from permalink structure.											</li>
									<li><a href="set_category_base/index.html">
							set_category_base</a>
						&mdash; Sets the category base for the category permalink.											</li>
									<li><a href="set_permalink_structure/index.html">
							set_permalink_structure</a>
						&mdash; Sets the main permalink structure for the site.											</li>
									<li><a href="set_tag_base/index.html">
							set_tag_base</a>
						&mdash; Sets the tag base for the tag permalink.											</li>
									<li><a href="using_index_permalinks/index.html">
							using_index_permalinks</a>
						&mdash; Determines whether permalinks are being used and rewrite module is not enabled.											</li>
									<li><a href="using_mod_rewrite_permalinks/index.html">
							using_mod_rewrite_permalinks</a>
						&mdash; Determines whether permalinks are being used and rewrite module is enabled.											</li>
									<li><a href="using_permalinks/index.html">
							using_permalinks</a>
						&mdash; Determines whether permalinks are being used.											</li>
									<li><a href="wp_rewrite_rules/index.html">
							wp_rewrite_rules</a>
						&mdash; Retrieves the rewrite rules.											</li>
							</ul>
		</section>
		<hr />
	<section class="changelog">
		<p class="toc-jump"><a href="#top">Top &uarr;</a></p><h2 class="toc-heading" id="changelog" tabindex="-1">Changelog <a href="#changelog" class="anchor"><span aria-hidden="true">#</span><span class="screen-reader-text">Changelog</span></a></h2>

		<table>
			<caption class="screen-reader-text">Changelog</caption>
			<thead>
				<tr>
					<th class="changelog-version">Version</th>
					<th class="changelog-desc">Description</th>
				</tr>
			</thead>

			<tbody>
									
					<tr>
						<td><a href="../../since/1.5.0/index.html" alt="WordPress 1.5.0">1.5.0</a></td>
						<td>Introduced.</td>
					</tr>
							</tbody>
		</table>
	</section>

	<hr />
	<section class="user-notes">
		<p class="toc-jump"><a href="#top">Top &uarr;</a></p><h2 class="toc-heading" id="user-contributed-notes" tabindex="-1">User Contributed Notes <a href="#user-contributed-notes" class="anchor"><span aria-hidden="true">#</span><span class="screen-reader-text">User Contributed Notes</span></a></h2>
		
<div id="comments" class="comments-area">

			
		<ol class="comment-list">
						<li id="comment-1156" data-comment-id="1156" class="comment byuser comment-author-codex even thread-even depth-1">
			<article id="div-comment-1156" class="comment-body">

							<a href="#comment-content-1156" class="screen-reader-text">Skip to note 1 content</a>
				<header class="comment-meta">

				<div class="user-note-voting" data-nonce="252d98c73a"><a class="user-note-voting-up" title="You must log in to vote on the helpfulness of this note" data-id="1156" data-vote="up" href="https://login.wordpress.org/?redirect_to=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Fclasses%2Fwp_rewrite%2F%23comment-1156"><span class="dashicons dashicons-arrow-up" aria-hidden="true"></span><span class="screen-reader-text">You must log in to vote on the helpfulness of this note</span></a><span class="user-note-voting-count " title=""><span class="screen-reader-text">Vote results for this note: </span>0</span><a class="user-note-voting-down" title="You must log in to vote on the helpfulness of this note" data-id="1156" data-vote="down" href="https://login.wordpress.org/?redirect_to=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Fclasses%2Fwp_rewrite%2F%23comment-1156"><span class="dashicons dashicons-arrow-down" aria-hidden="true"></span><span class="screen-reader-text">You must log in to vote on the helpfulness of this note</span></a></div>					<div class="comment-author vcard">
						<span class="comment-author-attribution">
						<img alt='' src='https://secure.gravatar.com/avatar/688ab6934b21bca68e0fe4fc54a66805?s=32&amp;d=mm&amp;r=g' srcset='https://secure.gravatar.com/avatar/688ab6934b21bca68e0fe4fc54a66805?s=64&#038;d=mm&#038;r=g 2x' class='avatar avatar-32 photo' height='32' width='32' loading='lazy'/>Contributed by <cite class="fn"><a href="https://profiles.wordpress.org/codex/" rel="external nofollow" class="url">Codex</a></cite>
						</span>
						&mdash;
						<a class="comment-date" href="index.html#comment-1156">
							<time datetime="2016-02-16T08:02:47+00:00">
							6 years ago							</time>
						</a>

																													</div>
				</header>
				<!-- .comment-metadata -->
			
				<div class="comment-content" id="comment-content-1156">
				<p><strong>Example</strong></p>
<p>The most obvious thing a plugin would do with the $wp_rewrite object is add its own rewrite rules. This is remarkably simple. Filter the generic rewrite_rules_array.</p>
<p>A Quick and dirty example for rewriting <a href="http://mysite/project/1" rel="nofollow ugc">http://mysite/project/1</a> into <a href="http://mysite/index.php?pagename=project&amp;id=1" rel="nofollow ugc">http://mysite/index.php?pagename=project&#038;id=1</a>: </p>
<section class="source-content">
<div class="source-code-container">
<pre class="brush: php; title: ; notranslate" title="">
/**
 * Flushes rewrites if our project rule isn't yet added.
 */
function wpdocs_flush_rules() {
	$rules = get_option( 'rewrite_rules' );

	if ( ! isset( $rules['(project)/(\d*)$'] ) ) {
		global $wp_rewrite;
	   	$wp_rewrite-&gt;flush_rules();
	}
}
add_action( 'wp_loaded','wpdocs_flush_rules' );

// Adding a new rule
/**
 * Adds a new rewrite rule.
 *
 * @param array $rules Existing rewrite rules.
 * @return array (Maybe) modified list of rewrites.
function wpdocs_insert_rewrite_rules( $rules ) {
	$newrules = array();
	$newrules['(project)/(\d*)$'] = 'index.php?pagename=$matches[1]&amp;id=$matches[2]';
	return $newrules + $rules;
}
add_filter( 'rewrite_rules_array','wpdocs_insert_rewrite_rules' );

// Adding the id var so that WP recognizes it
function wpdocs_insert_query_vars( $vars ) {
    array_push( $vars, 'id' );
    return $vars;
}
add_filter( 'query_vars','wpdocs_insert_query_vars' );

</pre>
</div>
<p class="source-code-links"><span><a href="#" class="show-complete-source">Expand full source code</a><a href="#" class="less-complete-source">Collapse full source code</a></span></p>
</section>
<p>Keep in mind that the flush_rules function is quite slow, so in practice you never want to call it from the {@see &#8216;wp_loaded&#8217;} action that gets executed on each page load. Instead, call this function only when the rewrite rules change. If the rules get set up and then never change, it is enough to flush in register_activation_hook of your plugin.</p>
<p>The Jerome&#8217;s Keywords plugin does this to enable URLs like <a href="http://example.com/tag/sausages" rel="nofollow ugc">http://example.com/tag/sausages</a>. </p>
<pre class="brush: php; title: ; notranslate" title="">
function keywords_create_rewrite_rules( $rewrite ) {
	global $wp_rewrite;
	
	// add rewrite tokens
	$keytag_token = '%tag%';
	$wp_rewrite-&gt;add_rewrite_tag( $keytag_token, '(.+)', 'tag=' );
	
	$keywords_structure = $wp_rewrite-&gt;root . &quot;tag/$keytag_token&quot;;
	$keywords_rewrite = $wp_rewrite-&gt;generate_rewrite_rules( $keywords_structure );
	
	return ( $rewrite + $keywords_rewrite );
}
</pre>
<p>Instead of inserting the rewrite rules into the <code>$rewrite</code> array itself, Jerome chose to create a second array, $keywords_rewrite, using the WP_Rewrite::generate_rewrite_rules(). Using that function means that the plugin doesn&#8217;t have to create rewrite rules for extra pages (like page/2), or feeds (like feed/atom), etc. This array is then appended onto the $rewrite array and returned.</p>
<p>A simpler example of this is (former lead developer) Ryan Boren&#8217;s Feed Director plugin. This simply redirects URLs like <a href="http://example.com/feed.xml" rel="nofollow ugc">http://example.com/feed.xml</a> to <a href="http://example.com/feed/rss2" rel="nofollow ugc">http://example.com/feed/rss2</a>: </p>
<section class="source-content">
<div class="source-code-container">
<pre class="brush: php; title: ; notranslate" title="">
function feed_dir_rewrite( $wp_rewrite ) {
    $feed_rules = array(
        'index.rdf' =&gt; 'index.php?feed=rdf',
        'index.xml' =&gt; 'index.php?feed=rss2',
        '(.+).xml' =&gt; 'index.php?feed=' . $wp_rewrite-&gt;preg_index(1)
    );

    $wp_rewrite-&gt;rules = $feed_rules + $wp_rewrite-&gt;rules;
    return $wp_rewrite-&gt;rules;
}

// Hook in.
add_filter( 'generate_rewrite_rules', 'feed_dir_rewrite' );
</pre>
</div>
<p class="source-code-links"><span><a href="#" class="show-complete-source">Expand full source code</a><a href="#" class="less-complete-source">Collapse full source code</a></span></p>
</section>
<p>As the array is so simple here, there is no need to call generate_rewrite_rules(). Again, the plugin&#8217;s rules are added to WordPress&#8217;. Notice that as this function filters generate_rewrite_rules, it accepts a reference to the entire $wp_rewrite object as a parameter, not just the rewrite rules.</p>
<p>Of course, as you&#8217;re adding your rewrite rules to the array before WordPress does anything with them, your plugins rewrite rules will be included in anything WordPress does with the rewrite rules, like write them to the .htaccess file.</p>
				</div><!-- .comment-content -->

					<section id='feedback-1156' class='feedback hide-if-js'>
</section><!-- .feedback -->
<footer class='feedback-links' >
<a role="button" class="feedback-login" href="https://login.wordpress.org/?redirect_to=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Fclasses%2Fwp_rewrite%2F%3Freplytocom%3D1156%23feedback-editor-1156" rel="nofollow">Log in to add feedback</a></footer>
</article><!-- .comment-body -->
</li>
			<li id="comment-4262" data-comment-id="4262" class="comment byuser comment-author-atachibana odd alt thread-odd thread-alt depth-1">
			<article id="div-comment-4262" class="comment-body">

							<a href="#comment-content-4262" class="screen-reader-text">Skip to note 2 content</a>
				<header class="comment-meta">

				<div class="user-note-voting" data-nonce="358f9a7735"><a class="user-note-voting-up" title="You must log in to vote on the helpfulness of this note" data-id="4262" data-vote="up" href="https://login.wordpress.org/?redirect_to=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Fclasses%2Fwp_rewrite%2F%23comment-4262"><span class="dashicons dashicons-arrow-up" aria-hidden="true"></span><span class="screen-reader-text">You must log in to vote on the helpfulness of this note</span></a><span class="user-note-voting-count " title=""><span class="screen-reader-text">Vote results for this note: </span>0</span><a class="user-note-voting-down" title="You must log in to vote on the helpfulness of this note" data-id="4262" data-vote="down" href="https://login.wordpress.org/?redirect_to=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Fclasses%2Fwp_rewrite%2F%23comment-4262"><span class="dashicons dashicons-arrow-down" aria-hidden="true"></span><span class="screen-reader-text">You must log in to vote on the helpfulness of this note</span></a></div>					<div class="comment-author vcard">
						<span class="comment-author-attribution">
						<img alt='' src='https://secure.gravatar.com/avatar/3e4bf9e440bd9f2629b26218c1362a1a?s=32&amp;d=mm&amp;r=g' srcset='https://secure.gravatar.com/avatar/3e4bf9e440bd9f2629b26218c1362a1a?s=64&#038;d=mm&#038;r=g 2x' class='avatar avatar-32 photo' height='32' width='32' loading='lazy'/>Contributed by <cite class="fn"><a href="https://profiles.wordpress.org/atachibana/" rel="external nofollow" class="url">Akira Tachibana</a></cite>
						</span>
						&mdash;
						<a class="comment-date" href="index.html#comment-4262">
							<time datetime="2020-09-14T14:49:22+00:00">
							12 months ago							</time>
						</a>

																													</div>
				</header>
				<!-- .comment-metadata -->
			
				<div class="comment-content" id="comment-content-4262">
				<p><em>From Codex</em><br />
<strong>Non-WordPress rewrite rules</strong></p>
<pre class="brush: php; title: ; notranslate" title=""> &lt;?php
    $wp_rewrite-&gt;non_wp_rules = array( 'Pattern' =&gt; 'Substitution' );
    print_r($wp_rewrite-&gt;mod_rewrite_rules());
?&gt; </pre>
<p>prints<br />
<code></p>
<p> RewriteEngine On<br />
 RewriteBase /wp_home/<br />
 RewriteRule ^Pattern /wp_home/Substitution [QSA,L]<br />
 RewriteCond %{REQUEST_FILENAME} !-f<br />
 RewriteCond %{REQUEST_FILENAME} !-d<br />
 RewriteRule . /wp_home/index.php [L]<br />
 </code></p>
<p>where /wp_home/ is WordPress&#8217; home directory (or the root URL / if WordPress is installed in your web root.)</p>
				</div><!-- .comment-content -->

					<section id='feedback-4262' class='feedback hide-if-js'>
</section><!-- .feedback -->
<footer class='feedback-links' >
<a role="button" class="feedback-login" href="https://login.wordpress.org/?redirect_to=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Fclasses%2Fwp_rewrite%2F%3Freplytocom%3D4262%23feedback-editor-4262" rel="nofollow">Log in to add feedback</a></footer>
</article><!-- .comment-body -->
</li>
		</ol><!-- .comment-list -->

		
	
	
			<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title"> <small></small></h3><p>You must <a href="https://login.wordpress.org/?redirect_to=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Fclasses%2Fwp_rewrite%2F%23comments">log in</a> before being able to contribute a note or feedback.</p>	</div><!-- #respond -->
		
	
</div><!-- #comments -->
	</section>
</div>

</article>

			
		
		</main><!-- #main -->
	</div><!-- #primary -->
	</div><!-- #content -->

</div><!-- #page -->


<div id="wporg-footer">
	<div class="wrapper">
		<ul>
			<li><a href="http://wordpress.org/about/" title="An introduction to the WordPress project">About</a></li>
			<li><a href="http://wordpress.org/news/" title="News and Updates">Blog</a></li>
			<li><a href="http://wordpress.org/hosting/" title="Recommended web hosting providers">Hosting</a></li>
			<li><a href="https://wordpressfoundation.org/donate/" title="Donate to the WordPress Foundation">Donate</a></li>
		</ul>

		<ul>
			<li><a href="http://wordpress.org/support/" title="Forums, documentation, and other resources">Support</a></li>
			<li><a href="../../../index.html" title="Resources for WordPress developers">Developers</a></li>
			<li><a href="http://make.wordpress.org/" title="Give back to WordPress through code, support, translation and more">Get Involved</a></li>
			<li><a href="http://learn.wordpress.org/" title="Workshops and training materials">Learn</a></li>
		</ul>

		<ul>
			<li><a href="http://wordpress.org/showcase/" title="Some of the best WordPress sites on the Web">Showcase</a></li>
			<li><a href="http://wordpress.org/plugins/" title="Add extra functionality to WordPress">Plugins</a></li>
			<li><a href="http://wordpress.org/themes/" title="Make your WordPress pretty">Themes</a></li>
		</ul>

		<ul>
			<li><a href="http://central.wordcamp.org/" title="Find a WordPress event near you">WordCamp</a></li>
			<li><a href="http://wordpress.tv/" title="Videos, tutorials, and WordCamp sessions">WordPress.TV</a></li>
			<li><a href="http://buddypress.org/" title="A set of plugins to transform your WordPress into a social network">BuddyPress</a></li>
			<li><a href="http://bbpress.org/" title="Fast, slick forums built on WordPress">bbPress</a></li>
		</ul>

		<ul>
			<li><a href="http://wordpress.com/?ref=wporg-footer" title="Hassle-free WordPress hosting">WordPress.com</a></li>
			<li><a href="http://ma.tt/" title="Co-founder of WordPress, an example of what WordPress can do">Matt</a></li>
			<li><a href="http://wordpress.org/about/privacy/" title="WordPress.org Privacy Policy">Privacy</a></li>
			<li><a href="https://publiccode.eu/" target="_blank">Public Code</a></li>
		</ul>

		<ul class="social-media-links">
			<li><span class="dashicons dashicons-twitter"></span><a href="https://twitter.com/WordPress" title="Follow @WordPress on Twitter">@WordPress</a></li>
			<li><span class="dashicons dashicons-facebook"></span><a href="https://www.facebook.com/WordPress/" title="Like WordPress on Facebook">WordPress</a></li>
		</ul>
	</div>

		<p class="cip cip-image">Code is Poetry.</p>
</div>

<script src="../../../../s.w.org/style/js/navigation.min.js?20190128"></script>

<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "../../../wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.9b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.head.appendChild( corecss );
		var themecssurl = "../../../wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.9b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		document.head.appendChild( themecss );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.defaults['toolbar'] = false;
	SyntaxHighlighter.all();

	// Infinite scroll support
	if ( typeof( jQuery ) !== 'undefined' ) {
		jQuery( function( $ ) {
			$( document.body ).on( 'post-load', function() {
				SyntaxHighlighter.highlight();
			} );
		} );
	}
</script>
<link rel='stylesheet' id='buttons-css'  href='../../../wp-includes/css/buttons.min.css?ver=5.9-alpha-51701' type='text/css' media='all' />
<script type='text/javascript' src='../../../wp-includes/js/hoverintent-js.min.js?ver=2.2.1' id='hoverintent-js-js'></script>
<script type='text/javascript' src='../../../wp-includes/js/admin-bar.min.js?ver=5.9-alpha-51701' id='admin-bar-js'></script>
<script type='text/javascript' src='../../../wp-content/themes/pub/wporg-developer/js/navigation.js?ver=20181209' id='wporg-developer-navigation-js'></script>
<script type='text/javascript' src='../../../wp-content/themes/pub/wporg-developer/js/skip-link-focus-fix.js?ver=20130115' id='wporg-developer-skip-link-focus-fix-js'></script>
<script type='text/javascript' src='../../../wp-content/themes/pub/wporg-developer/js/search.js?ver=20150430' id='wporg-developer-search-js'></script>
<script type='text/javascript' src='../../../wp-content/themes/pub/wporg-developer/js/menu.js?ver=20180201' id='wporg-developer-menu-js'></script>
<script type='text/javascript' src='../../../wp-content/themes/pub/wporg-developer/js/awesomplete.min.js?ver=20160322' id='awesomplete-js'></script>
<script type='text/javascript' id='autocomplete-js-extra'>
/* <![CDATA[ */
var autocomplete = {"ajaxurl":"https:\/\/developer.wordpress.org\/wp-admin\/admin-ajax.php","nonce":"8a60f70c4b"};
/* ]]> */
</script>
<script type='text/javascript' src='../../../wp-content/themes/pub/wporg-developer/js/autocomplete.js?ver=20160524' id='autocomplete-js'></script>
<script type='text/javascript' src='../../../wp-content/themes/pub/wporg-developer/js/function-reference.js?ver=20180724' id='wporg-developer-function-reference-js'></script>
<script type='text/javascript' id='quicktags-js-extra'>
/* <![CDATA[ */
var quicktagsL10n = {"closeAllOpenTags":"Close all open tags","closeTags":"close tags","enterURL":"Enter the URL","enterImageURL":"Enter the URL of the image","enterImageDescription":"Enter a description of the image","textdirection":"text direction","toggleTextdirection":"Toggle Editor Text Direction","dfw":"Distraction-free writing mode","strong":"Bold","strongClose":"Close bold tag","em":"Italic","emClose":"Close italic tag","link":"Insert link","blockquote":"Blockquote","blockquoteClose":"Close blockquote tag","del":"Deleted text (strikethrough)","delClose":"Close deleted text tag","ins":"Inserted text","insClose":"Close inserted text tag","image":"Insert image","ul":"Bulleted list","ulClose":"Close bulleted list tag","ol":"Numbered list","olClose":"Close numbered list tag","li":"List item","liClose":"Close list item tag","code":"Code","codeClose":"Close code tag","more":"Insert Read More tag"};
/* ]]> */
</script>
<script type='text/javascript' src='../../../wp-includes/js/quicktags.min.js?ver=5.9-alpha-51701' id='quicktags-js'></script>
<script type='text/javascript' src='../../../wp-content/themes/pub/wporg-developer/js/user-notes.js?ver=20200110' id='wporg-developer-user-notes-js'></script>
<script type='text/javascript' id='wporg-developer-user-notes-feedback-js-extra'>
/* <![CDATA[ */
var wporg_note_feedback = {"show":"Show Feedback","hide":"Hide Feedback"};
/* ]]> */
</script>
<script type='text/javascript' src='../../../wp-content/themes/pub/wporg-developer/js/user-notes-feedback.js?ver=20181023' id='wporg-developer-user-notes-feedback-js'></script>
<script type='text/javascript' src='../../../wp-content/themes/pub/wporg-developer/js/tabs.js?ver=20160824' id='wporg-developer-tabs-js'></script>
<script type='text/javascript' id='wporg-developer-preview-js-extra'>
/* <![CDATA[ */
var wporg_note_preview = {"ajaxurl":"https:\/\/developer.wordpress.org\/wp-admin\/admin-ajax.php","nonce":"504933b60e","preview":"preview note","preview_empty":"Nothing to preview","is_admin":""};
/* ]]> */
</script>
<script type='text/javascript' src='../../../wp-content/themes/pub/wporg-developer/js/user-notes-preview.js?ver=20200111' id='wporg-developer-preview-js'></script>
<script type='text/javascript' src='../../../wp-includes/js/wp-embed.min.js?ver=5.9-alpha-51701' id='wp-embed-js'></script>
<script type='text/javascript' src='../../../wp-includes/js/dist/vendor/regenerator-runtime.min.js?ver=0.13.7' id='regenerator-runtime-js'></script>
<script type='text/javascript' src='../../../wp-includes/js/dist/vendor/wp-polyfill.min.js?ver=3.15.0' id='wp-polyfill-js'></script>
<script type='text/javascript' src='../../../wp-includes/js/dist/dom-ready.min.js?ver=71883072590656bf22c74c7b887df3dd' id='wp-dom-ready-js'></script>
<script type='text/javascript' src='../../../wp-includes/js/dist/hooks.min.js?ver=a7edae857aab69d69fa10d5aef23a5de' id='wp-hooks-js'></script>
<script type='text/javascript' src='../../../wp-includes/js/dist/i18n.min.js?ver=5f1269854226b4dd90450db411a12b79' id='wp-i18n-js'></script>
<script type='text/javascript' id='wp-i18n-js-after'>
wp.i18n.setLocaleData( { 'text direction\u0004ltr': [ 'ltr' ] } );
</script>
<script type='text/javascript' id='wp-a11y-js-translations'>
( function( domain, translations ) {
	var localeData = translations.locale_data[ domain ] || translations.locale_data.messages;
	localeData[""].domain = domain;
	wp.i18n.setLocaleData( localeData, domain );
} )( "default", { "locale_data": { "messages": { "": {} } } } );
</script>
<script type='text/javascript' src='../../../wp-includes/js/dist/a11y.min.js?ver=0ac8327cc1c40dcfdf29716affd7ac63' id='wp-a11y-js'></script>
<script type='text/javascript' id='wplink-js-extra'>
/* <![CDATA[ */
var wpLinkL10n = {"title":"Insert\/edit link","update":"Update","save":"Add Link","noTitle":"(no title)","noMatchesFound":"No results found.","linkSelected":"Link selected.","linkInserted":"Link inserted.","minInputLength":"3"};
/* ]]> */
</script>
<script type='text/javascript' src='../../../wp-includes/js/wplink.min.js?ver=5.9-alpha-51701' id='wplink-js'></script>
<script type='text/javascript' src='../../../wp-includes/js/jquery/ui/core.min.js?ver=1.12.1' id='jquery-ui-core-js'></script>
<script type='text/javascript' src='../../../wp-includes/js/jquery/ui/menu.min.js?ver=1.12.1' id='jquery-ui-menu-js'></script>
<script type='text/javascript' id='jquery-ui-autocomplete-js-extra'>
/* <![CDATA[ */
var uiAutocompleteL10n = {"noResults":"No results found.","oneResult":"1 result found. Use up and down arrow keys to navigate.","manyResults":"%d results found. Use up and down arrow keys to navigate.","itemSelected":"Item selected."};
/* ]]> */
</script>
<script type='text/javascript' src='../../../wp-includes/js/jquery/ui/autocomplete.min.js?ver=1.12.1' id='jquery-ui-autocomplete-js'></script>

		<script type="text/javascript">
		tinyMCEPreInit = {
			baseURL: "https://developer.wordpress.org/wp-includes/js/tinymce",
			suffix: ".min",
						mceInit: {},
			qtInit: {'comment':{id:"comment",buttons:"strong,em,ul,ol,li,link"}},
			ref: {plugins:"",theme:"modern",language:""},
			load_ext: function(url,lang){var sl=tinymce.ScriptLoader;sl.markDone(url+'/langs/'+lang+'.js');sl.markDone(url+'/langs/'+lang+'_dlg.js');}
		};
		</script>
				<script type="text/javascript">
		var ajaxurl = "../../../wp-admin/admin-ajax.html";
		( function() {
			var initialized = [];
			var initialize  = function() {
				var init, id, inPostbox, $wrap;
				var readyState = document.readyState;

				if ( readyState !== 'complete' && readyState !== 'interactive' ) {
					return;
				}

				for ( id in tinyMCEPreInit.mceInit ) {
					if ( initialized.indexOf( id ) > -1 ) {
						continue;
					}

					init      = tinyMCEPreInit.mceInit[id];
					$wrap     = tinymce.$( '#wp-' + id + '-wrap' );
					inPostbox = $wrap.parents( '.postbox' ).length > 0;

					if (
						! init.wp_skip_init &&
						( $wrap.hasClass( 'tmce-active' ) || ! tinyMCEPreInit.qtInit.hasOwnProperty( id ) ) &&
						( readyState === 'complete' || ( ! inPostbox && readyState === 'interactive' ) )
					) {
						tinymce.init( init );
						initialized.push( id );

						if ( ! window.wpActiveEditor ) {
							window.wpActiveEditor = id;
						}
					}
				}
			}

			if ( typeof tinymce !== 'undefined' ) {
				if ( tinymce.Env.ie && tinymce.Env.ie < 11 ) {
					tinymce.$( '.wp-editor-wrap ' ).removeClass( 'tmce-active' ).addClass( 'html-active' );
				} else {
					if ( document.readyState === 'complete' ) {
						initialize();
					} else {
						document.addEventListener( 'readystatechange', initialize );
					}
				}
			}

			if ( typeof quicktags !== 'undefined' ) {
				for ( id in tinyMCEPreInit.qtInit ) {
					quicktags( tinyMCEPreInit.qtInit[id] );

					if ( ! window.wpActiveEditor ) {
						window.wpActiveEditor = id;
					}
				}
			}
		}());
		</script>
				<div id="wp-link-backdrop" style="display: none"></div>
		<div id="wp-link-wrap" class="wp-core-ui" style="display: none" role="dialog" aria-labelledby="link-modal-title">
		<form id="wp-link" tabindex="-1">
		<input type="hidden" id="_ajax_linking_nonce" name="_ajax_linking_nonce" value="86f5a0a85d" />		<h1 id="link-modal-title">Insert/edit link</h1>
		<button type="button" id="wp-link-close"><span class="screen-reader-text">Close</span></button>
		<div id="link-selector">
			<div id="link-options">
				<p class="howto" id="wplink-enter-url">Enter the destination URL</p>
				<div>
					<label><span>URL</span>
					<input id="wp-link-url" type="text" aria-describedby="wplink-enter-url" /></label>
				</div>
				<div class="wp-link-text-field">
					<label><span>Link Text</span>
					<input id="wp-link-text" type="text" /></label>
				</div>
				<div class="link-target">
					<label><span></span>
					<input type="checkbox" id="wp-link-target" /> Open link in a new tab</label>
				</div>
			</div>
			<p class="howto" id="wplink-link-existing-content">Or link to existing content</p>
			<div id="search-panel">
				<div class="link-search-wrapper">
					<label>
						<span class="search-label">Search</span>
						<input type="search" id="wp-link-search" class="link-search-field" autocomplete="off" aria-describedby="wplink-link-existing-content" />
						<span class="spinner"></span>
					</label>
				</div>
				<div id="search-results" class="query-results" tabindex="0">
					<ul></ul>
					<div class="river-waiting">
						<span class="spinner"></span>
					</div>
				</div>
				<div id="most-recent-results" class="query-results" tabindex="0">
					<div class="query-notice" id="query-notice-message">
						<em class="query-notice-default">No search term specified. Showing recent items.</em>
						<em class="query-notice-hint screen-reader-text">Search or use up and down arrow keys to select an item.</em>
					</div>
					<ul></ul>
					<div class="river-waiting">
						<span class="spinner"></span>
					</div>
				</div>
			</div>
		</div>
		<div class="submitbox">
			<div id="wp-link-cancel">
				<button type="button" class="button">Cancel</button>
			</div>
			<div id="wp-link-update">
				<input type="submit" value="Add Link" class="button button-primary" id="wp-link-submit" name="wp-link-submit">
			</div>
		</div>
		</form>
		</div>
		</body>

<!-- Mirrored from developer.wordpress.org/reference/classes/wp_rewrite/ by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 31 Aug 2021 16:55:01 GMT -->
</html>
