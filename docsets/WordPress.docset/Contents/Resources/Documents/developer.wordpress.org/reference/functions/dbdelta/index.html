<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">

<!-- Mirrored from developer.wordpress.org/reference/functions/dbdelta/ by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 31 Aug 2021 17:11:48 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<!--
<meta property="fb:page_id" content="6427302910" />
-->
<meta name="google-site-verification" content="7VWES_-rcHBcmaQis9mSYamPfNwE03f4vyTj4pfuAw0" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>dbDelta()</title>
<meta name="referrer" content="always">

		<link href='../../../../fonts.googleapis.com/css.css?family=Open+Sans:300italic,400italic,600italic,400,300,600&amp;subset=latin,cyrillic-ext,greek-ext,greek,vietnamese,latin-ext,cyrillic' rel='stylesheet' type='text/css'>

		<link rel="stylesheet" href="../../../../s.w.org/style/wp4.css?95" />

<link rel="shortcut icon" href="../../../../s.w.org/favicon.ico?2" type="image/x-icon" />
<link rel="pingback" href="../../../xmlrpc.php" /><meta name='robots' content='max-image-preview:large' />
<link rel='dns-prefetch' href='../../../../fonts.googleapis.com/index.html' />
<link rel='dns-prefetch' href='http://s.w.org/' />
<link rel='dns-prefetch' href='http://www.googletagmanager.com/' />
<link rel='dns-prefetch' href='http://fonts.gstatic.com/' />
<link rel="alternate" type="application/rss+xml" title="WordPress Developer Resources &raquo; Feed" href="../../../feed/index.html" />
<link rel="alternate" type="application/rss+xml" title="WordPress Developer Resources &raquo; Comments Feed" href="../../../comments/feed/index.html" />
<meta property="og:title" content="dbDelta() | Function | WordPress Developer Resources" />
<meta property="og:site_name" content="WordPress Developer Resources" />
<meta property="og:type" content="website" />
<meta property="og:url" content="../../../index.html" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@WordPress" />
<meta name="description" content="Modifies the database based on specified SQL statements." />
<meta property="og:description" content="Modifies the database based on specified SQL statements." />
<link rel="alternate" type="application/rss+xml" title="WordPress Developer Resources &raquo; dbDelta Comments Feed" href="https://developer.wordpress.org/reference/functions/dbdelta/feed/" />
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'../../../../www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-P24PF4B');</script>
			<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.1.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.1.0\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/developer.wordpress.org\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.9-alpha-51701"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([10084,65039,8205,55357,56613],[10084,65039,8203,55357,56613])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='dashicons-css'  href='../../../wp-includes/css/dashicons.min.css?ver=5.9-alpha-51701' type='text/css' media='all' />
<link rel='stylesheet' id='admin-bar-css'  href='../../../wp-includes/css/admin-bar.min.css?ver=5.9-alpha-51701' type='text/css' media='all' />
<link rel='stylesheet' id='wp-block-library-css'  href='../../../wp-includes/css/dist/block-library/style.min.css?ver=5.9-alpha-51701' type='text/css' media='all' />
<link rel='stylesheet' id='wporg-handbook-css-css'  href='../../../wp-content/plugins/handbook/stylesheets/callout-boxes.css?ver=20200121' type='text/css' media='all' />
<link rel='stylesheet' id='open-sans-css'  href='../../../../fonts.googleapis.com/css-2.css?family=Open+Sans%3A300italic%2C400italic%2C600italic%2C300%2C400%2C600&amp;subset=latin%2Clatin-ext&amp;display=fallback&amp;ver=5.9-alpha-51701' type='text/css' media='all' />
<link rel='stylesheet' id='wporg-developer-style-css'  href='../../../wp-content/themes/pub/wporg-developer/style.css?ver=3' type='text/css' media='all' />
<link rel='stylesheet' id='wp-dev-sass-compiled-css'  href='../../../wp-content/themes/pub/wporg-developer/stylesheets/main.css?ver=20200713' type='text/css' media='all' />
<link rel='stylesheet' id='awesomplete-css-css'  href='../../../wp-content/themes/pub/wporg-developer/stylesheets/awesomplete.css?ver=20160114' type='text/css' media='all' />
<link rel='stylesheet' id='autocomplete-css-css'  href='../../../wp-content/themes/pub/wporg-developer/stylesheets/autocomplete.css?ver=20171220' type='text/css' media='all' />
<link rel='stylesheet' id='syntaxhighlighter-core-css'  href='../../../wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.9b' type='text/css' media='all' />
<link rel='stylesheet' id='syntaxhighlighter-theme-default-css'  href='../../../wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.9b' type='text/css' media='all' />
<script type='text/javascript' src='../../../wp-includes/js/jquery/jquery.min.js?ver=3.6.0' id='jquery-core-js'></script>
<script type='text/javascript' src='../../../wp-includes/js/jquery/jquery-migrate.min.js?ver=3.3.2' id='jquery-migrate-js'></script>
<script type='text/javascript' src='../../../wp-content/plugins/handbook/scripts/handbook.js?ver=20150930' id='wporg-handbook-js'></script>
<script type='text/javascript' src='../../../wp-content/themes/pub/wporg-developer/js/chapters.js?ver=20190603' id='wporg-developer-chapters-js'></script>
<script type='text/javascript' src='../../../wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.9b' id='syntaxhighlighter-core-js'></script>
<script type='text/javascript' src='../../../wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushPhp.js?ver=3.0.9b' id='syntaxhighlighter-brush-php-js'></script>
<link rel="https://api.w.org/" href="https://developer.wordpress.org/wp-json/" /><link rel="alternate" type="application/json" href="https://developer.wordpress.org/wp-json/wp/v2/wp-parser-function/4835" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../../xmlrpc-2.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../../../wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.9-alpha-51701" />
<link rel='shortlink' href='https://developer.wordpress.org/?p=4835' />
<link rel="alternate" type="application/json+oembed" href="https://developer.wordpress.org/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Ffunctions%2Fdbdelta%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://developer.wordpress.org/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Ffunctions%2Fdbdelta%2F&amp;format=xml" />
<link rel="canonical" href="index.html">
<!-- Stream WordPress user activity plugin v3.6.2 -->
	<style>
		@media screen and (max-width: 782px) {
			#wpadminbar li#wp-admin-bar-log-in,
			#wpadminbar li#wp-admin-bar-register {
				display: block;
			}

			#wpadminbar li#wp-admin-bar-log-in a,
			#wpadminbar li#wp-admin-bar-register a {
				padding: 0 8px;
			}
		}
	</style>
		<style>
			a.github-edit {
				margin-left: .5em;
				font-size: .5em;
				vertical-align: top;
				display: inline-block;
				border: 1px solid #eeeeee;
				border-radius: 2px;
				background: #eeeeee;
				padding: .5em .6em .4em;
				color: black;
				margin-top: 0.1em;
			}
			a.github-edit > * {
				opacity: 0.6;
			}
			a.github-edit:hover > * {
				opacity: 1;
				color: black;
			}
			a.github-edit img {
				height: .8em;
			}
		</style>
		
	<script type="text/javascript">
		jQuery( '<style>.hide-if-js { display: none; }</style>' ).appendTo( 'head' );
		jQuery( function($) {
			$( 'body' ).addClass('js');
		} );
	</script>
<style type="text/css" media="print">#wpadminbar { display:none; }</style>
	<style type="text/css" media="screen">
	</style>
	<script>document.cookie='devicePixelRatio='+((window.devicePixelRatio === undefined) ? 1 : window.devicePixelRatio)+'; path=/';</script>

</head>


<body id="wordpress-org" class="wp-parser-function-template-default single single-wp-parser-function postid-4835 admin-bar no-customize-support">
		<div id="wpadminbar" class="nojq nojs">
						<div class="quicklinks" id="wp-toolbar" role="navigation" aria-label="Toolbar">
				<ul id='wp-admin-bar-root-default' class="ab-top-menu"><li id='wp-admin-bar-wp-logo' class="menupop"><a class='ab-item' aria-haspopup="true" href='https://wordpress.org/about/'><span class="ab-icon" aria-hidden="true"></span><span class="screen-reader-text">About WordPress</span></a><div class="ab-sub-wrapper"><ul id='wp-admin-bar-wp-logo-default' class="ab-submenu"><li id='wp-admin-bar-about'><a class='ab-item' href='https://wordpress.org/about/'>About WordPress</a></li></ul><ul id='wp-admin-bar-wp-logo-external' class="ab-sub-secondary ab-submenu"><li id='wp-admin-bar-wporg'><a class='ab-item' href='https://wordpress.org/'>WordPress.org</a></li><li id='wp-admin-bar-documentation'><a class='ab-item' href='https://wordpress.org/support/'>Documentation</a></li><li id='wp-admin-bar-support-forums'><a class='ab-item' href='https://wordpress.org/support/forums/'>Support</a></li><li id='wp-admin-bar-feedback'><a class='ab-item' href='https://wordpress.org/support/forum/requests-and-feedback'>Feedback</a></li></ul></div></li></ul><ul id='wp-admin-bar-top-secondary' class="ab-top-secondary ab-top-menu"><li id='wp-admin-bar-search' class="admin-bar-search"><div class="ab-item ab-empty-item" tabindex="-1"><form action="https://developer.wordpress.org/" method="get" id="adminbarsearch"><input class="adminbar-input" name="s" id="adminbar-search" type="text" value="" maxlength="150" /><label for="adminbar-search" class="screen-reader-text">Search</label><input type="submit" class="adminbar-button" value="Search" /></form></div></li><li id='wp-admin-bar-log-in'><a class='ab-item' href='https://login.wordpress.org/?locale=en_US'>Log In</a></li><li id='wp-admin-bar-register'><a class='ab-item' href='https://login.wordpress.org/register?locale=en_US'>Register</a></li></ul>			</div>
					</div>

		<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P24PF4B" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
	<div id="wporg-header">
	<div class="wrapper">
	<h1><a href="http://wordpress.org/">WordPress.org</a></h1>				<div id="head-search">
		<form action="http://wordpress.org/search/do-search.php" method="get">
			<label for="global-search" class="screen-reader-text">Search WordPress.org for:</label>
			<input id="global-search" class="text" name="search" type="text" value="" maxlength="150" placeholder="Search WordPress.org" />
			<button type="submit" class="button"><span class="screen-reader-text">Submit</span></button>
		</form>
		</div>
				<div style="clear:both"></div>
		<button id="mobile-menu-button" aria-expanded="false"><span class="screen-reader-text">Toggle Menu</span></button>
		
<nav aria-label="Main Menu">
<ul id="wporg-header-menu">
<li class="menu-item"><a href='http://wordpress.org/showcase/' data-title='See some of the sites built on WordPress.'>Showcase</a></li>
<li class="menu-item"><a href='http://learn.wordpress.org/' data-title='Resources to help you learn more about WordPress and teach it to others.'>Learn</a></li>
<li class="menu-item"><a href='http://wordpress.org/themes/' data-title='Find just the right look for your website.'>Themes</a></li>
<li class="menu-item"><a href='http://wordpress.org/plugins/' data-title='Plugins can extend WordPress to do almost anything you can imagine.'>Plugins</a></li>
<li class="menu-item"><a href='http://wordpress.org/mobile/' data-title='Take your website on the go!'>Mobile</a></li>
<li class="menu-item"><a href='http://wordpress.org/support/' data-title='Forums, documentation, help.'>Support</a><ul class="nav-submenu"><li><a href='http://wordpress.org/support/' title='Documentation, tutorials, best practices.'>Documentation</a></li><li><a href='http://wordpress.org/support/forums/' title='Support and discussion forums.'>Forums</a></li></ul><div class="uparrow"></div></li>
<li class="menu-item"><a href='http://make.wordpress.org/' data-title='Contribute your knowledge.'>Get Involved</a><ul class="nav-submenu"><li><a href='http://wordpress.org/five-for-the-future/' title='How five percent is powering the next generation of the web'>Five for the Future</a></li></ul><div class="uparrow"></div></li>
<li class="menu-item"><a href='http://wordpress.org/about/' data-title='About the WordPress Organization, and where we&#039;re going.'>About</a></li>
<li class="menu-item"><a href='http://wordpress.org/news/' data-title='Come here for the latest scoop.'>Blog</a></li>
<li class="menu-item"><a href='http://wordpress.org/hosting/' data-title='Find a home for your blog.'>Hosting</a></li>
<li id="download" class="button download-button menu-item"><a href='http://wordpress.org/download/' data-title='Get it. Got it? Good.'>Get WordPress</a></li>
</ul>
</nav>
		<div style="clear:both"></div>
	</div>
</div>



<header id="masthead" class="site-header" role="banner">
		<div class="site-branding">
		<h1 class="site-title">
			<a href="../../index.html" rel="home">Code Reference</a>
		</h1>

		
		<nav id="site-navigation" class="main-navigation" role="navigation">
			<button class="menu-toggle dashicons dashicons-arrow-down-alt2" aria-controls="primary-menu" aria-expanded="false" aria-label="Primary Menu"></button>
					</nav>
	</div>
</header><!-- #masthead -->

<div id="page" class="hfeed site devhub-wrap">
	<a href="#main" class="screen-reader-text">Skip to content</a>

				<div id="inner-search">
			<div class="search-section section clear hide-if-js">


	
	<form role="search" method="get" class="searchform searchform-filtered" action="https://developer.wordpress.org/">
		<label for="search-field" class="screen-reader-text">Search for:</label>
		<input type="text" id="search-field" class="search-field" placeholder="Search &hellip;" value="" name="s">
		<button class="button button-primary button-search"><i class="dashicons dashicons-search"></i><span class="screen-reader-text">Search plugins</span></button>
	
		<div class="search-post-type">
			<span>Filter by type:</span>
									<label><input type="checkbox" name="post_type[]" value="wp-parser-function"
						 /> Functions</label>
									<label><input type="checkbox" name="post_type[]" value="wp-parser-hook"
						 /> Hooks</label>
									<label><input type="checkbox" name="post_type[]" value="wp-parser-class"
						 /> Classes</label>
									<label><input type="checkbox" name="post_type[]" value="wp-parser-method"
						 /> Methods</label>
					</div>

	
	</form>

</div><!-- /search-guide -->
			<div id="inner-search-icon-container">
				<div id="inner-search-icon">
					<div class="dashicons dashicons-search"><span class="screen-reader-text">Search</span></div>
				</div>
			</div>
		</div>

		<div id="content" class="site-content">

	<div id="content-area" class="wp-parser-function-template-default single single-wp-parser-function postid-4835 admin-bar no-customize-support code-reference">

		
		<div class="breadcrumb-trail breadcrumbs" itemprop="breadcrumb">
			<span class="trail-browse">Browse:</span> 
			<span class="trail-begin"><a href="../../../index.html" title="WordPress Developer Resources" rel="home">Home</a></span> <span class="sep">&#47;</span> 
			<span class="trail-inner"><a href="../../index.html" title="Reference">Reference</a></span> <span class="sep">&#47;</span> 
			<span class="trail-inner"><a href="../index.html">Functions</a></span> <span class="sep">&#47;</span> <span class="trail-end">dbDelta()</span>
		</div>
		<main id="main" class="site-main" role="main">

		
			
<article id="post-4835" class="post-4835 wp-parser-function type-wp-parser-function status-publish hentry wp-parser-source-file-wp-admin_includes_upgrade-php wp-parser-package-administration wp-parser-package-wordpress wp-parser-since-1-5-0">

	
	
	<h1>dbDelta( <span class="arg-type">string[]|string</span>&nbsp;<span class="arg-name">$queries</span>&nbsp;=&nbsp;<span class="arg-default">''</span>,  <span class="arg-type">bool</span>&nbsp;<span class="arg-name">$execute</span>&nbsp;=&nbsp;<span class="arg-default">true</span>&nbsp;)</h1>

	<section class="summary">
		<p>Modifies the database based on specified SQL statements.</p>
	</section>


	
	<div class="content-toc"><style> .toc-jump { text-align: right; font-size: 12px; } .page .toc-heading { margin-top: -50px; padding-top: 50px !important; }</style><div class="table-of-contents"><h2>Contents</h2><ul class="items"><li><a href="#description">Description</a></li>
<li><a href="#parameters">Parameters</a></li>
<li><a href="#return">Return</a></li>
<li><a href="#source">Source</a></li>
<li><a href="#related">Related</a>
<ul>
<li><a href="#uses">Uses</a></li>
<li><a href="#used-by">Used By</a>
</ul></li>
<li><a href="#changelog">Changelog</a></li>
<li><a href="#user-contributed-notes">User Contributed Notes</a></ul>
</div>

<hr />
<section class="description">
	<h2 class="toc-heading" id="description" tabindex="-1">Description <a href="#description" class="anchor"><span aria-hidden="true">#</span><span class="screen-reader-text">Description</span></a></h2>
	<p>Useful for creating new tables and updating existing tables to a new structure.</p>

	</section>

	<hr />
	<section class="parameters">
		<p class="toc-jump"><a href="#top">Top &uarr;</a></p><h2 class="toc-heading" id="parameters" tabindex="-1">Parameters <a href="#parameters" class="anchor"><span aria-hidden="true">#</span><span class="screen-reader-text">Parameters</span></a></h2>
		<dl>
												<dt>$queries</dt>
								<dd>
					<p class="desc">
													<span class="type">(<span class="string[]">string[]</span>|<span class="string">string</span>)</span>
																			<span class="required">(Optional)</span>
																			<span class="description"> The query to run. Can be multiple queries                                 in an array, or a string of queries separated by                                 semicolons. </span>
											</p>
											<p class="default">Default value: ''</p>
									</dd>
												<dt>$execute</dt>
								<dd>
					<p class="desc">
													<span class="type">(<span class="bool">bool</span>)</span>
																			<span class="required">(Optional)</span>
																			<span class="description"> Whether or not to execute the query right away.                                 </span>
											</p>
											<p class="default">Default value: true</p>
									</dd>
					</dl>
	</section>
	<hr />
	<section class="return">
		<p class="toc-jump"><a href="#top">Top &uarr;</a></p><h2 class="toc-heading" id="return" tabindex="-1">Return <a href="#return" class="anchor"><span aria-hidden="true">#</span><span class="screen-reader-text">Return</span></a></h2>
		<p><span class='return-type'>(array)</span> Strings containing the results of the various update queries.</p>
	</section>
	<hr />
	<section class="source-content">
		<p class="toc-jump"><a href="#top">Top &uarr;</a></p><h2 class="toc-heading" id="source" tabindex="-1">Source <a href="#source" class="anchor"><span aria-hidden="true">#</span><span class="screen-reader-text">Source</span></a></h2>
		<p>
			File: <a href="../../files/wp-admin/includes/upgrade.php/index.html">wp-admin/includes/upgrade.php</a>		</p>

					<div class="source-code-container">
				<pre class="brush: php; toolbar: false; first-line: 2672">function dbDelta( $queries = '', $execute = true ) { // phpcs:ignore WordPress.NamingConventions.ValidFunctionName.FunctionNameInvalid
	global $wpdb;

	if ( in_array( $queries, array( '', 'all', 'blog', 'global', 'ms_global' ), true ) ) {
		$queries = wp_get_db_schema( $queries );
	}

	// Separate individual queries into an array.
	if ( ! is_array( $queries ) ) {
		$queries = explode( ';', $queries );
		$queries = array_filter( $queries );
	}

	/**
	 * Filters the dbDelta SQL queries.
	 *
	 * @since 3.3.0
	 *
	 * @param string[] $queries An array of dbDelta SQL queries.
	 */
	$queries = apply_filters( 'dbdelta_queries', $queries );

	$cqueries   = array(); // Creation queries.
	$iqueries   = array(); // Insertion queries.
	$for_update = array();

	// Create a tablename index for an array ($cqueries) of queries.
	foreach ( $queries as $qry ) {
		if ( preg_match( '|CREATE TABLE ([^ ]*)|', $qry, $matches ) ) {
			$cqueries[ trim( $matches[1], '`' ) ] = $qry;
			$for_update[ $matches[1] ]            = 'Created table ' . $matches[1];
		} elseif ( preg_match( '|CREATE DATABASE ([^ ]*)|', $qry, $matches ) ) {
			array_unshift( $cqueries, $qry );
		} elseif ( preg_match( '|INSERT INTO ([^ ]*)|', $qry, $matches ) ) {
			$iqueries[] = $qry;
		} elseif ( preg_match( '|UPDATE ([^ ]*)|', $qry, $matches ) ) {
			$iqueries[] = $qry;
		} else {
			// Unrecognized query type.
		}
	}

	/**
	 * Filters the dbDelta SQL queries for creating tables and/or databases.
	 *
	 * Queries filterable via this hook contain &quot;CREATE TABLE&quot; or &quot;CREATE DATABASE&quot;.
	 *
	 * @since 3.3.0
	 *
	 * @param string[] $cqueries An array of dbDelta create SQL queries.
	 */
	$cqueries = apply_filters( 'dbdelta_create_queries', $cqueries );

	/**
	 * Filters the dbDelta SQL queries for inserting or updating.
	 *
	 * Queries filterable via this hook contain &quot;INSERT INTO&quot; or &quot;UPDATE&quot;.
	 *
	 * @since 3.3.0
	 *
	 * @param string[] $iqueries An array of dbDelta insert or update SQL queries.
	 */
	$iqueries = apply_filters( 'dbdelta_insert_queries', $iqueries );

	$text_fields = array( 'tinytext', 'text', 'mediumtext', 'longtext' );
	$blob_fields = array( 'tinyblob', 'blob', 'mediumblob', 'longblob' );

	$global_tables = $wpdb-&gt;tables( 'global' );
	foreach ( $cqueries as $table =&gt; $qry ) {
		// Upgrade global tables only for the main site. Don't upgrade at all if conditions are not optimal.
		if ( in_array( $table, $global_tables, true ) &amp;&amp; ! wp_should_upgrade_global_tables() ) {
			unset( $cqueries[ $table ], $for_update[ $table ] );
			continue;
		}

		// Fetch the table column structure from the database.
		$suppress    = $wpdb-&gt;suppress_errors();
		$tablefields = $wpdb-&gt;get_results( &quot;DESCRIBE {$table};&quot; );
		$wpdb-&gt;suppress_errors( $suppress );

		if ( ! $tablefields ) {
			continue;
		}

		// Clear the field and index arrays.
		$cfields                  = array();
		$indices                  = array();
		$indices_without_subparts = array();

		// Get all of the field names in the query from between the parentheses.
		preg_match( '|\((.*)\)|ms', $qry, $match2 );
		$qryline = trim( $match2[1] );

		// Separate field lines into an array.
		$flds = explode( &quot;\n&quot;, $qryline );

		// For every field line specified in the query.
		foreach ( $flds as $fld ) {
			$fld = trim( $fld, &quot; \t\n\r\0\x0B,&quot; ); // Default trim characters, plus ','.

			// Extract the field name.
			preg_match( '|^([^ ]*)|', $fld, $fvals );
			$fieldname            = trim( $fvals[1], '`' );
			$fieldname_lowercased = strtolower( $fieldname );

			// Verify the found field name.
			$validfield = true;
			switch ( $fieldname_lowercased ) {
				case '':
				case 'primary':
				case 'index':
				case 'fulltext':
				case 'unique':
				case 'key':
				case 'spatial':
					$validfield = false;

					/*
					 * Normalize the index definition.
					 *
					 * This is done so the definition can be compared against the result of a
					 * `SHOW INDEX FROM $table_name` query which returns the current table
					 * index information.
					 */

					// Extract type, name and columns from the definition.
					// phpcs:disable Squiz.Strings.ConcatenationSpacing.PaddingFound -- don't remove regex indentation
					preg_match(
						'/^'
						.   '(?P&lt;index_type&gt;'             // 1) Type of the index.
						.       'PRIMARY\s+KEY|(?:UNIQUE|FULLTEXT|SPATIAL)\s+(?:KEY|INDEX)|KEY|INDEX'
						.   ')'
						.   '\s+'                         // Followed by at least one white space character.
						.   '(?:'                         // Name of the index. Optional if type is PRIMARY KEY.
						.       '`?'                      // Name can be escaped with a backtick.
						.           '(?P&lt;index_name&gt;'     // 2) Name of the index.
						.               '(?:[0-9a-zA-Z$_-]|[\xC2-\xDF][\x80-\xBF])+'
						.           ')'
						.       '`?'                      // Name can be escaped with a backtick.
						.       '\s+'                     // Followed by at least one white space character.
						.   ')*'
						.   '\('                          // Opening bracket for the columns.
						.       '(?P&lt;index_columns&gt;'
						.           '.+?'                 // 3) Column names, index prefixes, and orders.
						.       ')'
						.   '\)'                          // Closing bracket for the columns.
						. '$/im',
						$fld,
						$index_matches
					);
					// phpcs:enable

					// Uppercase the index type and normalize space characters.
					$index_type = strtoupper( preg_replace( '/\s+/', ' ', trim( $index_matches['index_type'] ) ) );

					// 'INDEX' is a synonym for 'KEY', standardize on 'KEY'.
					$index_type = str_replace( 'INDEX', 'KEY', $index_type );

					// Escape the index name with backticks. An index for a primary key has no name.
					$index_name = ( 'PRIMARY KEY' === $index_type ) ? '' : '`' . strtolower( $index_matches['index_name'] ) . '`';

					// Parse the columns. Multiple columns are separated by a comma.
					$index_columns                  = array_map( 'trim', explode( ',', $index_matches['index_columns'] ) );
					$index_columns_without_subparts = $index_columns;

					// Normalize columns.
					foreach ( $index_columns as $id =&gt; &amp;$index_column ) {
						// Extract column name and number of indexed characters (sub_part).
						preg_match(
							'/'
							. '`?'                      // Name can be escaped with a backtick.
							. '(?P&lt;column_name&gt;'    // 1) Name of the column.
							. '(?:[0-9a-zA-Z$_-]|[\xC2-\xDF][\x80-\xBF])+'
							. ')'
							. '`?'                      // Name can be escaped with a backtick.
							. '(?:'                     // Optional sub part.
							. '\s*'                 // Optional white space character between name and opening bracket.
							. '\('                  // Opening bracket for the sub part.
							. '\s*'             // Optional white space character after opening bracket.
							. '(?P&lt;sub_part&gt;'
							. '\d+'         // 2) Number of indexed characters.
							. ')'
							. '\s*'             // Optional white space character before closing bracket.
							. '\)'                 // Closing bracket for the sub part.
							. ')?'
							. '/',
							$index_column,
							$index_column_matches
						);

						// Escape the column name with backticks.
						$index_column = '`' . $index_column_matches['column_name'] . '`';

						// We don't need to add the subpart to $index_columns_without_subparts
						$index_columns_without_subparts[ $id ] = $index_column;

						// Append the optional sup part with the number of indexed characters.
						if ( isset( $index_column_matches['sub_part'] ) ) {
							$index_column .= '(' . $index_column_matches['sub_part'] . ')';
						}
					}

					// Build the normalized index definition and add it to the list of indices.
					$indices[]                  = &quot;{$index_type} {$index_name} (&quot; . implode( ',', $index_columns ) . ')';
					$indices_without_subparts[] = &quot;{$index_type} {$index_name} (&quot; . implode( ',', $index_columns_without_subparts ) . ')';

					// Destroy no longer needed variables.
					unset( $index_column, $index_column_matches, $index_matches, $index_type, $index_name, $index_columns, $index_columns_without_subparts );

					break;
			}

			// If it's a valid field, add it to the field array.
			if ( $validfield ) {
				$cfields[ $fieldname_lowercased ] = $fld;
			}
		}

		// For every field in the table.
		foreach ( $tablefields as $tablefield ) {
			$tablefield_field_lowercased = strtolower( $tablefield-&gt;Field );
			$tablefield_type_lowercased  = strtolower( $tablefield-&gt;Type );

			// If the table field exists in the field array...
			if ( array_key_exists( $tablefield_field_lowercased, $cfields ) ) {

				// Get the field type from the query.
				preg_match( '|`?' . $tablefield-&gt;Field . '`? ([^ ]*( unsigned)?)|i', $cfields[ $tablefield_field_lowercased ], $matches );
				$fieldtype            = $matches[1];
				$fieldtype_lowercased = strtolower( $fieldtype );

				// Is actual field type different from the field type in query?
				if ( $tablefield-&gt;Type != $fieldtype ) {
					$do_change = true;
					if ( in_array( $fieldtype_lowercased, $text_fields, true ) &amp;&amp; in_array( $tablefield_type_lowercased, $text_fields, true ) ) {
						if ( array_search( $fieldtype_lowercased, $text_fields, true ) &lt; array_search( $tablefield_type_lowercased, $text_fields, true ) ) {
							$do_change = false;
						}
					}

					if ( in_array( $fieldtype_lowercased, $blob_fields, true ) &amp;&amp; in_array( $tablefield_type_lowercased, $blob_fields, true ) ) {
						if ( array_search( $fieldtype_lowercased, $blob_fields, true ) &lt; array_search( $tablefield_type_lowercased, $blob_fields, true ) ) {
							$do_change = false;
						}
					}

					if ( $do_change ) {
						// Add a query to change the column type.
						$cqueries[] = &quot;ALTER TABLE {$table} CHANGE COLUMN `{$tablefield-&gt;Field}` &quot; . $cfields[ $tablefield_field_lowercased ];

						$for_update[ $table . '.' . $tablefield-&gt;Field ] = &quot;Changed type of {$table}.{$tablefield-&gt;Field} from {$tablefield-&gt;Type} to {$fieldtype}&quot;;
					}
				}

				// Get the default value from the array.
				if ( preg_match( &quot;| DEFAULT '(.*?)'|i&quot;, $cfields[ $tablefield_field_lowercased ], $matches ) ) {
					$default_value = $matches[1];
					if ( $tablefield-&gt;Default != $default_value ) {
						// Add a query to change the column's default value
						$cqueries[] = &quot;ALTER TABLE {$table} ALTER COLUMN `{$tablefield-&gt;Field}` SET DEFAULT '{$default_value}'&quot;;

						$for_update[ $table . '.' . $tablefield-&gt;Field ] = &quot;Changed default value of {$table}.{$tablefield-&gt;Field} from {$tablefield-&gt;Default} to {$default_value}&quot;;
					}
				}

				// Remove the field from the array (so it's not added).
				unset( $cfields[ $tablefield_field_lowercased ] );
			} else {
				// This field exists in the table, but not in the creation queries?
			}
		}

		// For every remaining field specified for the table.
		foreach ( $cfields as $fieldname =&gt; $fielddef ) {
			// Push a query line into $cqueries that adds the field to that table.
			$cqueries[] = &quot;ALTER TABLE {$table} ADD COLUMN $fielddef&quot;;

			$for_update[ $table . '.' . $fieldname ] = 'Added column ' . $table . '.' . $fieldname;
		}

		// Index stuff goes here. Fetch the table index structure from the database.
		$tableindices = $wpdb-&gt;get_results( &quot;SHOW INDEX FROM {$table};&quot; );

		if ( $tableindices ) {
			// Clear the index array.
			$index_ary = array();

			// For every index in the table.
			foreach ( $tableindices as $tableindex ) {
				$keyname = strtolower( $tableindex-&gt;Key_name );

				// Add the index to the index data array.
				$index_ary[ $keyname ]['columns'][]  = array(
					'fieldname' =&gt; $tableindex-&gt;Column_name,
					'subpart'   =&gt; $tableindex-&gt;Sub_part,
				);
				$index_ary[ $keyname ]['unique']     = ( 0 == $tableindex-&gt;Non_unique ) ? true : false;
				$index_ary[ $keyname ]['index_type'] = $tableindex-&gt;Index_type;
			}

			// For each actual index in the index array.
			foreach ( $index_ary as $index_name =&gt; $index_data ) {

				// Build a create string to compare to the query.
				$index_string = '';
				if ( 'primary' === $index_name ) {
					$index_string .= 'PRIMARY ';
				} elseif ( $index_data['unique'] ) {
					$index_string .= 'UNIQUE ';
				}
				if ( 'FULLTEXT' === strtoupper( $index_data['index_type'] ) ) {
					$index_string .= 'FULLTEXT ';
				}
				if ( 'SPATIAL' === strtoupper( $index_data['index_type'] ) ) {
					$index_string .= 'SPATIAL ';
				}
				$index_string .= 'KEY ';
				if ( 'primary' !== $index_name ) {
					$index_string .= '`' . $index_name . '`';
				}
				$index_columns = '';

				// For each column in the index.
				foreach ( $index_data['columns'] as $column_data ) {
					if ( '' !== $index_columns ) {
						$index_columns .= ',';
					}

					// Add the field to the column list string.
					$index_columns .= '`' . $column_data['fieldname'] . '`';
				}

				// Add the column list to the index create string.
				$index_string .= &quot; ($index_columns)&quot;;

				// Check if the index definition exists, ignoring subparts.
				$aindex = array_search( $index_string, $indices_without_subparts, true );
				if ( false !== $aindex ) {
					// If the index already exists (even with different subparts), we don't need to create it.
					unset( $indices_without_subparts[ $aindex ] );
					unset( $indices[ $aindex ] );
				}
			}
		}

		// For every remaining index specified for the table.
		foreach ( (array) $indices as $index ) {
			// Push a query line into $cqueries that adds the index to that table.
			$cqueries[] = &quot;ALTER TABLE {$table} ADD $index&quot;;

			$for_update[] = 'Added index ' . $table . ' ' . $index;
		}

		// Remove the original table creation query from processing.
		unset( $cqueries[ $table ], $for_update[ $table ] );
	}

	$allqueries = array_merge( $cqueries, $iqueries );
	if ( $execute ) {
		foreach ( $allqueries as $query ) {
			$wpdb-&gt;query( $query );
		}
	}

	return $for_update;
}
</pre>
			</div>
			<p class="source-code-links">
				<span>
					<a href="#" class="show-complete-source">Expand full source code</a>
					<a href="#" class="less-complete-source">Collapse full source code</a>
				</span>
				<span><a href="https://core.trac.wordpress.org/browser/tags/5.8/src/wp-admin/includes/upgrade.php#L2672">View on Trac</a></span>
			</p>
			</section>
	<hr />
	<section class="related">
		<p class="toc-jump"><a href="#top">Top &uarr;</a></p><h2 class="toc-heading" id="related" tabindex="-1">Related <a href="#related" class="anchor"><span aria-hidden="true">#</span><span class="screen-reader-text">Related</span></a></h2>

					<article class="uses">
				<h3 class="toc-heading" id="uses" tabindex="-1">Uses <a href="#uses" class="anchor"><span aria-hidden="true">#</span><span class="screen-reader-text">Uses</span></a></h3>
				<table id="uses-table">
					<caption class="screen-reader-text">Uses</caption>
					<thead>
						<tr>
							<th>Uses</th>
							<th class="related-desc">Description</th>
						</tr>
					</thead>
					<tbody>
												<tr>
							<td>
								<span>wp-admin/includes/upgrade.php:</span>
								<a href="../wp_should_upgrade_global_tables/index.html">wp_should_upgrade_global_tables()</a>
							</td>
							<td class="related-desc">
								<p>Determine if global tables should be upgraded.</p>
							</td>
						</tr>
												<tr>
							<td>
								<span>wp-admin/includes/schema.php:</span>
								<a href="../wp_get_db_schema/index.html">wp_get_db_schema()</a>
							</td>
							<td class="related-desc">
								<p>Retrieve the SQL for creating database tables.</p>
							</td>
						</tr>
												<tr>
							<td>
								<span>wp-admin/includes/upgrade.php:</span>
								<a href="../../hooks/dbdelta_create_queries/index.html">dbdelta_create_queries</a>
							</td>
							<td class="related-desc">
								<p>Filters the dbDelta SQL queries for creating tables and/or databases.</p>
							</td>
						</tr>
												<tr>
							<td>
								<span>wp-admin/includes/upgrade.php:</span>
								<a href="../../hooks/dbdelta_insert_queries/index.html">dbdelta_insert_queries</a>
							</td>
							<td class="related-desc">
								<p>Filters the dbDelta SQL queries for inserting or updating.</p>
							</td>
						</tr>
												<tr>
							<td>
								<span>wp-admin/includes/upgrade.php:</span>
								<a href="../../hooks/dbdelta_queries/index.html">dbdelta_queries</a>
							</td>
							<td class="related-desc">
								<p>Filters the dbDelta SQL queries.</p>
							</td>
						</tr>
												<tr>
							<td>
								<span>wp-includes/plugin.php:</span>
								<a href="../apply_filters/index.html">apply_filters()</a>
							</td>
							<td class="related-desc">
								<p>Calls the callback functions that have been added to a filter hook.</p>
							</td>
						</tr>
												<tr>
							<td>
								<span>wp-includes/wp-db.php:</span>
								<a href="../../classes/wpdb/get_results/index.html">wpdb::get_results()</a>
							</td>
							<td class="related-desc">
								<p>Retrieves an entire SQL result set from the database (i.e., many rows).</p>
							</td>
						</tr>
												<tr>
							<td>
								<span>wp-includes/wp-db.php:</span>
								<a href="../../classes/wpdb/query/index.html">wpdb::query()</a>
							</td>
							<td class="related-desc">
								<p>Performs a MySQL database query, using current database connection.</p>
							</td>
						</tr>
												<tr>
							<td>
								<span>wp-includes/wp-db.php:</span>
								<a href="../../classes/wpdb/tables/index.html">wpdb::tables()</a>
							</td>
							<td class="related-desc">
								<p>Returns an array of WordPress tables.</p>
							</td>
						</tr>
												<tr>
							<td>
								<span>wp-includes/wp-db.php:</span>
								<a href="../../classes/wpdb/suppress_errors/index.html">wpdb::suppress_errors()</a>
							</td>
							<td class="related-desc">
								<p>Enables or disables suppressing of database errors.</p>
							</td>
						</tr>
											<tbody>
				</table>

								<a href="#" class="show-more">Show 5 more uses</a>
				<a href="#" class="hide-more">Hide more uses</a>
							</article>
		
					<hr />
			<article class="used-by">
				<p class="toc-jump"><a href="#top">Top &uarr;</a></p><h3 class="toc-heading" id="used-by" tabindex="-1">Used By <a href="#used-by" class="anchor"><span aria-hidden="true">#</span><span class="screen-reader-text">Used By</span></a></h3>
				<table id="used-by-table">
					<caption class="screen-reader-text">Used By</caption>
					<thead>
						<tr>
							<th>Used By</th>
							<th class="related-desc">Description</th>
						</tr>
					</thead>
					<tbody>
												<tr>
							<td>
								<span>wp-admin/includes/schema.php:</span>
								<a href="../install_network/index.html">install_network()</a>
							</td>
							<td class="related-desc">
								<p>Install Network.</p>
							</td>
						</tr>
												<tr>
							<td>
								<span>wp-admin/includes/upgrade.php:</span>
								<a href="../make_db_current/index.html">make_db_current()</a>
							</td>
							<td class="related-desc">
								<p>Updates the database tables to a new schema.</p>
							</td>
						</tr>
												<tr>
							<td>
								<span>wp-admin/includes/upgrade.php:</span>
								<a href="../make_db_current_silent/index.html">make_db_current_silent()</a>
							</td>
							<td class="related-desc">
								<p>Updates the database tables to a new schema, but without displaying results.</p>
							</td>
						</tr>
												<tr>
							<td>
								<span>wp-admin/includes/upgrade.php:</span>
								<a href="../install_global_terms/index.html">install_global_terms()</a>
							</td>
							<td class="related-desc">
								<p>Install global terms.</p>
							</td>
						</tr>
											<tbody>
				</table>

							</article>
			</section>
		<hr />
	<section class="changelog">
		<p class="toc-jump"><a href="#top">Top &uarr;</a></p><h2 class="toc-heading" id="changelog" tabindex="-1">Changelog <a href="#changelog" class="anchor"><span aria-hidden="true">#</span><span class="screen-reader-text">Changelog</span></a></h2>

		<table>
			<caption class="screen-reader-text">Changelog</caption>
			<thead>
				<tr>
					<th class="changelog-version">Version</th>
					<th class="changelog-desc">Description</th>
				</tr>
			</thead>

			<tbody>
									
					<tr>
						<td><a href="../../since/1.5.0/index.html" alt="WordPress 1.5.0">1.5.0</a></td>
						<td>Introduced.</td>
					</tr>
							</tbody>
		</table>
	</section>

	<hr />
	<section class="user-notes">
		<p class="toc-jump"><a href="#top">Top &uarr;</a></p><h2 class="toc-heading" id="user-contributed-notes" tabindex="-1">User Contributed Notes <a href="#user-contributed-notes" class="anchor"><span aria-hidden="true">#</span><span class="screen-reader-text">User Contributed Notes</span></a></h2>
		
<div id="comments" class="comments-area">

			
		<ol class="comment-list">
						<li id="comment-1329" data-comment-id="1329" class="comment byuser comment-author-charlestonsw even thread-even depth-1">
			<article id="div-comment-1329" class="comment-body">

							<a href="#comment-content-1329" class="screen-reader-text">Skip to note 1 content</a>
				<header class="comment-meta">

				<div class="user-note-voting" data-nonce="4fb1919b27"><a class="user-note-voting-up" title="You must log in to vote on the helpfulness of this note" data-id="1329" data-vote="up" href="https://login.wordpress.org/?redirect_to=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Ffunctions%2Fdbdelta%2F%23comment-1329"><span class="dashicons dashicons-arrow-up" aria-hidden="true"></span><span class="screen-reader-text">You must log in to vote on the helpfulness of this note</span></a><span class="user-note-voting-count " title="89% like this"><span class="screen-reader-text">Vote results for this note: </span>7</span><a class="user-note-voting-down" title="You must log in to vote on the helpfulness of this note" data-id="1329" data-vote="down" href="https://login.wordpress.org/?redirect_to=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Ffunctions%2Fdbdelta%2F%23comment-1329"><span class="dashicons dashicons-arrow-down" aria-hidden="true"></span><span class="screen-reader-text">You must log in to vote on the helpfulness of this note</span></a></div>					<div class="comment-author vcard">
						<span class="comment-author-attribution">
						<img alt='' src='https://secure.gravatar.com/avatar/8f302572c1e8e0a3b68e2b68ba1f5474?s=32&amp;d=mm&amp;r=g' srcset='https://secure.gravatar.com/avatar/8f302572c1e8e0a3b68e2b68ba1f5474?s=64&#038;d=mm&#038;r=g 2x' class='avatar avatar-32 photo' height='32' width='32' loading='lazy'/>Contributed by <cite class="fn"><a href="https://profiles.wordpress.org/charlestonsw/" rel="external nofollow" class="url">Store Locator Plus</a></cite>
						</span>
						&mdash;
						<a class="comment-date" href="index.html#comment-1329">
							<time datetime="2016-02-29T21:45:57+00:00">
							6 years ago							</time>
						</a>

																													</div>
				</header>
				<!-- .comment-metadata -->
			
				<div class="comment-content" id="comment-content-1329">
				<p>You must be very careful in your SQL command structure when creating tables with indexes.</p>
<p>Here is a simple example of the proper create table syntax for a table with a primary key on a field named &#8220;id&#8221; and a secondary key on a field named &#8220;first&#8221;.    </p>
<p>PRIMARY KEY must be followed by TWO SPACES then the open parenthesis then the field name and a closing parenthesis.</p>
<p>KEY must be followed by a SINGLE SPACE then the key name then a space then open parenthesis with the field name then a closed parenthesis.</p>
<section class="source-content">
<div class="source-code-container">
<pre class="brush: php; title: ; notranslate" title="">
   private function index_test_001() {
        global $wpdb;
        $table_name = $wpdb-&gt;prefix . 'dbdelta_test_001';
        $wpdb_collate = $wpdb-&gt;collate;
        $sql =
            &quot;CREATE TABLE {$table_name} (
            id mediumint(8) unsigned NOT NULL auto_increment ,
            first varchar(255) NULL,
            PRIMARY KEY  (id),
            KEY first (first)
            )
            COLLATE {$wpdb_collate}&quot;;

        require_once(ABSPATH . 'wp-admin/includes/upgrade.php');
        dbDelta( $sql );
    }
</pre>
</div>
<p class="source-code-links"><span><a href="#" class="show-complete-source">Expand full source code</a><a href="#" class="less-complete-source">Collapse full source code</a></span></p>
</section>
				</div><!-- .comment-content -->

					<section id='feedback-1329' class='feedback hide-if-js'>
<h4 class='feedback-title'>Feedback</h4>
<ul class='children'>
			<li id="comment-3924" data-comment-id="3924" class="comment byuser comment-author-onmountain odd alt depth-2">
			<article id="div-comment-3924" class="comment-body">

			
				<div class="comment-content" id="comment-content-3924">
				<p>On my plugin I am developing I suddenly started getting errors:   //        The plugin generated 12250 characters of unexpected output during activation.    //        debug bar showed me stuff like: Notice: Undefined index: index_type in /home/cabox/workspace/wp-admin/includes/upgrade.php on line 2721    I used debug bar to see the errors but could not identify what had started the issue.  This document helped me, specifically the earlier suggestion to make sure that the &#8220;&#8230;PRIMARY KEY must be followed by TWO SPACES&#8221;.  I added the extra space on all 3 of my sql for my custom tables. It did not fix it, but that lead me to &#8220;clean up&#8221; all white spaces or any blank lines that were in my sql code.  I would click way to the right of the , on each line, and if there were blanks I would just backspace till I got rid of them.    That fixed it.  Funny, but all 3 of the custom tables were throwing the same type of errors when the 3 bdDelta&#8217;s ran:    <code> require_once ( ABSPATH . 'wp-admin/includes/upgrade.php');  dbDelta($creation_query);</code>    This was in PHP 7.2.11-2+ubuntu16.04.1+deb.sury.org+1,  MySQL  5.7.23,  WP  5.4.1  Not sure if a WP update made it more sensitive.  I did no changes to the code involved in this, before the errors started.  Without the help I found on this page, I would not have located whatever it was.  Just wanted to give back with this trick. &mdash; By <cite class="fn"><a href="https://profiles.wordpress.org/onmountain/" rel="external nofollow" class="url">onmountain</a></cite> &mdash;  <a class="comment-date" href="index.html#comment-3924"><time datetime="2020-05-29T16:53:37+00:00">1 year ago</time></a></p>
				</div><!-- .comment-content -->

						</article>
			</li>
					</ul>
</section><!-- .feedback -->
<footer class='feedback-links' >
<a role="button" class="feedback-login" href="https://login.wordpress.org/?redirect_to=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Ffunctions%2Fdbdelta%2F%3Freplytocom%3D1329%23feedback-editor-1329" rel="nofollow">Log in to add feedback</a></footer>
</article><!-- .comment-body -->
</li>
			<li id="comment-3322" data-comment-id="3322" class="comment byuser comment-author-mahd even thread-odd thread-alt depth-1">
			<article id="div-comment-3322" class="comment-body">

							<a href="#comment-content-3322" class="screen-reader-text">Skip to note 2 content</a>
				<header class="comment-meta">

				<div class="user-note-voting" data-nonce="48ff569e9c"><a class="user-note-voting-up" title="You must log in to vote on the helpfulness of this note" data-id="3322" data-vote="up" href="https://login.wordpress.org/?redirect_to=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Ffunctions%2Fdbdelta%2F%23comment-3322"><span class="dashicons dashicons-arrow-up" aria-hidden="true"></span><span class="screen-reader-text">You must log in to vote on the helpfulness of this note</span></a><span class="user-note-voting-count " title="100% like this"><span class="screen-reader-text">Vote results for this note: </span>6</span><a class="user-note-voting-down" title="You must log in to vote on the helpfulness of this note" data-id="3322" data-vote="down" href="https://login.wordpress.org/?redirect_to=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Ffunctions%2Fdbdelta%2F%23comment-3322"><span class="dashicons dashicons-arrow-down" aria-hidden="true"></span><span class="screen-reader-text">You must log in to vote on the helpfulness of this note</span></a></div>					<div class="comment-author vcard">
						<span class="comment-author-attribution">
						<img alt='' src='https://secure.gravatar.com/avatar/adfde180ddae5eecc38a412c99dfe82d?s=32&amp;d=mm&amp;r=g' srcset='https://secure.gravatar.com/avatar/adfde180ddae5eecc38a412c99dfe82d?s=64&#038;d=mm&#038;r=g 2x' class='avatar avatar-32 photo' height='32' width='32' loading='lazy'/>Contributed by <cite class="fn"><a href="https://profiles.wordpress.org/mahd/" rel="external nofollow" class="url">Mahd Ali</a></cite>
						</span>
						&mdash;
						<a class="comment-date" href="index.html#comment-3322">
							<time datetime="2019-08-02T18:33:36+00:00">
							2 years ago							</time>
						</a>

																													</div>
				</header>
				<!-- .comment-metadata -->
			
				<div class="comment-content" id="comment-content-3322">
				<p>I think it should be a common knowledge but in order to use dbDelta function you must require or include upgrade.php file. So if your dbDelta code is not working check if you have upgrade.php inside your code or not.<br />
It is required as following. </p>
<pre class="brush: php; title: ; notranslate" title="">require_once( ABSPATH . 'wp-admin/includes/upgrade.php' );</pre>
				</div><!-- .comment-content -->

					<section id='feedback-3322' class='feedback hide-if-js'>
</section><!-- .feedback -->
<footer class='feedback-links' >
<a role="button" class="feedback-login" href="https://login.wordpress.org/?redirect_to=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Ffunctions%2Fdbdelta%2F%3Freplytocom%3D3322%23feedback-editor-3322" rel="nofollow">Log in to add feedback</a></footer>
</article><!-- .comment-body -->
</li>
			<li id="comment-3062" data-comment-id="3062" class="comment byuser comment-author-grapestain odd alt thread-even depth-1">
			<article id="div-comment-3062" class="comment-body">

							<a href="#comment-content-3062" class="screen-reader-text">Skip to note 3 content</a>
				<header class="comment-meta">

				<div class="user-note-voting" data-nonce="6024afd1e1"><a class="user-note-voting-up" title="You must log in to vote on the helpfulness of this note" data-id="3062" data-vote="up" href="https://login.wordpress.org/?redirect_to=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Ffunctions%2Fdbdelta%2F%23comment-3062"><span class="dashicons dashicons-arrow-up" aria-hidden="true"></span><span class="screen-reader-text">You must log in to vote on the helpfulness of this note</span></a><span class="user-note-voting-count " title="100% like this"><span class="screen-reader-text">Vote results for this note: </span>4</span><a class="user-note-voting-down" title="You must log in to vote on the helpfulness of this note" data-id="3062" data-vote="down" href="https://login.wordpress.org/?redirect_to=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Ffunctions%2Fdbdelta%2F%23comment-3062"><span class="dashicons dashicons-arrow-down" aria-hidden="true"></span><span class="screen-reader-text">You must log in to vote on the helpfulness of this note</span></a></div>					<div class="comment-author vcard">
						<span class="comment-author-attribution">
						<img alt='' src='https://secure.gravatar.com/avatar/3acb62534572fad2ebca00206cdfc5a8?s=32&amp;d=mm&amp;r=g' srcset='https://secure.gravatar.com/avatar/3acb62534572fad2ebca00206cdfc5a8?s=64&#038;d=mm&#038;r=g 2x' class='avatar avatar-32 photo' height='32' width='32' loading='lazy'/>Contributed by <cite class="fn"><a href="https://profiles.wordpress.org/grapestain/" rel="external nofollow" class="url">Bence Szalai</a></cite>
						</span>
						&mdash;
						<a class="comment-date" href="index.html#comment-3062">
							<time datetime="2019-01-31T17:53:23+00:00">
							3 years ago							</time>
						</a>

																													</div>
				</header>
				<!-- .comment-metadata -->
			
				<div class="comment-content" id="comment-content-3062">
				<p>Note that the result array may say &#8220;Created table {yourtablename}&#8221; even if the table was not created, but should have been. So the result of the call is in some cases more like what should have been done, not what was actually done.</p>
<p>Always check if all requested changes were done properly after using this function, or prepare for surprises&#8230;</p>
<p>To check if the table was really created, you can use something like this:</p>
<pre class="brush: php; title: ; notranslate" title="">if ( $wpdb-&gt;get_var(&quot;SHOW TABLES LIKE '$table_name'&quot;) != $table_name ) {
    // Table was not created !!
}</pre>
				</div><!-- .comment-content -->

					<section id='feedback-3062' class='feedback hide-if-js'>
</section><!-- .feedback -->
<footer class='feedback-links' >
<a role="button" class="feedback-login" href="https://login.wordpress.org/?redirect_to=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Ffunctions%2Fdbdelta%2F%3Freplytocom%3D3062%23feedback-editor-3062" rel="nofollow">Log in to add feedback</a></footer>
</article><!-- .comment-body -->
</li>
			<li id="comment-4027" data-comment-id="4027" class="comment byuser comment-author-dingo_d even thread-odd thread-alt depth-1">
			<article id="div-comment-4027" class="comment-body">

							<a href="#comment-content-4027" class="screen-reader-text">Skip to note 4 content</a>
				<header class="comment-meta">

				<div class="user-note-voting" data-nonce="017614e8c0"><a class="user-note-voting-up" title="You must log in to vote on the helpfulness of this note" data-id="4027" data-vote="up" href="https://login.wordpress.org/?redirect_to=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Ffunctions%2Fdbdelta%2F%23comment-4027"><span class="dashicons dashicons-arrow-up" aria-hidden="true"></span><span class="screen-reader-text">You must log in to vote on the helpfulness of this note</span></a><span class="user-note-voting-count " title="100% like this"><span class="screen-reader-text">Vote results for this note: </span>3</span><a class="user-note-voting-down" title="You must log in to vote on the helpfulness of this note" data-id="4027" data-vote="down" href="https://login.wordpress.org/?redirect_to=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Ffunctions%2Fdbdelta%2F%23comment-4027"><span class="dashicons dashicons-arrow-down" aria-hidden="true"></span><span class="screen-reader-text">You must log in to vote on the helpfulness of this note</span></a></div>					<div class="comment-author vcard">
						<span class="comment-author-attribution">
						<img alt='' src='https://secure.gravatar.com/avatar/6b6ea0733d24af30e6707ec53cf1b86a?s=32&amp;d=mm&amp;r=g' srcset='https://secure.gravatar.com/avatar/6b6ea0733d24af30e6707ec53cf1b86a?s=64&#038;d=mm&#038;r=g 2x' class='avatar avatar-32 photo' height='32' width='32' loading='lazy'/>Contributed by <cite class="fn"><a href="https://profiles.wordpress.org/dingo_d/" rel="external nofollow" class="url">dingo-d</a></cite>
						</span>
						&mdash;
						<a class="comment-date" href="index.html#comment-4027">
							<time datetime="2020-07-03T08:34:03+00:00">
							1 year ago							</time>
						</a>

																													</div>
				</header>
				<!-- .comment-metadata -->
			
				<div class="comment-content" id="comment-content-4027">
				<p>Note that you cannot use `FOREIGN KEY` constraint with `dbDelta`: <a href="https://core.trac.wordpress.org/ticket/19207" rel="nofollow ugc">https://core.trac.wordpress.org/ticket/19207</a></p>
				</div><!-- .comment-content -->

					<section id='feedback-4027' class='feedback hide-if-js'>
</section><!-- .feedback -->
<footer class='feedback-links' >
<a role="button" class="feedback-login" href="https://login.wordpress.org/?redirect_to=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Ffunctions%2Fdbdelta%2F%3Freplytocom%3D4027%23feedback-editor-4027" rel="nofollow">Log in to add feedback</a></footer>
</article><!-- .comment-body -->
</li>
			<li id="comment-2195" data-comment-id="2195" class="comment byuser comment-author-opajaap odd alt thread-even depth-1">
			<article id="div-comment-2195" class="comment-body">

							<a href="#comment-content-2195" class="screen-reader-text">Skip to note 5 content</a>
				<header class="comment-meta">

				<div class="user-note-voting" data-nonce="f47ed3aa36"><a class="user-note-voting-up" title="You must log in to vote on the helpfulness of this note" data-id="2195" data-vote="up" href="https://login.wordpress.org/?redirect_to=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Ffunctions%2Fdbdelta%2F%23comment-2195"><span class="dashicons dashicons-arrow-up" aria-hidden="true"></span><span class="screen-reader-text">You must log in to vote on the helpfulness of this note</span></a><span class="user-note-voting-count " title="100% like this"><span class="screen-reader-text">Vote results for this note: </span>2</span><a class="user-note-voting-down" title="You must log in to vote on the helpfulness of this note" data-id="2195" data-vote="down" href="https://login.wordpress.org/?redirect_to=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Ffunctions%2Fdbdelta%2F%23comment-2195"><span class="dashicons dashicons-arrow-down" aria-hidden="true"></span><span class="screen-reader-text">You must log in to vote on the helpfulness of this note</span></a></div>					<div class="comment-author vcard">
						<span class="comment-author-attribution">
						<img alt='' src='https://secure.gravatar.com/avatar/b421f77aa39db35a5c1787240c77634f?s=32&amp;d=mm&amp;r=g' srcset='https://secure.gravatar.com/avatar/b421f77aa39db35a5c1787240c77634f?s=64&#038;d=mm&#038;r=g 2x' class='avatar avatar-32 photo' height='32' width='32' loading='lazy'/>Contributed by <cite class="fn"><a href="https://profiles.wordpress.org/opajaap/" rel="external nofollow" class="url">Jacob N. Breetvelt</a></cite>
						</span>
						&mdash;
						<a class="comment-date" href="index.html#comment-2195">
							<time datetime="2017-04-18T08:50:52+00:00">
							4 years ago							</time>
						</a>

																													</div>
				</header>
				<!-- .comment-metadata -->
			
				<div class="comment-content" id="comment-content-2195">
				<p>Note: If you change the name of a field, an empty column with the new name will be created, but the old column is not removed!</p>
				</div><!-- .comment-content -->

					<section id='feedback-2195' class='feedback hide-if-js'>
</section><!-- .feedback -->
<footer class='feedback-links' >
<a role="button" class="feedback-login" href="https://login.wordpress.org/?redirect_to=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Ffunctions%2Fdbdelta%2F%3Freplytocom%3D2195%23feedback-editor-2195" rel="nofollow">Log in to add feedback</a></footer>
</article><!-- .comment-body -->
</li>
			<li id="comment-4925" data-comment-id="4925" class="comment byuser comment-author-tcbarrett even thread-odd thread-alt depth-1">
			<article id="div-comment-4925" class="comment-body">

							<a href="#comment-content-4925" class="screen-reader-text">Skip to note 6 content</a>
				<header class="comment-meta">

				<div class="user-note-voting" data-nonce="f27d0c681c"><a class="user-note-voting-up" title="You must log in to vote on the helpfulness of this note" data-id="4925" data-vote="up" href="https://login.wordpress.org/?redirect_to=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Ffunctions%2Fdbdelta%2F%23comment-4925"><span class="dashicons dashicons-arrow-up" aria-hidden="true"></span><span class="screen-reader-text">You must log in to vote on the helpfulness of this note</span></a><span class="user-note-voting-count " title=""><span class="screen-reader-text">Vote results for this note: </span>0</span><a class="user-note-voting-down" title="You must log in to vote on the helpfulness of this note" data-id="4925" data-vote="down" href="https://login.wordpress.org/?redirect_to=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Ffunctions%2Fdbdelta%2F%23comment-4925"><span class="dashicons dashicons-arrow-down" aria-hidden="true"></span><span class="screen-reader-text">You must log in to vote on the helpfulness of this note</span></a></div>					<div class="comment-author vcard">
						<span class="comment-author-attribution">
						<img alt='' src='https://secure.gravatar.com/avatar/107f81bb9475567becfc44c38bacf03b?s=32&amp;d=mm&amp;r=g' srcset='https://secure.gravatar.com/avatar/107f81bb9475567becfc44c38bacf03b?s=64&#038;d=mm&#038;r=g 2x' class='avatar avatar-32 photo' height='32' width='32' loading='lazy'/>Contributed by <cite class="fn"><a href="https://profiles.wordpress.org/tcbarrett/" rel="external nofollow" class="url">TCBarrett</a></cite>
						</span>
						&mdash;
						<a class="comment-date" href="index.html#comment-4925">
							<time datetime="2021-03-16T09:24:26+00:00">
							6 months ago							</time>
						</a>

																													</div>
				</header>
				<!-- .comment-metadata -->
			
				<div class="comment-content" id="comment-content-4925">
				<p>Always use the CREATE statement.</p>
<p>I think it is worth noting that this function has been specifically design to carry out the heavy lifting for you. Instead of having to manage updated table specs yourself, simply *always* pass in the CREATE statement and the dbDelta function will compare it to the existing schema. It will perform the CREATE or UPDATE as needed.</p>
				</div><!-- .comment-content -->

					<section id='feedback-4925' class='feedback hide-if-js'>
</section><!-- .feedback -->
<footer class='feedback-links' >
<a role="button" class="feedback-login" href="https://login.wordpress.org/?redirect_to=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Ffunctions%2Fdbdelta%2F%3Freplytocom%3D4925%23feedback-editor-4925" rel="nofollow">Log in to add feedback</a></footer>
</article><!-- .comment-body -->
</li>
			<li id="comment-2070" data-comment-id="2070" class="comment byuser comment-author-eboyd53 odd alt thread-even depth-1">
			<article id="div-comment-2070" class="comment-body">

							<a href="#comment-content-2070" class="screen-reader-text">Skip to note 7 content</a>
				<header class="comment-meta">

				<div class="user-note-voting" data-nonce="aa7be38fb0"><a class="user-note-voting-up" title="You must log in to vote on the helpfulness of this note" data-id="2070" data-vote="up" href="https://login.wordpress.org/?redirect_to=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Ffunctions%2Fdbdelta%2F%23comment-2070"><span class="dashicons dashicons-arrow-up" aria-hidden="true"></span><span class="screen-reader-text">You must log in to vote on the helpfulness of this note</span></a><span class="user-note-voting-count " title="0% like this"><span class="screen-reader-text">Vote results for this note: </span>-1</span><a class="user-note-voting-down" title="You must log in to vote on the helpfulness of this note" data-id="2070" data-vote="down" href="https://login.wordpress.org/?redirect_to=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Ffunctions%2Fdbdelta%2F%23comment-2070"><span class="dashicons dashicons-arrow-down" aria-hidden="true"></span><span class="screen-reader-text">You must log in to vote on the helpfulness of this note</span></a></div>					<div class="comment-author vcard">
						<span class="comment-author-attribution">
						<img alt='' src='https://secure.gravatar.com/avatar/70ee4d66b4d2d1c87afacd43798ea564?s=32&amp;d=mm&amp;r=g' srcset='https://secure.gravatar.com/avatar/70ee4d66b4d2d1c87afacd43798ea564?s=64&#038;d=mm&#038;r=g 2x' class='avatar avatar-32 photo' height='32' width='32' loading='lazy'/>Contributed by <cite class="fn"><a href="https://profiles.wordpress.org/eboyd53/" rel="external nofollow" class="url">Earnest Boyd</a></cite>
						</span>
						&mdash;
						<a class="comment-date" href="index.html#comment-2070">
							<time datetime="2017-01-27T16:43:38+00:00">
							5 years ago							</time>
						</a>

																													</div>
				</header>
				<!-- .comment-metadata -->
			
				<div class="comment-content" id="comment-content-2070">
				<p>Be careful not to put a COMMENT on field or key; the preg_match code doesn&#8217;t handle it.  The following code is wrong (thanks to Store Locator Plus&#8217; code).</p>
<section class="source-content">
<div class="source-code-container">
<pre class="brush: php; title: ; notranslate" title="">private function index_test_001() {
     global $wpdb;
     $table_name = $wpdb-&gt;prefix . 'dbdelta_test_001';
     $wpdb_collate = $wpdb-&gt;collate;
     $sql =
         &quot;CREATE TABLE {$table_name} (
         id mediumint(8) unsigned NOT NULL auto_increment ,
         first varchar(255) NULL,
         PRIMARY KEY  (id),
         KEY first (first) COMMENT 'First name'
         )
         COLLATE {$wpdb_collate}&quot;;
 
     require_once(ABSPATH . 'wp-admin/includes/upgrade.php');
     dbDelta( $sql );
 }</pre>
</div>
<p class="source-code-links"><span><a href="#" class="show-complete-source">Expand full source code</a><a href="#" class="less-complete-source">Collapse full source code</a></span></p>
</section>
				</div><!-- .comment-content -->

					<section id='feedback-2070' class='feedback hide-if-js'>
</section><!-- .feedback -->
<footer class='feedback-links' >
<a role="button" class="feedback-login" href="https://login.wordpress.org/?redirect_to=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Ffunctions%2Fdbdelta%2F%3Freplytocom%3D2070%23feedback-editor-2070" rel="nofollow">Log in to add feedback</a></footer>
</article><!-- .comment-body -->
</li>
			<li id="comment-2495" data-comment-id="2495" class="comment byuser comment-author-neoacevedo even thread-odd thread-alt depth-1 bad-note">
			<article id="div-comment-2495" class="comment-body">

							<a href="#comment-content-2495" class="screen-reader-text">Skip to note 8 content</a>
				<header class="comment-meta">

				<div class="user-note-voting" data-nonce="9b951b4fcd"><a class="user-note-voting-up" title="You must log in to vote on the helpfulness of this note" data-id="2495" data-vote="up" href="https://login.wordpress.org/?redirect_to=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Ffunctions%2Fdbdelta%2F%23comment-2495"><span class="dashicons dashicons-arrow-up" aria-hidden="true"></span><span class="screen-reader-text">You must log in to vote on the helpfulness of this note</span></a><span class="user-note-voting-count " title="33% like this"><span class="screen-reader-text">Vote results for this note: </span>-2</span><a class="user-note-voting-down" title="You must log in to vote on the helpfulness of this note" data-id="2495" data-vote="down" href="https://login.wordpress.org/?redirect_to=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Ffunctions%2Fdbdelta%2F%23comment-2495"><span class="dashicons dashicons-arrow-down" aria-hidden="true"></span><span class="screen-reader-text">You must log in to vote on the helpfulness of this note</span></a></div>					<div class="comment-author vcard">
						<span class="comment-author-attribution">
						<img alt='' src='https://secure.gravatar.com/avatar/5c2d258fdd35bc83f113ebc6067a0e6c?s=32&amp;d=mm&amp;r=g' srcset='https://secure.gravatar.com/avatar/5c2d258fdd35bc83f113ebc6067a0e6c?s=64&#038;d=mm&#038;r=g 2x' class='avatar avatar-32 photo' height='32' width='32' loading='lazy'/>Contributed by <cite class="fn"><a href="https://profiles.wordpress.org/neoacevedo/" rel="external nofollow" class="url">neoacevedo</a></cite>
						</span>
						&mdash;
						<a class="comment-date" href="index.html#comment-2495">
							<time datetime="2017-12-14T00:23:05+00:00">
							4 years ago							</time>
						</a>

																													</div>
				</header>
				<!-- .comment-metadata -->
			
				<div class="comment-content" id="comment-content-2495">
				<p>If you need to change the structure of a table, is better to use <code>$wpdb</code> rather than this method because is not guaranteed it works for updating any table structure.</p>
				</div><!-- .comment-content -->

					<section id='feedback-2495' class='feedback hide-if-js'>
</section><!-- .feedback -->
<footer class='feedback-links' >
<a role="button" class="feedback-login" href="https://login.wordpress.org/?redirect_to=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Ffunctions%2Fdbdelta%2F%3Freplytocom%3D2495%23feedback-editor-2495" rel="nofollow">Log in to add feedback</a></footer>
</article><!-- .comment-body -->
</li>
			<li id="comment-2215" data-comment-id="2215" class="comment byuser comment-author-octag odd alt thread-even depth-1 bad-note">
			<article id="div-comment-2215" class="comment-body">

							<a href="#comment-content-2215" class="screen-reader-text">Skip to note 9 content</a>
				<header class="comment-meta">

				<div class="user-note-voting" data-nonce="bc1afba46b"><a class="user-note-voting-up" title="You must log in to vote on the helpfulness of this note" data-id="2215" data-vote="up" href="https://login.wordpress.org/?redirect_to=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Ffunctions%2Fdbdelta%2F%23comment-2215"><span class="dashicons dashicons-arrow-up" aria-hidden="true"></span><span class="screen-reader-text">You must log in to vote on the helpfulness of this note</span></a><span class="user-note-voting-count " title="20% like this"><span class="screen-reader-text">Vote results for this note: </span>-3</span><a class="user-note-voting-down" title="You must log in to vote on the helpfulness of this note" data-id="2215" data-vote="down" href="https://login.wordpress.org/?redirect_to=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Ffunctions%2Fdbdelta%2F%23comment-2215"><span class="dashicons dashicons-arrow-down" aria-hidden="true"></span><span class="screen-reader-text">You must log in to vote on the helpfulness of this note</span></a></div>					<div class="comment-author vcard">
						<span class="comment-author-attribution">
						<img alt='' src='https://secure.gravatar.com/avatar/a3de80480bb646920369bcafc0e00490?s=32&amp;d=mm&amp;r=g' srcset='https://secure.gravatar.com/avatar/a3de80480bb646920369bcafc0e00490?s=64&#038;d=mm&#038;r=g 2x' class='avatar avatar-32 photo' height='32' width='32' loading='lazy'/>Contributed by <cite class="fn"><a href="https://profiles.wordpress.org/octag/" rel="external nofollow" class="url">octag</a></cite>
						</span>
						&mdash;
						<a class="comment-date" href="index.html#comment-2215">
							<time datetime="2017-05-05T15:23:27+00:00">
							4 years ago							</time>
						</a>

																													</div>
				</header>
				<!-- .comment-metadata -->
			
				<div class="comment-content" id="comment-content-2215">
				<p>(I post here a <strong>corrected version</strong> of my previous note. Several typographical mistakes have slipped into the original version.)<br />
As a side-note, the <strong>dbDelta</strong> function cannot be used to <strong>drop a table</strong> from the <strong>wp_</strong> database . A function such as the one below can be used instead (don’t forget to replace <code>my_theme</code> with your own theme name):</p>
<pre class="brush: php; title: ; notranslate" title="">
function my_theme_drop_table ( $table_name = 'the_name_without_any_prefix' ){
	global $wpdb;

	$table_name_prepared = $wpdb-&gt;prefix . $table_name;
	$the_removal_query = &quot;DROP TABLE IF EXISTS {$table_name_prepared}&quot;;

	$wpdb-&gt;query( $the_removal_query );
}
</pre>
<p>See also <a href="../../../plugins/the-basics/uninstall-methods/index.html" rel="nofollow ugc">https://developer.wordpress.org/plugins/the-basics/uninstall-methods/</a>.</p>
				</div><!-- .comment-content -->

					<section id='feedback-2215' class='feedback hide-if-js'>
</section><!-- .feedback -->
<footer class='feedback-links' >
<a role="button" class="feedback-login" href="https://login.wordpress.org/?redirect_to=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Ffunctions%2Fdbdelta%2F%3Freplytocom%3D2215%23feedback-editor-2215" rel="nofollow">Log in to add feedback</a></footer>
</article><!-- .comment-body -->
</li>
		</ol><!-- .comment-list -->

		
	
	
			<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title"> <small></small></h3><p>You must <a href="https://login.wordpress.org/?redirect_to=https%3A%2F%2Fdeveloper.wordpress.org%2Freference%2Ffunctions%2Fdbdelta%2F%23comments">log in</a> before being able to contribute a note or feedback.</p>	</div><!-- #respond -->
		
	
</div><!-- #comments -->
	</section>
</div>

</article>

			
		
		</main><!-- #main -->
	</div><!-- #primary -->
	</div><!-- #content -->

</div><!-- #page -->


<div id="wporg-footer">
	<div class="wrapper">
		<ul>
			<li><a href="http://wordpress.org/about/" title="An introduction to the WordPress project">About</a></li>
			<li><a href="http://wordpress.org/news/" title="News and Updates">Blog</a></li>
			<li><a href="http://wordpress.org/hosting/" title="Recommended web hosting providers">Hosting</a></li>
			<li><a href="https://wordpressfoundation.org/donate/" title="Donate to the WordPress Foundation">Donate</a></li>
		</ul>

		<ul>
			<li><a href="http://wordpress.org/support/" title="Forums, documentation, and other resources">Support</a></li>
			<li><a href="../../../index.html" title="Resources for WordPress developers">Developers</a></li>
			<li><a href="http://make.wordpress.org/" title="Give back to WordPress through code, support, translation and more">Get Involved</a></li>
			<li><a href="http://learn.wordpress.org/" title="Workshops and training materials">Learn</a></li>
		</ul>

		<ul>
			<li><a href="http://wordpress.org/showcase/" title="Some of the best WordPress sites on the Web">Showcase</a></li>
			<li><a href="http://wordpress.org/plugins/" title="Add extra functionality to WordPress">Plugins</a></li>
			<li><a href="http://wordpress.org/themes/" title="Make your WordPress pretty">Themes</a></li>
		</ul>

		<ul>
			<li><a href="http://central.wordcamp.org/" title="Find a WordPress event near you">WordCamp</a></li>
			<li><a href="http://wordpress.tv/" title="Videos, tutorials, and WordCamp sessions">WordPress.TV</a></li>
			<li><a href="http://buddypress.org/" title="A set of plugins to transform your WordPress into a social network">BuddyPress</a></li>
			<li><a href="http://bbpress.org/" title="Fast, slick forums built on WordPress">bbPress</a></li>
		</ul>

		<ul>
			<li><a href="http://wordpress.com/?ref=wporg-footer" title="Hassle-free WordPress hosting">WordPress.com</a></li>
			<li><a href="http://ma.tt/" title="Co-founder of WordPress, an example of what WordPress can do">Matt</a></li>
			<li><a href="http://wordpress.org/about/privacy/" title="WordPress.org Privacy Policy">Privacy</a></li>
			<li><a href="https://publiccode.eu/" target="_blank">Public Code</a></li>
		</ul>

		<ul class="social-media-links">
			<li><span class="dashicons dashicons-twitter"></span><a href="https://twitter.com/WordPress" title="Follow @WordPress on Twitter">@WordPress</a></li>
			<li><span class="dashicons dashicons-facebook"></span><a href="https://www.facebook.com/WordPress/" title="Like WordPress on Facebook">WordPress</a></li>
		</ul>
	</div>

		<p class="cip cip-image">Code is Poetry.</p>
</div>

<script src="../../../../s.w.org/style/js/navigation.min.js?20190128"></script>

<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "../../../wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.9b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.head.appendChild( corecss );
		var themecssurl = "../../../wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.9b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		document.head.appendChild( themecss );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.defaults['toolbar'] = false;
	SyntaxHighlighter.all();

	// Infinite scroll support
	if ( typeof( jQuery ) !== 'undefined' ) {
		jQuery( function( $ ) {
			$( document.body ).on( 'post-load', function() {
				SyntaxHighlighter.highlight();
			} );
		} );
	}
</script>
<link rel='stylesheet' id='buttons-css'  href='../../../wp-includes/css/buttons.min.css?ver=5.9-alpha-51701' type='text/css' media='all' />
<script type='text/javascript' src='../../../wp-includes/js/hoverintent-js.min.js?ver=2.2.1' id='hoverintent-js-js'></script>
<script type='text/javascript' src='../../../wp-includes/js/admin-bar.min.js?ver=5.9-alpha-51701' id='admin-bar-js'></script>
<script type='text/javascript' src='../../../wp-content/themes/pub/wporg-developer/js/navigation.js?ver=20181209' id='wporg-developer-navigation-js'></script>
<script type='text/javascript' src='../../../wp-content/themes/pub/wporg-developer/js/skip-link-focus-fix.js?ver=20130115' id='wporg-developer-skip-link-focus-fix-js'></script>
<script type='text/javascript' src='../../../wp-content/themes/pub/wporg-developer/js/search.js?ver=20150430' id='wporg-developer-search-js'></script>
<script type='text/javascript' src='../../../wp-content/themes/pub/wporg-developer/js/menu.js?ver=20180201' id='wporg-developer-menu-js'></script>
<script type='text/javascript' src='../../../wp-content/themes/pub/wporg-developer/js/awesomplete.min.js?ver=20160322' id='awesomplete-js'></script>
<script type='text/javascript' id='autocomplete-js-extra'>
/* <![CDATA[ */
var autocomplete = {"ajaxurl":"https:\/\/developer.wordpress.org\/wp-admin\/admin-ajax.php","nonce":"8a60f70c4b"};
/* ]]> */
</script>
<script type='text/javascript' src='../../../wp-content/themes/pub/wporg-developer/js/autocomplete.js?ver=20160524' id='autocomplete-js'></script>
<script type='text/javascript' src='../../../wp-content/themes/pub/wporg-developer/js/function-reference.js?ver=20180724' id='wporg-developer-function-reference-js'></script>
<script type='text/javascript' id='quicktags-js-extra'>
/* <![CDATA[ */
var quicktagsL10n = {"closeAllOpenTags":"Close all open tags","closeTags":"close tags","enterURL":"Enter the URL","enterImageURL":"Enter the URL of the image","enterImageDescription":"Enter a description of the image","textdirection":"text direction","toggleTextdirection":"Toggle Editor Text Direction","dfw":"Distraction-free writing mode","strong":"Bold","strongClose":"Close bold tag","em":"Italic","emClose":"Close italic tag","link":"Insert link","blockquote":"Blockquote","blockquoteClose":"Close blockquote tag","del":"Deleted text (strikethrough)","delClose":"Close deleted text tag","ins":"Inserted text","insClose":"Close inserted text tag","image":"Insert image","ul":"Bulleted list","ulClose":"Close bulleted list tag","ol":"Numbered list","olClose":"Close numbered list tag","li":"List item","liClose":"Close list item tag","code":"Code","codeClose":"Close code tag","more":"Insert Read More tag"};
/* ]]> */
</script>
<script type='text/javascript' src='../../../wp-includes/js/quicktags.min.js?ver=5.9-alpha-51701' id='quicktags-js'></script>
<script type='text/javascript' src='../../../wp-content/themes/pub/wporg-developer/js/user-notes.js?ver=20200110' id='wporg-developer-user-notes-js'></script>
<script type='text/javascript' id='wporg-developer-user-notes-feedback-js-extra'>
/* <![CDATA[ */
var wporg_note_feedback = {"show":"Show Feedback","hide":"Hide Feedback"};
/* ]]> */
</script>
<script type='text/javascript' src='../../../wp-content/themes/pub/wporg-developer/js/user-notes-feedback.js?ver=20181023' id='wporg-developer-user-notes-feedback-js'></script>
<script type='text/javascript' src='../../../wp-content/themes/pub/wporg-developer/js/tabs.js?ver=20160824' id='wporg-developer-tabs-js'></script>
<script type='text/javascript' id='wporg-developer-preview-js-extra'>
/* <![CDATA[ */
var wporg_note_preview = {"ajaxurl":"https:\/\/developer.wordpress.org\/wp-admin\/admin-ajax.php","nonce":"504933b60e","preview":"preview note","preview_empty":"Nothing to preview","is_admin":""};
/* ]]> */
</script>
<script type='text/javascript' src='../../../wp-content/themes/pub/wporg-developer/js/user-notes-preview.js?ver=20200111' id='wporg-developer-preview-js'></script>
<script type='text/javascript' src='../../../wp-includes/js/wp-embed.min.js?ver=5.9-alpha-51701' id='wp-embed-js'></script>
<script type='text/javascript' src='../../../wp-includes/js/dist/vendor/regenerator-runtime.min.js?ver=0.13.7' id='regenerator-runtime-js'></script>
<script type='text/javascript' src='../../../wp-includes/js/dist/vendor/wp-polyfill.min.js?ver=3.15.0' id='wp-polyfill-js'></script>
<script type='text/javascript' src='../../../wp-includes/js/dist/dom-ready.min.js?ver=71883072590656bf22c74c7b887df3dd' id='wp-dom-ready-js'></script>
<script type='text/javascript' src='../../../wp-includes/js/dist/hooks.min.js?ver=a7edae857aab69d69fa10d5aef23a5de' id='wp-hooks-js'></script>
<script type='text/javascript' src='../../../wp-includes/js/dist/i18n.min.js?ver=5f1269854226b4dd90450db411a12b79' id='wp-i18n-js'></script>
<script type='text/javascript' id='wp-i18n-js-after'>
wp.i18n.setLocaleData( { 'text direction\u0004ltr': [ 'ltr' ] } );
</script>
<script type='text/javascript' id='wp-a11y-js-translations'>
( function( domain, translations ) {
	var localeData = translations.locale_data[ domain ] || translations.locale_data.messages;
	localeData[""].domain = domain;
	wp.i18n.setLocaleData( localeData, domain );
} )( "default", { "locale_data": { "messages": { "": {} } } } );
</script>
<script type='text/javascript' src='../../../wp-includes/js/dist/a11y.min.js?ver=0ac8327cc1c40dcfdf29716affd7ac63' id='wp-a11y-js'></script>
<script type='text/javascript' id='wplink-js-extra'>
/* <![CDATA[ */
var wpLinkL10n = {"title":"Insert\/edit link","update":"Update","save":"Add Link","noTitle":"(no title)","noMatchesFound":"No results found.","linkSelected":"Link selected.","linkInserted":"Link inserted.","minInputLength":"3"};
/* ]]> */
</script>
<script type='text/javascript' src='../../../wp-includes/js/wplink.min.js?ver=5.9-alpha-51701' id='wplink-js'></script>
<script type='text/javascript' src='../../../wp-includes/js/jquery/ui/core.min.js?ver=1.12.1' id='jquery-ui-core-js'></script>
<script type='text/javascript' src='../../../wp-includes/js/jquery/ui/menu.min.js?ver=1.12.1' id='jquery-ui-menu-js'></script>
<script type='text/javascript' id='jquery-ui-autocomplete-js-extra'>
/* <![CDATA[ */
var uiAutocompleteL10n = {"noResults":"No results found.","oneResult":"1 result found. Use up and down arrow keys to navigate.","manyResults":"%d results found. Use up and down arrow keys to navigate.","itemSelected":"Item selected."};
/* ]]> */
</script>
<script type='text/javascript' src='../../../wp-includes/js/jquery/ui/autocomplete.min.js?ver=1.12.1' id='jquery-ui-autocomplete-js'></script>

		<script type="text/javascript">
		tinyMCEPreInit = {
			baseURL: "https://developer.wordpress.org/wp-includes/js/tinymce",
			suffix: ".min",
						mceInit: {},
			qtInit: {'comment':{id:"comment",buttons:"strong,em,ul,ol,li,link"}},
			ref: {plugins:"",theme:"modern",language:""},
			load_ext: function(url,lang){var sl=tinymce.ScriptLoader;sl.markDone(url+'/langs/'+lang+'.js');sl.markDone(url+'/langs/'+lang+'_dlg.js');}
		};
		</script>
				<script type="text/javascript">
		var ajaxurl = "../../../wp-admin/admin-ajax.html";
		( function() {
			var initialized = [];
			var initialize  = function() {
				var init, id, inPostbox, $wrap;
				var readyState = document.readyState;

				if ( readyState !== 'complete' && readyState !== 'interactive' ) {
					return;
				}

				for ( id in tinyMCEPreInit.mceInit ) {
					if ( initialized.indexOf( id ) > -1 ) {
						continue;
					}

					init      = tinyMCEPreInit.mceInit[id];
					$wrap     = tinymce.$( '#wp-' + id + '-wrap' );
					inPostbox = $wrap.parents( '.postbox' ).length > 0;

					if (
						! init.wp_skip_init &&
						( $wrap.hasClass( 'tmce-active' ) || ! tinyMCEPreInit.qtInit.hasOwnProperty( id ) ) &&
						( readyState === 'complete' || ( ! inPostbox && readyState === 'interactive' ) )
					) {
						tinymce.init( init );
						initialized.push( id );

						if ( ! window.wpActiveEditor ) {
							window.wpActiveEditor = id;
						}
					}
				}
			}

			if ( typeof tinymce !== 'undefined' ) {
				if ( tinymce.Env.ie && tinymce.Env.ie < 11 ) {
					tinymce.$( '.wp-editor-wrap ' ).removeClass( 'tmce-active' ).addClass( 'html-active' );
				} else {
					if ( document.readyState === 'complete' ) {
						initialize();
					} else {
						document.addEventListener( 'readystatechange', initialize );
					}
				}
			}

			if ( typeof quicktags !== 'undefined' ) {
				for ( id in tinyMCEPreInit.qtInit ) {
					quicktags( tinyMCEPreInit.qtInit[id] );

					if ( ! window.wpActiveEditor ) {
						window.wpActiveEditor = id;
					}
				}
			}
		}());
		</script>
				<div id="wp-link-backdrop" style="display: none"></div>
		<div id="wp-link-wrap" class="wp-core-ui" style="display: none" role="dialog" aria-labelledby="link-modal-title">
		<form id="wp-link" tabindex="-1">
		<input type="hidden" id="_ajax_linking_nonce" name="_ajax_linking_nonce" value="86f5a0a85d" />		<h1 id="link-modal-title">Insert/edit link</h1>
		<button type="button" id="wp-link-close"><span class="screen-reader-text">Close</span></button>
		<div id="link-selector">
			<div id="link-options">
				<p class="howto" id="wplink-enter-url">Enter the destination URL</p>
				<div>
					<label><span>URL</span>
					<input id="wp-link-url" type="text" aria-describedby="wplink-enter-url" /></label>
				</div>
				<div class="wp-link-text-field">
					<label><span>Link Text</span>
					<input id="wp-link-text" type="text" /></label>
				</div>
				<div class="link-target">
					<label><span></span>
					<input type="checkbox" id="wp-link-target" /> Open link in a new tab</label>
				</div>
			</div>
			<p class="howto" id="wplink-link-existing-content">Or link to existing content</p>
			<div id="search-panel">
				<div class="link-search-wrapper">
					<label>
						<span class="search-label">Search</span>
						<input type="search" id="wp-link-search" class="link-search-field" autocomplete="off" aria-describedby="wplink-link-existing-content" />
						<span class="spinner"></span>
					</label>
				</div>
				<div id="search-results" class="query-results" tabindex="0">
					<ul></ul>
					<div class="river-waiting">
						<span class="spinner"></span>
					</div>
				</div>
				<div id="most-recent-results" class="query-results" tabindex="0">
					<div class="query-notice" id="query-notice-message">
						<em class="query-notice-default">No search term specified. Showing recent items.</em>
						<em class="query-notice-hint screen-reader-text">Search or use up and down arrow keys to select an item.</em>
					</div>
					<ul></ul>
					<div class="river-waiting">
						<span class="spinner"></span>
					</div>
				</div>
			</div>
		</div>
		<div class="submitbox">
			<div id="wp-link-cancel">
				<button type="button" class="button">Cancel</button>
			</div>
			<div id="wp-link-update">
				<input type="submit" value="Add Link" class="button button-primary" id="wp-link-submit" name="wp-link-submit">
			</div>
		</div>
		</form>
		</div>
		</body>

<!-- Mirrored from developer.wordpress.org/reference/functions/dbdelta/ by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 31 Aug 2021 17:11:48 GMT -->
</html>
