<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">


<!-- Mirrored from codex.wordpress.org/Combating_Comment_Spam/Denying_Access by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 31 Aug 2021 16:48:03 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'../../www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-P24PF4B');</script>
<!--
<meta property="fb:page_id" content="6427302910" />
-->
<link rel="dns-prefetch" href="http://s.w.org/" />
<link rel="dns-prefetch" href="../../fonts.googleapis.com/index.html" />
<link rel="dns-prefetch" href="http://fonts.gstatic.com/" />
<link rel="dns-prefetch" href="http://www.googletagmanager.com/" />
<meta name="google-site-verification" content="7VWES_-rcHBcmaQis9mSYamPfNwE03f4vyTj4pfuAw0" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Combating Comment Spam/Denying Access</title>
<link rel="canonical" href="Denying_Access.html" />

<link rel="stylesheet" href="../../s.w.org/style/codex-wp4.css?3" />
<meta name="referrer" content="always">

			<link href="../../s.w.org/wp-includes/css/dashicons.min.css?20181204" rel="stylesheet" type="text/css" />
		<link href='../../fonts.googleapis.com/css.css?family=Open+Sans:300italic,400italic,600italic,400,300,600&amp;subset=latin,cyrillic-ext,greek-ext,greek,vietnamese,latin-ext,cyrillic' rel='stylesheet' type='text/css'>

		<link rel="stylesheet" href="../../s.w.org/style/wp4-2.css?92" />

<link rel="shortcut icon" href="../../s.w.org/favicon.ico?2" type="image/x-icon" />
<script type="text/javascript" src="../../s.w.org/wp-includes/js/jquery/jquery.js?v=1.11.1"></script>
<script>document.cookie='devicePixelRatio='+((window.devicePixelRatio === undefined) ? 1 : window.devicePixelRatio)+'; path=/';</script>
<!--[if IE]>
    <script type="text/javascript" src="/skins/common/IEFixes.js"></script>
    <meta http-equiv="imagetoolbar" content="no" />
<![endif]-->

<script type="text/javascript">wgBreakFrames=false;wgContentLanguage='en';</script>


</head>


<body id="wordpress-org" class="wporg-responsive wporg-codex">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P24PF4B" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<div id="wporg-header">
	<div class="wrapper">
	<h1><a href="http://wordpress.org/">WordPress.org</a></h1>				<div id="head-search">
		<form action="http://wordpress.org/search/do-search.php" method="get">
			<label for="global-search" class="screen-reader-text">Search WordPress.org for:</label>
			<input id="global-search" class="text" name="search" type="text" value="" maxlength="150" placeholder="Search WordPress.org" />
			<button type="submit" class="button"><span class="screen-reader-text">Submit</span></button>
		</form>
		</div>
				<div style="clear:both"></div>
		<button id="mobile-menu-button" aria-expanded="false"><span class="screen-reader-text">Toggle Menu</span></button>
		
<nav aria-label="Main Menu">
<ul id="wporg-header-menu">
<li class="menu-item"><a href='http://wordpress.org/showcase/' data-title='See some of the sites built on WordPress.'>Showcase</a></li>
<li class="menu-item"><a href='http://learn.wordpress.org/' data-title='Resources to help you learn more about WordPress and teach it to others.'>Learn</a></li>
<li class="menu-item"><a href='http://wordpress.org/themes/' data-title='Find just the right look for your website.'>Themes</a></li>
<li class="menu-item"><a href='http://wordpress.org/plugins/' data-title='Plugins can extend WordPress to do almost anything you can imagine.'>Plugins</a></li>
<li class="menu-item"><a href='http://wordpress.org/mobile/' data-title='Take your website on the go!'>Mobile</a></li>
<li class="menu-item"><a href='http://wordpress.org/support/' data-title='Forums, documentation, help.' aria-current="true" class="current">Support</a><ul class="nav-submenu"><li><a href='http://wordpress.org/support/' title='Documentation, tutorials, best practices.'>Documentation</a></li><li><a href='http://wordpress.org/support/forums/' title='Support and discussion forums.'>Forums</a></li></ul><div class="uparrow"></div></li>
<li class="menu-item"><a href='http://make.wordpress.org/' data-title='Contribute your knowledge.'>Get Involved</a><ul class="nav-submenu"><li><a href='http://wordpress.org/five-for-the-future/' title='How five percent is powering the next generation of the web'>Five for the Future</a></li></ul><div class="uparrow"></div></li>
<li class="menu-item"><a href='http://wordpress.org/about/' data-title='About the WordPress Organization, and where we&#039;re going.'>About</a></li>
<li class="menu-item"><a href='http://wordpress.org/news/' data-title='Come here for the latest scoop.'>Blog</a></li>
<li class="menu-item"><a href='http://wordpress.org/hosting/' data-title='Find a home for your blog.'>Hosting</a></li>
<li id="download" class="button download-button menu-item"><a href='http://wordpress.org/download/' data-title='Get it. Got it? Good.'>Get WordPress</a></li>
</ul>
</nav>
		<div style="clear:both"></div>
	</div>
</div>



<div id="headline">
	<div class="wrapper">
		<h2><a href="../index.html">Codex</a></h2>
		
		<div class="portlet" id="p-personal">
		  <p class="login">Codex tools:
		     <a href="https://codex.wordpress.org/index.php?title=Special:UserLogin&amp;returnto=Combating+Comment+Spam%2FDenying+Access">Log in</a> 		  </p>
		</div>
	</div>
</div>

<div id="pagebody">
	<div class="wrapper">	
		<div class="col-10" id="bodyContent">
			<div id="siteNotice"><div id="localNotice" lang="en" dir="ltr"><div style="clear:both; background-color:#e5f5fa; border-left:4px solid #00a0d2; padding:10px 12px 8px; margin:0.5em auto 1.5em auto;"><span class="dashicons dashicons-info" style="color:#00a0d2"></span> Interested in functions, hooks, classes, or methods? Check out the new <a rel="nofollow" class="external text" href="../../developer.wordpress.org/reference/index.html">WordPress Code Reference</a>!</div>
</div></div>			<h2 class="pagetitle">Combating Comment Spam/Denying Access</h2>
									<!-- start content -->
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Deny_Access_to_Spammer_IPs"><span class="tocnumber">1</span> <span class="toctext">Deny Access to Spammer IPs</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Deny_Access_to_No_Referrer_Requests"><span class="tocnumber">2</span> <span class="toctext">Deny Access to No Referrer Requests</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Deny_Access_Referrer_Spammers"><span class="tocnumber">3</span> <span class="toctext">Deny Access Referrer Spammers</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Using_a_Custom_403"><span class="tocnumber">4</span> <span class="toctext">Using a Custom 403</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Using_PHP_Code_to_Block"><span class="tocnumber">5</span> <span class="toctext">Using PHP Code to Block</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Resources"><span class="tocnumber">6</span> <span class="toctext">Resources</span></a></li>
</ul>
</div>

<p>While denying access to comment spammers may be seen as drastic action, there are ways to prevent access to spammers while still allowing comments to be posted.
</p><p>Keep in mind that most spammers use random IPs.  Blocking spammers by their IP does break up spam floods, but it also <b>increases the chance of blocking legitimate users</b>.
</p>
<h2><span class="mw-headline" id="Deny_Access_to_Spammer_IPs">Deny Access to Spammer IPs</span></h2>
<p>When a comment is sent to your weblog, the IP address is included in the packet of information that travels with that comment across the internet. Think of it as a phone number, and the WordPress comment moderation acts like call display to show you where the comment is coming from.
</p><p>It should be noted that spammers are notorious for hijacking IP addresses, so it is possible that the IP address attached to a spam item is, in fact, "stolen" from a legitimate internet-connected device.
</p><p>If you watch the IP addresses carefully, you may notice that there is only a slight variation in some of the numbers. For example, you might see:
</p>
<ul><li> <b>192.168.0.1</b></li>
<li> <b>192.168.0.2</b></li>
<li> <b>192.168.0.3</b></li></ul>
<p>And other sequential or similar number orders. You have the ability to add a simpler IP address to your comment spam word list by dropping one or more of the IP numbers, thusly: <b>192.168</b> -- in this way, any IP address that starts with <b>192.168</b> will be screened as spam regardless of the numbers that appear with this "wildcard". It saves you having to type in lots of individual numbers. Be careful with how generic you make your wildcard IP numbers though, because just using <b>192</b>. would probably eliminate legitimate IP addresses to comment.
</p><p>The <tt>.htaccess</tt> file - which also controls your permalinks - can be used to completely block an IP from even seeing your site. You can place this either in your site root, or the directory where your blog is (if they are different).
</p><p>Below is an example of the <tt>.htaccess</tt> that is present in the root directory of a website.
</p>
<pre>
Order allow,deny
Deny from 123.123.123.123
Deny from 156.156.156.0/24
Deny from 189.189.0.0/16
Allow from all
</pre>
<dl><dt>Deny from 123.123.123.123&#160;</dt>
<dd>Access is denied to that IP alone</dd></dl>
<dl><dt>Deny from 156.156.156.0/24&#160;</dt>
<dd>Access is denied to ALL users whose IPs start with 156.156.156</dd></dl>
<dl><dt>Deny from 189.189.0.0/16&#160;</dt>
<dd>Again, anyone at all with an IP that starts 189.189 is blocked.</dd></dl>
<p>So a total of 256*256 unique IP addresses are blocked
</p><p>The syntax used for specifying IP ranges is <a href="http://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing" class="extiw" title="wikipedia:Classless Inter-Domain Routing">Wikipedia:Classless_Inter-Domain_Routing</a>.
</p><p>If you do start blocking IPs, then a blocked visitor will see a <b>403 error page</b>. Try to make sure that such a page has your contact details listed. Check your hosting to see how to make a custom 403 (or see below too).
</p><p>If you start blocking IPs with the <tt>*</tt> wildcard, at least give someone the chance to email you to say you may have made a mistake.
</p><p>If you want to check that someone is blocked, get a friend's IP, tell them what you are doing, and block them (until you know it works).
</p>
<h2><span class="mw-headline" id="Deny_Access_to_No_Referrer_Requests">Deny Access to No Referrer Requests</span></h2>
<p>When your readers comment, the <tt>wp-comments-post.php</tt> file is accessed, does its thing, and creates the post. The user's browser will send a "referral" line about this.
</p><p>When a <b>spam-bot</b> comes in, it hits the file directly and <b>usually</b> does not leave a referrer. This allows for some nifty detection and action direct from the server. If you are not familiar with Apache directives, then write the following in your root directory <tt>.htaccess</tt> file::
</p>
<pre>RewriteEngine On
RewriteCond&#160;%{REQUEST_METHOD} POST
RewriteCond&#160;%{REQUEST_URI} .wp-comments-post\.php*
RewriteCond&#160;%{HTTP_REFERER}&#160;!.*yourdomain.com.* [OR]
RewriteCond&#160;%{HTTP_USER_AGENT} ^$
RewriteRule (.*) http://%{REMOTE_ADDR}/$ [R=301,L]</pre>
<p>This will:
</p>
<ol><li> Detect when a POST is being made</li>
<li> Check to see if the post is on wp-comments-post.php</li>
<li> Check if the <b>referrer</b> is in your domain or if <b>no referrer</b></li>
<li> Send the spam-bot BACK to its originating server's IP address.</li></ol>
<dl><dd><strong style="color:RED;">NOTE 1:</strong> In the 4th line, change yourdomain.com to your <b><em>domain.xxx</em></b> without the www or any prefix for that matter.</dd></dl>
<dl><dd><strong style="color:RED;">NOTE 2:</strong> There is a slim chance that someone's browser will not send the referral, but this is extremely rare.</dd></dl>
<p>This essentially <em>deflects</em> the spam-bot back on itself.
</p><p><strong>TIP:</strong> If you want to see this work, and you know the absolute path to your root directory, then do this:
</p>
<pre>RewriteEngine On
RewriteLog /absolute/path/to/your/wwwroot/public_html/rewrite_log.txt
RewriteLogLevel 2</pre>
<p>When the RewriteRule is activated, you will get something like this in rewrite_log.txt:
</p>
<pre style="margin-bottom:0px">
65.197.28.xxx- - [06/Feb/2005:10:59:34 --0500] [yourdomain.com/sid#80054890][rid#804b6a50/initial] (2) init rewrite engine with requested uri /wp-comments-post.php
65.197.28.xxx- - [06/Feb/2005:10:59:34 --0500] [yourdomain.com/sid#80054890][rid#804b6a50/initial] (2) rewrite /press/wp-comments-post.php -&gt; http://65.197.28.xxx/
65.197.28.xxx- - [06/Feb/2005:10:59:34 --0500] [yourdomain.com/sid#80054890][rid#804b6a50/initial] (2) explicitly forcing redirect with http://65.197.28.170/
65.197.28.xxx- - [06/Feb/2005:10:59:34 --0500] [yourdomain.com/sid#80054890][rid#804b6a50/initial] (1) escaping http://65.197.28.xxx/ for redirect
65.197.28.xxx- - [06/Feb/2005:10:59:34 --0500] [yourdomain.com/sid#80054890][rid#804b6a50/initial] (1) redirect to http://65.197.28.xxx/ [REDIRECT/301]</pre>
<blockquote style="margin-top:0px;font-size:90%;">Taken from an actual log</blockquote>
<p>Note: As easy as it is to block IP addresses, it is ineffective against spambots which use compromised machines to spread their spam for two reasons:
1. The original owners of the machine are still accessing the machine and are most likely decent people who don't deserve to be blocked
2. The sheer number of such machines will overwhelm anyone trying to block by IP
</p>
<h2><span class="mw-headline" id="Deny_Access_Referrer_Spammers">Deny Access Referrer Spammers</span></h2>
<p>Many bloggers show referrer's to their site or links from which people came to visit their site. Spammers exploit this and indiscriminately spam blogs (even bloggers who do not have this feature enabled) with referral links pointing to their spammy sites. They end up wasting your resources, polluting your legitimate referrer's list and slowing down access for your readers.
</p><p>In an effort to economize their resources, spammers often send out comment spam bots with their spam referrers for that two-in-one-shot effect.  Consequently, you can block quite a few comment spam bots by blocking the referrer spam.
</p><p>Once you know which referrer URL you'd like to block, and believe me you'll know, you can keep them out by adding the following into your .htaccess file:
</p>
<pre>
SetEnvIfNoCase Via evil-spam-proxy spammer=yes
SetEnvIfNoCase Referer evil-spam-domain.com spammer=yes
SetEnvIfNoCase Referer evil-spam-keyword spammer=yes
SetEnvIfNoCase Via pinappleproxy spammer=yes
SetEnvIfNoCase Referer doobu.com spammer=yes
SetEnvIfNoCase Referer poker spammer=yes

Order allow,deny
Allow from all
Deny from env=spammer
</pre>
<p>The aforementioned <tt>.htaccess</tt> rules were brought to you by <a rel="nofollow" class="external text" href="http://www.tomrafteryit.net/using-htaccess-to-minimise-comment-and-referrer-spam/">Tom Raftery</a>, who originally used regular rewrite conditions and later decided that "using SetEnvIfNoCase instead of RewriteCond - seems to be quite effective (especially for referrers)." 
</p><p>Plugins for blocking Referrer Spam can be found on the <a rel="nofollow" class="external text" href="http://wordpress.org/extend/plugins/">Official WordPress Plugin Directory</a>.
</p>
<h2><span class="mw-headline" id="Using_a_Custom_403">Using a Custom 403</span></h2>
<p>It's a regular webpage, and again using <tt>.htaccess</tt> you tell the server to show your page, not the default one.
</p><p>The <tt>.htaccess</tt> should have this:
</p>
<pre>ErrorDocument 403 /errors/403.html</pre>
<p>Create a directory called "errors", for example,  and put your custom 403 message into that.
Again, to test, block a friend and ask for feedback.
</p><p>You create a custom 404 the same way.
</p>
<dl><dd><dl><dd><b>Caution:</b> Read any and all documentation that your host has regarding use of custom pages - your server requirements may differ from the above suggestions! If in doubt, contact your host directly for assistance.</dd></dl></dd></dl>
<h2><span class="mw-headline" id="Using_PHP_Code_to_Block">Using PHP Code to Block</span></h2>
<p>You can add this to the top of any PHP page, putting the actual IP address where the xxx or yyy is.
</p>
<pre>
&lt;?php
$block = array("xxx.xxx.xxx.xxx", "yy.yy.y.yyy");

if (in_array ($_SERVER['REMOTE_ADDR'], $block)) {
    header("Location: http://google.com/");
    exit();
}
?&gt;
</pre>
<h2><span class="mw-headline" id="Resources">Resources</span></h2>
<ul><li> <a href="../Combating_Comment_Spam.html" title="Combating Comment Spam">Combating Comment Spam</a></li>
<li> <a href="../Comment_Spam.html" title="Comment Spam">Comment Spam</a></li>
<li> <a href="../Spam_Words.html" title="Spam Words">Spam Words</a></li></ul>

<!-- 
NewPP limit report
Cached time: 20210122073546
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.008 seconds
Real time usage: 0.009 seconds
Preprocessor visited node count: 89/1000000
Preprocessor generated node count: 174/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 - -total
-->
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="https://codex.wordpress.org/index.php?title=Combating_Comment_Spam/Denying_Access&amp;oldid=136706">https://codex.wordpress.org/index.php?title=Combating_Comment_Spam/Denying_Access&amp;oldid=136706</a>"</div>
				<div id="catlinks"><div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="https://codex.wordpress.org/Special:Categories" title="Special:Categories">Categories</a>: <ul><li><a href="../Category_Getting_Started.html" title="Category:Getting Started">Getting Started</a></li><li><a href="../Category_Troubleshooting.html" title="Category:Troubleshooting">Troubleshooting</a></li></ul></div></div></div>			<!-- end content -->
		</div>
		<div class="col-2">
			
						
			<ul class="submenu">
				<li id="n-mainpage"><a href="../Main_Page.html">Home Page</a></li>	
				<li><a href="../WordPress_Lessons.html">WordPress Lessons</a></li>
				<li><a href="../Getting_Started_with_WordPress.html">Getting Started</a></li>
				<li><a href="../Working_with_WordPress.html">Working with WordPress</a></li>
				<li><a href="../Blog_Design_and_Layout.html">Design and Layout</a></li>
				<li><a href="../Advanced_Topics.html">Advanced Topics</a></li>
				<li><a href="../Troubleshooting.html">Troubleshooting</a></li>
				<li><a href="../Developer_Documentation.html">Developer Docs</a></li>
				<li><a href="../About_WordPress.html">About WordPress</a></li>
			</ul>

			<h3>Codex Resources</h3>
			<ul class="submenu">
				<li id="n-portal"><a href="https://codex.wordpress.org/Codex:Community_Portal">Community portal</a></li>	      
				<li id="n-currentevents"><a href="../Current_events.html">Current events</a></li>	      
				<li id="n-recentchanges"><a href="https://codex.wordpress.org/Special:RecentChanges">Recent changes</a></li>	      
				<li id="n-randompage"><a href="https://codex.wordpress.org/Special:Random">Random page</a></li>	      
				<li id="n-help"><a href="https://codex.wordpress.org/Help:Contents">Help</a></li>	
			</ul>
			
		</div>
	</div>
</div>


<div id="wporg-footer">
	<div class="wrapper">
		<ul>
			<li><a href="http://wordpress.org/about/" title="An introduction to the WordPress project">About</a></li>
			<li><a href="http://wordpress.org/news/" title="News and Updates">Blog</a></li>
			<li><a href="http://wordpress.org/hosting/" title="Recommended web hosting providers">Hosting</a></li>
			<li><a href="https://wordpressfoundation.org/donate/" title="Donate to the WordPress Foundation">Donate</a></li>
		</ul>

		<ul>
			<li><a href="http://wordpress.org/support/" title="Forums, documentation, and other resources">Support</a></li>
			<li><a href="../../developer.wordpress.org/index.html" title="Resources for WordPress developers">Developers</a></li>
			<li><a href="http://make.wordpress.org/" title="Give back to WordPress through code, support, translation and more">Get Involved</a></li>
			<li><a href="http://learn.wordpress.org/" title="Workshops and training materials">Learn</a></li>
		</ul>

		<ul>
			<li><a href="http://wordpress.org/showcase/" title="Some of the best WordPress sites on the Web">Showcase</a></li>
			<li><a href="http://wordpress.org/plugins/" title="Add extra functionality to WordPress">Plugins</a></li>
			<li><a href="http://wordpress.org/themes/" title="Make your WordPress pretty">Themes</a></li>
		</ul>

		<ul>
			<li><a href="http://central.wordcamp.org/" title="Find a WordPress event near you">WordCamp</a></li>
			<li><a href="http://wordpress.tv/" title="Videos, tutorials, and WordCamp sessions">WordPress.TV</a></li>
			<li><a href="http://buddypress.org/" title="A set of plugins to transform your WordPress into a social network">BuddyPress</a></li>
			<li><a href="http://bbpress.org/" title="Fast, slick forums built on WordPress">bbPress</a></li>
		</ul>

		<ul>
			<li><a href="http://wordpress.com/?ref=wporg-footer" title="Hassle-free WordPress hosting">WordPress.com</a></li>
			<li><a href="http://ma.tt/" title="Co-founder of WordPress, an example of what WordPress can do">Matt</a></li>
			<li><a href="http://wordpress.org/about/privacy/" title="WordPress.org Privacy Policy">Privacy</a></li>
			<li><a href="https://publiccode.eu/" target="_blank">Public Code</a></li>
		</ul>

		<ul>
			<li><span class="dashicons dashicons-twitter"></span><a href="https://twitter.com/WordPress" title="Follow @WordPress on Twitter">@WordPress</a></li>
			<li><span class="dashicons dashicons-facebook"></span><a href="https://www.facebook.com/WordPress/" title="Like WordPress on Facebook">WordPress</a></li>
		</ul>
	</div>

		<p class="cip cip-image">Code is Poetry.</p>
</div>

<script src="../../s.w.org/style/js/navigation.min.js?20190128"></script>

</body>
<!-- Cached 20210122073546 -->

<!-- Mirrored from codex.wordpress.org/Combating_Comment_Spam/Denying_Access by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 31 Aug 2021 16:48:03 GMT -->
</html>
