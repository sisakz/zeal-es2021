<html><!-- Mirrored from www.php.net/manual/en/language.oop5.decon.php by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 11 Sep 2021 02:31:44 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Constructors and Destructors</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="language.oop5.decon.html">
 <link rel="shorturl" href="https://www.php.net/oop5.decon">
 <link rel="alternate" href="https://www.php.net/oop5.decon" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="language.oop5.html">
 <link rel="prev" href="language.oop5.autoload.html">
 <link rel="next" href="language.oop5.visibility.html">

 <link rel="alternate" href="language.oop5.decon.html" hreflang="en">
 <link rel="alternate" href="https://www.php.net/manual/pt_BR/language.oop5.decon.php" hreflang="pt_BR">
 <link rel="alternate" href="https://www.php.net/manual/zh/language.oop5.decon.php" hreflang="zh">
 <link rel="alternate" href="https://www.php.net/manual/fr/language.oop5.decon.php" hreflang="fr">
 <link rel="alternate" href="https://www.php.net/manual/de/language.oop5.decon.php" hreflang="de">
 <link rel="alternate" href="https://www.php.net/manual/ja/language.oop5.decon.php" hreflang="ja">
 <link rel="alternate" href="https://www.php.net/manual/ro/language.oop5.decon.php" hreflang="ro">
 <link rel="alternate" href="https://www.php.net/manual/ru/language.oop5.decon.php" hreflang="ru">
 <link rel="alternate" href="https://www.php.net/manual/es/language.oop5.decon.php" hreflang="es">
 <link rel="alternate" href="https://www.php.net/manual/tr/language.oop5.decon.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached0aba.css?t=1539771603&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached2ecf.css?t=1539765004&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedba57.css?t=1606338002&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached3afa.css?t=1627831203&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="https://www.php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script>
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="https://www.php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script src="https://www.php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>


</head>
<body class="docs " style="">


<div class="headsup"><a href="https://www.php.net/conferences/index.php#id2021-09-08-1">Longhorn PHP 2021</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.errors.html">Errors</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.attributes.html">Attributes</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.sessions.html">Session Security</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
	<dd><a href="refs.ui.html">GUI Extensions</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
    <div id="breadcrumbs-inner">
          
              
          <ul>
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="langref.html">Language Reference</a></li>      <li><a href="language.oop5.html">Classes and Objects</a></li>      </ul>
    </div>
  </div>




<div id="layout" class="clearfix">
  <section id="layout-content">
  <div id="language.oop5.decon" class="sect1">
  <h2 class="title">Constructors and Destructors</h2>

  <div class="sect2" id="language.oop5.decon.constructor">
   <h3 class="title">Constructor</h3>
   <div class="methodsynopsis dc-description" id="object.construct">
    <span class="methodname"><strong>__construct</strong></span>(<span class="methodparam"><span class="type"><a href="language.types.declarations.html#language.types.declarations.mixed" class="type mixed">mixed</a></span> <code class="parameter">...$values</code><span class="initializer"> = ""</span></span>): <span class="type"><span class="type void">void</span></span></div>

   <p class="para">
    PHP allows developers to declare constructor methods for classes.
    Classes which have a constructor method call this method on each
    newly-created object, so it is suitable for any initialization that the
    object may need before it is used.
   </p>
   <blockquote class="note"><p><strong class="note">Note</strong>: 
    <span class="simpara">
     Parent constructors are not called implicitly if the child class defines
     a constructor.  In order to run a parent constructor, a call to
     <span class="function"><strong>parent::__construct()</strong></span> within the child constructor is
     required. If the child does not define a constructor then it may be inherited
     from the parent class just like a normal class method (if it was not declared
     as private).
    </span>
   </p></blockquote>
   <div class="example" id="language.oop5.basic.class.class.name">
    <p><strong>Example #1 Constructors in inheritance</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">BaseClass&nbsp;</span><span style="color: #007700">{<br>&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;</span><span style="color: #0000BB">__construct</span><span style="color: #007700">()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;</span><span style="color: #DD0000">"In&nbsp;BaseClass&nbsp;constructor\n"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br><br>class&nbsp;</span><span style="color: #0000BB">SubClass&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">BaseClass&nbsp;</span><span style="color: #007700">{<br>&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;</span><span style="color: #0000BB">__construct</span><span style="color: #007700">()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">parent</span><span style="color: #007700">::</span><span style="color: #0000BB">__construct</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;</span><span style="color: #DD0000">"In&nbsp;SubClass&nbsp;constructor\n"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br><br>class&nbsp;</span><span style="color: #0000BB">OtherSubClass&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">BaseClass&nbsp;</span><span style="color: #007700">{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;inherits&nbsp;BaseClass's&nbsp;constructor<br></span><span style="color: #007700">}<br><br></span><span style="color: #FF8000">//&nbsp;In&nbsp;BaseClass&nbsp;constructor<br></span><span style="color: #0000BB">$obj&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">BaseClass</span><span style="color: #007700">();<br><br></span><span style="color: #FF8000">//&nbsp;In&nbsp;BaseClass&nbsp;constructor<br>//&nbsp;In&nbsp;SubClass&nbsp;constructor<br></span><span style="color: #0000BB">$obj&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">SubClass</span><span style="color: #007700">();<br><br></span><span style="color: #FF8000">//&nbsp;In&nbsp;BaseClass&nbsp;constructor<br></span><span style="color: #0000BB">$obj&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">OtherSubClass</span><span style="color: #007700">();<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
   <p class="para">
    Unlike other methods, <a href="language.oop5.decon.html#object.construct" class="link">__construct()</a>
    is exempt from the usual
    <a href="language.oop5.basic.html#language.oop.lsp" class="link">signature compatibility rules</a>
    when being extended.
   </p>
   <p class="para">
    Constructors are ordinary methods which are called during the instantiation of their
    corresponding object.  As such, they may define an arbitrary number of arguments, which
    may be required, may have a type, and may have a default value. Constructor arguments
    are called by placing the arguments in parentheses after the class name.
   </p>
   <div class="example" id="language.oop5.basic.class.class.fail">
    <p><strong>Example #2 Using constructor arguments</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Point&nbsp;</span><span style="color: #007700">{<br>&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;</span><span style="color: #0000BB">int&nbsp;$x</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;</span><span style="color: #0000BB">int&nbsp;$y</span><span style="color: #007700">;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">__construct</span><span style="color: #007700">(</span><span style="color: #0000BB">int&nbsp;$x</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">int&nbsp;$y&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">x&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$x</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">y&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$y</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br><br></span><span style="color: #FF8000">//&nbsp;Pass&nbsp;both&nbsp;parameters.<br></span><span style="color: #0000BB">$p1&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Point</span><span style="color: #007700">(</span><span style="color: #0000BB">4</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">5</span><span style="color: #007700">);<br></span><span style="color: #FF8000">//&nbsp;Pass&nbsp;only&nbsp;the&nbsp;required&nbsp;parameter.&nbsp;$y&nbsp;will&nbsp;take&nbsp;its&nbsp;default&nbsp;value&nbsp;of&nbsp;0.<br></span><span style="color: #0000BB">$p2&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Point</span><span style="color: #007700">(</span><span style="color: #0000BB">4</span><span style="color: #007700">);<br></span><span style="color: #FF8000">//&nbsp;With&nbsp;named&nbsp;parameters&nbsp;(as&nbsp;of&nbsp;PHP&nbsp;8.0):<br></span><span style="color: #0000BB">$p3&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Point</span><span style="color: #007700">(</span><span style="color: #0000BB">y</span><span style="color: #007700">:&nbsp;</span><span style="color: #0000BB">5</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">x</span><span style="color: #007700">:&nbsp;</span><span style="color: #0000BB">4</span><span style="color: #007700">);<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
   <p class="para">
    If a class has no constructor, or the constructor has no required arguments, the parentheses
    may be omitted.
   </p>
   <div class="sect3">
    <h4 class="title">Old-style constructors</h4>
    <p class="para">
     Prior to PHP 8.0.0, classes in the global namespace will interpret a method named
     the same as the class as an old-style constructor.  That syntax is deprecated,
     and will result in an <strong><code>E_DEPRECATED</code></strong> error but still call that function as a constructor.
     If both <a href="language.oop5.decon.html#object.construct" class="link">__construct()</a> and a same-name method are
     defined, <a href="language.oop5.decon.html#object.construct" class="link">__construct()</a> will be called.
    </p>
    <p class="para">
     In namespaced classes, or any class as of PHP 8.0.0, a method named
     the same as the class never has any special meaning.
    </p>
    <p class="para">Always use <a href="language.oop5.decon.html#object.construct" class="link">__construct()</a> in new code.
    </p>
   </div>
   <div class="sect3" id="language.oop5.decon.constructor.promotion">
    <h4 class="title">Constructor Promotion</h4>
    <p class="para">
     As of PHP 8.0.0, constructor parameters may also be promoted to correspond to an
     object property.  It is very common for constructor parameters to be assigned to
     a property in the constructor but otherwise not operated upon.  Constructor promotion
     provides a short-hand for that use case.  The example above could be rewritten as the following.
    </p>
    <div class="example" id="language.oop5.basic.class.class.object">
     <p><strong>Example #3 Using constructor property promotion</strong></p>
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Point&nbsp;</span><span style="color: #007700">{<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">__construct</span><span style="color: #007700">(protected&nbsp;</span><span style="color: #0000BB">int&nbsp;$x</span><span style="color: #007700">,&nbsp;protected&nbsp;</span><span style="color: #0000BB">int&nbsp;$y&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}</span>
</span>
</code></div>
     </div>

    </div>
    <p class="para">
     When a constructor argument includes a visibility modifier, PHP will interpret it as
     both an object property and a constructor argument, and assign the argument value to
     the property.  The constructor body may then be empty or may contain other statements.
     Any additional statements will be executed after the argument values have been assigned
     to the corresponding properties.
    </p>
    <p class="para">
     Not all arguments need to be promoted. It is possible to mix and match promoted and not-promoted
     arguments, in any order.  Promoted arguments have no impact on code calling the constructor.
    </p>
    <blockquote class="note"><p><strong class="note">Note</strong>: 
     </p><p class="para">
      Object properties may not be typed <span class="type"><a href="language.types.callable.html" class="type callable">callable</a></span> due to engine ambiguity that would
      introduce. Promoted arguments, therefore, may not be typed <span class="type"><a href="language.types.callable.html" class="type callable">callable</a></span> either. Any
      other <a href="language.types.declarations.html" class="link">type declaration</a> is permitted, however.
     </p>
    <p></p></blockquote>
    <blockquote class="note"><p><strong class="note">Note</strong>: 
     </p><p class="para">
      <a href="language.attributes.html" class="link">Attributes</a> placed on a
      promoted constructor argument will be replicated to both the property
      and argument.
     </p>
    <p></p></blockquote>
   </div>
   <div class="sect3" id="language.oop5.decon.constructor.static">
    <h4 class="title">Static creation methods</h4>
    <p class="para">
     PHP only supports a single constructor per class.  In some cases, however, it may be
     desirable to allow an object to be constructed in different ways with different inputs.
     The recommended way to do so is by using static methods as constructor wrappers.
    </p>
    <div class="example" id="example-203">
     <p><strong>Example #4 Using static creation methods</strong></p>
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Product&nbsp;</span><span style="color: #007700">{<br><br>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;?</span><span style="color: #0000BB">int&nbsp;$id</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;?</span><span style="color: #0000BB">string&nbsp;$name</span><span style="color: #007700">;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;function&nbsp;</span><span style="color: #0000BB">__construct</span><span style="color: #007700">(?</span><span style="color: #0000BB">int&nbsp;$id&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">,&nbsp;?</span><span style="color: #0000BB">string&nbsp;$name&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">id&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$id</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">name&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$name</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">fromBasicData</span><span style="color: #007700">(</span><span style="color: #0000BB">int&nbsp;$id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">string&nbsp;$name</span><span style="color: #007700">):&nbsp;static&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$new&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;static(</span><span style="color: #0000BB">$id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$name</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$new</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">fromJson</span><span style="color: #007700">(</span><span style="color: #0000BB">string&nbsp;$json</span><span style="color: #007700">):&nbsp;static&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">json_decode</span><span style="color: #007700">(</span><span style="color: #0000BB">$json</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;static(</span><span style="color: #0000BB">$data</span><span style="color: #007700">[</span><span style="color: #DD0000">'id'</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">[</span><span style="color: #DD0000">'name'</span><span style="color: #007700">]);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">fromXml</span><span style="color: #007700">(</span><span style="color: #0000BB">string&nbsp;$xml</span><span style="color: #007700">):&nbsp;static&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Custom&nbsp;logic&nbsp;here.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">convert_xml_to_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$new&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;static();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$new</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">id&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">[</span><span style="color: #DD0000">'id'</span><span style="color: #007700">];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$new</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">name&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">[</span><span style="color: #DD0000">'name'</span><span style="color: #007700">];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$new</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br><br></span><span style="color: #0000BB">$p1&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Product</span><span style="color: #007700">::</span><span style="color: #0000BB">fromBasicData</span><span style="color: #007700">(</span><span style="color: #0000BB">5</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'Widget'</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$p2&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Product</span><span style="color: #007700">::</span><span style="color: #0000BB">fromJson</span><span style="color: #007700">(</span><span style="color: #0000BB">$some_json_string</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$p3&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Product</span><span style="color: #007700">::</span><span style="color: #0000BB">fromXml</span><span style="color: #007700">(</span><span style="color: #0000BB">$some_xml_string</span><span style="color: #007700">);</span>
</span>
</code></div>
     </div>

    </div>
    <p class="para">
     The constructor may be made private or protected to prevent it from being called externally.
     If so, only a static method will be able to instantiate the class. Because they are in the
     same class definition they have access to private methods, even if not of the same object
     instance. The private constructor is optional and may or may not make sense depending on
     the use case.
    </p>
    <p class="para">
     The three public static methods then demonstrate different ways of instantiating the object.
    </p>
    <ul class="simplelist">
     <li class="member"><code class="code">fromBasicData()</code> takes the exact parameters that are needed, then creates the
      object by calling the constructor and returning the result.</li>
     <li class="member"><code class="code">fromJson()</code> accepts a JSON string and does some pre-processing on it itself
     to convert it into the format desired by the constructor. It then returns the new object.</li>
     <li class="member"><code class="code">fromXml()</code> accepts an XML string, preprocesses it, and then creates a bare
     object.  The constructor is still called, but as all of the parameters are optional the method
     skips them.  It then assigns values to the object properties directly before returning the result.</li>
    </ul>
    <p class="para">
     In all three cases, the <code class="code">static</code> keyword is translated into the name of the class the code is in.
     In this case, <code class="code">Product</code>.
    </p>
   </div>
  </div>
  <div class="sect2" id="language.oop5.decon.destructor">
   <h3 class="title">Destructor</h3>
   <div class="methodsynopsis dc-description" id="object.destruct">
    <span class="methodname"><strong>__destruct</strong></span>(): <span class="type"><span class="type void">void</span></span></div>

   <p class="para">
    PHP possesses a destructor concept similar to that of other
    object-oriented languages, such as C++. The destructor method will be
    called as soon as there are no other references to a particular object,
    or in any order during the shutdown sequence.
   </p>
   <div class="example" id="example-204">
    <p><strong>Example #5 Destructor Example</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">MyDestructableClass&nbsp;<br></span><span style="color: #007700">{<br>&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;</span><span style="color: #0000BB">__construct</span><span style="color: #007700">()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;</span><span style="color: #DD0000">"In&nbsp;constructor\n"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;</span><span style="color: #0000BB">__destruct</span><span style="color: #007700">()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;</span><span style="color: #DD0000">"Destroying&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">__CLASS__&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br><br></span><span style="color: #0000BB">$obj&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">MyDestructableClass</span><span style="color: #007700">();</span>
</span>
</code></div>
    </div>

   </div>
   <p class="para">
    Like constructors, parent destructors will not be called implicitly by
    the engine. In order to run a parent destructor, one would have to
    explicitly call <span class="function"><strong>parent::__destruct()</strong></span> in the destructor
    body. Also like constructors, a child class may inherit the parent's
    destructor if it does not implement one itself.
   </p>
   <p class="para">
    The destructor will be called even if script execution is stopped using
    <span class="function"><a href="function.exit.html" class="function">exit()</a></span>. Calling <span class="function"><a href="function.exit.html" class="function">exit()</a></span> in a destructor
    will prevent the remaining shutdown routines from executing.
   </p>
   <blockquote class="note"><p><strong class="note">Note</strong>: 
    </p><p class="para">
     Destructors called during the script shutdown have HTTP headers already
     sent. The working directory in the script shutdown phase can be different
     with some SAPIs (e.g. Apache).
    </p>
   <p></p></blockquote>
   <blockquote class="note"><p><strong class="note">Note</strong>: 
    </p><p class="para">
     Attempting to throw an exception from a destructor (called in the time of
     script termination) causes a fatal error.
    </p>
   <p></p></blockquote>
  </div>

 </div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="105368">  
  <a class="name">
  <strong class="user"><em>david dot scourfield at llynfi dot co dot uk</em></strong></a><div class="date" title="2011-08-12 04:17"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom105368">
<div class="phpcode"><code><span class="html">
Be aware of potential memory leaks caused by circular references within objects.&nbsp; The PHP manual states "[t]he destructor method will be called as soon as all references to a particular object are removed" and this is precisely true: if two objects reference each other (or even if one object has a field that points to itself as in $this-&gt;foo = $this) then this reference will prevent the destructor being called even when there are no other references to the object at all.&nbsp; The programmer can no longer access the objects, but they still stay in memory.<br><br>Consider the following example:<br><br><span class="default">&lt;?php<br><br>header</span><span class="keyword">(</span><span class="string">"Content-type: text/plain"</span><span class="keyword">);<br><br>class </span><span class="default">Foo </span><span class="keyword">{<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">/**<br>&nbsp; &nbsp;&nbsp; * An indentifier<br>&nbsp; &nbsp;&nbsp; * @var string <br>&nbsp; &nbsp;&nbsp; */<br>&nbsp; &nbsp; </span><span class="keyword">private </span><span class="default">$name</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="comment">/**<br>&nbsp; &nbsp;&nbsp; * A reference to another Foo object<br>&nbsp; &nbsp;&nbsp; * @var Foo<br>&nbsp; &nbsp;&nbsp; */<br>&nbsp; &nbsp; </span><span class="keyword">private </span><span class="default">$link</span><span class="keyword">;<br><br>&nbsp; &nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">name </span><span class="keyword">= </span><span class="default">$name</span><span class="keyword">;<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; public function </span><span class="default">setLink</span><span class="keyword">(</span><span class="default">Foo $link</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">link </span><span class="keyword">= </span><span class="default">$link</span><span class="keyword">;<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; public function </span><span class="default">__destruct</span><span class="keyword">() {<br>&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">'Destroying: '</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">, </span><span class="default">PHP_EOL</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>}<br><br></span><span class="comment">// create two Foo objects:<br></span><span class="default">$foo </span><span class="keyword">= new </span><span class="default">Foo</span><span class="keyword">(</span><span class="string">'Foo 1'</span><span class="keyword">);<br></span><span class="default">$bar </span><span class="keyword">= new </span><span class="default">Foo</span><span class="keyword">(</span><span class="string">'Foo 2'</span><span class="keyword">);<br><br></span><span class="comment">// make them point to each other<br></span><span class="default">$foo</span><span class="keyword">-&gt;</span><span class="default">setLink</span><span class="keyword">(</span><span class="default">$bar</span><span class="keyword">);<br></span><span class="default">$bar</span><span class="keyword">-&gt;</span><span class="default">setLink</span><span class="keyword">(</span><span class="default">$foo</span><span class="keyword">);<br><br></span><span class="comment">// destroy the global references to them<br></span><span class="default">$foo </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br></span><span class="default">$bar </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br><br></span><span class="comment">// we now have no way to access Foo 1 or Foo 2, so they OUGHT to be __destruct()ed<br>// but they are not, so we get a memory leak as they are still in memory.<br>//<br>// Uncomment the next line to see the difference when explicitly calling the GC:<br>// gc_collect_cycles();<br>// <br>// see also: <a rel="nofollow" target="_blank">http://www.php.net/manual/en/features.gc.php</a><br>// <br><br>// create two more Foo objects, but DO NOT set their internal Foo references<br>// so nothing except the vars $foo and $bar point to them:<br></span><span class="default">$foo </span><span class="keyword">= new </span><span class="default">Foo</span><span class="keyword">(</span><span class="string">'Foo 3'</span><span class="keyword">);<br></span><span class="default">$bar </span><span class="keyword">= new </span><span class="default">Foo</span><span class="keyword">(</span><span class="string">'Foo 4'</span><span class="keyword">);<br><br></span><span class="comment">// destroy the global references to them<br></span><span class="default">$foo </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br></span><span class="default">$bar </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br><br></span><span class="comment">// we now have no way to access Foo 3 or Foo 4 and as there are no more references<br>// to them anywhere, their __destruct() methods are automatically called here,<br>// BEFORE the next line is executed:<br><br></span><span class="keyword">echo </span><span class="string">'End of script'</span><span class="keyword">, </span><span class="default">PHP_EOL</span><span class="keyword">;<br><br></span><span class="default">?&gt;<br></span><br>This will output:<br><br>Destroying: Foo 3<br>Destroying: Foo 4<br>End of script<br>Destroying: Foo 1<br>Destroying: Foo 2<br><br>But if we uncomment the gc_collect_cycles(); function call in the middle of the script, we get:<br><br>Destroying: Foo 2<br>Destroying: Foo 1<br>Destroying: Foo 3<br>Destroying: Foo 4<br>End of script<br><br>As may be desired.<br><br>NOTE: calling gc_collect_cycles() does have a speed overhead, so only use it if you feel you need to.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="121521">  
  <a class="name">
  <strong class="user"><em>domger at freenet dot de</em></strong></a><div class="date" title="2017-08-14 07:53"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom121521">
<div class="phpcode"><code><span class="html">
The __destruct magic method must be public. <br><br>public function __destruct()<br>{<br>&nbsp; &nbsp; ;<br>}<br><br>The method will automatically be called externally to the instance.&nbsp; Declaring __destruct as protected or private will result in a warning and the magic method will not be called. <br><br>Note: In PHP 5.3.10 i saw strange side effects while some Destructors were declared as protected.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="124619">  
  <a class="name">
  <strong class="user"><em>iwwp at outlook dot com</em></strong></a><div class="date" title="2020-01-16 07:58"><strong>1 year ago</strong></div>
  <div class="text" id="Hcom124619">
<div class="phpcode"><code><span class="html">
To better understand the __destrust method:<br><br>class A {<br>&nbsp; &nbsp; protected $id;<br><br>&nbsp; &nbsp; public function __construct($id)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;id = $id;<br>&nbsp; &nbsp; &nbsp; &nbsp; echo "construct {$this-&gt;id}\n";<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; public function __destruct()<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; echo "destruct {$this-&gt;id}\n";<br>&nbsp; &nbsp; }<br>}<br><br>$a = new A(1);<br>echo "-------------\n";<br>$aa = new A(2);<br>echo "=============\n";<br><br>The output content:<br><br>construct 1<br>-------------<br>construct 2<br>=============<br>destruct 2<br>destruct 1</span>
</code></div>
  </div>
 </div>
  <div class="note" id="86423">  
  <a class="name">
  <strong class="user"><em>spleen</em></strong></a><div class="date" title="2008-10-17 04:35"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom86423">
<div class="phpcode"><code><span class="html">
It's always the easy things that get you -<br><br>Being new to OOP, it took me quite a while to figure out that there are TWO underscores in front of the word __construct.<br><br>It is __construct<br>Not _construct<br><br>Extremely obvious once you figure it out, but it can be sooo frustrating until you do.<br><br>I spent quite a bit of needless time debugging working code.<br><br>I even thought about it a few times, thinking it looked a little long in the examples, but at the time that just seemed silly(always thinking "oh somebody would have made that clear if it weren't just a regular underscore...")<br><br>All the manuals I looked at, all the tuturials I read, all the examples I browsed through&nbsp; - not once did anybody mention this!&nbsp; <br><br>(please don't tell me it's explained somewhere on this page and I just missed it,&nbsp; you'll only add to my pain.)<br><br>I hope this helps somebody else!</span>
</code></div>
  </div>
 </div>
  <div class="note" id="76710">  
  <a class="name">
  <strong class="user"><em>prieler at abm dot at</em></strong></a><div class="date" title="2007-07-27 12:42"><strong>14 years ago</strong></div>
  <div class="text" id="Hcom76710">
<div class="phpcode"><code><span class="html">
i have written a quick example about the order of destructors and shutdown functions in php 5.2.1:<br><br><span class="default">&lt;?php<br></span><span class="keyword">class </span><span class="default">destruction </span><span class="keyword">{<br>&nbsp; &nbsp; var </span><span class="default">$name</span><span class="keyword">;<br><br>&nbsp; &nbsp; function </span><span class="default">destruction</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">name </span><span class="keyword">= </span><span class="default">$name</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">register_shutdown_function</span><span class="keyword">(array(&amp;</span><span class="default">$this</span><span class="keyword">, </span><span class="string">"shutdown"</span><span class="keyword">));<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; function </span><span class="default">shutdown</span><span class="keyword">() {<br>&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">'shutdown: '</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; function </span><span class="default">__destruct</span><span class="keyword">() {<br>&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">'destruct: '</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>}<br><br></span><span class="default">$a </span><span class="keyword">= new </span><span class="default">destruction</span><span class="keyword">(</span><span class="string">'a: global 1'</span><span class="keyword">);<br><br>function </span><span class="default">test</span><span class="keyword">() {<br>&nbsp; &nbsp; </span><span class="default">$b </span><span class="keyword">= new </span><span class="default">destruction</span><span class="keyword">(</span><span class="string">'b: func 1'</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$c </span><span class="keyword">= new </span><span class="default">destruction</span><span class="keyword">(</span><span class="string">'c: func 2'</span><span class="keyword">);<br>}<br></span><span class="default">test</span><span class="keyword">();<br><br></span><span class="default">$d </span><span class="keyword">= new </span><span class="default">destruction</span><span class="keyword">(</span><span class="string">'d: global 2'</span><span class="keyword">);<br><br></span><span class="default">?&gt;<br></span><br>this will output:<br>shutdown: a: global 1<br>shutdown: b: func 1<br>shutdown: c: func 2<br>shutdown: d: global 2<br>destruct: b: func 1<br>destruct: c: func 2<br>destruct: d: global 2<br>destruct: a: global 1<br><br>conclusions:<br>destructors are always called on script end.<br>destructors are called in order of their "context": first functions, then global objects<br>objects in function context are deleted in order as they are set (older objects first).<br>objects in global context are deleted in reverse order (older objects last)<br><br>shutdown functions are called before the destructors.<br>shutdown functions are called in there "register" order. ;)<br><br>regards, J</span>
</code></div>
  </div>
 </div>
  <div class="note" id="108598">  
  <a class="name">
  <strong class="user"><em>Per Persson</em></strong></a><div class="date" title="2012-05-09 01:57"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom108598">
<div class="phpcode"><code><span class="html">
As of PHP 5.3.10 destructors are not run on shutdown caused by fatal errors.<br><br>For example:<br><span class="default">&lt;?php<br></span><span class="keyword">class </span><span class="default">Logger<br></span><span class="keyword">{<br>&nbsp; &nbsp; protected </span><span class="default">$rows </span><span class="keyword">= array();<br><br>&nbsp; &nbsp; public function </span><span class="default">__destruct</span><span class="keyword">()<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">save</span><span class="keyword">();<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; public function </span><span class="default">log</span><span class="keyword">(</span><span class="default">$row</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">rows</span><span class="keyword">[] = </span><span class="default">$row</span><span class="keyword">;<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; public function </span><span class="default">save</span><span class="keyword">()<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">'&lt;ul&gt;'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; foreach (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">rows </span><span class="keyword">as </span><span class="default">$row</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">'&lt;li&gt;'</span><span class="keyword">, </span><span class="default">$row</span><span class="keyword">, </span><span class="string">'&lt;/li&gt;'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">'&lt;/ul&gt;'</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>}<br><br></span><span class="default">$logger </span><span class="keyword">= new </span><span class="default">Logger</span><span class="keyword">;<br></span><span class="default">$logger</span><span class="keyword">-&gt;</span><span class="default">log</span><span class="keyword">(</span><span class="string">'Before'</span><span class="keyword">);<br><br></span><span class="default">$nonset</span><span class="keyword">-&gt;</span><span class="default">foo</span><span class="keyword">();<br><br></span><span class="default">$logger</span><span class="keyword">-&gt;</span><span class="default">log</span><span class="keyword">(</span><span class="string">'After'</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>Without the $nonset-&gt;foo(); line, Before and After will both be printed, but with the line neither will be printed.<br><br>One can however register the destructor or another method as a shutdown function:<br><span class="default">&lt;?php<br></span><span class="keyword">class </span><span class="default">Logger<br></span><span class="keyword">{<br>&nbsp; &nbsp; protected </span><span class="default">$rows </span><span class="keyword">= array();<br><br>&nbsp; &nbsp; public function </span><span class="default">__construct</span><span class="keyword">()<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">register_shutdown_function</span><span class="keyword">(array(</span><span class="default">$this</span><span class="keyword">, </span><span class="string">'__destruct'</span><span class="keyword">));<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; public function </span><span class="default">__destruct</span><span class="keyword">()<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">save</span><span class="keyword">();<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; public function </span><span class="default">log</span><span class="keyword">(</span><span class="default">$row</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">rows</span><span class="keyword">[] = </span><span class="default">$row</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; public function </span><span class="default">save</span><span class="keyword">()<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">'&lt;ul&gt;'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; foreach (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">rows </span><span class="keyword">as </span><span class="default">$row</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">'&lt;li&gt;'</span><span class="keyword">, </span><span class="default">$row</span><span class="keyword">, </span><span class="string">'&lt;/li&gt;'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">'&lt;/ul&gt;'</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>}<br><br></span><span class="default">$logger </span><span class="keyword">= new </span><span class="default">Logger</span><span class="keyword">;<br></span><span class="default">$logger</span><span class="keyword">-&gt;</span><span class="default">log</span><span class="keyword">(</span><span class="string">'Before'</span><span class="keyword">);<br><br></span><span class="default">$nonset</span><span class="keyword">-&gt;</span><span class="default">foo</span><span class="keyword">();<br><br></span><span class="default">$logger</span><span class="keyword">-&gt;</span><span class="default">log</span><span class="keyword">(</span><span class="string">'After'</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span>Now Before will be printed, but not After, so you can see that a shutdown occurred after Before.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="113052">  
  <a class="name">
  <strong class="user"><em>Yousef Ismaeil cliprz[At]gmail[Dot]com</em></strong></a><div class="date" title="2013-08-22 09:06"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom113052">
<div class="phpcode"><code><span class="html">
<span class="default">&lt;?php<br><br></span><span class="comment">/**<br> * a funny example Mobile class<br> * <br> * @author Yousef Ismaeil Cliprz[At]gmail[Dot]com<br> */<br><br></span><span class="keyword">class </span><span class="default">Mobile </span><span class="keyword">{<br><br>&nbsp; &nbsp; </span><span class="comment">/**<br>&nbsp; &nbsp;&nbsp; * Some device properties<br>&nbsp; &nbsp;&nbsp; * <br>&nbsp; &nbsp;&nbsp; * @var string<br>&nbsp; &nbsp;&nbsp; * @access public<br>&nbsp; &nbsp;&nbsp; */<br>&nbsp; &nbsp; </span><span class="keyword">public </span><span class="default">$deviceName</span><span class="keyword">,</span><span class="default">$deviceVersion</span><span class="keyword">,</span><span class="default">$deviceColor</span><span class="keyword">;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">/**<br>&nbsp; &nbsp;&nbsp; * Set some values for Mobile::properties<br>&nbsp; &nbsp;&nbsp; * <br>&nbsp; &nbsp;&nbsp; * @param string device name<br>&nbsp; &nbsp;&nbsp; * @param string device version<br>&nbsp; &nbsp;&nbsp; * @param string device color<br>&nbsp; &nbsp;&nbsp; */<br>&nbsp; &nbsp; </span><span class="keyword">public function </span><span class="default">__construct </span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">,</span><span class="default">$version</span><span class="keyword">,</span><span class="default">$color</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">deviceName </span><span class="keyword">= </span><span class="default">$name</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">deviceVersion </span><span class="keyword">= </span><span class="default">$version</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">deviceColor </span><span class="keyword">= </span><span class="default">$color</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"The "</span><span class="keyword">.</span><span class="default">__CLASS__</span><span class="keyword">.</span><span class="string">" class is stratup.&lt;br /&gt;&lt;br /&gt;"</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">/**<br>&nbsp; &nbsp;&nbsp; * Some Output<br>&nbsp; &nbsp;&nbsp; * <br>&nbsp; &nbsp;&nbsp; * @access public<br>&nbsp; &nbsp;&nbsp; */<br>&nbsp; &nbsp; </span><span class="keyword">public function </span><span class="default">printOut </span><span class="keyword">() {<br>&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">'I have a '</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">deviceName<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">.</span><span class="string">' version '</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">deviceVersion<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">.</span><span class="string">' my device color is : '</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">deviceColor</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">/**<br>&nbsp; &nbsp;&nbsp; * Umm only for example we will remove Mobile::$deviceName Hum not unset only to check how __destruct working <br>&nbsp; &nbsp;&nbsp; * <br>&nbsp; &nbsp;&nbsp; * @access public<br>&nbsp; &nbsp;&nbsp; */<br>&nbsp; &nbsp; </span><span class="keyword">public function </span><span class="default">__destruct </span><span class="keyword">() {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">deviceName </span><span class="keyword">= </span><span class="string">'Removed'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">'&lt;br /&gt;&lt;br /&gt;Dumpping Mobile::deviceName to make sure its removed, Olay :'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">deviceName</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"&lt;br /&gt;The "</span><span class="keyword">.</span><span class="default">__CLASS__</span><span class="keyword">.</span><span class="string">" class is shutdown."</span><span class="keyword">;<br>&nbsp; &nbsp; }<br><br>}<br><br></span><span class="comment">// Oh ya instance<br></span><span class="default">$mob </span><span class="keyword">= new </span><span class="default">Mobile</span><span class="keyword">(</span><span class="string">'iPhone'</span><span class="keyword">,</span><span class="string">'5'</span><span class="keyword">,</span><span class="string">'Black'</span><span class="keyword">);<br><br></span><span class="comment">// print output<br></span><span class="default">$mob</span><span class="keyword">-&gt;</span><span class="default">printOut</span><span class="keyword">();<br><br></span><span class="default">?&gt;<br></span><br>The Mobile class is stratup.<br><br>I have a iPhone version 5 my device color is : Black<br><br>Dumpping Mobile::deviceName to make sure its removed, Olay :<br>string 'Removed' (length=7)<br><br>The Mobile class is shutdown.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="95569">  
  <a class="name">
  <strong class="user"><em>Jonathon Hibbard</em></strong></a><div class="date" title="2010-01-09 04:32"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom95569">
<div class="phpcode"><code><span class="html">
Please be aware of when using __destruct() in which you are unsetting variables...<br><br>Consider the following code:<br><span class="default">&lt;?php<br></span><span class="keyword">class </span><span class="default">my_class </span><span class="keyword">{<br>&nbsp; public </span><span class="default">$error_reporting </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br><br>&nbsp; function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$error_reporting </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">error_reporting </span><span class="keyword">= </span><span class="default">$error_reporting</span><span class="keyword">;<br>&nbsp; }<br><br>&nbsp; function </span><span class="default">__destruct</span><span class="keyword">() {<br>&nbsp; &nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">error_reporting </span><span class="keyword">=== </span><span class="default">true</span><span class="keyword">) </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">show_report</span><span class="keyword">();<br>&nbsp; &nbsp; unset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">error_reporting</span><span class="keyword">);<br>&nbsp; }<br></span><span class="default">?&gt;<br></span><br>The above will result in an error:<br>Notice: Undefined property: my_class::$error_reporting in my_class.php on line 10<br><br>It appears as though the variable will be unset BEFORE it actually can execute the if statement.&nbsp; Removing the unset will fix this.&nbsp; It's not needed anyways as PHP will release everything anyways, but just in case you run across this, you know why ;)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="82577">  
  <a class="name">
  <strong class="user"><em>bolshun at mail dot ru</em></strong></a><div class="date" title="2008-04-16 06:13"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom82577">
<div class="phpcode"><code><span class="html">
Ensuring that instance of some class will be available in destructor of some other class is easy: just keep a reference to that instance in this other class.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="125863">  
  <a class="name">
  <strong class="user"><em>instatiendaweb at gmail dot com</em></strong></a><div class="date" title="2021-02-27 10:07"><strong>6 months ago</strong></div>
  <div class="text" id="Hcom125863">
<div class="phpcode"><code><span class="html">
/**<br> * Haciendo una prueba con dos clases y dos destructores<br> * La prueba consta de acceder a la variable global del primer objeto en el segundo<br> * objeto el destructor 2<br> * Primera clase ==&gt; $GLOBALS['obj']<br> * SEgunda clase ==&gt; $GLOBALS['obj2']<br> * Se ejecuta construct y todo el codigo....<br> * Primer destruct borra el objeto y lo hace null<br> * Tratamos de acceder a $GLOBALS['obj'] en el segundo destruct pero <br> * ya no esta es un objeto null<br> * Warning: Undefined array key "obj" in...<br> */<br><br>class MyDestructableClass{<br>public $parametro;<br><br>&nbsp; &nbsp;&nbsp; function __construct($parametro) {<br>echo("&lt;div class=\"div\"&gt;"), "Construyendo ",__CLASS__ , ("&lt;/div&gt;");<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; escribir::verifacionnota($this ,'Antes de guardar la variable&nbsp; ');<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;parametro = $parametro;<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; escribir::verifacionnota($this ,'Despues de guardar la variable&nbsp; ');<br>&nbsp; &nbsp;&nbsp; }<br> <br>&nbsp;&nbsp; <br><br>&nbsp; &nbsp;&nbsp; function __destruct() {<br>&nbsp; &nbsp; &nbsp; &nbsp; escribir::linea(5); //Separador<br>&nbsp; &nbsp; &nbsp; &nbsp; echo("&lt;div class=\"div\"&gt;"), "Destruyendo " ,&nbsp; __CLASS__ , ("&lt;/div&gt;");<br>&nbsp; &nbsp; &nbsp; &nbsp; escribir::verifacionnota($this ,'Antes de borrar la variable&nbsp; ');<br>&nbsp; &nbsp; &nbsp; &nbsp; unset($this-&gt;parametro);<br>&nbsp; &nbsp; &nbsp; &nbsp; escribir::verifacionnota($this ,'Despues de borrar la variable&nbsp; ');<br><br>&nbsp; &nbsp; &nbsp;&nbsp; // unset($GLOBALS[$this]);<br>&nbsp; &nbsp;&nbsp; }<br> }<br> <br> $obj = new MyDestructableClass('parametroone');<br> escribir::verifacionnota($obj ,' Verificar la clase MyDestructableClass, no es necesario<br> borrar la clase porque se ejecuta al final del script&nbsp; ');<br> escribir::titulosep('Provando ejemplo aqui se puede acceder a la variable global');<br> escribir::verificacion($GLOBALS['obj']);<br><br>class destructora{<br>&nbsp; &nbsp; function __destruct(){<br>&nbsp; &nbsp; &nbsp; &nbsp; escribir::titulosep('Sin embargo esta variable muere aqui');<br>&nbsp; &nbsp; &nbsp; &nbsp; escribir::verificacion($GLOBALS['obj']);<br>&nbsp; &nbsp; }<br>}<br><br>$obj2 = new destructora();</span>
</code></div>
  </div>
 </div>
  <div class="note" id="68028">  
  <a class="name">
  <strong class="user"><em>Reza Mahjourian</em></strong></a><div class="date" title="2006-07-10 02:18"><strong>15 years ago</strong></div>
  <div class="text" id="Hcom68028">
<div class="phpcode"><code><span class="html">
Peter has suggested using static methods to compensate for unavailability of multiple constructors in PHP.&nbsp; This works fine for most purposes, but if you have a class hierarchy and want to delegate parts of initialization to the parent class, you can no longer use this scheme.&nbsp; It is because unlike constructors, in a static method you need to do the instantiation yourself.&nbsp; So if you call the parent static method, you will get an object of parent type which you can't continue to initialize with derived class fields.<br><br>Imagine you have an Employee class and a derived HourlyEmployee class and you want to be able to construct these objects out of some XML input too.<br><br><span class="default">&lt;?php<br></span><span class="keyword">class </span><span class="default">Employee </span><span class="keyword">{<br>&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$inName</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">name </span><span class="keyword">= </span><span class="default">$inName</span><span class="keyword">;<br>&nbsp;&nbsp; }<br><br>&nbsp;&nbsp; public static function </span><span class="default">constructFromDom</span><span class="keyword">(</span><span class="default">$inDom</span><span class="keyword">)<br>&nbsp;&nbsp; {<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$name </span><span class="keyword">= </span><span class="default">$inDom</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp;&nbsp; return new </span><span class="default">Employee</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">);<br>&nbsp;&nbsp; }<br><br>&nbsp;&nbsp; private </span><span class="default">$name</span><span class="keyword">;<br>}<br><br>class </span><span class="default">HourlyEmployee </span><span class="keyword">extends </span><span class="default">Employee </span><span class="keyword">{<br>&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$inName</span><span class="keyword">, </span><span class="default">$inHourlyRate</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">parent</span><span class="keyword">::</span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$inName</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">hourlyRate </span><span class="keyword">= </span><span class="default">$inHourlyRate</span><span class="keyword">;<br>&nbsp;&nbsp; }<br><br>&nbsp;&nbsp; public static function </span><span class="default">constructFromDom</span><span class="keyword">(</span><span class="default">$inDom</span><span class="keyword">)<br>&nbsp;&nbsp; {<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// can't call parent::constructFromDom($inDom)<br>&nbsp; &nbsp; &nbsp;&nbsp; // need to do all the work here again<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$name </span><span class="keyword">= </span><span class="default">$inDom</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">;&nbsp; </span><span class="comment">// increased coupling<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$hourlyRate </span><span class="keyword">= </span><span class="default">$inDom</span><span class="keyword">-&gt;</span><span class="default">hourlyrate</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp;&nbsp; return new </span><span class="default">EmployeeHourly</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">, </span><span class="default">$hourlyRate</span><span class="keyword">);<br>&nbsp;&nbsp; }<br><br>&nbsp;&nbsp; private </span><span class="default">$hourlyRate</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;<br></span><br>The only solution is to merge the two constructors in one by adding an optional $inDom parameter to every constructor.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="80107">  
  <a class="name">
  <strong class="user"><em>david at synatree dot com</em></strong></a><div class="date" title="2007-12-29 01:26"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom80107">
<div class="phpcode"><code><span class="html">
When a script is in the process of die()ing, you can't count on the order in which __destruct() will be called.<br><br>For a script I have been working on, I wanted to do transparent low-level encryption of any outgoing data.&nbsp; To accomplish this, I used a global singleton class configured like this:<br><br>class EncryptedComms<br>{<br>&nbsp; &nbsp; private $C;<br>&nbsp; &nbsp; private $objs = array();<br>&nbsp; &nbsp; private static $_me;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; public static function destroyAfter(&amp;$obj)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; self::getInstance()-&gt;objs[] =&amp; $obj;<br>&nbsp; &nbsp; &nbsp; &nbsp; /*<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Hopefully by forcing a reference to another object to exist <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inside this class, the referenced object will need to be destroyed<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; before garbage collection can occur on this object.&nbsp; This will force <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; this object's destruct method to be fired AFTER the destructors of<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; all the objects referenced here.<br>&nbsp; &nbsp; &nbsp; &nbsp; */<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; public function __construct($key)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;C = new SimpleCrypt($key);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ob_start(array($this,'getBuffer'));<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; public static function &amp;getInstance($key=NULL)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; if(!self::$_me &amp;&amp; $key)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self::$_me = new EncryptedComms($key);<br>&nbsp; &nbsp; &nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return self::$_me;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; public function __destruct()<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; ob_end_flush();<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; public function getBuffer($str)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; return $this-&gt;C-&gt;encrypt($str);<br>&nbsp; &nbsp; }<br><br>}<br><br>In this example, I tried to register other objects to always be destroyed just before this object.&nbsp; Like this:<br><br>class A<br>{<br><br>public function __construct()<br>{<br>&nbsp; &nbsp;&nbsp; EncryptedComms::destroyAfter($this);<br>}<br>}<br><br>One would think that the references to the objects contained in the singleton would be destroyed first, but this is not the case.&nbsp; In fact, this won't work even if you reverse the paradigm and store a reference to EncryptedComms in every object you'd like to be destroyed before it.<br><br>In short, when a script die()s, there doesn't seem to be any way to predict the order in which the destructors will fire.</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->

  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from www.php.net/manual/en/language.oop5.decon.php by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 11 Sep 2021 02:31:44 GMT -->

</body></html>