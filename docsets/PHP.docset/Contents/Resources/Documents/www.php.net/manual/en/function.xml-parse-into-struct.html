<html><!-- Mirrored from www.php.net/manual/en/function.xml-parse-into-struct.php by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 11 Sep 2021 06:32:50 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>xml_parse_into_struct</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.xml-parse-into-struct.html">
 <link rel="shorturl" href="https://www.php.net/xml-parse-into-struct">
 <link rel="alternate" href="https://www.php.net/xml-parse-into-struct" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.xml.html">
 <link rel="prev" href="function.xml-get-error-code.html">
 <link rel="next" href="function.xml-parse.html">

 <link rel="alternate" href="function.xml-parse-into-struct.html" hreflang="en">
 <link rel="alternate" href="https://www.php.net/manual/pt_BR/function.xml-parse-into-struct.php" hreflang="pt_BR">
 <link rel="alternate" href="https://www.php.net/manual/zh/function.xml-parse-into-struct.php" hreflang="zh">
 <link rel="alternate" href="https://www.php.net/manual/fr/function.xml-parse-into-struct.php" hreflang="fr">
 <link rel="alternate" href="https://www.php.net/manual/de/function.xml-parse-into-struct.php" hreflang="de">
 <link rel="alternate" href="https://www.php.net/manual/ja/function.xml-parse-into-struct.php" hreflang="ja">
 <link rel="alternate" href="https://www.php.net/manual/ro/function.xml-parse-into-struct.php" hreflang="ro">
 <link rel="alternate" href="https://www.php.net/manual/ru/function.xml-parse-into-struct.php" hreflang="ru">
 <link rel="alternate" href="https://www.php.net/manual/es/function.xml-parse-into-struct.php" hreflang="es">
 <link rel="alternate" href="https://www.php.net/manual/tr/function.xml-parse-into-struct.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached0aba.css?t=1539771603&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached2ecf.css?t=1539765004&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedba57.css?t=1606338002&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached3afa.css?t=1627831203&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="https://www.php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script>
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="https://www.php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script src="https://www.php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>


</head>
<body class="docs " style="">


<div class="headsup"><a href="https://www.php.net/conferences/index.php#id2021-09-08-1">Longhorn PHP 2021</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.errors.html">Errors</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.attributes.html">Attributes</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.sessions.html">Session Security</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
	<dd><a href="refs.ui.html">GUI Extensions</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
    <div id="breadcrumbs-inner">
          
              
          <ul>
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.xml.html">XML Manipulation</a></li>      <li><a href="book.xml.html">XML Parser</a></li>      <li><a href="ref.xml.html">XML Parser Functions</a></li>      </ul>
    </div>
  </div>




<div id="layout" class="clearfix">
  <section id="layout-content">
  <div id="function.xml-parse-into-struct" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">xml_parse_into_struct</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">xml_parse_into_struct</span> â€” <span class="dc-title">Parse XML data into an array structure</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.xml-parse-into-struct-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>xml_parse_into_struct</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type"><a href="class.xmlparser.html" class="type XMLParser">XMLParser</a></span> <code class="parameter">$parser</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$data</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">array</span> <code class="parameter reference">&amp;$values</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">array</span> <code class="parameter reference">&amp;$index</code><span class="initializer"> = <strong><code>null</code></strong></span></span><br>): <span class="type">int</span></div>

  <p class="para rdfs-comment">
   This function parses an XML string into 2 parallel array structures, one
   (<code class="parameter">index</code>) containing pointers to the location of the
   appropriate values in the <code class="parameter">values</code> array. These last
   two parameters must be passed by reference.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.xml-parse-into-struct-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>
    
     <dt>
<code class="parameter">parser</code></dt>

     <dd>

      <p class="para">
       A reference to the XML parser.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">data</code></dt>

     <dd>

      <p class="para">
       A string containing the XML data.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">values</code></dt>

     <dd>

      <p class="para">
       An array containing the values of the XML data
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">index</code></dt>

     <dd>

      <p class="para">
       An array containing pointers to the location of the appropriate values in the $values.
      </p>
     </dd>

    
   </dl>

  <p></p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.xml-parse-into-struct-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   <span class="function"><strong>xml_parse_into_struct()</strong></span> returns 0 for failure and 1 for
   success. This is not the same as <strong><code>false</code></strong> and <strong><code>true</code></strong>, be careful with
   operators such as ===.
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.xml-parse-into-struct-changelog">
  <h3 class="title">Changelog</h3>
  <table class="doctable informaltable">
   
    <thead>
     <tr>
      <th>Version</th>
      <th>Description</th>
     </tr>

    </thead>

    <tbody class="tbody">
     <tr>
 <td>8.0.0</td>
 <td>
  <code class="parameter">parser</code> expects an <span class="classname"><a href="class.xmlparser.html" class="classname">XMLParser</a></span>
  instance now; previously, a <span class="type">resource</span> was expected.
 </td>
</tr>

    </tbody>
   
  </table>

 </div>


 <div class="refsect1 examples" id="refsect1-function.xml-parse-into-struct-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   Below is an example that illustrates the internal structure of
   the arrays being generated by the function. We use a simple
   <code class="literal">note</code> tag embedded inside a
   <code class="literal">para</code> tag, and then we parse this and print out
   the structures generated:
   </p><div class="example" id="example-5366">
    <p><strong>Example #1 <span class="function"><strong>xml_parse_into_struct()</strong></span> example</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br>$simple&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"&lt;para&gt;&lt;note&gt;simple&nbsp;note&lt;/note&gt;&lt;/para&gt;"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$p&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">xml_parser_create</span><span style="color: #007700">();<br></span><span style="color: #0000BB">xml_parse_into_struct</span><span style="color: #007700">(</span><span style="color: #0000BB">$p</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$simple</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$vals</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$index</span><span style="color: #007700">);<br></span><span style="color: #0000BB">xml_parser_free</span><span style="color: #007700">(</span><span style="color: #0000BB">$p</span><span style="color: #007700">);<br>echo&nbsp;</span><span style="color: #DD0000">"Index&nbsp;array\n"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">$index</span><span style="color: #007700">);<br>echo&nbsp;</span><span style="color: #DD0000">"\nVals&nbsp;array\n"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">$vals</span><span style="color: #007700">);<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>
     When we run that code, the output will be:
    </p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>Index array
Array
(
    [PARA] =&gt; Array
        (
            [0] =&gt; 0
            [1] =&gt; 2
        )

    [NOTE] =&gt; Array
        (
            [0] =&gt; 1
        )

)

Vals array
Array
(
    [0] =&gt; Array
        (
            [tag] =&gt; PARA
            [type] =&gt; open
            [level] =&gt; 1
        )

    [1] =&gt; Array
        (
            [tag] =&gt; NOTE
            [type] =&gt; complete
            [level] =&gt; 2
            [value] =&gt; simple note
        )

    [2] =&gt; Array
        (
            [tag] =&gt; PARA
            [type] =&gt; close
            [level] =&gt; 1
        )

)
</pre></div>
    </div>
   </div>
  <p></p>
  <p class="para">
   Event-driven parsing (based on the expat library) can get
   complicated when you have an XML document that is complex.
   This function does not produce a DOM style object, but it
   generates structures amenable of being traversed in a tree
   fashion. Thus, we can create objects representing the data
   in the XML file easily. Let's consider the following XML file
   representing a small database of aminoacids information:
   </p><div class="example" id="example-5367">
    <p><strong>Example #2 moldb.xml - small database of molecular information</strong></p>
    <div class="example-contents">
<div class="xmlcode"><pre class="xmlcode">&lt;?xml version="1.0"?&gt;
&lt;moldb&gt;

  &lt;molecule&gt;
      &lt;name&gt;Alanine&lt;/name&gt;
      &lt;symbol&gt;ala&lt;/symbol&gt;
      &lt;code&gt;A&lt;/code&gt;
      &lt;type&gt;hydrophobic&lt;/type&gt;
  &lt;/molecule&gt;

  &lt;molecule&gt;
      &lt;name&gt;Lysine&lt;/name&gt;
      &lt;symbol&gt;lys&lt;/symbol&gt;
      &lt;code&gt;K&lt;/code&gt;
      &lt;type&gt;charged&lt;/type&gt;
  &lt;/molecule&gt;

&lt;/moldb&gt;</pre>
</div>
    </div>

   </div>
   And some code to parse the document and generate the appropriate
   objects:
   <div class="example" id="example-5368">
    <p><strong>Example #3 
     parsemoldb.php - parses moldb.xml into an array of
     molecular objects
    </strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">AminoAcid&nbsp;</span><span style="color: #007700">{<br>&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;</span><span style="color: #0000BB">$name</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;aa&nbsp;name<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">var&nbsp;</span><span style="color: #0000BB">$symbol</span><span style="color: #007700">;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;three&nbsp;letter&nbsp;symbol<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">var&nbsp;</span><span style="color: #0000BB">$code</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;one&nbsp;letter&nbsp;code<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">var&nbsp;</span><span style="color: #0000BB">$type</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;hydrophobic,&nbsp;charged&nbsp;or&nbsp;neutral<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">__construct&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">$aa</span><span style="color: #007700">)&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$aa&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$k</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$v</span><span style="color: #007700">)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">$k&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$aa</span><span style="color: #007700">[</span><span style="color: #0000BB">$k</span><span style="color: #007700">];<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br><br>function&nbsp;</span><span style="color: #0000BB">readDatabase</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename</span><span style="color: #007700">)&nbsp;<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;read&nbsp;the&nbsp;XML&nbsp;database&nbsp;of&nbsp;aminoacids<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">file_get_contents</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$parser&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">xml_parser_create</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_parser_set_option</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">XML_OPTION_CASE_FOLDING</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_parser_set_option</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">XML_OPTION_SKIP_WHITE</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_parse_into_struct</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$values</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$tags</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_parser_free</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;loop&nbsp;through&nbsp;the&nbsp;structures<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">foreach&nbsp;(</span><span style="color: #0000BB">$tags&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$val</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$key&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #DD0000">"molecule"</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$molranges&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$val</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;each&nbsp;contiguous&nbsp;pair&nbsp;of&nbsp;array&nbsp;entries&nbsp;are&nbsp;the&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;lower&nbsp;and&nbsp;upper&nbsp;range&nbsp;for&nbsp;each&nbsp;molecule&nbsp;definition<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">for&nbsp;(</span><span style="color: #0000BB">$i</span><span style="color: #007700">=</span><span style="color: #0000BB">0</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">&lt;&nbsp;</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$molranges</span><span style="color: #007700">);&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">+=</span><span style="color: #0000BB">2</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$offset&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$molranges</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">]&nbsp;+&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$len&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$molranges</span><span style="color: #007700">[</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">+&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">]&nbsp;-&nbsp;</span><span style="color: #0000BB">$offset</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$tdb</span><span style="color: #007700">[]&nbsp;=&nbsp;</span><span style="color: #0000BB">parseMol</span><span style="color: #007700">(</span><span style="color: #0000BB">array_slice</span><span style="color: #007700">(</span><span style="color: #0000BB">$values</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$offset</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$len</span><span style="color: #007700">));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$tdb</span><span style="color: #007700">;<br>}<br><br>function&nbsp;</span><span style="color: #0000BB">parseMol</span><span style="color: #007700">(</span><span style="color: #0000BB">$mvalues</span><span style="color: #007700">)&nbsp;<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(</span><span style="color: #0000BB">$i</span><span style="color: #007700">=</span><span style="color: #0000BB">0</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">&lt;&nbsp;</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$mvalues</span><span style="color: #007700">);&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">++)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$mol</span><span style="color: #007700">[</span><span style="color: #0000BB">$mvalues</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">][</span><span style="color: #DD0000">"tag"</span><span style="color: #007700">]]&nbsp;=&nbsp;</span><span style="color: #0000BB">$mvalues</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">][</span><span style="color: #DD0000">"value"</span><span style="color: #007700">];<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;</span><span style="color: #0000BB">AminoAcid</span><span style="color: #007700">(</span><span style="color: #0000BB">$mol</span><span style="color: #007700">);<br>}<br><br></span><span style="color: #0000BB">$db&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">readDatabase</span><span style="color: #007700">(</span><span style="color: #DD0000">"moldb.xml"</span><span style="color: #007700">);<br>echo&nbsp;</span><span style="color: #DD0000">"**&nbsp;Database&nbsp;of&nbsp;AminoAcid&nbsp;objects:\n"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">$db</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
   After executing <var class="filename">parsemoldb.php</var>, the variable
   <var class="varname">$db</var> contains an array of
   <span class="classname"><strong class="classname">AminoAcid</strong></span> objects, and the output of the
   script confirms that:
   <div class="informalexample">
    <div class="example-contents screen">
<div class="cdata"><pre>** Database of AminoAcid objects:
Array
(
    [0] =&gt; aminoacid Object
        (
            [name] =&gt; Alanine
            [symbol] =&gt; ala
            [code] =&gt; A
            [type] =&gt; hydrophobic
        )

    [1] =&gt; aminoacid Object
        (
            [name] =&gt; Lysine
            [symbol] =&gt; lys
            [code] =&gt; K
            [type] =&gt; charged
        )

)
</pre></div>
    </div>
   </div>
  <p></p>
 </div>


</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="66487">  
  <a class="name">
  <strong class="user"><em>efredricksen at gmail dot com</em></strong></a><div class="date" title="2006-05-24 12:55"><strong>15 years ago</strong></div>
  <div class="text" id="Hcom66487">
<div class="phpcode"><code><span class="html">
Perhaps the one true parser:? I modified xademax's fine code to tidy it up, codewise and style wise, rationalize some minor crazyness, and make names fit nomenclature from the XML spec. (There are no uses of eval, and shame on you people who do.)<br><br><span class="default">&lt;?php <br></span><span class="keyword">class </span><span class="default">XmlElement </span><span class="keyword">{<br>&nbsp; var </span><span class="default">$name</span><span class="keyword">;<br>&nbsp; var </span><span class="default">$attributes</span><span class="keyword">;<br>&nbsp; var </span><span class="default">$content</span><span class="keyword">;<br>&nbsp; var </span><span class="default">$children</span><span class="keyword">;<br>};<br><br>function </span><span class="default">xml_to_object</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">) {<br>&nbsp; </span><span class="default">$parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br>&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br>&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">XML_OPTION_SKIP_WHITE</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br>&nbsp; </span><span class="default">xml_parse_into_struct</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$xml</span><span class="keyword">, </span><span class="default">$tags</span><span class="keyword">);<br>&nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">);<br><br>&nbsp; </span><span class="default">$elements </span><span class="keyword">= array();&nbsp; </span><span class="comment">// the currently filling [child] XmlElement array<br>&nbsp; </span><span class="default">$stack </span><span class="keyword">= array();<br>&nbsp; foreach (</span><span class="default">$tags </span><span class="keyword">as </span><span class="default">$tag</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="default">$index </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$elements</span><span class="keyword">);<br>&nbsp; &nbsp; if (</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"complete" </span><span class="keyword">|| </span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"open"</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$elements</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">] = new </span><span class="default">XmlElement</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$elements</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">]-&gt;</span><span class="default">name </span><span class="keyword">= </span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$elements</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">]-&gt;</span><span class="default">attributes </span><span class="keyword">= </span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'attributes'</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$elements</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">]-&gt;</span><span class="default">content </span><span class="keyword">= </span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; if (</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"open"</span><span class="keyword">) {&nbsp; </span><span class="comment">// push<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$elements</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">]-&gt;</span><span class="default">children </span><span class="keyword">= array();<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$stack</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">)] = &amp;</span><span class="default">$elements</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$elements </span><span class="keyword">= &amp;</span><span class="default">$elements</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">]-&gt;</span><span class="default">children</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; if (</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"close"</span><span class="keyword">) {&nbsp; </span><span class="comment">// pop<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$elements </span><span class="keyword">= &amp;</span><span class="default">$stack</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; unset(</span><span class="default">$stack</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">]);<br>&nbsp; &nbsp; }<br>&nbsp; }<br>&nbsp; return </span><span class="default">$elements</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];&nbsp; </span><span class="comment">// the single top-level element<br></span><span class="keyword">}<br><br></span><span class="comment">// For example:<br></span><span class="default">$xml </span><span class="keyword">= </span><span class="string">'<br>&lt;parser&gt;<br>&nbsp;&nbsp; &lt;name language="en-us"&gt;Fred Parser&lt;/name&gt;<br>&nbsp;&nbsp; &lt;category&gt;<br>&nbsp; &nbsp; &nbsp;&nbsp; &lt;name&gt;Nomenclature&lt;/name&gt;<br>&nbsp; &nbsp; &nbsp;&nbsp; &lt;note&gt;Noteworthy&lt;/note&gt;<br>&nbsp;&nbsp; &lt;/category&gt;<br>&lt;/parser&gt;<br>'</span><span class="keyword">;<br></span><span class="default">print_r</span><span class="keyword">(</span><span class="default">xml_to_object</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">));<br></span><span class="default">?&gt;<br></span><br>will give:<br><br>xmlelement Object<br>(<br>&nbsp; &nbsp; [name] =&gt; parser<br>&nbsp; &nbsp; [attributes] =&gt; <br>&nbsp; &nbsp; [content] =&gt; <br>&nbsp; &nbsp; [children] =&gt; Array<br>&nbsp; &nbsp; &nbsp; &nbsp; (<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [0] =&gt; xmlelement Object<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [name] =&gt; name<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [attributes] =&gt; Array<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [language] =&gt; en-us<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [content] =&gt; Fred Parser<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [children] =&gt; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [1] =&gt; xmlelement Object<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [name] =&gt; category<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [attributes] =&gt; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [content] =&gt; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [children] =&gt; Array<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [0] =&gt; xmlelement Object<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [name] =&gt; name<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [attributes] =&gt; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [content] =&gt; Nomenclature<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [children] =&gt; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [1] =&gt; xmlelement Object<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [name] =&gt; note<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [attributes] =&gt; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [content] =&gt; Noteworthy<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [children] =&gt; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br><br>&nbsp; &nbsp; &nbsp; &nbsp; )<br><br>)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="79922">  
  <a class="name">
  <strong class="user"><em>beaudurrant at gmail dot com</em></strong></a><div class="date" title="2007-12-19 11:23"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom79922">
<div class="phpcode"><code><span class="html">
This is extending what Alf Marius Foss Olsen had posted above.<br><br>It takes into account array keys with the same name and uses an increment for them instead of overwriting the keys.<br><br>I am using it for SOAP requests (20K - 150K) and it parses very fast compared to PEAR.<br><br>&lt;?<br><br>class XMLParser&nbsp; {<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; // raw xml<br>&nbsp; &nbsp; private $rawXML;<br>&nbsp; &nbsp; // xml parser<br>&nbsp; &nbsp; private $parser = null;<br>&nbsp; &nbsp; // array returned by the xml parser<br>&nbsp; &nbsp; private $valueArray = array();<br>&nbsp; &nbsp; private $keyArray = array();<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; // arrays for dealing with duplicate keys<br>&nbsp; &nbsp; private $duplicateKeys = array();<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; // return data<br>&nbsp; &nbsp; private $output = array();<br>&nbsp; &nbsp; private $status;<br><br>&nbsp; &nbsp; public function XMLParser($xml){<br>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;rawXML = $xml;<br>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;parser = xml_parser_create();<br>&nbsp; &nbsp; &nbsp; &nbsp; return $this-&gt;parse();<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; private function parse(){<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; $parser = $this-&gt;parser;<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; xml_parser_set_option($parser, XML_OPTION_CASE_FOLDING, 0); // Dont mess with my cAsE sEtTings<br>&nbsp; &nbsp; &nbsp; &nbsp; xml_parser_set_option($parser, XML_OPTION_SKIP_WHITE, 1);&nbsp; &nbsp;&nbsp; // Dont bother with empty info<br>&nbsp; &nbsp; &nbsp; &nbsp; if(!xml_parse_into_struct($parser, $this-&gt;rawXML, $this-&gt;valueArray, $this-&gt;keyArray)){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;status = 'error: '.xml_error_string(xml_get_error_code($parser)).' at line '.xml_get_current_line_number($parser);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return false;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; xml_parser_free($parser);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;findDuplicateKeys();<br><br>&nbsp; &nbsp; &nbsp; &nbsp; // tmp array used for stacking<br>&nbsp; &nbsp; &nbsp; &nbsp; $stack = array();&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; $increment = 0;<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; foreach($this-&gt;valueArray as $val) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if($val['type'] == "open") {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //if array key is duplicate then send in increment<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(array_key_exists($val['tag'], $this-&gt;duplicateKeys)){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; array_push($stack, $this-&gt;duplicateKeys[$val['tag']]);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;duplicateKeys[$val['tag']]++;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else{<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // else send in tag<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; array_push($stack, $val['tag']);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } elseif($val['type'] == "close") {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; array_pop($stack);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // reset the increment if they tag does not exists in the stack<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(array_key_exists($val['tag'], $stack)){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;duplicateKeys[$val['tag']] = 0;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } elseif($val['type'] == "complete") {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //if array key is duplicate then send in increment<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(array_key_exists($val['tag'], $this-&gt;duplicateKeys)){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; array_push($stack, $this-&gt;duplicateKeys[$val['tag']]);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;duplicateKeys[$val['tag']]++;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else{&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // else send in tag<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; array_push($stack,&nbsp; $val['tag']);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;setArrayValue($this-&gt;output, $stack, $val['value']);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; array_pop($stack);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $increment++;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;status = 'success: xml was parsed';<br>&nbsp; &nbsp; &nbsp; &nbsp; return true;<br><br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; private function findDuplicateKeys(){<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; for($i=0;$i &lt; count($this-&gt;valueArray); $i++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // duplicate keys are when two complete tags are side by side<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if($this-&gt;valueArray[$i]['type'] == "complete"){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if( $i+1 &lt; count($this-&gt;valueArray) ){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if($this-&gt;valueArray[$i+1]['tag'] == $this-&gt;valueArray[$i]['tag'] &amp;&amp; $this-&gt;valueArray[$i+1]['type'] == "complete"){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;duplicateKeys[$this-&gt;valueArray[$i]['tag']] = 0;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // also when a close tag is before an open tag and the tags are the same<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if($this-&gt;valueArray[$i]['type'] == "close"){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if( $i+1 &lt; count($this-&gt;valueArray) ){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(&nbsp; &nbsp; $this-&gt;valueArray[$i+1]['type'] == "open" &amp;&amp; $this-&gt;valueArray[$i+1]['tag'] == $this-&gt;valueArray[$i]['tag'])<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;duplicateKeys[$this-&gt;valueArray[$i]['tag']] = 0; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; private function setArrayValue(&amp;$array, $stack, $value){<br>&nbsp; &nbsp; &nbsp; &nbsp; if ($stack) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $key = array_shift($stack);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;setArrayValue($array[$key], $stack, $value);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return $array;<br>&nbsp; &nbsp; &nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $array = $value;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; public function getOutput(){<br>&nbsp; &nbsp; &nbsp; &nbsp; return $this-&gt;output;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; public function getStatus(){<br>&nbsp; &nbsp; &nbsp; &nbsp; return $this-&gt;status;&nbsp; &nbsp; <br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp;&nbsp; <br>}<br><br>?&gt;<br><br>Usage:<br><br>$p = new XMLParser($xml);<br>$p-&gt;getOutput();</span>
</code></div>
  </div>
 </div>
  <div class="note" id="77768">  
  <a class="name">
  <strong class="user"><em>Alf Marius Foss Olsen</em></strong></a><div class="date" title="2007-09-12 06:46"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom77768">
<div class="phpcode"><code><span class="html">
<span class="default">&lt;?php<br></span><span class="comment">/*<br>&nbsp; An easy lightweight (Array -&gt;) XML -&gt; Array algorithm..<br><br>&nbsp; Typical case: You have an array you want to export to an external server,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; so you make XML out of it, exports it, and "on the other side"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; make it into an array again. These two functions will take care<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; of that last part, ie XML -&gt; Array<br>&nbsp; <br>&nbsp; NOTE! The function XMLToArray assumes that the XML _dont_ have nodes on the<br>&nbsp; &nbsp; &nbsp; &nbsp; same level with the same name, then it just wont work. This is not a<br>&nbsp; &nbsp; &nbsp; &nbsp; problem, as this case deals with Array -&gt; XML -&gt; Array, and an array<br>&nbsp; &nbsp; &nbsp; &nbsp; cant have to identical indexes/keys.<br>*/<br><br></span><span class="keyword">function </span><span class="default">XMLToArray</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">) {<br>&nbsp; </span><span class="default">$parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">(</span><span class="string">'ISO-8859-1'</span><span class="keyword">); </span><span class="comment">// For Latin-1 charset<br>&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">); </span><span class="comment">// Dont mess with my cAsE sEtTings<br>&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">XML_OPTION_SKIP_WHITE</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">); </span><span class="comment">// Dont bother with empty info<br>&nbsp; </span><span class="default">xml_parse_into_struct</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$xml</span><span class="keyword">, </span><span class="default">$values</span><span class="keyword">);<br>&nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">);<br>&nbsp; <br>&nbsp; </span><span class="default">$return </span><span class="keyword">= array(); </span><span class="comment">// The returned array<br>&nbsp; </span><span class="default">$stack </span><span class="keyword">= array(); </span><span class="comment">// tmp array used for stacking<br>&nbsp; </span><span class="keyword">foreach(</span><span class="default">$values </span><span class="keyword">as </span><span class="default">$val</span><span class="keyword">) {<br>&nbsp; &nbsp; if(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"open"</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]);<br>&nbsp; &nbsp; } elseif(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"close"</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">);<br>&nbsp; &nbsp; } elseif(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"complete"</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; </span><span class="default">setArrayValue</span><span class="keyword">(</span><span class="default">$return</span><span class="keyword">, </span><span class="default">$stack</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">);<br>&nbsp; &nbsp; }</span><span class="comment">//if-elseif<br>&nbsp; </span><span class="keyword">}</span><span class="comment">//foreach<br>&nbsp; </span><span class="keyword">return </span><span class="default">$return</span><span class="keyword">;<br>}</span><span class="comment">//function XMLToArray<br>&nbsp; <br></span><span class="keyword">function </span><span class="default">setArrayValue</span><span class="keyword">(&amp;</span><span class="default">$array</span><span class="keyword">, </span><span class="default">$stack</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">) {<br>&nbsp; if (</span><span class="default">$stack</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="default">$key </span><span class="keyword">= </span><span class="default">array_shift</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">setArrayValue</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">], </span><span class="default">$stack</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">);<br>&nbsp; &nbsp; return </span><span class="default">$array</span><span class="keyword">;<br>&nbsp; } else {<br>&nbsp; &nbsp; </span><span class="default">$array </span><span class="keyword">= </span><span class="default">$value</span><span class="keyword">;<br>&nbsp; }</span><span class="comment">//if-else<br></span><span class="keyword">}</span><span class="comment">//function setArrayValue<br>&nbsp; <br>// USAGE:<br></span><span class="default">$xml </span><span class="keyword">= &lt;&lt;&lt;QQQ<br></span><span class="string">&lt;?xml version="1.0"?&gt;<br>&lt;root&gt;<br>&nbsp; &lt;node1&gt;Some text&lt;/node1&gt;<br>&nbsp; &lt;node2a&gt;<br>&nbsp; &nbsp; &lt;node2b&gt;<br>&nbsp; &nbsp; &nbsp; &lt;node2c&gt;Some text&lt;/node2c&gt;<br>&nbsp; &nbsp; &lt;/node2b&gt;<br>&nbsp; &lt;/node2a&gt;<br>&lt;/root&gt;\n<br></span><span class="keyword">QQQ;<br></span><span class="default">$array </span><span class="keyword">= </span><span class="default">XMLToArray</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">);<br>print </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">;<br></span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">);<br>print </span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">;<br></span><span class="comment">//&nbsp; Output:<br>//<br>//&nbsp; Array<br>//&nbsp; (<br>//&nbsp; &nbsp; &nbsp; [root] =&gt; Array<br>//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<br>//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [node1] =&gt; Some text<br>//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [node2a] =&gt; Array<br>//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<br>//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [node2b] =&gt; Array<br>//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<br>//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [node2c] =&gt; Some text<br>//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br>//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br>//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br>//&nbsp; )<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="81704">  
  <a class="name">
  <strong class="user"><em>mathiasrav at gmail dot com</em></strong></a><div class="date" title="2008-03-10 08:42"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom81704">
<div class="phpcode"><code><span class="html">
In response to Anonymous' post at 26-Feb-2008 11:50:<br><br>Saying that you "don't understand everything" isn't going to get you very popular - you should understand the code you use.<br>foreach isn't *slow* in PHP, it is actually faster than the equivalent for-construct (which, in many cases, isn't available).<br><br>The reason your script is slow is simply your use of xml_parse_into_struct - it reads the whole XML-string and doesn't return until it has parsed and validated it all. If you're looking for efficiency, you'll have to use the more low-level xml_parser_create, xml_set_*_handler functions. Then make sure you don't keep everything in a huge array before outputting it (at least don't if you're going for efficiency).</span>
</code></div>
  </div>
 </div>
  <div class="note" id="83881">  
  <a class="name">
  <strong class="user"><em>jemptymethod at gmail dot com</em></strong></a><div class="date" title="2008-06-16 01:39"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom83881">
<div class="phpcode"><code><span class="html">
@wickedfather, re: beaudurrant....I just cannot concur that the latter's class is "great"....First of all, it doesn't handle attributes.&nbsp; Second of all, as my code below demonstrates, there is no need waste processing by determining duplicates within their own loop.&nbsp; Thirdly, when there are duplicates, it collapses the layer in the array above the duplicates.<br><br>Here is some much more consise code, though not (yet) object oriented, and also not yet handling attributes; it maintains a stack for each level:<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">xml_parse_into_assoc</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) {<br>&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">implode</span><span class="keyword">(</span><span class="string">""</span><span class="keyword">, </span><span class="default">file</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">));<br>&nbsp; </span><span class="default">$p </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br>&nbsp; <br>&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br>&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">, </span><span class="default">XML_OPTION_SKIP_WHITE</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br>&nbsp; <br>&nbsp; </span><span class="default">xml_parse_into_struct</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">$vals</span><span class="keyword">, </span><span class="default">$index</span><span class="keyword">);<br>&nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">);<br><br>&nbsp; </span><span class="default">$levels </span><span class="keyword">= array(</span><span class="default">null</span><span class="keyword">);<br>&nbsp; <br>&nbsp; foreach (</span><span class="default">$vals </span><span class="keyword">as </span><span class="default">$val</span><span class="keyword">) {<br>&nbsp; &nbsp; if (</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">'open' </span><span class="keyword">|| </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">'complete'</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; if (!</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">], </span><span class="default">$levels</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$levels</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">]] = array();<br>&nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="default">$prevLevel </span><span class="keyword">=&amp; </span><span class="default">$levels</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">] - </span><span class="default">1</span><span class="keyword">];<br>&nbsp; &nbsp; </span><span class="default">$parent </span><span class="keyword">= </span><span class="default">$prevLevel</span><span class="keyword">[</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$prevLevel</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">]; <br>&nbsp; &nbsp; <br>&nbsp; &nbsp; if (</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">'open'</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">] = array();<br>&nbsp; &nbsp; &nbsp; </span><span class="default">array_push</span><span class="keyword">(&amp;</span><span class="default">$levels</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">]], </span><span class="default">$val</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; continue;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; else if (</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">'complete'</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$parent</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">][</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]] = </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">];<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; else if (</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">'close'</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$pop </span><span class="keyword">= </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$levels</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">]]);<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$tag </span><span class="keyword">= </span><span class="default">$pop</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; if (</span><span class="default">$parent</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; if (!</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="default">$tag</span><span class="keyword">, </span><span class="default">$parent</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">])) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$parent</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">][</span><span class="default">$tag</span><span class="keyword">] = </span><span class="default">$pop</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; else if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$parent</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">][</span><span class="default">$tag</span><span class="keyword">])) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$parent</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">][</span><span class="default">$tag</span><span class="keyword">][] = </span><span class="default">$pop</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">]; <br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; else {<br>&nbsp; &nbsp; &nbsp; &nbsp; return(array(</span><span class="default">$pop</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">] =&gt; </span><span class="default">$pop</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">]));<br>&nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="default">$prevLevel</span><span class="keyword">[</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$prevLevel</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">] = </span><span class="default">$parent</span><span class="keyword">;<br>&nbsp; }<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="73044">  
  <a class="name">
  <strong class="user"><em>siteres at gmail dot com</em></strong></a><div class="date" title="2007-02-07 01:38"><strong>14 years ago</strong></div>
  <div class="text" id="Hcom73044">
<div class="phpcode"><code><span class="html">
PHP: XML to Array and backwards:<br><br>Here the XML with PHP solution: XML-&gt;Array and Array-&gt;XML.<br>Work with it as with usual array.<br><br>Sources are here:<br><a rel="nofollow" target="_blank">http://mysrc.blogspot.com/2007/02/php-xml-to-array-and-backwards.html</a><br>(leave me comments:)<br><br>Example #1 (1.xml):<br><br>&lt;ddd&gt;<br> &lt;onemore dd="55"&gt;<br>&nbsp; &lt;tt&gt;333&lt;/tt&gt;<br>&nbsp; &lt;tt ss="s1"&gt;555&lt;/tt&gt;<br>&nbsp; &lt;tt&gt;777&lt;/tt&gt;<br> &lt;/onemore&gt;<br> &lt;two&gt;sdf rr&lt;/two&gt;<br>&lt;/ddd&gt;<br><br>The code:<br><br>$xml=xml2ary(file_get_contents('1.xml'));<br>print_r($xml); <br><br>Here is the Array result:<br><br>Array<br>(<br>&nbsp;&nbsp; [ddd] =&gt; Array (<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [_c] =&gt; Array (<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [_p] =&gt; Array *RECURSION*<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [onemore] =&gt; Array (<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [_a] =&gt; Array (<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [dd] =&gt; 55<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [_c] =&gt; Array (<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [_p] =&gt; Array&nbsp; *RECURSION*<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [tt] =&gt; Array (<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; Array (<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [_v] =&gt; 333<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; Array (<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [_a] =&gt; Array (<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [ss] =&gt; s1<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [_v] =&gt; 555<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [2] =&gt; Array (<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [_v] =&gt; 777<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [two] =&gt; Array (<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [_v] =&gt; sdf rr<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br>&nbsp; &nbsp; &nbsp;&nbsp; )<br>)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="85948">  
  <a class="name">
  <strong class="user"><em>dale at ucsc dot edu</em></strong></a><div class="date" title="2008-09-25 04:16"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom85948">
<div class="phpcode"><code><span class="html">
here you can [re]assemble xml from a xml_parse_into_struct generated array: ie array2xml
<br>
<br><span class="default">&lt;?php
<br>$xml_parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">( </span><span class="string">'UTF-8' </span><span class="keyword">); </span><span class="comment">// UTF-8 or ISO-8859-1
<br></span><span class="default">xml_parser_set_option</span><span class="keyword">( </span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">0 </span><span class="keyword">);
<br></span><span class="default">xml_parser_set_option</span><span class="keyword">( </span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="default">XML_OPTION_SKIP_WHITE</span><span class="keyword">, </span><span class="default">1 </span><span class="keyword">);
<br></span><span class="default">xml_parse_into_struct</span><span class="keyword">( </span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="default">$my_text_xml</span><span class="keyword">, </span><span class="default">$aryXML </span><span class="keyword">);
<br></span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">);
<br>
<br></span><span class="comment">//now use aryXML array to xml string:
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$o</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; foreach( </span><span class="default">$aryXML </span><span class="keyword">as </span><span class="default">$tag </span><span class="keyword">){
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//tab space:
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">];</span><span class="default">$i</span><span class="keyword">++)
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$o</span><span class="keyword">.=</span><span class="string">"\t"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">]!=</span><span class="string">'close'</span><span class="keyword">){
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">]!=</span><span class="string">'cdata'</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$o</span><span class="keyword">.=</span><span class="string">'&lt;'</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">];
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(isset(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'attributes'</span><span class="keyword">])){&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'attributes'</span><span class="keyword">] as </span><span class="default">$attr</span><span class="keyword">=&gt;</span><span class="default">$aval</span><span class="keyword">){
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$o</span><span class="keyword">.=</span><span class="string">' '</span><span class="keyword">.</span><span class="default">$attr</span><span class="keyword">.</span><span class="string">'="'</span><span class="keyword">.</span><span class="default">$aval</span><span class="keyword">.</span><span class="string">'"'</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">]!=</span><span class="string">'cdata'</span><span class="keyword">){
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$o</span><span class="keyword">.=(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">]==</span><span class="string">'complete'</span><span class="keyword">)?</span><span class="string">'/&gt;'</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">:</span><span class="string">'&gt;'</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$o</span><span class="keyword">.=(isset(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">]))?</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">]:</span><span class="string">''</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }else{
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$o</span><span class="keyword">.=</span><span class="string">'&lt;/'</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">].</span><span class="string">'&gt;'</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="84261">  
  <a class="name">
  <strong class="user"><em>wickedfather at hotmail dot com</em></strong></a><div class="date" title="2008-07-06 12:33"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom84261">
<div class="phpcode"><code><span class="html">
Had a comment up that was removed saying I'd found drawbacks, but here's a class what I wrote which works fine for me.&nbsp; Comments removed due to post restrictions.&nbsp; Pass the xml into the parse method or in the constructor.&nbsp; Php4 and 5 safe.<br><br>class XMLThing<br>{<br>&nbsp; &nbsp; var $rawXML;<br>&nbsp; &nbsp; var $valueArray = array();<br>&nbsp; &nbsp; var $keyArray = array();<br>&nbsp; &nbsp; var $parsed = array();<br>&nbsp; &nbsp; var $index = 0;<br>&nbsp; &nbsp; var $attribKey = 'attributes';<br>&nbsp; &nbsp; var $valueKey = 'value';<br>&nbsp; &nbsp; var $cdataKey = 'cdata';<br>&nbsp; &nbsp; var $isError = false;<br>&nbsp; &nbsp; var $error = '';<br><br>&nbsp; &nbsp; function XMLThing($xml = NULL)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;rawXML = $xml;<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; function parse($xml = NULL)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; if (!is_null($xml))<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;rawXML = $xml;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;isError = false;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; if (!$this-&gt;parse_init())<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return false;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;index = 0;<br>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;parsed = $this-&gt;parse_recurse();<br>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;status = 'parsing complete';<br><br>&nbsp; &nbsp; &nbsp; &nbsp; return $this-&gt;parsed;<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; function parse_recurse()<br>&nbsp; &nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; $found = array();<br>&nbsp; &nbsp; &nbsp; &nbsp; $tagCount = array();<br><br>&nbsp; &nbsp; &nbsp; &nbsp; while (isset($this-&gt;valueArray[$this-&gt;index]))<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $tag = $this-&gt;valueArray[$this-&gt;index];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;index++;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($tag['type'] == 'close')<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return $found;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($tag['type'] == 'cdata')<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $tag['tag'] = $this-&gt;cdataKey;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $tag['type'] = 'complete';<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $tagName = $tag['tag'];<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (isset($tagCount[$tagName]))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($tagCount[$tagName] == 1)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $found[$tagName] = array($found[$tagName]);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $tagRef =&amp; $found[$tagName][$tagCount[$tagName]];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $tagCount[$tagName]++;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $tagCount[$tagName] = 1;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $tagRef =&amp; $found[$tagName];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; switch ($tag['type'])<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case 'open':<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $tagRef = $this-&gt;parse_recurse();<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (isset($tag['attributes']))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $tagRef[$this-&gt;attribKey] = $tag['attributes'];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (isset($tag['value']))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (isset($tagRef[$this-&gt;cdataKey]))&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $tagRef[$this-&gt;cdataKey] = (array)$tagRef[$this-&gt;cdataKey];&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; array_unshift($tagRef[$this-&gt;cdataKey], $tag['value']);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $tagRef[$this-&gt;cdataKey] = $tag['value'];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case 'complete':<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (isset($tag['attributes']))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $tagRef[$this-&gt;attribKey] = $tag['attributes'];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $tagRef =&amp; $tagRef[$this-&gt;valueKey];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (isset($tag['value']))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $tagRef = $tag['value'];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; return $found;<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; function parse_init()<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;parser = xml_parser_create();<br><br>&nbsp; &nbsp; &nbsp; &nbsp; $parser = $this-&gt;parser;<br>&nbsp; &nbsp; &nbsp; &nbsp; xml_parser_set_option($parser, XML_OPTION_CASE_FOLDING, 0);&nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; xml_parser_set_option($parser, XML_OPTION_SKIP_WHITE, 1);&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; if (!$res = (bool)xml_parse_into_struct($parser, $this-&gt;rawXML, $this-&gt;valueArray, $this-&gt;keyArray))<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;isError = true;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;error = 'error: '.xml_error_string(xml_get_error_code($parser)).' at line '.xml_get_current_line_number($parser);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; xml_parser_free($parser);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; return $res;<br>&nbsp; &nbsp; }<br>}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="45052">  
  <a class="name">
  <strong class="user"><em>happyseb at free dot fr</em></strong></a><div class="date" title="2004-08-24 08:51"><strong>17 years ago</strong></div>
  <div class="text" id="Hcom45052">
<div class="phpcode"><code><span class="html">
I would just add something about the solution proposed by "gordon at kanazawa dot ac dot jp".<br><br>Something went wrong about the fact that "cdata" are treated the same way as "complete" in the xml_get_children first and in the xml_get_child then.<br><br>When ?<br>with this method, something like this :<br>&lt;tagA&gt;<br>&nbsp; &lt;tagB&gt;valueB&lt;/tagB&gt;<br>&nbsp; valueA<br>&nbsp; &lt;tagC&gt;valueC&lt;/tagC&gt;<br>&lt;/tagA&gt;<br>is considered as the same thing as<br>&lt;tagA&gt;<br>&nbsp; &lt;tagB&gt;valueB&lt;/tagB&gt;<br>&nbsp; &lt;tagA&gt;valueA&lt;/tagA&gt;<br>&nbsp; &lt;tagC&gt;valueC&lt;/tagC&gt;<br>&lt;/tagA&gt;<br><br>The algorithm is nomore bijective.<br><br>Even if it might not be perfect :-) i propose a little modification of the xml_get_child function :<br><br>function xml_get_child(&amp;$v, $children=NULL) {<br>&nbsp; &nbsp; &nbsp; $c = array(); // the "child"<br>&nbsp; &nbsp; &nbsp; if (isset($v['tag']) &amp;&amp; $v['type'] != 'cdata') $c['tag'] = $v['tag'];<br>&nbsp; &nbsp; &nbsp; if (isset($v['value'])) $c['value'] = $v['value'];<br>&nbsp; &nbsp; &nbsp; if (isset($v['attributes'])) $c['attributes'] = $v['attributes'];<br>&nbsp; &nbsp; &nbsp; if (is_array($children)) $c['children'] = $children;<br>&nbsp; &nbsp; &nbsp; return $c;<br>}<br><br>moreover, the following function will take the tree (made from the xml_get_tree function) as a parameter and build the xml content back<br><br>&nbsp; &nbsp; /*<br>&nbsp; &nbsp; // setTree<br>&nbsp; &nbsp; // set xml Tree from a well-formed array<br>&nbsp; &nbsp; // manage indentation<br>&nbsp; &nbsp; // Parameters are :<br>&nbsp; &nbsp; // $1 (needed) : Tree to transform<br>&nbsp; &nbsp; // $2 (optional) : Indentation type (default is one tabulation)<br>&nbsp; &nbsp; // $3 (optional) : First indent (default is empty string)<br>&nbsp; &nbsp; */<br><br>&nbsp; &nbsp; function setTree($Atree, $indentType = '&nbsp; &nbsp; ', $Sindent = '')<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; if (! isset ($Atree['tag']) &amp;&amp; isset ($Atree['value'])) return ($Sindent.trim($Atree['value'])."\r\n") ;<br>&nbsp; &nbsp; &nbsp; else {<br>&nbsp; &nbsp; &nbsp; &nbsp; $Stemp = $Sindent.'&lt;'.$Atree['tag'].' ' ;<br>&nbsp; &nbsp; &nbsp; &nbsp; if (isset ($Atree['attributes']) &amp;&amp; is_array ($Atree['attributes'])) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($Atree['attributes'] as $Aattribute =&gt; $Svalue) $Stemp .= $Aattribute.'="'.$Svalue.'" ' ;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; if (! isset ($Atree['children']) &amp;&amp; ! isset ($Atree['value'])) $Stemp .= '/&gt;'."\r\n" ;<br>&nbsp; &nbsp; &nbsp; &nbsp; else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $Stemp .= '&gt;'."\r\n" ;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (isset ($Atree['value'])) $Stemp .= $Sindent.$indentType.trim($Atree['value'])."\r\n" ;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (isset ($Atree['children']) &amp;&amp; is_array ($Atree['children']))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($Atree['children'] as $Achild) $Stemp .= $this-&gt;setTree($Achild, $indentType, $Sindent.$indentType) ;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $Stemp .= $Sindent.'&lt;/'.$Atree['tag'].'&gt;'."\r\n" ;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; return ($Stemp) ;<br>&nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }</span>
</code></div>
  </div>
 </div>
  <div class="note" id="90621">  
  <a class="name">
  <strong class="user"><em>Adam Tylmad</em></strong></a><div class="date" title="2009-04-30 12:58"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom90621">
<div class="phpcode"><code><span class="html">
Thanx to jukea i've upgraded the characterData-function to allow the value 0. Here is the new complete code:<br><br><span class="default">&lt;?php<br><br></span><span class="keyword">class </span><span class="default">XMLParser </span><span class="keyword">{<br>&nbsp; &nbsp; var </span><span class="default">$path</span><span class="keyword">;<br>&nbsp; &nbsp; var </span><span class="default">$result</span><span class="keyword">;<br><br>&nbsp; &nbsp; function </span><span class="default">cleanString</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">trim</span><span class="keyword">(</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"'"</span><span class="keyword">, </span><span class="string">"&amp;#39;"</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">));<br>&nbsp; &nbsp; }<br>&nbsp;&nbsp; <br>&nbsp; &nbsp; function </span><span class="default">XMLParser</span><span class="keyword">(</span><span class="default">$encoding</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path </span><span class="keyword">= </span><span class="string">"\$this-&gt;result"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">index </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$xml_parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">(</span><span class="default">$encoding</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_set_object</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, &amp;</span><span class="default">$this</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="string">'startElement'</span><span class="keyword">, </span><span class="string">'endElement'</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_set_character_data_handler</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="string">'characterData'</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp;&nbsp; <br>&nbsp; &nbsp; function </span><span class="default">startElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$tag</span><span class="keyword">, </span><span class="default">$attributeList</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path </span><span class="keyword">.= </span><span class="string">"-&gt;"</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; eval(</span><span class="string">"\$data = "</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">.</span><span class="string">";"</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$index </span><span class="keyword">= </span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path </span><span class="keyword">.= </span><span class="string">"["</span><span class="keyword">.</span><span class="default">$index</span><span class="keyword">.</span><span class="string">"]"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; } else if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; eval(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">.</span><span class="string">" = array("</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">.</span><span class="string">");"</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path </span><span class="keyword">.= </span><span class="string">"[1]"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; foreach(</span><span class="default">$attributeList </span><span class="keyword">as </span><span class="default">$name </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; eval(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">.</span><span class="string">"-&gt;"</span><span class="keyword">.</span><span class="default">$name</span><span class="keyword">. </span><span class="string">" = '"</span><span class="keyword">.</span><span class="default">XMLParser</span><span class="keyword">::</span><span class="default">cleanString</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">).</span><span class="string">"';"</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp;&nbsp; <br>&nbsp; &nbsp; function </span><span class="default">endElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$tag</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strrpos</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">, </span><span class="string">"-&gt;"</span><span class="keyword">));<br>&nbsp; &nbsp; }<br>&nbsp;&nbsp; <br>&nbsp; &nbsp; function </span><span class="default">characterData</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data </span><span class="keyword">= </span><span class="default">XMLParser</span><span class="keyword">::</span><span class="default">cleanString</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; eval(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">.</span><span class="string">" = '</span><span class="default">$data</span><span class="string">';"</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>}<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="87304">  
  <a class="name">
  <strong class="user"><em>aerik at thesylvans dot com</em></strong></a><div class="date" title="2008-11-28 03:55"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom87304">
<div class="phpcode"><code><span class="html">
Here's another attempt at dealing with rebuilding the xml from the array.&nbsp; I'm basically preventing certain tags from being self closing by just checking for them explicitly (sure wish expat didn't interpret &lt;textarea /&gt; and &lt;textarea&gt;&lt;/textarea&gt; the same way (as "complete" tags).
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">array2xml</span><span class="keyword">(</span><span class="default">$xmlary</span><span class="keyword">){
<br>&nbsp; </span><span class="default">$o</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;
<br>&nbsp; foreach(</span><span class="default">$xmlary </span><span class="keyword">as </span><span class="default">$tag </span><span class="keyword">){
<br>&nbsp; &nbsp; if(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">] == </span><span class="string">'textarea' </span><span class="keyword">&amp;&amp; !isset(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">])){
<br>&nbsp; &nbsp; &nbsp; </span><span class="comment">//fake a value so it won't self close
<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">]=</span><span class="string">''</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; </span><span class="comment">//tab space:
<br>&nbsp; &nbsp; </span><span class="default">$t </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br>&nbsp; &nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">];</span><span class="default">$i</span><span class="keyword">++){
<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$t</span><span class="keyword">.=</span><span class="string">"\t"</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; switch(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">]){
<br>&nbsp; &nbsp; &nbsp; case </span><span class="string">'complete'</span><span class="keyword">:
<br>&nbsp; &nbsp; &nbsp; case </span><span class="string">'open'</span><span class="keyword">:
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$o</span><span class="keyword">.=</span><span class="default">$t</span><span class="keyword">.</span><span class="string">'&lt;'</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">];
<br>&nbsp; &nbsp; &nbsp; &nbsp; if(isset(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'attributes'</span><span class="keyword">])){
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'attributes'</span><span class="keyword">] as </span><span class="default">$attr</span><span class="keyword">=&gt;</span><span class="default">$aval</span><span class="keyword">){
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$o</span><span class="keyword">.=</span><span class="string">' '</span><span class="keyword">.</span><span class="default">$attr</span><span class="keyword">.</span><span class="string">'="'</span><span class="keyword">.</span><span class="default">$aval</span><span class="keyword">.</span><span class="string">'"'</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span><span class="comment">//foreach
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">}</span><span class="comment">//attributes
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">'complete'</span><span class="keyword">){
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(!isset(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">])){
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$o </span><span class="keyword">.= </span><span class="string">' /&gt;'</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$o </span><span class="keyword">.= </span><span class="string">'&gt;'</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">.</span><span class="default">$t</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">].</span><span class="string">"\n"</span><span class="keyword">.</span><span class="default">$t</span><span class="keyword">.</span><span class="string">'&lt;/'</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">].</span><span class="string">'&gt;'</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; }else{
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$o </span><span class="keyword">.= </span><span class="string">'&gt;'</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; break;
<br>&nbsp; &nbsp; &nbsp; case </span><span class="string">'close'</span><span class="keyword">:
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$o </span><span class="keyword">.= </span><span class="default">$t</span><span class="keyword">.</span><span class="string">'&lt;/'</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">].</span><span class="string">'&gt;'</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; break;
<br>&nbsp; &nbsp; &nbsp; case </span><span class="string">'cdata'</span><span class="keyword">:
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$o </span><span class="keyword">.= </span><span class="default">$t</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">].</span><span class="string">"\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; break;
<br>&nbsp; &nbsp; }</span><span class="comment">//switch
<br>&nbsp; </span><span class="keyword">}</span><span class="comment">//foreach
<br></span><span class="keyword">}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="85636">  
  <a class="name">
  <strong class="user"><em>Llorenc</em></strong></a><div class="date" title="2008-09-09 03:20"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom85636">
<div class="phpcode"><code><span class="html">
Sorry, forgot my last post below, I confused CDATA sections (&lt;![CDATA[]]&gt;) with the value type "cdata", which despite its name it's very different! The first allows adding markup (&amp;,&lt;,&gt;) as regular text and the second is to indicate a not complete node between the open and close nodes. What is true is that the CDATA delimiters are lost after xml_parse_into_struct so it's not possible to revert the process.<br><br>Please, feel free to remove my comments or leave them if you think they can help anyone.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="82476">  
  <a class="name">
  <strong class="user"><em>wickedfather at hotmail dot com</em></strong></a><div class="date" title="2008-04-12 08:36"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom82476">
<div class="phpcode"><code><span class="html">
To beaudurrant - that class is great and structures things in a very sensible way.&nbsp; Only problem is that it raises an error if a tag is empty, so would suggest a simple mod to the parse method just to add an isset test.<br><br>if (isset($val['value']))<br>{<br>&nbsp; &nbsp; $this-&gt;setArrayValue($this-&gt;output, $stack, $val['value']);<br>}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="77503">  
  <a class="name">
  <strong class="user"><em>vinod at citadel-soft dot com</em></strong></a><div class="date" title="2007-09-01 03:43"><strong>14 years ago</strong></div>
  <div class="text" id="Hcom77503">
<div class="phpcode"><code><span class="html">
My previous code was having some bugs in, that is fixed now <br><br><span class="default">&lt;?php<br></span><span class="keyword">class </span><span class="default">CSLXmlReader </span><span class="keyword">{<br>&nbsp; &nbsp; private </span><span class="default">$tagstack</span><span class="keyword">;<br>&nbsp; &nbsp; private </span><span class="default">$xmlvals</span><span class="keyword">;&nbsp; <br>&nbsp; &nbsp; private&nbsp; </span><span class="default">$xmlvarArrPos</span><span class="keyword">;<br>&nbsp; &nbsp; private </span><span class="default">$xmlfile</span><span class="keyword">;<br>&nbsp; &nbsp; function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">)&nbsp; </span><span class="comment">// constructor to intialize the stack and val array<br>&nbsp; &nbsp; </span><span class="keyword">{<br>&nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">tagstack </span><span class="keyword">= array();&nbsp;&nbsp; </span><span class="comment">// contain the open tags till now<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvals </span><span class="keyword">= array(); <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvals</span><span class="keyword">;&nbsp; </span><span class="comment">// temporary variable to hold the current tag position&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlfile </span><span class="keyword">= </span><span class="default">$filename</span><span class="keyword">; <br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; function </span><span class="default">readDatabase</span><span class="keyword">() <br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// read the XML database <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">implode</span><span class="keyword">(</span><span class="string">""</span><span class="keyword">, </span><span class="default">file</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlfile</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">XML_OPTION_SKIP_WHITE</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_parse_into_struct</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">$values</span><span class="keyword">, </span><span class="default">$tags</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">);<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; foreach(</span><span class="default">$values </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$val</span><span class="keyword">)&nbsp; </span><span class="comment">// <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">{<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"open"</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">tagstack</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">getArrayPath</span><span class="keyword">(); <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">) &gt; </span><span class="default">0 </span><span class="keyword">&amp;&amp; (!</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">)))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$temp1 </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos </span><span class="keyword">=&nbsp; array();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] = </span><span class="default">$temp1</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">tagstack</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else if( </span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">)){ <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$opncount </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">tagstack</span><span class="keyword">, </span><span class="default">$opncount</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tagStackPointer </span><span class="keyword">+= </span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }else if(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"close"</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; while( </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">] != (</span><span class="default">$lastOpened </span><span class="keyword">= </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">tagstack</span><span class="keyword">))){}<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }else if(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] ==&nbsp; </span><span class="string">"complete"</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">getArrayPath</span><span class="keyword">();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if( </span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">],</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]]))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$elementCount </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]]);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]][</span><span class="default">$elementCount</span><span class="keyword">] = </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }else<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$temp1 </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]] =&nbsp; array();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]][</span><span class="default">0</span><span class="keyword">] = </span><span class="default">$temp1</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]][</span><span class="default">1</span><span class="keyword">] = </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]] = </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">reset</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvals</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvals</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; function </span><span class="default">getArrayPath</span><span class="keyword">()<br>&nbsp; &nbsp; {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">reset</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvals</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos </span><span class="keyword">= &amp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvals</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; foreach(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">tagstack </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos </span><span class="keyword">= &amp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>}<br><br></span><span class="default">$readerObj&nbsp; </span><span class="keyword">= new </span><span class="default">CSLXmlReader</span><span class="keyword">(</span><span class="string">"test.xml"</span><span class="keyword">);<br></span><span class="default">$xmlvals </span><span class="keyword">= </span><span class="default">$readerObj</span><span class="keyword">-&gt;</span><span class="default">readDatabase</span><span class="keyword">();<br><br>echo </span><span class="string">"########## XML Values In array as the multidimentional array&nbsp; #############\n"</span><span class="keyword">;<br>echo </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">;<br></span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$xmlvals</span><span class="keyword">);<br>echo </span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">; <br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="71472">  
  <a class="name">
  <strong class="user"><em>webmaster at after5webdesign dot com</em></strong></a><div class="date" title="2006-11-30 04:48"><strong>14 years ago</strong></div>
  <div class="text" id="Hcom71472">
<div class="phpcode"><code><span class="html">
That parser also has a problem in which it will not parse more items than the current level it is on. That is, parsing this:&nbsp; &lt;1&gt;&lt;2&gt;A&lt;/2&gt;&lt;2&gt;B&lt;/2&gt;&lt;2&gt;C&lt;/2&gt;&lt;/1&gt;<br>Will only result in this: A B<br>C is never processed.<br><br>It might be better with something like this:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $file = get_url('<a rel="nofollow" target="_blank">http://news.search.yahoo.com/news/rss?p=current+events</a>', URL_CONTENT);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $data = $file['content'];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $xml_parser = xml_parser_create();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; xml_parse_into_struct($xml_parser, $data, $vals, $index);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; xml_parser_free($xml_parser);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //Uncomment the lines below to see the entire structure of your XML document<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //echo "&lt;pre&gt;INDEX: \n";<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //print_r ($index);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //echo "\n \n \n VALUES:";<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //print_r ($vals);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //echo "&lt;/pre&gt;";<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $params = array();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $level = array();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $start_level = 1;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($vals as $xml_elem) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($xml_elem['type'] == 'open') {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (array_key_exists('attributes',$xml_elem)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; list($level[$xml_elem['level']],$extra) = array_values($xml_elem['attributes']);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $level[$xml_elem['level']] = $xml_elem['tag'];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($xml_elem['type'] == 'complete') {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $php_stmt = '$params';<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; while($start_level &lt; $xml_elem['level']) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $php_stmt .= '[$level['.$start_level.']]';<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $start_level++;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $php_stmt .= '[$xml_elem[\'tag\']][] = $xml_elem[\'value\'];';<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; eval($php_stmt);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $start_level--;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo "&lt;pre&gt;";<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print_r ($params);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo "&lt;/pre&gt;";<br><br>~Tim_Myth</span>
</code></div>
  </div>
 </div>
  <div class="note" id="69616">  
  <a class="name">
  <strong class="user"><em>Elad Elrom</em></strong></a><div class="date" title="2006-09-12 02:14"><strong>14 years ago</strong></div>
  <div class="text" id="Hcom69616">
<div class="phpcode"><code><span class="html">
This is a quick fix for parsing XML from remote URL, some of the example above will work when trying to parse on your local server without "<a rel="nofollow" target="_blank">http://</a>" but not when trying to parse from remote server using "<a rel="nofollow" target="_blank">http://www.URL</a>"...<br><br>&lt;?<br>$file="<a rel="nofollow" target="_blank">http://www.URL.com/file.XML</a>";<br><br>$xml_parser = xml_parser_create();<br><br>$handle = fopen($file, "rb");<br>$contents = '';<br>while (!feof($handle)) {<br>&nbsp; $data .= fread($handle, 8192);<br>}<br>fclose($handle);<br><br>xml_parse_into_struct($xml_parser, $data, $vals, $index);<br>xml_parser_free($xml_parser);<br><br>$params = array();<br>$level = array();<br>foreach ($vals as $xml_elem) {<br>&nbsp; if ($xml_elem['type'] == 'open') {<br>&nbsp;&nbsp; if (array_key_exists('attributes',$xml_elem)) {<br>&nbsp; &nbsp;&nbsp; list($level[$xml_elem['level']],$extra) = array_values($xml_elem['attributes']);<br>&nbsp;&nbsp; } else {<br>&nbsp; &nbsp;&nbsp; $level[$xml_elem['level']] = $xml_elem['tag'];<br>&nbsp;&nbsp; }<br>&nbsp; }<br>&nbsp; if ($xml_elem['type'] == 'complete') {<br>&nbsp;&nbsp; $start_level = 1;<br>&nbsp;&nbsp; $php_stmt = '$params';<br>&nbsp;&nbsp; while($start_level &lt; $xml_elem['level']) {<br>&nbsp; &nbsp;&nbsp; $php_stmt .= '[$level['.$start_level.']]';<br>&nbsp; &nbsp;&nbsp; $start_level++;<br>&nbsp;&nbsp; }<br>&nbsp;&nbsp; $php_stmt .= '[$xml_elem[\'tag\']] = $xml_elem[\'value\'];';<br>&nbsp;&nbsp; eval($php_stmt);<br>&nbsp; }<br>}<br><br>echo "&lt;pre&gt;";<br>print_r ($params);<br>echo "&lt;/pre&gt;";<br>?&gt;</span>
</code></div>
  </div>
 </div>
  <div class="note" id="66479">  
  <a class="name">
  <strong class="user"><em>Stuart</em></strong></a><div class="date" title="2006-05-23 03:26"><strong>15 years ago</strong></div>
  <div class="text" id="Hcom66479">
<div class="phpcode"><code><span class="html">
This is a great little function for a lot of XML work, but note that this function does not handle XML entities properly.<br><br>The basic XML entities &amp;lt; &amp;gt; &amp;amp; &amp;quot; are fine, just anything else will not work:<br><br>If the entity is defined in the XML header, the parser will drop it completely from the struct it creates.<br><br>If the entity is not defined in the XML then the parser will crash out with an undefined entity error.<br><br>You should be able to work around this limitation by using a preg_replace on your XML string before passing it to the parser.<br><br>(Further details in Bug #35271; this is just a warning to those thinking of using this function for parsing real XML documents not just trivial XML examples)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="60485">  
  <a class="name">
  <strong class="user"><em>xademax at gmail dot com</em></strong></a><div class="date" title="2006-01-08 12:15"><strong>15 years ago</strong></div>
  <div class="text" id="Hcom60485">
<div class="phpcode"><code><span class="html">
This is just another simple xml parser :)<br><br><span class="default">&lt;?php<br><br></span><span class="keyword">class </span><span class="default">Xml<br></span><span class="keyword">{<br>&nbsp; &nbsp; var </span><span class="default">$tag</span><span class="keyword">;<br>&nbsp; &nbsp; var </span><span class="default">$value</span><span class="keyword">;<br>&nbsp; &nbsp; var </span><span class="default">$attributes</span><span class="keyword">;<br>&nbsp; &nbsp; var </span><span class="default">$next</span><span class="keyword">;<br>}<br><br>function </span><span class="default">xml2array</span><span class="keyword">(</span><span class="default">$xml_string</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; </span><span class="default">$Parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br>&nbsp; &nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$Parser</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$Parser</span><span class="keyword">, </span><span class="default">XML_OPTION_SKIP_WHITE</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">xml_parse_into_struct</span><span class="keyword">(</span><span class="default">$Parser</span><span class="keyword">, </span><span class="default">$xml_string</span><span class="keyword">, </span><span class="default">$Xml_Values</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$Parser</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$XmlClass </span><span class="keyword">= array();<br>&nbsp; &nbsp; </span><span class="default">$LastObj </span><span class="keyword">= array();<br>&nbsp; &nbsp; </span><span class="default">$NowObj </span><span class="keyword">= &amp;</span><span class="default">$XmlClass</span><span class="keyword">;<br><br>&nbsp; &nbsp; foreach(</span><span class="default">$Xml_Values </span><span class="keyword">as </span><span class="default">$Xml_Key </span><span class="keyword">=&gt; </span><span class="default">$Xml_Value</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$Index </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$NowObj</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$Xml_Value</span><span class="keyword">[</span><span class="string">"type"</span><span class="keyword">] == </span><span class="string">"complete"</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$NowObj</span><span class="keyword">[</span><span class="default">$Index</span><span class="keyword">] = new </span><span class="default">Xml</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$NowObj</span><span class="keyword">[</span><span class="default">$Index</span><span class="keyword">]-&gt;</span><span class="default">tag </span><span class="keyword">= </span><span class="default">$Xml_Value</span><span class="keyword">[</span><span class="string">"tag"</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$NowObj</span><span class="keyword">[</span><span class="default">$Index</span><span class="keyword">]-&gt;</span><span class="default">value </span><span class="keyword">= </span><span class="default">$Xml_Value</span><span class="keyword">[</span><span class="string">"value"</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$NowObj</span><span class="keyword">[</span><span class="default">$Index</span><span class="keyword">]-&gt;</span><span class="default">attributes </span><span class="keyword">= </span><span class="default">$Xml_Value</span><span class="keyword">[</span><span class="string">"attributes"</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; elseif(</span><span class="default">$Xml_Value</span><span class="keyword">[</span><span class="string">"type"</span><span class="keyword">] == </span><span class="string">"open"</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$NowObj</span><span class="keyword">[</span><span class="default">$Index</span><span class="keyword">] = new </span><span class="default">Xml</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$NowObj</span><span class="keyword">[</span><span class="default">$Index</span><span class="keyword">]-&gt;</span><span class="default">tag </span><span class="keyword">= </span><span class="default">$Xml_Value</span><span class="keyword">[</span><span class="string">"tag"</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$NowObj</span><span class="keyword">[</span><span class="default">$Index</span><span class="keyword">]-&gt;</span><span class="default">value </span><span class="keyword">= </span><span class="default">$Xml_Value</span><span class="keyword">[</span><span class="string">"value"</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$NowObj</span><span class="keyword">[</span><span class="default">$Index</span><span class="keyword">]-&gt;</span><span class="default">attributes </span><span class="keyword">= </span><span class="default">$Xml_Value</span><span class="keyword">[</span><span class="string">"attributes"</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$NowObj</span><span class="keyword">[</span><span class="default">$Index</span><span class="keyword">]-&gt;</span><span class="default">next </span><span class="keyword">= array();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$LastObj</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$LastObj</span><span class="keyword">)] = &amp;</span><span class="default">$NowObj</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$NowObj </span><span class="keyword">= &amp;</span><span class="default">$NowObj</span><span class="keyword">[</span><span class="default">$Index</span><span class="keyword">]-&gt;</span><span class="default">next</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; elseif(</span><span class="default">$Xml_Value</span><span class="keyword">[</span><span class="string">"type"</span><span class="keyword">] == </span><span class="string">"close"</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$NowObj </span><span class="keyword">= &amp;</span><span class="default">$LastObj</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$LastObj</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unset(</span><span class="default">$LastObj</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$LastObj</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; return </span><span class="default">$XmlClass</span><span class="keyword">;<br>}<br><br></span><span class="default">$String </span><span class="keyword">= </span><span class="string">"<br>&lt;parser&gt;<br>&nbsp; &nbsp; &lt;parseur_name&gt;MyParser&lt;/parseur_name&gt;<br>&nbsp; &nbsp; &lt;category&gt;<br>&nbsp; &nbsp; &nbsp; &nbsp; &lt;name&gt;Name 1&lt;/name&gt;<br>&nbsp; &nbsp; &nbsp; &nbsp; &lt;note&gt;A note 1&lt;/note&gt;<br>&nbsp; &nbsp; &lt;/category&gt;<br>&lt;/parser&gt;<br>"</span><span class="keyword">;<br></span><span class="default">$Xml </span><span class="keyword">= </span><span class="default">xml2array</span><span class="keyword">(</span><span class="default">$String</span><span class="keyword">);<br><br></span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$Xml</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>This exemple will show : <br>Array<br>(<br>&nbsp; &nbsp; [0] =&gt; Xml Object<br>&nbsp; &nbsp; &nbsp; &nbsp; (<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [tag] =&gt; parser<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [value] =&gt; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [attributes] =&gt; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [next] =&gt; Array<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [0] =&gt; Xml Object<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [tag] =&gt; parseur_name<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [value] =&gt; MyParser<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [attributes] =&gt; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [next] =&gt; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [1] =&gt; Xml Object<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [tag] =&gt; category<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [value] =&gt; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [attributes] =&gt; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [next] =&gt; Array<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [0] =&gt; Xml Object<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [tag] =&gt; name<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [value] =&gt; Name 1<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [attributes] =&gt; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [next] =&gt; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [1] =&gt; Xml Object<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [tag] =&gt; note<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [value] =&gt; A note 1<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [attributes] =&gt; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [next] =&gt; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br><br>&nbsp; &nbsp; &nbsp; &nbsp; )<br><br>)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="57975">  
  <a class="name">
  <strong class="user"><em>kieran at kieran dot ca</em></strong></a><div class="date" title="2005-10-20 09:20"><strong>15 years ago</strong></div>
  <div class="text" id="Hcom57975">
<div class="phpcode"><code><span class="html">
&lt;?
<br>/*
<br>|
<br>| _xml2array - another abstraction layer on xml_parse_into_struct 
<br>|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; that returns a nice nested array.
<br>|
<br>|&nbsp; &nbsp; &nbsp; @param: $xml is a string containing a full xml document
<br>|
<br>|&nbsp; &nbsp;&nbsp; returns: a nested php array that looks like this: 
<br>|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br>|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; array
<br>|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (
<br>|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [_name] =&gt; the name of the tag
<br>|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [_attributes] =&gt; an array of 'attribute'=&gt;'value' combos
<br>|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [_value] =&gt; the text contents of the node
<br>|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [_children] =&gt; an array of these arrays, one for each node.
<br>|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )
<br>|
<br>|&nbsp; &nbsp; &nbsp;&nbsp; notes: thanks to 'jeffg at activestate dot com' who inspired
<br>|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; me to essentially re-write his example code from php.net
<br>|
<br>|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; me: Kieran Huggins &lt; kieran[at]kieran[dot]ca &gt;
<br>|
<br>*/
<br>function _xml2array($xml){
<br>&nbsp; &nbsp; global $keys;
<br>&nbsp; &nbsp; global $level;
<br>&nbsp; &nbsp; if(!is_array($xml)){ // init on first run
<br>&nbsp; &nbsp; &nbsp; &nbsp; $raw_xml = $xml;
<br>&nbsp; &nbsp; &nbsp; &nbsp; $p = xml_parser_create();
<br>&nbsp; &nbsp; &nbsp; &nbsp; xml_parser_set_option($p, XML_OPTION_CASE_FOLDING, 0);
<br>&nbsp; &nbsp; &nbsp; &nbsp; xml_parser_set_option($p, XML_OPTION_SKIP_WHITE, 1);
<br>&nbsp; &nbsp; &nbsp; &nbsp; xml_parse_into_struct($p, $raw_xml, $xml, $idx);
<br>&nbsp; &nbsp; &nbsp; &nbsp; xml_parser_free($p);
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; for($i=0;$i&lt;count($xml,1);$i++){
<br>&nbsp; &nbsp; &nbsp; &nbsp; // set the current level
<br>&nbsp; &nbsp; &nbsp; &nbsp; $level = $xml[$i]['level'];
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; if($level&lt;1)break;
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; // mark this level's tag in the array
<br>&nbsp; &nbsp; &nbsp; &nbsp; $keys[$level] = '['.$i.']';
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; // if we've come down a level, sort output and destroy the upper level
<br>&nbsp; &nbsp; &nbsp; &nbsp; if(count($keys)&gt;$level) unset($keys[count($keys)]);
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; // ignore close tags, they're useless
<br>&nbsp; &nbsp; &nbsp; &nbsp; if($xml[$i]['type']=="open" || $xml[$i]['type']=="complete"){
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // build the evalstring
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $e = '$output'.implode('[\'_children\']',$keys);
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // set the tag name
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; eval($e.'[\'_name\'] = $xml[$i][\'tag\'];');
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // set the attributes
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if($xml[$i]['attributes']){
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; eval($e.'[\'_attributes\'] = $xml[$i][\'attributes\'];');
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // set the value
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if($xml[$i]['value']){
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; eval($e.'[\'_value\'] = trim($xml[$i][\'value\']);');
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>
<br>&nbsp; &nbsp; }
<br>
<br>&nbsp; &nbsp; return $output;
<br>}
<br>?&gt;</span>
</code></div>
  </div>
 </div>
  <div class="note" id="55243">  
  <a class="name">
  <strong class="user"><em>Chris Hester</em></strong></a><div class="date" title="2005-07-28 05:06"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom55243">
<div class="phpcode"><code><span class="html">
The array generated from XML stores not only the elements but also any spaces and linebreaks between the tags. This results in a much longer array. (I had 24 array fields instead of 10!) To cure this use the following code when creating the parser:<br><br><span class="default">&lt;?php<br>$xml_parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br></span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">,</span><span class="default">XML_OPTION_SKIP_WHITE</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="54934">  
  <a class="name">
  <strong class="user"><em>grusin at gmail dot com</em></strong></a><div class="date" title="2005-07-19 11:54"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom54934">
<div class="phpcode"><code><span class="html">
Here is a simple patch to peter's xml2array function.<br><br>Replace:<br><br>&lt;?<br>case 'open':<br>$tag_or_id = (array_key_exists ('attributes', xml_elem)) ? $xml_elem['attributes']['ID'] : $xml_elem['tag'];<br>$ptrs[$level][$tag_or_id] = array ();<br>$ptrs[$level+1] = &amp; $ptrs[$level][$tag_or_id];<br>break;<br>?&gt;<br><br>with:<br><br>&lt;?<br>case 'open':<br>$tag_or_id = (array_key_exists ('attributes', $xml_elem)) ? $xml_elem['attributes']['ID'] : $xml_elem['tag'];<br>$ptrs[$level][$tag_or_id][] = array ();<br>$ptrs[$level+1] = &amp; $ptrs[$level][$tag_or_id][count($ptrs[$level][$tag_or_id])-1];<br>break;<br>?&gt;<br><br>and now code should handle multiple element case :)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="54718">  
  <a class="name">
  <strong class="user"><em>Dustin</em></strong></a><div class="date" title="2005-07-13 08:39"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom54718">
<div class="phpcode"><code><span class="html">
If you happen to have problems with weird charaters, I added this code to the first line of dUDA's function:<br><br>$XML = utf8_decode($XML);</span>
</code></div>
  </div>
 </div>
  <div class="note" id="54106">  
  <a class="name">
  <strong class="user"><em>PhF at madmac dot fr</em></strong></a><div class="date" title="2005-06-23 01:11"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom54106">
<div class="phpcode"><code><span class="html">
The code previously posted by noob at noobsrule dot com doesn't work when the same tag name is used at different levels.<br>(but perhaps "$php_used_prefix" was intended for that ?)<br>For example:<br>&lt;RatedShipment&gt;<br>&nbsp; &lt;TransportationCharges&gt;<br>&nbsp; &nbsp; ...<br>&nbsp; &lt;/TransportationCharges&gt;<br>&nbsp; &lt;RatedPackage&gt;<br>&nbsp; &nbsp; &lt;TransportationCharges&gt;<br>&nbsp; &nbsp; &nbsp; ...<br>&nbsp; &nbsp; &lt;/TransportationCharges&gt;<br>&nbsp; &lt;/RatedPackage&gt;<br>&lt;/RatedShipment&gt;<br><span class="default">&lt;?php<br>&nbsp; &nbsp; $p </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br>&nbsp; &nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">, </span><span class="default">XML_OPTION_SKIP_WHITE</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">xml_parse_into_struct</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">, </span><span class="default">$UPSxml</span><span class="keyword">, </span><span class="default">$values</span><span class="keyword">, </span><span class="default">$idx</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">);<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// tracking used keys<br>&nbsp; &nbsp; </span><span class="default">$usedKeys </span><span class="keyword">= array();<br>&nbsp; &nbsp; </span><span class="default">$deepLevel </span><span class="keyword">= -</span><span class="default">1</span><span class="keyword">;<br><br>&nbsp; &nbsp; </span><span class="comment">// start a php array string (evaluated later)<br>&nbsp; &nbsp; </span><span class="default">$forEvalPrefix </span><span class="keyword">= </span><span class="string">'$xml_array'</span><span class="keyword">;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// loop throught the value array<br>&nbsp; &nbsp; </span><span class="keyword">foreach (</span><span class="default">$values </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$val</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tagName </span><span class="keyword">= </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]; </span><span class="comment">// pass the key tag into a more friendly looking variable<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$level </span><span class="keyword">= </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">]; </span><span class="comment">// idem<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">'open'</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$deepLevel</span><span class="keyword">++; </span><span class="comment">// increase deep level<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$forEvalPrefix </span><span class="keyword">.= </span><span class="string">'[\''</span><span class="keyword">. </span><span class="default">$tagName </span><span class="keyword">.</span><span class="string">'\']'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// begin used keys checks to allow multidimensionatity under the same tag<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">(isset(</span><span class="default">$usedKeys</span><span class="keyword">[</span><span class="default">$level</span><span class="keyword">][</span><span class="default">$tagName</span><span class="keyword">])) ? </span><span class="default">$usedKeys</span><span class="keyword">[</span><span class="default">$level</span><span class="keyword">][</span><span class="default">$tagName</span><span class="keyword">]++ : </span><span class="default">$usedKeys</span><span class="keyword">[</span><span class="default">$level</span><span class="keyword">][</span><span class="default">$tagName</span><span class="keyword">] = </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$forEvalPrefix </span><span class="keyword">.= </span><span class="string">'['</span><span class="keyword">. </span><span class="default">$usedKeys</span><span class="keyword">[</span><span class="default">$level</span><span class="keyword">][</span><span class="default">$tagName</span><span class="keyword">] .</span><span class="string">']'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; } <br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">'complete'</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (</span><span class="default">$level </span><span class="keyword">&gt; </span><span class="default">$deepLevel</span><span class="keyword">) ? </span><span class="default">$deepLevel</span><span class="keyword">++ : </span><span class="string">''</span><span class="keyword">; </span><span class="comment">// increase $deepLevel only if current level is bigger<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tagValue </span><span class="keyword">= </span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">] ); </span><span class="comment">// format the value for evaluation as a string<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$forEvalSuffix </span><span class="keyword">= </span><span class="string">'[\''</span><span class="keyword">. </span><span class="default">$tagName </span><span class="keyword">.</span><span class="string">'\'] = \''</span><span class="keyword">. </span><span class="default">$tagValue </span><span class="keyword">.</span><span class="string">'\';'</span><span class="keyword">; </span><span class="comment">// create a string to append to the current prefix<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$forEval </span><span class="keyword">= </span><span class="default">$forEvalPrefix </span><span class="keyword">. </span><span class="default">$forEvalSuffix</span><span class="keyword">; </span><span class="comment">// (without "$php_used_prefix"...)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">eval(</span><span class="default">$forEval</span><span class="keyword">); </span><span class="comment">// write the string to the array structure<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">}<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">'close'</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unset(</span><span class="default">$usedKeys</span><span class="keyword">[</span><span class="default">$deepLevel</span><span class="keyword">]); </span><span class="comment">// Suppress tagname's keys useless<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$deepLevel</span><span class="keyword">--;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$forEvalPrefix </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$forEvalPrefix</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strrpos</span><span class="keyword">(</span><span class="default">$forEvalPrefix</span><span class="keyword">, </span><span class="string">'['</span><span class="keyword">)); </span><span class="comment">// cut off the used keys node<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$forEvalPrefix </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$forEvalPrefix</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strrpos</span><span class="keyword">(</span><span class="default">$forEvalPrefix</span><span class="keyword">, </span><span class="string">'['</span><span class="keyword">)); </span><span class="comment">// cut off the end level of the array string prefix<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">}<br>&nbsp; &nbsp; }<br>echo </span><span class="string">'&lt;pre&gt;'</span><span class="keyword">;<br></span><span class="default">print_r </span><span class="keyword">(</span><span class="default">$xml_array</span><span class="keyword">);<br>echo </span><span class="string">'&lt;/pre&gt;'</span><span class="keyword">;<br></span><span class="default">?&gt;<br></span><br>MADmac ;-)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="53864">  
  <a class="name">
  <strong class="user"><em>peter at elemental dot org</em></strong></a><div class="date" title="2005-06-15 08:46"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom53864">
<div class="phpcode"><code><span class="html">
Quick addendum to my post below... The code does *not* handle cases where multiple elements are used without attribute IDs, as is the case with the moldb example.&nbsp; (It is probably worth noting that some of the other code below doesn't do this either, and is still more complex.)<br><br>It is not difficult to add that functionality, but I have yet to find an elegant way to integrate that feature, and since I don't need that functionality at the moment, I'm going leave that as an exercise to the reader.&nbsp; ;-)<br><br>-p.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="53840">  
  <a class="name">
  <strong class="user"><em>peter at elemental dot org</em></strong></a><div class="date" title="2005-06-14 04:09"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom53840">
<div class="phpcode"><code><span class="html">
Some of the code posted previously seemed absurdly complex, so I thought I'd see if I could simplify things a bit. Here's what I came up with.&nbsp; (I'm still a PHP newbie, so perhaps I simplified too much.&nbsp; ;-)&nbsp; Untested for speed, but it *should* be pretty quick since it uses references instead of lookups or (gack) evals.<br><br>Enjoy!<br><br>/*<br> *&nbsp; Convert a string containing XML into a nested array<br> *<br> *&nbsp; Takes a raw XML string as input<br> *&nbsp; Returns a nested array<br> */<br><br>function xml2array ($xml_data)<br>{<br>&nbsp; &nbsp; // parse the XML datastring<br>&nbsp; &nbsp; $xml_parser = xml_parser_create ();<br>&nbsp; &nbsp; xml_parse_into_struct ($xml_parser, $xml_data, $vals, $index);<br>&nbsp; &nbsp; xml_parser_free ($xml_parser);<br><br>&nbsp; &nbsp; // convert the parsed data into a PHP datatype<br>&nbsp; &nbsp; $params = array();<br>&nbsp; &nbsp; $ptrs[0] = &amp; $params;&nbsp;&nbsp; <br>&nbsp; &nbsp; foreach ($vals as $xml_elem) {<br>&nbsp; &nbsp; &nbsp; &nbsp; $level = $xml_elem['level'] - 1;<br>&nbsp; &nbsp; &nbsp; &nbsp; switch ($xml_elem['type']) {<br>&nbsp; &nbsp; &nbsp; &nbsp; case 'open':<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $tag_or_id = (array_key_exists ('attributes', $xml_elem)) ? $xml_elem['attributes']['ID'] : $xml_elem['tag'];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $ptrs[$level][$tag_or_id] = array ();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $ptrs[$level+1] = &amp; $ptrs[$level][$tag_or_id];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; case 'complete':<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $ptrs[$level][$xml_elem['tag']] = (isset ($xml_elem['value'])) ? $xml_elem['value'] : '';<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; return ($params);<br><br>}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="51310">  
  <a class="name">
  <strong class="user"><em>gleber at mapnet dot pl</em></strong></a><div class="date" title="2005-03-26 03:03"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom51310">
<div class="phpcode"><code><span class="html">
XMLtoArray created by dudus at onet dot pl was not good enough for me, that's why i decided to create my own version, and here's the result:<br><br><span class="default">&lt;?php<br><br></span><span class="keyword">function &amp;</span><span class="default">last</span><span class="keyword">(&amp;</span><span class="default">$array</span><span class="keyword">) {<br>if (!</span><span class="default">count</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">)) return </span><span class="default">null</span><span class="keyword">;<br></span><span class="default">end</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">);<br>return </span><span class="default">$array</span><span class="keyword">[</span><span class="default">key</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">)];<br>}<br><br>function </span><span class="default">myParseXML</span><span class="keyword">(&amp;</span><span class="default">$vals</span><span class="keyword">, &amp;</span><span class="default">$dom</span><span class="keyword">, &amp;</span><span class="default">$lev</span><span class="keyword">) {<br>&nbsp; &nbsp; do {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$curr </span><span class="keyword">= </span><span class="default">current</span><span class="keyword">(</span><span class="default">$vals</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$lev </span><span class="keyword">= </span><span class="default">$curr</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; switch (</span><span class="default">$curr</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">]) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">'open'</span><span class="keyword">:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (isset(</span><span class="default">$dom</span><span class="keyword">[</span><span class="default">$curr</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]])) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">$dom</span><span class="keyword">[</span><span class="default">$curr</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!</span><span class="default">$tmp</span><span class="keyword">[</span><span class="string">'__multi'</span><span class="keyword">])<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dom</span><span class="keyword">[</span><span class="default">$curr</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]] = array(</span><span class="string">'__multi' </span><span class="keyword">=&gt; </span><span class="default">true</span><span class="keyword">, </span><span class="default">$tmp</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$dom</span><span class="keyword">[</span><span class="default">$curr</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]], array());<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$new </span><span class="keyword">=&amp; </span><span class="default">last</span><span class="keyword">(</span><span class="default">$dom</span><span class="keyword">[</span><span class="default">$curr</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]]);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dom</span><span class="keyword">[</span><span class="default">$curr</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]] = array();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$new </span><span class="keyword">=&amp; </span><span class="default">$dom</span><span class="keyword">[</span><span class="default">$curr</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">next</span><span class="keyword">(</span><span class="default">$vals</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">myParseXML</span><span class="keyword">(&amp;</span><span class="default">$vals</span><span class="keyword">, </span><span class="default">$new</span><span class="keyword">, </span><span class="default">$lev</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">'cdata'</span><span class="keyword">:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">'complete'</span><span class="keyword">:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!isset(</span><span class="default">$dom</span><span class="keyword">[</span><span class="default">$curr</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]]))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dom</span><span class="keyword">[</span><span class="default">$curr</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]] = </span><span class="default">$curr</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$dom</span><span class="keyword">[</span><span class="default">$curr</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]])) <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$dom</span><span class="keyword">[</span><span class="default">$curr</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]] , </span><span class="default">$curr</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$dom</span><span class="keyword">[</span><span class="default">$curr</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]] = array(</span><span class="default">$dom</span><span class="keyword">[</span><span class="default">$curr</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]]) , </span><span class="default">$curr</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">'close'</span><span class="keyword">:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; while (</span><span class="default">next</span><span class="keyword">(</span><span class="default">$vals</span><span class="keyword">)!==</span><span class="default">FALSE</span><span class="keyword">);<br>}<br><br>function </span><span class="default">MyXMLtoArray</span><span class="keyword">(</span><span class="default">$XML</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$xml_parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_parse_into_struct</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="default">$XML</span><span class="keyword">, </span><span class="default">$vals</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">reset</span><span class="keyword">(</span><span class="default">$vals</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dom </span><span class="keyword">= array(); </span><span class="default">$lev </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">myParseXML</span><span class="keyword">(</span><span class="default">$vals</span><span class="keyword">, </span><span class="default">$dom</span><span class="keyword">, </span><span class="default">$lev</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$dom</span><span class="keyword">;<br>}<br><br></span><span class="default">?&gt;<br></span><br>MyXMLtoArray() is that function you should call, other are for "internal" use.<br><br>P.S. It's 4-5 time faster then dudus at onet dot pl 's code</span>
</code></div>
  </div>
 </div>
  <div class="note" id="49334">  
  <a class="name">
  <strong class="user"><em>noob at noobsrule dot com</em></strong></a><div class="date" title="2005-01-24 10:59"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom49334">
<div class="phpcode"><code><span class="html">
This is my first time contributing but I found all the examples either didn't work or were beyond my comprehension.&nbsp; I also wanted to maintain the XML multi-dimensionality so I could do loops based on keys I was expecting rather than numbers or some other whatnot.&nbsp; This script is probably way inefficient, but should give you a multidimensional array with a depth that will match the XML source.&nbsp; Great for situations when you aren't sure what you'll be getting back.&nbsp; Its also only based on the values array of xml_parse_into_str() using the 3 tag types (open, complete, and close) -- hopefully it will make more sense to other noobs.<br><br>Basically it just constructs a string ($php_prefix) that is tweaked if it hits an "open" or "close" tag and evaluated if it hits a "complete" tag.<br><br>Thanks.<br><br><span class="default">&lt;?php<br><br></span><span class="comment"># initiate curl session...<br></span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">( </span><span class="string">"<a rel="nofollow" target="_blank">http://yourtargethost</a>" </span><span class="keyword">) or die ( </span><span class="string">"could not initialize curl" </span><span class="keyword">); <br><br></span><span class="comment"># set curl options...<br></span><span class="default">curl_setopt</span><span class="keyword">( </span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER</span><span class="keyword">, </span><span class="default">0 </span><span class="keyword">);<br></span><span class="default">curl_setopt</span><span class="keyword">( </span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POST</span><span class="keyword">, </span><span class="default">1 </span><span class="keyword">);<br></span><span class="default">curl_setopt</span><span class="keyword">( </span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$request_str </span><span class="keyword">);<br></span><span class="default">curl_setopt</span><span class="keyword">( </span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_FOLLOWLOCATION</span><span class="keyword">, </span><span class="default">0 </span><span class="keyword">);<br></span><span class="default">curl_setopt</span><span class="keyword">( </span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_REFERER</span><span class="keyword">, </span><span class="default">https</span><span class="keyword">:</span><span class="comment">//foobar.com" );<br></span><span class="default">curl_setopt</span><span class="keyword">( </span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1 </span><span class="keyword">);<br><br></span><span class="comment"># execute curl commands...<br></span><span class="default">$curl_result </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">( </span><span class="default">$ch </span><span class="keyword">) or die ( </span><span class="string">"could not execute the post" </span><span class="keyword">);<br></span><span class="default">curl_close</span><span class="keyword">( </span><span class="default">$ch </span><span class="keyword">); </span><span class="comment">// close curl session <br><br># pass the XML result into 2 arrays ( index and values )...<br></span><span class="default">$p </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br></span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br></span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">, </span><span class="default">XML_OPTION_SKIP_WHITE</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br></span><span class="default">xml_parse_into_struct</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">, </span><span class="default">$curl_result</span><span class="keyword">, </span><span class="default">$vals</span><span class="keyword">, </span><span class="default">$index</span><span class="keyword">);<br></span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">);<br><br></span><span class="comment"># create an empty used key tracker...<br></span><span class="default">$used_keys </span><span class="keyword">= array();<br><br></span><span class="comment"># start a php array string (evaluated later)...<br></span><span class="default">$php_prefix </span><span class="keyword">= </span><span class="string">"$"</span><span class="keyword">.</span><span class="string">"my_array"</span><span class="keyword">;<br><br></span><span class="comment"># loop through the values array...<br></span><span class="keyword">foreach (</span><span class="default">$vals </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$val</span><span class="keyword">) {<br>&nbsp; &nbsp; if( </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"open" </span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$my_tag </span><span class="keyword">= </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]; </span><span class="comment">// pass the key tag into a more friendly looking variable...<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$php_prefix </span><span class="keyword">.= </span><span class="string">"['"</span><span class="keyword">.</span><span class="default">$my_tag</span><span class="keyword">.</span><span class="string">"']"</span><span class="keyword">; </span><span class="comment"># add a new level to the array string...<br><br>&nbsp; &nbsp; &nbsp; &nbsp; # begin used key checks to allow multidimensionality under the same tag, adds a number to the prefix if necessary...<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if( ! </span><span class="default">array_key_exists</span><span class="keyword">( </span><span class="default">$my_tag</span><span class="keyword">, </span><span class="default">$used_keys </span><span class="keyword">) ) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$used_keys</span><span class="keyword">[</span><span class="default">$my_tag</span><span class="keyword">] = </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$php_prefix </span><span class="keyword">.= </span><span class="string">"["</span><span class="keyword">.</span><span class="default">$used_keys</span><span class="keyword">[</span><span class="default">$my_tag</span><span class="keyword">].</span><span class="string">"]"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$used_keys</span><span class="keyword">[</span><span class="default">$my_tag</span><span class="keyword">]++; </span><span class="comment">// increment the key tracker to avoid overwriting existing key...<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$php_prefix </span><span class="keyword">.= </span><span class="string">"["</span><span class="keyword">.</span><span class="default">$used_keys</span><span class="keyword">[</span><span class="default">$my_tag</span><span class="keyword">].</span><span class="string">"]"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; } elseif( </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"complete" </span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$my_value </span><span class="keyword">= </span><span class="default">addslashes</span><span class="keyword">( </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">] ); </span><span class="comment"># format the value for evaluation as a string...<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$php_suffix </span><span class="keyword">= </span><span class="string">"['"</span><span class="keyword">.</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">].</span><span class="string">"'] = \""</span><span class="keyword">.</span><span class="default">$my_value</span><span class="keyword">.</span><span class="string">"\";"</span><span class="keyword">; </span><span class="comment"># create a string with the tag and value to append to the current prefix (just used here)...<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$php_str </span><span class="keyword">= </span><span class="default">$php_prefix</span><span class="keyword">.</span><span class="default">$php_used_prefix</span><span class="keyword">.</span><span class="default">$php_suffix</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; eval( </span><span class="default">$php_str </span><span class="keyword">); </span><span class="comment"># write the string to the array structure...<br>&nbsp; &nbsp; </span><span class="keyword">}<br>&nbsp; &nbsp; if( </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"close" </span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$php_prefix </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">( </span><span class="default">$php_prefix</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strrpos</span><span class="keyword">( </span><span class="default">$php_prefix</span><span class="keyword">, </span><span class="string">"[" </span><span class="keyword">) ); </span><span class="comment"># cut off the used keys node...<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$php_prefix </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">( </span><span class="default">$php_prefix</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strrpos</span><span class="keyword">( </span><span class="default">$php_prefix</span><span class="keyword">, </span><span class="string">"[" </span><span class="keyword">) ); </span><span class="comment"># cut off the end level of the array string prefix...<br>&nbsp; &nbsp; </span><span class="keyword">}<br>}<br><br>echo </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">;<br></span><span class="comment">//print_r ($index);<br>//echo "&lt;br&gt;&lt;br&gt;&lt;br&gt;";<br>//print_r ($vals);<br>//echo "&lt;br&gt;&lt;br&gt;&lt;br&gt;";<br></span><span class="default">print_r </span><span class="keyword">(</span><span class="default">$my_array</span><span class="keyword">);<br>echo </span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">;<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="49154">  
  <a class="name">
  <strong class="user"><em>dudus at onet dot pl</em></strong></a><div class="date" title="2005-01-18 06:33"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom49154">
<div class="phpcode"><code><span class="html">
This function return array from XML. Included attributes and tags in same level.<br>I wrote this function based on mmustafa code. <br><br>enjoy! <br>dUDA<br><br>-------------------------------<br><br>&lt;?<br>function XMLtoArray($XML)<br>{<br>&nbsp; &nbsp; $xml_parser = xml_parser_create();<br>&nbsp; &nbsp; xml_parse_into_struct($xml_parser, $XML, $vals);<br>&nbsp; &nbsp; xml_parser_free($xml_parser);<br>&nbsp; &nbsp; // wyznaczamy tablice z powtarzajacymi sie tagami na tym samym poziomie <br>&nbsp; &nbsp; $_tmp='';<br>&nbsp; &nbsp; foreach ($vals as $xml_elem)<br>&nbsp; &nbsp; { <br>&nbsp; &nbsp; &nbsp; &nbsp; $x_tag=$xml_elem['tag'];<br>&nbsp; &nbsp; &nbsp; &nbsp; $x_level=$xml_elem['level'];<br>&nbsp; &nbsp; &nbsp; &nbsp; $x_type=$xml_elem['type'];<br>&nbsp; &nbsp; &nbsp; &nbsp; if ($x_level!=1 &amp;&amp; $x_type == 'close')<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (isset($multi_key[$x_tag][$x_level]))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $multi_key[$x_tag][$x_level]=1;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $multi_key[$x_tag][$x_level]=0;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; if ($x_level!=1 &amp;&amp; $x_type == 'complete')<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($_tmp==$x_tag) <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $multi_key[$x_tag][$x_level]=1;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $_tmp=$x_tag;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; // jedziemy po tablicy<br>&nbsp; &nbsp; foreach ($vals as $xml_elem)<br>&nbsp; &nbsp; { <br>&nbsp; &nbsp; &nbsp; &nbsp; $x_tag=$xml_elem['tag'];<br>&nbsp; &nbsp; &nbsp; &nbsp; $x_level=$xml_elem['level'];<br>&nbsp; &nbsp; &nbsp; &nbsp; $x_type=$xml_elem['type'];<br>&nbsp; &nbsp; &nbsp; &nbsp; if ($x_type == 'open') <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $level[$x_level] = $x_tag;<br>&nbsp; &nbsp; &nbsp; &nbsp; $start_level = 1;<br>&nbsp; &nbsp; &nbsp; &nbsp; $php_stmt = '$xml_array';<br>&nbsp; &nbsp; &nbsp; &nbsp; if ($x_type=='close' &amp;&amp; $x_level!=1) <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $multi_key[$x_tag][$x_level]++;<br>&nbsp; &nbsp; &nbsp; &nbsp; while($start_level &lt; $x_level)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $php_stmt .= '[$level['.$start_level.']]';<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (isset($multi_key[$level[$start_level]][$start_level]) &amp;&amp; $multi_key[$level[$start_level]][$start_level]) <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $php_stmt .= '['.($multi_key[$level[$start_level]][$start_level]-1).']';<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $start_level++;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; $add='';<br>&nbsp; &nbsp; &nbsp; &nbsp; if (isset($multi_key[$x_tag][$x_level]) &amp;&amp; $multi_key[$x_tag][$x_level] &amp;&amp; ($x_type=='open' || $x_type=='complete'))<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!isset($multi_key2[$x_tag][$x_level]))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $multi_key2[$x_tag][$x_level]=0;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $multi_key2[$x_tag][$x_level]++;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $add='['.$multi_key2[$x_tag][$x_level].']'; <br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; if (isset($xml_elem['value']) &amp;&amp; trim($xml_elem['value'])!='' &amp;&amp; !array_key_exists('attributes',$xml_elem))<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($x_type == 'open') <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $php_stmt_main=$php_stmt.'[$x_type]'.$add.'[\'content\'] = $xml_elem[\'value\'];';<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $php_stmt_main=$php_stmt.'[$x_tag]'.$add.' = $xml_elem[\'value\'];';<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; eval($php_stmt_main);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; if (array_key_exists('attributes',$xml_elem))<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (isset($xml_elem['value']))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $php_stmt_main=$php_stmt.'[$x_tag]'.$add.'[\'content\'] = $xml_elem[\'value\'];';<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; eval($php_stmt_main);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($xml_elem['attributes'] as $key=&gt;$value)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $php_stmt_att=$php_stmt.'[$x_tag]'.$add.'[$key] = $value;';<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; eval($php_stmt_att);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp;&nbsp; return $xml_array;<br>}&nbsp; &nbsp; // END XMLtoArray<br>?&gt;</span>
</code></div>
  </div>
 </div>
  <div class="note" id="47866">  
  <a class="name">
  <strong class="user"><em>memandeemail at gmail dot com</em></strong></a><div class="date" title="2004-12-03 04:32"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom47866">
<div class="phpcode"><code><span class="html">
If you have de XML:
<br>&lt;?xml version="1.0" encoding="iso-8859-1"?&gt;
<br>&lt;teste&gt;
<br>&nbsp; &nbsp; &lt;teste&gt;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &lt;teste&gt;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &lt;/teste&gt;
<br>&nbsp; &nbsp; &lt;/teste&gt;
<br>&lt;/teste&gt;
<br>
<br>this function will return this tags:
<br>Array
<br>(
<br>&nbsp; &nbsp; [teste] =&gt; Array
<br>&nbsp; &nbsp; &nbsp; &nbsp; (
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [0] =&gt; 0
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [1] =&gt; 1
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [2] =&gt; 2
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [3] =&gt; 3
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [4] =&gt; 4
<br>&nbsp; &nbsp; &nbsp; &nbsp; )
<br>
<br>)
<br>
<br>With this function (right below) will convert the struc to OPEN and CLOSE concept.
<br>
<br>The New Struct:
<br>Array
<br>(
<br>&nbsp; &nbsp; [teste] =&gt; Array
<br>&nbsp; &nbsp; &nbsp; &nbsp; (
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [0] =&gt; 0
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [1] =&gt; 4
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [2] =&gt; 1
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [3] =&gt; 3
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [4] =&gt; 2
<br>&nbsp; &nbsp; &nbsp; &nbsp; )
<br>
<br>)
<br>The Function:
<br>
<br><span class="default">&lt;?php
<br></span><span class="comment">/**
<br> * @return bool
<br> * @param xml_array $values
<br> * @param xml_array[reference] $tags
<br> * @desc Reconstruct xml_parse_into_struct
<br>*/
<br></span><span class="keyword">function </span><span class="default">reconstruct_tag</span><span class="keyword">(</span><span class="default">$values</span><span class="keyword">, &amp;</span><span class="default">$tags</span><span class="keyword">) {
<br>&nbsp; &nbsp; unset(</span><span class="default">$return</span><span class="keyword">);
<br>&nbsp; &nbsp; foreach (</span><span class="default">$tags </span><span class="keyword">as </span><span class="default">$tkey </span><span class="keyword">=&gt; </span><span class="default">$tvalue</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; foreach (</span><span class="default">$tvalue </span><span class="keyword">as </span><span class="default">$vvalue</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$values</span><span class="keyword">[</span><span class="default">$vvalue</span><span class="keyword">][</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">'open' </span><span class="keyword">or </span><span class="default">$values</span><span class="keyword">[</span><span class="default">$vvalue</span><span class="keyword">][</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">'complete'</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$return</span><span class="keyword">[</span><span class="default">$tkey</span><span class="keyword">][] = </span><span class="default">$vvalue</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$values</span><span class="keyword">[</span><span class="default">$vvalue</span><span class="keyword">][</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">'open'</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach (</span><span class="default">$tvalue </span><span class="keyword">as </span><span class="default">$tv_value</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$values</span><span class="keyword">[</span><span class="default">$tv_value</span><span class="keyword">][</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">'close'
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">and </span><span class="default">$values</span><span class="keyword">[</span><span class="default">$tv_value</span><span class="keyword">][</span><span class="string">'level'</span><span class="keyword">] == </span><span class="default">$values</span><span class="keyword">[</span><span class="default">$vvalue</span><span class="keyword">][</span><span class="string">'level'</span><span class="keyword">]
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; and </span><span class="default">$tv_value </span><span class="keyword">&gt; </span><span class="default">$vvalue</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$return</span><span class="keyword">[</span><span class="default">$tkey</span><span class="keyword">][] = </span><span class="default">$tv_value</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; </span><span class="default">$tags </span><span class="keyword">= </span><span class="default">$return</span><span class="keyword">;
<br>&nbsp; &nbsp; return (bool) </span><span class="default">$tags</span><span class="keyword">;
<br>}
<br></span><span class="default">?&gt;
<br></span>
<br>Ahh, DO NOT forget this comment:
<br>
<br>jukkaho at mail dot student dot oulu dot fi
<br>29-Jun-2004 12:17 
<br>Everyone seems to forget the return value of this function (including people making examples!), but it is there for a reason:
<br>0 if failed (invalid XML), 1 if succeeded.
<br>
<br>Return value really is an integer, be careful with those === operators.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="43203">  
  <a class="name">
  <strong class="user"><em>sdh33 at cornell dot edu</em></strong></a><div class="date" title="2004-06-13 10:12"><strong>17 years ago</strong></div>
  <div class="text" id="Hcom43203">
<div class="phpcode"><code><span class="html">
(The previous post I wrote was incorrect.&nbsp; I fix that herein)<br>I used the algorithm from stephane for writing back to a file, but ran into the following problem.&nbsp; My original XML looks like<br><br>&lt;ENTRY id="1"&gt; ... &lt;/ENTRY&gt;&lt;ENTRY id="2"&gt; ... &lt;/ENTRY&gt;<br><br>This got saved back as<br><br>&lt;1&gt; ... &lt;/1&gt;&lt;2&gt; ... &lt;/2&gt;,<br><br>which expat doesn't like.&nbsp; So I propose the following modification:<br><br>function writeXmlToFile($data, $f, $niv = 0) {<br>&nbsp; foreach($data as $name =&gt; $elem) {<br>&nbsp; &nbsp; if (preg_match("/\A[0-9]/",$name)) {<br>&nbsp; &nbsp; &nbsp; $open = "ENTRY id=\"$name\""; $name = "ENTRY";<br>&nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; $open = $name;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; if(is_array($elem)) {<br>&nbsp; &nbsp; &nbsp; fwrite($f, str_repeat("&nbsp; ", $niv)."&lt;".$open."&gt;"."\n");<br>&nbsp; &nbsp; &nbsp; writeXmlToFile($elem, $f, $niv + 1);<br>&nbsp; &nbsp; &nbsp; fwrite($f, str_repeat("&nbsp; ", $niv)."&lt;/".$name."&gt;"."\n");<br>&nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; fwrite($f, str_repeat("&nbsp; ", $niv)."&lt;".$open."&gt;".$elem."&lt;/".$name."&gt;"."\n");<br>&nbsp; &nbsp; }<br>&nbsp; }<br>}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="41399">  
  <a class="name">
  <strong class="user"><em>stephane dot dekeyzer at noemail dot com</em></strong></a><div class="date" title="2004-04-08 11:54"><strong>17 years ago</strong></div>
  <div class="text" id="Hcom41399">
<div class="phpcode"><code><span class="html">
for writing the array of mmustafa back to a xml file, use this code:<br><br>function writeXmlFile($fileName, $struct){<br>&nbsp; $f = fopen($fileName, "w");<br>&nbsp; writeXmlToFile($struct, $f);<br>&nbsp; fclose($f);<br>}<br><br>function writeXmlToFile($data, $f, $niv = 0){<br>&nbsp; foreach($data as $name =&gt; $elem){<br>&nbsp; &nbsp; if(is_array($elem)){<br>&nbsp; &nbsp; &nbsp; fwrite($f, str_repeat("&nbsp; ", $niv)."&lt;".$name."&gt;"."\n");<br>&nbsp; &nbsp; &nbsp; writeXmlToFile($elem, $f, $niv + 1);<br>&nbsp; &nbsp; &nbsp; fwrite($f, str_repeat("&nbsp; ", $niv)."&lt;/".$name."&gt;"."\n");<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; else{<br>&nbsp; &nbsp; &nbsp; fwrite($f, str_repeat("&nbsp; ", $niv)."&lt;".$name."&gt;".$elem."&lt;/".$name."&gt;"."\n");<br>&nbsp; &nbsp; }<br>&nbsp; }<br>}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="38755">  
  <a class="name">
  <strong class="user"><em>mmustafa at vsnl dot com</em></strong></a><div class="date" title="2004-01-06 12:19"><strong>17 years ago</strong></div>
  <div class="text" id="Hcom38755">
<div class="phpcode"><code><span class="html">
A small and simple php code to convert the raw array returned by xml_parse_into_struct into a proper data structure ..<br><br><span class="default">&lt;?php<br>$file </span><span class="keyword">= </span><span class="string">"data.xml"</span><span class="keyword">;<br></span><span class="default">$xml_parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br><br>if (!(</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">))) {<br>&nbsp; &nbsp; die(</span><span class="string">"could not open XML input"</span><span class="keyword">);<br>}<br><br></span><span class="default">$data </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">));<br></span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br></span><span class="default">xml_parse_into_struct</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">$vals</span><span class="keyword">, </span><span class="default">$index</span><span class="keyword">);<br></span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">);<br><br></span><span class="default">$params </span><span class="keyword">= array();<br></span><span class="default">$level </span><span class="keyword">= array();<br>foreach (</span><span class="default">$vals </span><span class="keyword">as </span><span class="default">$xml_elem</span><span class="keyword">) {<br>&nbsp; if (</span><span class="default">$xml_elem</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">'open'</span><span class="keyword">) {<br>&nbsp; &nbsp; if (</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="string">'attributes'</span><span class="keyword">,</span><span class="default">$xml_elem</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; list(</span><span class="default">$level</span><span class="keyword">[</span><span class="default">$xml_elem</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">]],</span><span class="default">$extra</span><span class="keyword">) = </span><span class="default">array_values</span><span class="keyword">(</span><span class="default">$xml_elem</span><span class="keyword">[</span><span class="string">'attributes'</span><span class="keyword">]);<br>&nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$level</span><span class="keyword">[</span><span class="default">$xml_elem</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">]] = </span><span class="default">$xml_elem</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">];<br>&nbsp; &nbsp; }<br>&nbsp; }<br>&nbsp; if (</span><span class="default">$xml_elem</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">'complete'</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="default">$start_level </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$php_stmt </span><span class="keyword">= </span><span class="string">'$params'</span><span class="keyword">;<br>&nbsp; &nbsp; while(</span><span class="default">$start_level </span><span class="keyword">&lt; </span><span class="default">$xml_elem</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">]) {<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$php_stmt </span><span class="keyword">.= </span><span class="string">'[$level['</span><span class="keyword">.</span><span class="default">$start_level</span><span class="keyword">.</span><span class="string">']]'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$start_level</span><span class="keyword">++;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; </span><span class="default">$php_stmt </span><span class="keyword">.= </span><span class="string">'[$xml_elem[\'tag\']] = $xml_elem[\'value\'];'</span><span class="keyword">;<br>&nbsp; &nbsp; eval(</span><span class="default">$php_stmt</span><span class="keyword">);<br>&nbsp; }<br>}<br><br>echo </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">;<br></span><span class="default">print_r </span><span class="keyword">(</span><span class="default">$params</span><span class="keyword">);<br>echo </span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">;<br></span><span class="default">?&gt;<br></span><br>Converts an XML document like ..<br><br>&lt;country id="ZZ"&gt;<br>&lt;name&gt;My Land&lt;/name&gt;<br>&lt;location&gt;15E&lt;/location&gt;<br>&lt;area&gt;40000&lt;/area&gt;<br>&lt;state1&gt;<br>&lt;name&gt;Hi State&lt;/name&gt;<br>&lt;area&gt;1000&lt;/area&gt;<br>&lt;population&gt;2000&lt;/population&gt;<br>&lt;city1&gt;<br>&lt;location&gt;13E&lt;/location&gt;<br>&lt;population&gt;500&lt;/population&gt;<br>&lt;area&gt;500&lt;/area&gt;<br>&lt;/city1&gt;<br>&lt;city2&gt;<br>&lt;location&gt;13E&lt;/location&gt;<br>&lt;population&gt;500&lt;/population&gt;<br>&lt;area&gt;5000&lt;/area&gt;<br>&lt;/city2&gt;<br>&lt;/state1&gt;<br>&lt;state2&gt;<br>&lt;name&gt;Low State&lt;/name&gt;<br>&lt;area&gt;3000&lt;/area&gt;<br>&lt;population&gt;20000&lt;/population&gt;<br>&lt;city1&gt;<br>&lt;location&gt;15E&lt;/location&gt;<br>&lt;population&gt;5000&lt;/population&gt;<br>&lt;area&gt;1500&lt;/area&gt;<br>&lt;/city1&gt;<br>&lt;/state2&gt;<br>&lt;/country&gt;<br><br>To a php datastructure like ..<br><br>Array<br>(<br>&nbsp; &nbsp; [ZZ] =&gt; Array<br>&nbsp; &nbsp; &nbsp; &nbsp; (<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [NAME] =&gt; My Land<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [LOCATION] =&gt; 15E<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [AREA] =&gt; 40000<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [STATE1] =&gt; Array<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [NAME] =&gt; Hi State<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [AREA] =&gt; 1000<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [POPULATION] =&gt; 2000<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [CITY1] =&gt; Array<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [LOCATION] =&gt; 13E<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [POPULATION] =&gt; 500<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [AREA] =&gt; 500<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [CITY2] =&gt; Array<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [LOCATION] =&gt; 13E<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [POPULATION] =&gt; 500<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [AREA] =&gt; 5000<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [STATE2] =&gt; Array<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [NAME] =&gt; Low State<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [AREA] =&gt; 3000<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [POPULATION] =&gt; 20000<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [CITY1] =&gt; Array<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [LOCATION] =&gt; 15E<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [POPULATION] =&gt; 5000<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [AREA] =&gt; 1500<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br><br>&nbsp; &nbsp; &nbsp; &nbsp; )<br><br>)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="27015">  
  <a class="name">
  <strong class="user"><em>bisqwit at iki dot fi dot not dot for dot ads dot invalid</em></strong></a><div class="date" title="2002-11-20 08:33"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom27015">
<div class="phpcode"><code><span class="html">
I made my own xml2tree()-function.<br>The difference to the previously suggested ones on this manual page is that this creates a tree where the tags are keys.<br><br>Example input:<br><br>&lt;tree&gt;<br> &lt;leaf name="gruu"&gt; pl\xF6\xF6 &lt;/leaf&gt;<br> &lt;animal type="cat" /&gt;<br>&lt;/tree&gt;<br><br>Example output:<br><br>Array<br>( 'tree' =&gt; Array<br>&nbsp; &nbsp;&nbsp; ( 0 =&gt; Array<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ( 'children' =&gt; Array<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ( 'leaf' =&gt; Array<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ( 0 =&gt; Array<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ( 'attrs' =&gt; Array('name' =&gt; 'gruu'),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'values' =&gt; Array(0 =&gt; ' pl\xF6\xF6 ')<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )&nbsp; &nbsp; ),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'animal' =&gt; Array<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ( 0 =&gt; Array<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ( 'attrs' =&gt; Array('type' =&gt; 'cat')<br>)&nbsp; &nbsp; )&nbsp;&nbsp; )&nbsp; &nbsp; )&nbsp; &nbsp; )&nbsp;&nbsp; )<br><br>function xml2tree2($string)<br>{<br>&nbsp; $parser = xml_parser_create();<br>&nbsp; xml_parser_set_option($parser, XML_OPTION_CASE_FOLDING, 0);<br>&nbsp; xml_parser_set_option($parser, XML_OPTION_SKIP_WHITE, 1);<br>&nbsp; xml_parse_into_struct($parser, $string, $vals, $index);<br>&nbsp; xml_parser_free($parser);<br>&nbsp; <br>&nbsp; $stack = array( array() );<br>&nbsp; $stacktop = 0;<br>&nbsp; $parent = array();<br>&nbsp; foreach($vals as $val)<br>&nbsp; {<br>&nbsp; &nbsp; $type = $val['type'];<br>&nbsp; &nbsp; if($type=='open' || $type=='complete')<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; // open tag<br>&nbsp; &nbsp; &nbsp; $stack[$stacktop++] = $tagi;<br>&nbsp; &nbsp; &nbsp; $tagi = array('tag' =&gt; $val['tag']);<br><br>&nbsp; &nbsp; &nbsp; if(isset($val['attributes']))&nbsp; $tagi['attrs'] = $val['attributes'];&nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; if(isset($val['value']))<br>&nbsp; &nbsp; &nbsp; &nbsp; $tagi['values'][] = $val['value'];<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; if($type=='complete' || $type=='close')<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; // finish tag<br>&nbsp; &nbsp; &nbsp; $tags[] = $oldtagi = $tagi; <br>&nbsp; &nbsp; &nbsp; $tagi = $stack[--$stacktop];<br>&nbsp; &nbsp; &nbsp; $oldtag = $oldtagi['tag'];&nbsp; <br>&nbsp; &nbsp; &nbsp; unset($oldtagi['tag']);<br>&nbsp; &nbsp; &nbsp; $tagi['children'][$oldtag][] = $oldtagi;<br>&nbsp; &nbsp; &nbsp; $parent = $tagi;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; if($type=='cdata')<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; $tagi['values'][] = $val['value'];<br>&nbsp; &nbsp; }<br>&nbsp; }<br>&nbsp; return $parent['children'];<br>}&nbsp; &nbsp; &nbsp; &nbsp; <br><br>Ps: Note that the xml parsing for some reason chokes if the values contain &lt;&gt; (even inside ""). You need to escape them as &amp;lt; and &amp;gt;.<br>Same for &amp; (for obvious reasons). Escape it as &amp;amp;.<br>For example "&amp;nbsp;" should be written as "&amp;amp;nbsp;".</span>
</code></div>
  </div>
 </div>
  <div class="note" id="24199">  
  <a class="name"><strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2002-08-09 01:20"><strong>19 years ago</strong></div>
  <div class="text" id="Hcom24199">
<div class="phpcode"><code><span class="html">
This is based on a comment above by mh@mainlab.de.&nbsp; This version makes more sense to me and I included a few comments that might make it more usefull for specific purposes.<br><br>// Look through $vals and $index,<br>// generated by parse_xml_data(),<br>// for $location.&nbsp; $location resembles a unix path.<br>// E.g. "my/xml/path/to/my/data".<br>// Note: This is NOT a full-feature xml utility.<br>// Your path must be unique in the xml data<br>// and the tags must not contain slashes.<br>//<br>// returns: cdata from last element of $location<br>//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; or NULL.<br>function get_xml_values($vals, $index, $location) {<br>&nbsp; $location = explode('/', $location);<br>&nbsp; $location_level = count($location);<br>&nbsp; for ($n=0; $n&lt;$location_level; ++$n) {<br>&nbsp; &nbsp; $val_indexes=$index[$location[$n]];<br>&nbsp; &nbsp; $good=0;<br>&nbsp; &nbsp; for ($i=0; $i&lt;count($val_indexes); ++$i) {<br>&nbsp; &nbsp; &nbsp; $v = $vals[$val_indexes[$i]];<br>&nbsp; &nbsp; &nbsp; // level is 1 based, n is 0 based:<br>&nbsp; &nbsp; &nbsp; if ($v['level']-1 == $n) {<br>&nbsp; &nbsp; &nbsp; &nbsp; if ($v['type'] == 'open') {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // We found an open tag at the correct level.<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $good=1;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break; // Remove break to avoid 'open' hiding<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // 'complete' at last $n. (Speed Vs. Robustness:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // For now, I'm going with speed).<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; if ($v['type'] == 'complete') {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // We found it, after finding all the prior elements:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // You may want to change this to<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // return $v<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // so you can call $v['value'] and $v['attributes']<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return $v['value'];<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; if (!$good) {<br>&nbsp; &nbsp; &nbsp; return NULL;<br>&nbsp; &nbsp; }<br>&nbsp; }<br>}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="23526">  
  <a class="name">
  <strong class="user"><em>farinspace-at-hotmail-dot-com</em></strong></a><div class="date" title="2002-07-20 06:41"><strong>19 years ago</strong></div>
  <div class="text" id="Hcom23526">
<div class="phpcode"><code><span class="html">
Wow, took a while to consume all of this. I am a noobie at XML, in fact i just really started working with it today. I went ahead and added to the above code by gdemartini@bol.com.br. I also added the update by nyk@cowham.net.<br><br>Added 'value' =&gt; $vals[$i]['value'] to the open case, as some nodes have both cdata as well as a children node. In previous versions of the functions the cdata of a node(a) that also had children would get stored in the children's array of the parent node(a). Now only children values are in the children array and the cdata is in the value key of the parent node(a).<br><br>Added 'value' =&gt; $vals[$i]['value'] to tree array as the vals array produced by PHP includes a value to the top most node if no children exist (for completeness).<br><br>Also, using xml_parser_set_option($parser, XML_OPTION_SKIP_WHITE,1) will strip all white space from both around the XML tags as well as inside the cdata. I added a piece of code by waldo@wh-e.com to take care of this. All SPACE characters are now only stripped from around the XML tags and cdata spacing is retained.<br><br>CODE:<br>***************************************<br><br>function GetChildren($vals, &amp;$i) {<br><br>&nbsp; &nbsp; $children = array();<br><br>&nbsp; &nbsp; while (++$i &lt; sizeof($vals)) {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; // compair type<br>&nbsp; &nbsp; &nbsp; &nbsp; switch ($vals[$i]['type']) {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case 'cdata':<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $children[] = $vals[$i]['value'];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case 'complete':<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $children[] = array(<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'tag' =&gt; $vals[$i]['tag'], <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'attributes' =&gt; $vals[$i]['attributes'], <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'value' =&gt; $vals[$i]['value']<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case 'open':<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $children[] = array(<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'tag' =&gt; $vals[$i]['tag'], <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'attributes' =&gt; $vals[$i]['attributes'], <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'value' =&gt; $vals[$i]['value'], <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'children' =&gt; GetChildren($vals, $i)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case 'close':<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return $children;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>}<br><br>function GetXMLTree($file) {<br><br>&nbsp; &nbsp; $data = implode('', file($file));<br><br>&nbsp; &nbsp; // by: waldo@wh-e.com - trim space around tags not within<br>&nbsp; &nbsp; $data = eregi_replace("&gt;"."[[:space:]]+"."&lt;","&gt;&lt;",$data);<br><br>&nbsp; &nbsp; // XML functions<br>&nbsp; &nbsp; $p = xml_parser_create();<br><br>&nbsp; &nbsp; // by: anony@mous.com - meets XML 1.0 specification<br>&nbsp; &nbsp; xml_parser_set_option($p, XML_OPTION_CASE_FOLDING, 0);<br>&nbsp; &nbsp; xml_parse_into_struct($p, $data, &amp;$vals, &amp;$index);<br>&nbsp; &nbsp; xml_parser_free($p);<br><br>&nbsp; &nbsp; $i = 0;<br>&nbsp; &nbsp; $tree = array();<br>&nbsp; &nbsp; $tree[] = array(<br>&nbsp; &nbsp; &nbsp; &nbsp; 'tag' =&gt; $vals[$i]['tag'], <br>&nbsp; &nbsp; &nbsp; &nbsp; 'attributes' =&gt; $vals[$i]['attributes'], <br>&nbsp; &nbsp; &nbsp; &nbsp; 'value' =&gt; $vals[$i]['value'], <br>&nbsp; &nbsp; &nbsp; &nbsp; 'children' =&gt; GetChildren($vals, $i)<br>&nbsp; &nbsp; );<br><br>&nbsp; &nbsp; return $tree;<br>}<br><br>***************************************</span>
</code></div>
  </div>
 </div>
  <div class="note" id="20412">  
  <a class="name">
  <strong class="user"><em>dave at ovumdesign dot com</em></strong></a><div class="date" title="2002-04-03 03:32"><strong>19 years ago</strong></div>
  <div class="text" id="Hcom20412">
<div class="phpcode"><code><span class="html">
Here is another variation on gdemartini@bol.com.br's nice tree algorithm. I have included nyk@cowham.net's "cdata" suggestion. I made a few changes to suppress unitialized variable warnings with error_reporting(E_ALL), and made a few stylistic changes.<br><br>There are two functional modifications as well. The first is the added option to expat to turn off "case folding", since XML is technically a case-sensitive language. The second is the returned tree - instead of returning a single-element list (an array with index 0 pointing to the top node) like the original algorithm, it returns the top node itself. This saves you an unnecessary level of indirection.<br><br>function xml_get_children($vals, &amp;$i) {<br>&nbsp; &nbsp; $children = array();<br>&nbsp; &nbsp; if (isset($vals[$i]['value'])) $children[] = $vals[$i]['value'];<br><br>&nbsp; &nbsp; while (++$i &lt; count($vals)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; switch ($vals[$i]['type']) {<br>&nbsp; &nbsp; &nbsp; &nbsp; case 'cdata':<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $children[] = $vals[$i]['value'];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; case 'complete':<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $children[] = array(<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'tag'&nbsp; &nbsp; &nbsp; &nbsp; =&gt; $vals[$i]['tag'],<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'attributes' =&gt; isset($vals[$i]['attributes'])?<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $vals[$i]['attributes'] : null,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'value'&nbsp; &nbsp; &nbsp; =&gt; $vals[$i]['value'],<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; case 'open':<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $children[] = array(<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'tag'&nbsp; &nbsp; &nbsp; &nbsp; =&gt; $vals[$i]['tag'],<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'attributes' =&gt; isset($vals[$i]['attributes'])?<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $vals[$i]['attributes'] : null,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'children'&nbsp;&nbsp; =&gt; xml_get_children($vals, $i),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; case 'close':<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return $children;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>}<br><br>function xml_get_tree($file) {<br>&nbsp; &nbsp; $data = join('', file($file));<br><br>&nbsp; &nbsp; $parser = xml_parser_create();<br>&nbsp; &nbsp; xml_parser_set_option($parser, XML_OPTION_CASE_FOLDING, 0);<br>&nbsp; &nbsp; xml_parser_set_option($parser, XML_OPTION_SKIP_WHITE,&nbsp;&nbsp; 1);<br>&nbsp; &nbsp; xml_parse_into_struct($parser, $data, $vals, $index);<br>&nbsp; &nbsp; xml_parser_free($parser);<br><br>&nbsp; &nbsp; return array(<br>&nbsp; &nbsp; &nbsp; &nbsp; 'tag'&nbsp; &nbsp; &nbsp; &nbsp; =&gt; $vals[0]['tag'],<br>&nbsp; &nbsp; &nbsp; &nbsp; 'attributes' =&gt; isset($vals[0]['attributes'])?<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $vals[0]['attributes'] : null,<br>&nbsp; &nbsp; &nbsp; &nbsp; 'children'&nbsp;&nbsp; =&gt; xml_get_children($vals, $i = 0),<br>&nbsp; &nbsp; );<br>}<br><br>This function takes a tree returned by xml_get_tree() and simplifies it similarly to voncken@mailandnews.com and oknapp@soly.de's suggestions. It finds any nodes that expat considered "complete" (childless) and contain no attributes, and it moves the tag name (as the key) and value into an element in the parent node's "values" array.<br><br>For example: <br>$tree = xml_get_tree('moldb.xml');&nbsp;&nbsp; <br>$tree = xml_condense_tree($tree); <br>echo $tree['children'][1]['values']['name'];<br><br>Outputs:<br>Lysine<br><br>function xml_condense_tree($tree) {<br>&nbsp; &nbsp; foreach ($tree['children'] as $index =&gt; $node) {<br>&nbsp; &nbsp; &nbsp; &nbsp; if (isset($node['children'])) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $tree['children'][$index] = xml_condense_tree($node);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; } elseif (isset($node['value']) and !$node['attributes']) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $tree['values'][$node['tag']] = $node['value'];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unset($tree['children'][$index]);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; if (!$tree['children']) unset($tree['children']);<br>&nbsp; &nbsp; return $tree;<br>}<br><br>Enjoy,<br>Dave</span>
</code></div>
  </div>
 </div>
  <div class="note" id="58568">  
  <a class="name">
  <strong class="user"><em>mbirth at webwriters dot de</em></strong></a><div class="date" title="2005-11-08 03:48"><strong>15 years ago</strong></div>
  <div class="text" id="Hcom58568">
<div class="phpcode"><code><span class="html">
Searching for a nice and working way to get a RSS feed into an array-structure, I found the solution posted by kieran but disliked those several eval()s. So I wrote my own using references/pointers.<br><br><span class="default">&lt;?php<br><br></span><span class="keyword">class </span><span class="default">RSSParser </span><span class="keyword">{<br>&nbsp; <br>&nbsp; var </span><span class="default">$struct </span><span class="keyword">= array();&nbsp; </span><span class="comment">// holds final structure<br>&nbsp; </span><span class="keyword">var </span><span class="default">$curptr</span><span class="keyword">;&nbsp; </span><span class="comment">// current branch on $struct<br>&nbsp; </span><span class="keyword">var </span><span class="default">$parents </span><span class="keyword">= array();&nbsp; </span><span class="comment">// parent branches of current branch<br>&nbsp; <br>&nbsp; </span><span class="keyword">function </span><span class="default">RSSParser</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curptr </span><span class="keyword">=&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">struct</span><span class="keyword">;&nbsp; </span><span class="comment">// set ref to base<br>&nbsp; &nbsp; </span><span class="default">$xmlparser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br>&nbsp; &nbsp; </span><span class="default">xml_set_object</span><span class="keyword">(</span><span class="default">$xmlparser</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$xmlparser</span><span class="keyword">, </span><span class="string">'tag_open'</span><span class="keyword">, </span><span class="string">'tag_close'</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">xml_set_character_data_handler</span><span class="keyword">(</span><span class="default">$xmlparser</span><span class="keyword">, </span><span class="string">'cdata'</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">);<br><br>&nbsp; &nbsp; while (</span><span class="default">$data </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; </span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$xmlparser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; || die(</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"XML error: %s at line %d"</span><span class="keyword">, <br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_error_string</span><span class="keyword">(</span><span class="default">xml_get_error_code</span><span class="keyword">(</span><span class="default">$xmlparser</span><span class="keyword">)), <br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_get_current_line_number</span><span class="keyword">(</span><span class="default">$xmlparser</span><span class="keyword">)));<br><br>&nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$xmlparser</span><span class="keyword">);<br>&nbsp; }<br>&nbsp; <br>&nbsp; function </span><span class="default">tag_open</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$tag</span><span class="keyword">, </span><span class="default">$attr</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curptr</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">]);<br>&nbsp; &nbsp; </span><span class="default">$j </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parents</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curptr</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">]=array();&nbsp; </span><span class="comment">// add new child element<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parents</span><span class="keyword">[</span><span class="default">$j</span><span class="keyword">] =&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curptr</span><span class="keyword">;&nbsp; </span><span class="comment">// store current position as parent<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curptr </span><span class="keyword">=&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curptr</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">];&nbsp; </span><span class="comment">// submerge to newly created child element<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curptr</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">] = </span><span class="default">$tag</span><span class="keyword">;<br>&nbsp; &nbsp; if (</span><span class="default">count</span><span class="keyword">(</span><span class="default">$attr</span><span class="keyword">)&gt;</span><span class="default">0</span><span class="keyword">) </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curptr</span><span class="keyword">[</span><span class="string">'attr'</span><span class="keyword">] = </span><span class="default">$attr</span><span class="keyword">;<br>&nbsp; }<br>&nbsp; <br>&nbsp; function </span><span class="default">tag_close</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$tag</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parents</span><span class="keyword">);<br>&nbsp; &nbsp; if (</span><span class="default">$i</span><span class="keyword">&gt;</span><span class="default">0</span><span class="keyword">) </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curptr </span><span class="keyword">=&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parents</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">];&nbsp; </span><span class="comment">// return to parent element<br>&nbsp; &nbsp; </span><span class="keyword">unset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parents</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">]);&nbsp; </span><span class="comment">// clear from list of parents<br>&nbsp; </span><span class="keyword">}<br>&nbsp; <br>&nbsp; function </span><span class="default">cdata</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);<br>&nbsp; &nbsp; if (!empty(</span><span class="default">$data</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curptr</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">] .= </span><span class="default">$data</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; }<br>&nbsp; <br>}<br><br></span><span class="default">$myparser </span><span class="keyword">= new </span><span class="default">RSSParser</span><span class="keyword">(</span><span class="string">'getitems.xml'</span><span class="keyword">);<br></span><span class="default">$anotherparser </span><span class="keyword">= new </span><span class="default">RSSParser</span><span class="keyword">(</span><span class="string">'<a rel="nofollow" target="_blank">http://johndoe:secret@myfeeds.com/getfeed.xml</a>'</span><span class="keyword">);<br><br></span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$myparser</span><span class="keyword">-&gt;</span><span class="default">struct</span><span class="keyword">);<br></span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$anotherparser</span><span class="keyword">-&gt;</span><span class="default">struct</span><span class="keyword">);<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="70916">  
  <a class="name">
  <strong class="user"><em>A3</em></strong></a><div class="date" title="2006-11-03 05:28"><strong>14 years ago</strong></div>
  <div class="text" id="Hcom70916">
<div class="phpcode"><code><span class="html">
XML -&gt; Array<br>&lt;?<br>&nbsp; &nbsp; $data = '&lt;root&gt;&lt;a&gt;&lt;b x="s" a="2"&gt;asdf&lt;/b&gt;&lt;c&gt;&lt;/c&gt;&lt;/a&gt;&lt;/root&gt;';<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; $p = xml_parser_create();<br>&nbsp; &nbsp; xml_parse_into_struct($p, $data, $vals);<br>&nbsp; &nbsp; xml_parser_free($p);<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; $key = $output = array();<br>&nbsp;&nbsp; foreach ($vals as $id=&gt;$item) {<br>&nbsp; &nbsp; &nbsp; if ($item["type"]=="open" || $item["level"]&gt;count($key)) {// &amp;&amp; count($key)&lt;=$item["level"])<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; array_push($key, $id);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $temp = array("tag"=&gt;$item["tag"], "value"=&gt;"", "attributes"=&gt;array());<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; eval("\$output[".implode("][", $key)."] = \$temp;");<br>&nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; if ($item["type"]=="close" || $item["level"]&lt;count($key))// &amp;&amp; $item["level"]&gt;=count($key))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; array_pop($key);<br>&nbsp; &nbsp; &nbsp; if (isset($item["attributes"]))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; eval("\$output[".implode("][", $key)."]['attributes'] = array_merge(\$output[".implode("][", $key)."]['attributes'], \$item['attributes']);");<br>&nbsp; &nbsp; &nbsp; if (isset($item["value"]))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; eval("\$output[".implode("][", $key)."]['value'] .= \$item['value'];");<br>&nbsp;&nbsp; }<br>?&gt;</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->

  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from www.php.net/manual/en/function.xml-parse-into-struct.php by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 11 Sep 2021 06:32:50 GMT -->

</body></html>