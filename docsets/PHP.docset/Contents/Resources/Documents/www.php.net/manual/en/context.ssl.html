<html><!-- Mirrored from www.php.net/manual/en/context.ssl.php by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 11 Sep 2021 02:36:04 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>SSL context options</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="context.ssl.html">
 <link rel="shorturl" href="context.ssl.html">
 <link rel="alternate" href="context.ssl.html" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="context.html">
 <link rel="prev" href="context.ftp.html">
 <link rel="next" href="context.curl.html">

 <link rel="alternate" href="context.ssl.html" hreflang="en">
 <link rel="alternate" href="https://www.php.net/manual/pt_BR/context.ssl.php" hreflang="pt_BR">
 <link rel="alternate" href="https://www.php.net/manual/zh/context.ssl.php" hreflang="zh">
 <link rel="alternate" href="https://www.php.net/manual/fr/context.ssl.php" hreflang="fr">
 <link rel="alternate" href="https://www.php.net/manual/de/context.ssl.php" hreflang="de">
 <link rel="alternate" href="https://www.php.net/manual/ja/context.ssl.php" hreflang="ja">
 <link rel="alternate" href="https://www.php.net/manual/ro/context.ssl.php" hreflang="ro">
 <link rel="alternate" href="https://www.php.net/manual/ru/context.ssl.php" hreflang="ru">
 <link rel="alternate" href="https://www.php.net/manual/es/context.ssl.php" hreflang="es">
 <link rel="alternate" href="https://www.php.net/manual/tr/context.ssl.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached0aba.css?t=1539771603&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached2ecf.css?t=1539765004&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedba57.css?t=1606338002&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached3afa.css?t=1627831203&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="https://www.php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script>
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="https://www.php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script src="https://www.php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>


</head>
<body class="docs " style="">


<div class="headsup"><a href="https://www.php.net/conferences/index.php#id2021-09-08-1">Longhorn PHP 2021</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.errors.html">Errors</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.attributes.html">Attributes</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.sessions.html">Session Security</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
	<dd><a href="refs.ui.html">GUI Extensions</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
    <div id="breadcrumbs-inner">
          
              
          <ul>
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="langref.html">Language Reference</a></li>      <li><a href="context.html">Context options and parameters</a></li>      </ul>
    </div>
  </div>




<div id="layout" class="clearfix">
  <section id="layout-content">
  <div id="context.ssl" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">SSL context options</h1>
  <p class="refpurpose"><span class="refname">SSL context options</span> â€” <span class="dc-title">SSL context option listing</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-context.ssl-description">
  <h3 class="title">Description</h3>
  <p class="para">
   Context options for <code class="literal">ssl://</code> and <code class="literal">tls://</code>
   transports.
  </p>
 </div>


 <div class="refsect1 options" id="refsect1-context.ssl-options">
  <h3 class="title">Options</h3>
  <p class="para">
   </p><dl>
    
     <dt id="context.ssl.peer-name">
      <code class="parameter">peer_name</code>
      <span class="type">string</span>
     </dt>

     <dd>

      <p class="para">
       Peer name to be used. If this value is not set, then the name is guessed
       based on the hostname used when opening the stream.
      </p>
     </dd>

    
    
     <dt id="context.ssl.verify-peer">
      <code class="parameter">verify_peer</code>
      <span class="type">bool</span>
     </dt>

     <dd>

      <p class="para">
       Require verification of SSL certificate used.
      </p>
      <p class="para">
       Defaults to <strong><code>true</code></strong>.
      </p>
     </dd>

    
    
     <dt id="context.ssl.verify-peer-name">
      <code class="parameter">verify_peer_name</code>
      <span class="type">bool</span>
     </dt>

     <dd>

      <p class="para">
       Require verification of peer name.
      </p>
      <p class="para">
       Defaults to <strong><code>true</code></strong>.
      </p>
     </dd>

    
    
     <dt id="context.ssl.allow-self-signed">
      <code class="parameter">allow_self_signed</code>
      <span class="type">bool</span>
     </dt>

     <dd>

      <p class="para">
       Allow self-signed certificates. Requires
       <a href="context.ssl.html#context.ssl.verify-peer" class="link"><code class="parameter">verify_peer</code></a>.
      </p>
      <p class="para">
       Defaults to <strong><code>false</code></strong>
      </p>
     </dd>

    
    
     <dt id="context.ssl.cafile">
      <code class="parameter">cafile</code>
      <span class="type">string</span>
     </dt>

     <dd>

      <p class="para">
       Location of Certificate Authority file on local filesystem
       which should be used with the <code class="literal">verify_peer</code>
       context option to authenticate the identity of the remote peer.
      </p>
     </dd>

    
    
     <dt id="context.ssl.capath">
      <code class="parameter">capath</code>
      <span class="type">string</span>
     </dt>

     <dd>

      <p class="para">
       If <code class="literal">cafile</code> is not specified or if the certificate
       is not found there, the directory pointed to by <code class="literal">capath</code> 
       is searched for a suitable certificate.  <code class="literal">capath</code>
       must be a correctly hashed certificate directory.
      </p>
     </dd>

    
    
     <dt id="context.ssl.local-cert">
      <code class="parameter">local_cert</code>
      <span class="type">string</span>
     </dt>

     <dd>

      <p class="para">
       Path to local certificate file on filesystem.  It must be a PEM
       encoded file which contains your certificate and private key.
       It can optionally contain the certificate chain of issuers.
       The private key also may be contained in a separate file specified
       by <code class="literal">local_pk</code>.
      </p>
     </dd>

    
    
     <dt id="context.ssl.local-pk">
      <code class="parameter">local_pk</code>
      <span class="type">string</span>
     </dt>

     <dd>

      <p class="para">
       Path to local private key file on filesystem in case of separate
       files for certificate (<code class="literal">local_cert</code>) and private key.
      </p>
     </dd>

    
    
     <dt id="context.ssl.passphrase">
      <code class="parameter">passphrase</code>
      <span class="type">string</span>
     </dt>

     <dd>

      <p class="para">
       Passphrase with which your <code class="literal">local_cert</code> file
       was encoded.
      </p>
     </dd>

    
    
     <dt id="context.ssl.verify-depth">
      <code class="parameter">verify_depth</code>
      <span class="type">int</span>
     </dt>

     <dd>

      <p class="para">
       Abort if the certificate chain is too deep.
      </p>
      <p class="para">
       Defaults to no verification.
      </p>
     </dd>

    
    
     <dt id="context.ssl.ciphers">
      <code class="parameter">ciphers</code>
      <span class="type">string</span>
     </dt>

     <dd>

      <p class="para">
       Sets the list of available ciphers. The format of the string is described
       in <a href="https://www.openssl.org/docs/manmaster/man1/ciphers.html#CIPHER-LIST-FORMAT" class="link external">Â»&nbsp;ciphers(1)</a>.
      </p>
      <p class="para">
       Defaults to <code class="literal">DEFAULT</code>.
      </p>
     </dd>

    
    
     <dt id="context.ssl.capture-peer-cert">
      <code class="parameter">capture_peer_cert</code>
      <span class="type">bool</span>
     </dt>

     <dd>

      <p class="para">
       If set to <strong><code>true</code></strong> a <code class="literal">peer_certificate</code> context option
       will be created containing the peer certificate.
      </p>
     </dd>

    
    
     <dt id="context.ssl.capture-peer-cert-chain">
      <code class="parameter">capture_peer_cert_chain</code>
      <span class="type">bool</span>
     </dt>

     <dd>

      <p class="para">
       If set to <strong><code>true</code></strong> a <code class="literal">peer_certificate_chain</code> context
       option will be created containing the certificate chain.
      </p>
     </dd>

    
    
     <dt id="context.ssl.sni-enabled">
      <code class="parameter">SNI_enabled</code>
      <span class="type">bool</span>
     </dt>

     <dd>

      <p class="para">
       If set to <strong><code>true</code></strong> server name indication will be enabled. Enabling SNI 
       allows multiple certificates on the same IP address.
      </p>
     </dd>

    
    
     <dt id="context.ssl.disable-compression">
      <code class="parameter">disable_compression</code>
      <span class="type">bool</span>
     </dt>

     <dd>

      <p class="para">
       If set, disable TLS compression. This can help mitigate the CRIME attack
       vector. 
      </p>
     </dd>

    
    
     <dt id="context.ssl.peer-fingerprint">
      <code class="parameter">peer_fingerprint</code>
      <span class="type">string</span> | <span class="type">array</span>
     </dt>

     <dd>

      <p class="para">
       Aborts when the remote certificate digest doesn't match the specified
       hash.
      </p>
      <p class="para">
       When a <span class="type">string</span> is used, the length will determine which hashing algorithm
       is applied, either "md5" (32) or "sha1" (40).
      </p>
      <p class="para">
       When an <span class="type">array</span> is used, the keys indicate the hashing algorithm name
       and each corresponding value is the expected digest.
      </p>
     </dd>

    
    
     <dt id="context.ssl.security-level">
      <code class="parameter">security_level</code>
      <span class="type">int</span>
     </dt>

     <dd>

      <p class="para">
       Sets the security level. If not specified the library default security level is used.
       The security levels are described in 
       <a href="https://www.openssl.org/docs/man1.1.0/man3/SSL_CTX_get_security_level.html" class="link external">Â»&nbsp;SSL_CTX_get_security_level(3)</a>.
      </p>
      <p class="para">
       Available as of PHP 7.2.0 and OpenSSL 1.1.0.
      </p>
     </dd>

    
   </dl>

  <p></p>
 </div>

 
 <div class="refsect1 changelog" id="refsect1-context.ssl-changelog">
  <h3 class="title">Changelog</h3>
  <p class="para">
   </p><table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>Version</th>
       <th>Description</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>7.2.0</td>
       <td>
        Added <code class="parameter">security_levels</code>. Requires OpenSSL &gt;= 1.1.0.
       </td>
      </tr>

     </tbody>
    
   </table>

  <p></p>
 </div>


 <div class="refsect1 notes" id="refsect1-context.ssl-notes">
  <h3 class="title">Notes</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <span class="simpara">
    Because <code class="literal">ssl://</code> is the underlying transport for the
    <a href="wrappers.http.html" class="link"><code class="literal">https://</code></a> and
    <a href="wrappers.ftp.html" class="link"><code class="literal">ftps://</code></a> wrappers, 
    any context options which apply to <code class="literal">ssl://</code> also apply to
    <code class="literal">https://</code> and <code class="literal">ftps://</code>.
   </span>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <span class="simpara">
    For SNI (Server Name Indication) to be available, then PHP must be compiled 
    with OpenSSL 0.9.8j or greater. Use the 
    <strong><code>OPENSSL_TLSEXT_SERVER_NAME</code></strong> to determine whether SNI is 
    supported.
   </span>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-context.ssl-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   </p><ul class="simplelist">
    <li class="member"><a href="context.socket.html" class="xref">Socket context options</a></li>
   </ul>
  <p></p>
 </div>


</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="119844">  
  <a class="name">
  <strong class="user"><em>website at meezaan dot net</em></strong></a><div class="date" title="2016-09-05 01:48"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom119844">
<div class="phpcode"><code><span class="html">
There is also a crypto_type context. In older versions this was crypto_method. This is referenced on <a rel="nofollow" target="_blank">http://php.net/manual/en/function.stream-socket-enable-crypto.php</a></span>
</code></div>
  </div>
 </div>
  <div class="note" id="96328">  
  <a class="name">
  <strong class="user"><em>Botjan kufca</em></strong></a><div class="date" title="2010-02-20 11:11"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom96328">
<div class="phpcode"><code><span class="html">
CN_match works contrary to intuitive thinking. I came across this when I was developing SSL server implemented in PHP. I stated (in code): <br><br>- do not allow self signed certs (works)<br>- verify peer certs against CA cert (works)<br>- verify the client's CN against CN_match (does not work), like this:<br><br>stream_context_set_option($context, 'ssl', 'CN_match', '*.example.org');<br><br>I presumed this would match any client with CN below .example.org domain.<br>Unfortunately this is NOT the case. The option above does not do that.<br><br>What it really does is this:<br>- it takes client's CN and compares it to CN_match<br>- IF CLIENT's CN CONTAINS AN ASTERISK like *.example.org, then it is matched against CN_match in wildcard matching fashion<br><br>Examples to illustrate behaviour:<br>(CNM = server's CN_match)<br>(CCN = client's CN)<br><br>- CNM=host.example.org, CCN=host.example.org ---&gt; OK<br>- CNM=host.example.org, CCN=*.example.org ---&gt; OK<br>- CNM=.example.org, CCN=*.example.org ---&gt; OK<br>- CNM=example.org, CCN=*.example.org ---&gt; ERROR<br><br>- CNM=*.example.org, CCN=host.example.org ---&gt; ERROR<br>- CNM=*.example.org, CCN=*.example.org ---&gt; OK<br><br>According to PHP sources I believe that the same applies if you are trying to act as Client and the server contains a wildcard certificate. If you set CN_match to myserver.example.org and server presents itself with *.example.org, the connection is allowed.<br><br>Everything above applies to PHP version 5.2.12.<br>I will supply a patch to support CN_match starting with asterisk.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="120278">  
  <a class="name">
  <strong class="user"><em>Charlie</em></strong></a><div class="date" title="2016-12-05 07:53"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom120278">
<div class="phpcode"><code><span class="html">
I am unable to load a PEM that was generated with the stunnel tools. However, I am able to use PHP calls to generate a working PEM that is recognized both by stunnel and php, as outlined here:<br><br><a rel="nofollow" target="_blank">http://www.devdungeon.com/content/how-use-ssl-sockets-php</a><br><br>This code fragment is now working for me, and with stunnel verify=4, both sides confirm the fingerprint. Oddly, if "tls://" is set below, then TLSv1 is forced, but using "ssl://" allows TLSv1.2:<br><br>$stream_context = stream_context_create([ 'ssl' =&gt; [<br>'local_cert'&nbsp; &nbsp; &nbsp; &nbsp; =&gt; '/path/to/key.pem',<br>'peer_fingerprint'&nbsp; =&gt; openssl_x509_fingerprint(file_get_contents('/path/to/key.crt')),<br>'verify_peer'&nbsp; &nbsp; &nbsp;&nbsp; =&gt; false,<br>'verify_peer_name'&nbsp; =&gt; false,<br>'allow_self_signed' =&gt; true,<br>'verify_depth'&nbsp; &nbsp; &nbsp; =&gt; 0 ]]);<br><br>$fp = stream_socket_client('ssl://ssl.server.com:12345',<br>&nbsp;&nbsp; $errno, $errstr, 30, STREAM_CLIENT_CONNECT, $stream_context);<br>fwrite($fp, "foo bar\n");<br>while($line = fgets($fp, 8192)) echo $line;</span>
</code></div>
  </div>
 </div>
  <div class="note" id="114269">  
  <a class="name">
  <strong class="user"><em>borbas dot geri at gmail dot com</em></strong></a><div class="date" title="2014-01-31 12:06"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom114269">
<div class="phpcode"><code><span class="html">
I used this for Apple Push Notification Service.<br>Passed in a local certificate filename `cert.pem` trough local_cert option. <br>Worked fine, when invoked the script directly.<br><br>But when I included/required the script from a different location, it stopped working, without any explicit error message.<br><br>Resolved by passed in the full path for the file `&lt;FullPathTo&gt;cert.pem`.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="124605">  
  <a class="name">
  <strong class="user"><em>gabri dot ns at gmail dot com</em></strong></a><div class="date" title="2020-01-13 09:21"><strong>1 year ago</strong></div>
  <div class="text" id="Hcom124605">
<div class="phpcode"><code><span class="html">
i usually download root CA certificate from <a rel="nofollow" target="_blank">https://curl.haxx.se/docs/caextract.html</a> then put it as 'cafile' and it work almost all of the time.<br><br>the only problem i'v ever found is when the server does not properly sending intermediete CA certificate, then, you must add it manually to the file.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="123325">  
  <a class="name">
  <strong class="user"><em>mechtecs at gmail dot com</em></strong></a><div class="date" title="2018-11-09 01:09"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom123325">
<div class="phpcode"><code><span class="html">
If you want to validate the server against a local certificate, which you already saved, to further validate the target server, you have to use a fullchain.pem. Then the verify_peer option will work. So just get the server certificate, and search the root CA's pem's and copy everything into a single file. For example:<br><br>My certificate has the "GeoTrust TLS RSA CA G1" certificate in the chain, so you google that string. Go to the official digicert Geotrust page and download the "GeoTrustTLSRSACAG1.crt" certificate. Then you can use the following command to convert it into the pem format:<br>openssl x509 -inform DER -in GeoTrustTLSRSACAG1.crt -out GeoTrustTLSRSACAG1.crt.pem -outform PEM</span>
</code></div>
  </div>
 </div>
  <div class="note" id="120265">  
  <a class="name">
  <strong class="user"><em>Charlie</em></strong></a><div class="date" title="2016-12-02 07:28"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom120265">
<div class="phpcode"><code><span class="html">
It appears that "allow_self_signed" does not and cannot apply to the local_cert option.<br><br>The stunnel verify=4 option, which verifies but ignores a CA, has no analog in these settings, which is unfortunate.<br><br>Even more perplexingly, while the "openssl verify -CAfile" is successful, PHP appears unable to use the new ca/crt pair in any configuration.<br><br>I did actually link my PHP against a copy of LibreSSL 2.3.8, but PHP oddly is unable to use TLS1.1 or 1.2. It does, however, enable EC secp521r1 (of which my native OpenSSL 0.9.8e is incapable).</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->

  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from www.php.net/manual/en/context.ssl.php by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 11 Sep 2021 02:36:08 GMT -->

</body></html>