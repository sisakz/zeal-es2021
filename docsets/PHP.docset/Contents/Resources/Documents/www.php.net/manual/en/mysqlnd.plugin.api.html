<html><!-- Mirrored from www.php.net/manual/en/mysqlnd.plugin.api.php by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 11 Sep 2021 10:46:46 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>The mysqlnd plugin API</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="mysqlnd.plugin.api.html">
 <link rel="shorturl" href="mysqlnd.plugin.api.html">
 <link rel="alternate" href="mysqlnd.plugin.api.html" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="mysqlnd.plugin.html">
 <link rel="prev" href="mysqlnd.plugin.architecture.html">
 <link rel="next" href="mysqlnd.plugin.developing.html">

 <link rel="alternate" href="mysqlnd.plugin.api.html" hreflang="en">
 <link rel="alternate" href="https://www.php.net/manual/pt_BR/mysqlnd.plugin.api.php" hreflang="pt_BR">
 <link rel="alternate" href="https://www.php.net/manual/zh/mysqlnd.plugin.api.php" hreflang="zh">
 <link rel="alternate" href="https://www.php.net/manual/fr/mysqlnd.plugin.api.php" hreflang="fr">
 <link rel="alternate" href="https://www.php.net/manual/de/mysqlnd.plugin.api.php" hreflang="de">
 <link rel="alternate" href="https://www.php.net/manual/ja/mysqlnd.plugin.api.php" hreflang="ja">
 <link rel="alternate" href="https://www.php.net/manual/ro/mysqlnd.plugin.api.php" hreflang="ro">
 <link rel="alternate" href="https://www.php.net/manual/ru/mysqlnd.plugin.api.php" hreflang="ru">
 <link rel="alternate" href="https://www.php.net/manual/es/mysqlnd.plugin.api.php" hreflang="es">
 <link rel="alternate" href="https://www.php.net/manual/tr/mysqlnd.plugin.api.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached0aba.css?t=1539771603&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached2ecf.css?t=1539765004&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedba57.css?t=1606338002&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached3afa.css?t=1627831203&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="https://www.php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script>
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="https://www.php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script src="https://www.php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>


</head>
<body class="docs " style="">


<div class="headsup"><a href="https://www.php.net/conferences/index.php#id2021-09-08-1">Longhorn PHP 2021</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.errors.html">Errors</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.attributes.html">Attributes</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.sessions.html">Session Security</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
	<dd><a href="refs.ui.html">GUI Extensions</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
    <div id="breadcrumbs-inner">
          
              
          <ul>
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.database.html">Database Extensions</a></li>      <li><a href="refs.database.vendors.html">Vendor Specific Database Extensions</a></li>      <li><a href="set.mysqlinfo.html">MySQL</a></li>      <li><a href="book.mysqlnd.html">Mysqlnd</a></li>      <li><a href="mysqlnd.plugin.html">MySQL Native Driver Plugin API</a></li>      </ul>
    </div>
  </div>




<div id="layout" class="clearfix">
  <section id="layout-content">
  <div id="mysqlnd.plugin.api" class="section">
  <h2 class="title">The mysqlnd plugin API</h2>
  <p class="para">
   The following is a list of functions provided in the
   <code class="literal">mysqlnd</code> plugin API:
  </p>
  <ul class="itemizedlist">
   <li class="listitem">
    <p class="para">
     mysqlnd_plugin_register()
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     mysqlnd_plugin_count()
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     mysqlnd_plugin_get_plugin_connection_data()
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     mysqlnd_plugin_get_plugin_result_data()
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     mysqlnd_plugin_get_plugin_stmt_data()
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     mysqlnd_plugin_get_plugin_net_data()
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     mysqlnd_plugin_get_plugin_protocol_data()
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     mysqlnd_conn_get_methods()
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     mysqlnd_result_get_methods()
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     mysqlnd_result_meta_get_methods()
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     mysqlnd_stmt_get_methods()
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     mysqlnd_net_get_methods()
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     mysqlnd_protocol_get_methods()
    </p>
   </li>
  </ul>
  <p class="para">
   There is no formal definition of what a plugin is and how a plugin
   mechanism works.
  </p>
  <p class="para">
   Components often found in plugins mechanisms are:
  </p>
  <ul class="itemizedlist">
   <li class="listitem">
    <p class="para">
     A plugin manager
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     A plugin API
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     Application services (or modules)
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     Application service APIs (or module APIs)
    </p>
   </li>
  </ul>
  <p class="para">
   The <code class="literal">mysqlnd</code> plugin concept employs these features,
   and additionally enjoys an open architecture.
  </p>
  <p class="para">
   <em class="emphasis"> No Restrictions </em>
  </p>
  <p class="para">
   A plugin has full access to the inner workings of
   <code class="literal">mysqlnd</code>. There are no security limits or
   restrictions. Everything can be overwritten to implement friendly or
   hostile algorithms. It is recommended you only deploy plugins from a
   trusted source.
  </p>
  <p class="para">
   As discussed previously, plugins can use pointers freely. These
   pointers are not restricted in any way, and can point into another
   plugin's data. Simple offset arithmetic can be used to read another
   plugin's data.
  </p>
  <p class="para">
   It is recommended that you write cooperative plugins, and that you
   always call the parent method. The plugins should always cooperate
   with <code class="literal">mysqlnd</code> itself.
  </p>
  <table id="mysqlnd.plugin.chaining" class="doctable table">
   <caption><strong>Issues: an example of chaining and cooperation</strong></caption>
   
    <thead>
     <tr>
      <th>Extension</th>
      <th>mysqlnd.query() pointer</th>
      <th>call stack if calling parent</th>
     </tr>

    </thead>

    <tbody class="tbody">
     <tr>
      <td>ext/mysqlnd</td>
      <td>mysqlnd.query()</td>
      <td>mysqlnd.query</td>
     </tr>

     <tr>
      <td>ext/mysqlnd_cache</td>
      <td>mysqlnd_cache.query()</td>
      <td><ol type="1">
        <li class="listitem">
         <p class="para">
          mysqlnd_cache.query()
         </p>
        </li>
        <li class="listitem">
         <p class="para">
          mysqlnd.query
         </p>
        </li>
       </ol></td>
     </tr>

     <tr>
      <td>ext/mysqlnd_monitor</td>
      <td>mysqlnd_monitor.query()</td>
      <td><ol type="1">
        <li class="listitem">
         <p class="para">
          mysqlnd_monitor.query()
         </p>
        </li>
        <li class="listitem">
         <p class="para">
          mysqlnd_cache.query()
         </p>
        </li>
        <li class="listitem">
         <p class="para">
          mysqlnd.query
         </p>
        </li>
       </ol></td>
     </tr>

    </tbody>
   
  </table>

  <p class="para">
   In this scenario, a cache (<code class="literal">ext/mysqlnd_cache</code>) and
   a monitor (<code class="literal">ext/mysqlnd_monitor</code>) plugin are loaded.
   Both subclass <code class="literal">Connection::query()</code>. Plugin
   registration happens at <code class="literal">MINIT</code> using the logic
   shown previously. PHP calls extensions in alphabetical order by
   default. Plugins are not aware of each other and do not set extension
   dependencies.
  </p>
  <p class="para">
   By default the plugins call the parent implementation of the query
   method in their derived version of the method.
  </p>
  <p class="para">
   <em class="emphasis"> PHP Extension Recap </em>
  </p>
  <p class="para">
   This is a recap of what happens when using an example plugin,
   <code class="literal">ext/mysqlnd_plugin</code>, which exposes the
   <code class="literal">mysqlnd</code> C plugin API to PHP:
  </p>
  <ul class="itemizedlist">
   <li class="listitem">
    <p class="para">
     Any PHP MySQL application tries to establish a connection to
     192.168.2.29
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     The PHP application will either use <code class="literal">ext/mysql</code>,
     <code class="literal">ext/mysqli</code> or <code class="literal">PDO_MYSQL</code>. All
     three PHP MySQL extensions use <code class="literal">mysqlnd</code> to
     establish the connection to 192.168.2.29.
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     <code class="literal">Mysqlnd</code> calls its connect method, which has been
     subclassed by <code class="literal">ext/mysqlnd_plugin</code>.
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     <code class="literal">ext/mysqlnd_plugin</code> calls the userspace hook
     <code class="literal">proxy::connect()</code> registered by the user.
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     The userspace hook changes the connection host IP from 192.168.2.29
     to 127.0.0.1 and returns the connection established by
     <code class="literal">parent::connect()</code>.
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     <code class="literal">ext/mysqlnd_plugin</code> performs the equivalent of
     <code class="literal">parent::connect(127.0.0.1)</code> by calling the
     original <code class="literal">mysqlnd</code> method for establishing a
     connection.
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     <code class="literal">ext/mysqlnd</code> establishes a connection and returns
     to <code class="literal">ext/mysqlnd_plugin</code>.
     <code class="literal">ext/mysqlnd_plugin</code> returns as well.
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     Whatever PHP MySQL extension had been used by the application, it
     receives a connection to 127.0.0.1. The PHP MySQL extension itself
     returns to the PHP application. The circle is closed.
    </p>
   </li>
  </ul>
 </div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div>
 <div class="note">There are no user contributed notes for this page.</div></section>    </section><!-- layout-content -->
        


  </div><!-- layout -->

  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from www.php.net/manual/en/mysqlnd.plugin.api.php by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 11 Sep 2021 10:46:46 GMT -->

</body></html>