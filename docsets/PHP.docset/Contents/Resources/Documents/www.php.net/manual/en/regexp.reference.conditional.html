<html><!-- Mirrored from www.php.net/manual/en/regexp.reference.conditional.php by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 11 Sep 2021 10:47:47 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Conditional subpatterns</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="regexp.reference.conditional.html">
 <link rel="shorturl" href="regexp.reference.conditional.html">
 <link rel="alternate" href="regexp.reference.conditional.html" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="reference.pcre.pattern.syntax.html">
 <link rel="prev" href="regexp.reference.onlyonce.html">
 <link rel="next" href="regexp.reference.comments.html">

 <link rel="alternate" href="regexp.reference.conditional.html" hreflang="en">
 <link rel="alternate" href="https://www.php.net/manual/pt_BR/regexp.reference.conditional.php" hreflang="pt_BR">
 <link rel="alternate" href="https://www.php.net/manual/zh/regexp.reference.conditional.php" hreflang="zh">
 <link rel="alternate" href="https://www.php.net/manual/fr/regexp.reference.conditional.php" hreflang="fr">
 <link rel="alternate" href="https://www.php.net/manual/de/regexp.reference.conditional.php" hreflang="de">
 <link rel="alternate" href="https://www.php.net/manual/ja/regexp.reference.conditional.php" hreflang="ja">
 <link rel="alternate" href="https://www.php.net/manual/ro/regexp.reference.conditional.php" hreflang="ro">
 <link rel="alternate" href="https://www.php.net/manual/ru/regexp.reference.conditional.php" hreflang="ru">
 <link rel="alternate" href="https://www.php.net/manual/es/regexp.reference.conditional.php" hreflang="es">
 <link rel="alternate" href="https://www.php.net/manual/tr/regexp.reference.conditional.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached0aba.css?t=1539771603&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached2ecf.css?t=1539765004&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedba57.css?t=1606338002&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached3afa.css?t=1627831203&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="https://www.php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script>
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="https://www.php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script src="https://www.php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>


</head>
<body class="docs " style="">


<div class="headsup"><a href="https://www.php.net/conferences/index.php#id2021-09-08-1">Longhorn PHP 2021</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.errors.html">Errors</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.attributes.html">Attributes</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.sessions.html">Session Security</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
	<dd><a href="refs.ui.html">GUI Extensions</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
    <div id="breadcrumbs-inner">
          
              
          <ul>
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.basic.text.html">Text Processing</a></li>      <li><a href="book.pcre.html">PCRE</a></li>      <li><a href="pcre.pattern.html">PCRE Patterns</a></li>      <li><a href="reference.pcre.pattern.syntax.html">PCRE regex syntax</a></li>      </ul>
    </div>
  </div>




<div id="layout" class="clearfix">
  <section id="layout-content">
  <div id="regexp.reference.conditional" class="section">
  <h2 class="title">Conditional subpatterns</h2>
  <p class="para">
   It is possible to cause the matching process to obey a  subpattern
   conditionally  or to choose between two alternative
   subpatterns, depending on the result  of  an  assertion,  or
   whether  a previous capturing subpattern matched or not. The
   two possible forms of conditional subpattern are
  </p>

  <div class="informalexample">
   <div class="example-contents">
<div class="cdata"><pre>(?(condition)yes-pattern)
(?(condition)yes-pattern|no-pattern)
</pre></div>
   </div>

  </div>
  <p class="para">
   If the condition is satisfied, the yes-pattern is used; otherwise
   the  no-pattern  (if  present) is used. If there are
   more than two alternatives in the subpattern, a compile-time
   error occurs.
  </p>
  <p class="para">
   There are two kinds of condition. If the  text  between  the
   parentheses  consists  of  a  sequence  of  digits, then the
   condition is satisfied if the capturing subpattern  of  that
   number  has  previously matched. Consider the following pattern,
   which contains non-significant white space to make  it
   more  readable  (assume  the  <a href="reference.pcre.pattern.modifiers.html" class="link">PCRE_EXTENDED</a>
   option)  and to divide it into three parts for ease of discussion:
  </p>
  <div class="informalexample">
   <div class="example-contents">
<div class="cdata"><pre>( \( )?    [^()]+    (?(1) \) )
</pre></div>
   </div>

  </div>
  <p class="para">
   The first part matches an optional opening parenthesis,  and
   if  that character is present, sets it as the first captured
   substring. The second part matches one  or  more  characters
   that  are  not  parentheses. The third part is a conditional
   subpattern that tests whether the first set  of  parentheses
   matched  or  not.  If  they did, that is, if subject started
   with an opening parenthesis, the condition is <strong><code>true</code></strong>,  and  so
   the  yes-pattern  is  executed  and a closing parenthesis is
   required. Otherwise, since no-pattern is  not  present,  the
   subpattern  matches  nothing.  In  other words, this pattern
   matches a sequence of non-parentheses,  optionally  enclosed
   in parentheses.
  </p>
  <p class="para">
   If the condition is the string <code class="literal">(R)</code>, it is satisfied if
   a recursive call to the pattern or subpattern has been made. At "top
   level", the condition is false.
  </p>
  <p class="para">
   If the condition is not a sequence of digits or (R), it must be  an
   assertion.  This  may be a positive or negative lookahead or
   lookbehind assertion. Consider this pattern, again  containing
   non-significant  white space, and with the two alternatives on
   the second line:
  </p>

  <div class="informalexample">
   <div class="example-contents">
<div class="cdata"><pre>(?(?=[^a-z]*[a-z])
\d{2}-[a-z]{3}-\d{2}  |  \d{2}-\d{2}-\d{2} )
</pre></div>
   </div>

  </div>
  <p class="para">
   The condition is a positive lookahead assertion that matches
   an optional sequence of non-letters followed by a letter. In
   other words, it tests for  the  presence  of  at  least  one
   letter  in the subject. If a letter is found, the subject is
   matched against  the  first  alternative;  otherwise  it  is
   matched  against the second. This pattern matches strings in
   one of the two forms dd-aaa-dd or dd-dd-dd,  where  aaa  are
   letters and dd are digits.
  </p>
 </div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="102285">  
  <a class="name">
  <strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2011-02-06 09:26"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom102285">
<div class="phpcode"><code><span class="html">
Repetition of a subpattern will repeat conditionals that are contained inside it, updating subpattern matches with iteration.
<br>
<br>Consider the following code, which scans thru HTML, keeping track of angle brackets "&lt;" "&gt;".&nbsp; If open bracket "&lt;" matches, then closing bracket "&gt;" must follow before repetition can possibly end.&nbsp; That way regex will effectively match only outside of tags. 
<br>
<br><span class="default">&lt;?php
<br>$pattern</span><span class="keyword">=</span><span class="string">'%(*ANY)(.*?(&lt;)(?(2).*?&gt;)(.*?))*?\'\'%s'</span><span class="keyword">;
<br></span><span class="default">$replace</span><span class="keyword">=</span><span class="string">'\1Fred'</span><span class="keyword">;
<br></span><span class="default">$subject</span><span class="keyword">=
<br></span><span class="string">'&lt;html&gt;&lt;body class=\'\'&gt;\'\' went to '</span><span class="keyword">\</span><span class="string">'\meyer and ran 
<br>into &lt;b&gt;\'\'&lt;/b&gt;.
<br>&lt;/body&gt;&lt;/html&gt;'
<br></span><span class="keyword">echo </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"%(*ANY)(.*?((&lt;)(?(3).*?&gt;).*?)*?)\'\'%s"</span><span class="keyword">,</span><span class="string">'\1Fred'</span><span class="keyword">,</span><span class="default">$subject</span><span class="keyword">);
<br></span><span class="default">?&gt;
<br></span>
<br>Output will be:
<br>'&lt;html&gt;&lt;body class=\'\'&gt;Fred went to Fredmeyer and ran 
<br>into &lt;b&gt;Fred&lt;/b&gt;.
<br>&lt;/body&gt;&lt;/html&gt;'</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->

  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from www.php.net/manual/en/regexp.reference.conditional.php by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 11 Sep 2021 10:47:47 GMT -->

</body></html>