<html><!-- Mirrored from www.php.net/manual/en/function.imap-append.php by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 11 Sep 2021 06:22:31 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>imap_append</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.imap-append.html">
 <link rel="shorturl" href="https://www.php.net/imap-append">
 <link rel="alternate" href="https://www.php.net/imap-append" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.imap.html">
 <link rel="prev" href="function.imap-alerts.html">
 <link rel="next" href="function.imap-base64.html">

 <link rel="alternate" href="function.imap-append.html" hreflang="en">
 <link rel="alternate" href="https://www.php.net/manual/pt_BR/function.imap-append.php" hreflang="pt_BR">
 <link rel="alternate" href="https://www.php.net/manual/zh/function.imap-append.php" hreflang="zh">
 <link rel="alternate" href="https://www.php.net/manual/fr/function.imap-append.php" hreflang="fr">
 <link rel="alternate" href="https://www.php.net/manual/de/function.imap-append.php" hreflang="de">
 <link rel="alternate" href="https://www.php.net/manual/ja/function.imap-append.php" hreflang="ja">
 <link rel="alternate" href="https://www.php.net/manual/ro/function.imap-append.php" hreflang="ro">
 <link rel="alternate" href="https://www.php.net/manual/ru/function.imap-append.php" hreflang="ru">
 <link rel="alternate" href="https://www.php.net/manual/es/function.imap-append.php" hreflang="es">
 <link rel="alternate" href="https://www.php.net/manual/tr/function.imap-append.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached0aba.css?t=1539771603&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached2ecf.css?t=1539765004&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedba57.css?t=1606338002&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached3afa.css?t=1627831203&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="https://www.php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script>
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="https://www.php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script src="https://www.php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>


</head>
<body class="docs " style="">


<div class="headsup"><a href="https://www.php.net/conferences/index.php#id2021-09-08-1">Longhorn PHP 2021</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.errors.html">Errors</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.attributes.html">Attributes</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.sessions.html">Session Security</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
	<dd><a href="refs.ui.html">GUI Extensions</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
    <div id="breadcrumbs-inner">
          
              
          <ul>
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.remote.mail.html">Mail Related Extensions</a></li>      <li><a href="book.imap.html">IMAP</a></li>      <li><a href="ref.imap.html">IMAP Functions</a></li>      </ul>
    </div>
  </div>




<div id="layout" class="clearfix">
  <section id="layout-content">
  <div id="function.imap-append" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">imap_append</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">imap_append</span> â€” <span class="dc-title">Append a string message to a specified mailbox</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.imap-append-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>imap_append</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">resource</span> <code class="parameter">$imap</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$folder</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$message</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">?</span><span class="type"><span class="type">string</span><span class="type"></span></span> <code class="parameter">$options</code><span class="initializer"> = <strong><code>null</code></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">?</span><span class="type"><span class="type">string</span><span class="type"></span></span> <code class="parameter">$internal_date</code><span class="initializer"> = <strong><code>null</code></strong></span></span><br>): <span class="type">bool</span></div>

  <p class="para rdfs-comment">
   Appends a string <code class="parameter">message</code> to the specified <code class="parameter">folder</code>. 
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.imap-append-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>
    <dt>
<code class="parameter">
imap</code></dt>
<dd>
<p class="para">An IMAP stream returned by
<span class="function"><a href="function.imap-open.html" class="function">imap_open()</a></span>.</p></dd>

    
     <dt>
<code class="parameter">folder</code></dt>

     <dd>

      <p class="para">
       The mailbox name, see <span class="function"><a href="function.imap-open.html" class="function">imap_open()</a></span> for more
       information
      </p>
      <div class="warning"><strong class="warning">Warning</strong><p class="simpara">
Passing untrusted data to this parameter is <em class="emphasis">insecure</em>, unless
<a href="imap.configuration.html#ini.imap.enable-insecure-rsh" class="link">imap.enable_insecure_rsh</a> is disabled.
</p></div>
     </dd>

    
    
     <dt>
<code class="parameter">message</code></dt>

     <dd>

      <p class="para">
       The message to be append, as a string
      </p>
      <p class="para">
       When talking to the Cyrus IMAP server, you must use "\r\n" as
       your end-of-line terminator instead of "\n" or the operation will
       fail
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">options</code></dt>

     <dd>

      <p class="para">
       If provided, the <code class="parameter">options</code> will also be written
       to the <code class="parameter">folder</code>
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">internal_date</code></dt>

     <dd>

      <p class="para">
       If this parameter is set, it will set the INTERNALDATE on the appended message.  The parameter should be a date string that conforms to the rfc2060 specifications for a date_time value.
      </p>
     </dd>

    
   </dl>

  <p></p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.imap-append-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns <strong><code>true</code></strong> on success or <strong><code>false</code></strong> on failure.
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.imap-append-changelog">
  <h3 class="title">Changelog</h3>
  <table class="doctable informaltable">
   
    <thead>
     <tr>
      <th>Version</th>
      <th>Description</th>
     </tr>

    </thead>

    <tbody class="tbody">
     <tr>
      <td>8.0.0</td>
      <td>
       <code class="parameter">options</code> and <code class="parameter">internal_date</code> are now nullable.
      </td>
     </tr>

    </tbody>
   
  </table>

 </div>


 <div class="refsect1 examples" id="refsect1-function.imap-append-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   </p><div class="example" id="example-2955">
    <p><strong>Example #1 <span class="function"><strong>imap_append()</strong></span> example</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br>$stream&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imap_open</span><span style="color: #007700">(</span><span style="color: #DD0000">"{imap.example.org}INBOX.Drafts"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"username"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"password"</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">$check&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imap_check</span><span style="color: #007700">(</span><span style="color: #0000BB">$stream</span><span style="color: #007700">);<br>echo&nbsp;</span><span style="color: #DD0000">"Msg&nbsp;Count&nbsp;before&nbsp;append:&nbsp;"</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$check</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">Nmsgs&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br><br></span><span style="color: #0000BB">imap_append</span><span style="color: #007700">(</span><span style="color: #0000BB">$stream</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"{imap.example.org}INBOX.Drafts"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"From:&nbsp;me@example.com\r\n"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"To:&nbsp;you@example.com\r\n"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"Subject:&nbsp;test\r\n"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\r\n"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"this&nbsp;is&nbsp;a&nbsp;test&nbsp;message,&nbsp;please&nbsp;ignore\r\n"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">$check&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imap_check</span><span style="color: #007700">(</span><span style="color: #0000BB">$stream</span><span style="color: #007700">);<br>echo&nbsp;</span><span style="color: #DD0000">"Msg&nbsp;Count&nbsp;after&nbsp;append&nbsp;:&nbsp;"</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$check</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">Nmsgs&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br><br></span><span style="color: #0000BB">imap_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$stream</span><span style="color: #007700">);<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  <p></p>
 </div>

</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="106637">  
  <a class="name">
  <strong class="user"><em>bill at dyndns dot org</em></strong></a><div class="date" title="2011-11-23 11:45"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom106637">
<div class="phpcode"><code><span class="html">
Here is how I used this function with an attachment. I used examples from everyone else but made it easier and cleaner to change.
<br>
<br><span class="default">&lt;?php
<br>$authhost</span><span class="keyword">=</span><span class="string">"{000.000.000.000:993/validate-cert/ssl}Drafts"</span><span class="keyword">;
<br>
<br></span><span class="default">$user</span><span class="keyword">=</span><span class="string">"sadasd"</span><span class="keyword">;
<br></span><span class="default">$pass</span><span class="keyword">=</span><span class="string">"sadasd"</span><span class="keyword">;
<br>
<br>if (</span><span class="default">$mbox</span><span class="keyword">=</span><span class="default">imap_open</span><span class="keyword">( </span><span class="default">$authhost</span><span class="keyword">, </span><span class="default">$user</span><span class="keyword">, </span><span class="default">$pass</span><span class="keyword">))
<br>{
<br>&nbsp; &nbsp; </span><span class="default">$dmy</span><span class="keyword">=</span><span class="default">date</span><span class="keyword">(</span><span class="string">"d-M-Y H:i:s"</span><span class="keyword">);
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="default">$filename</span><span class="keyword">=</span><span class="string">"filename.pdf"</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$attachment </span><span class="keyword">= </span><span class="default">chunk_split</span><span class="keyword">(</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$filestring</span><span class="keyword">));
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="default">$boundary </span><span class="keyword">= </span><span class="string">"------="</span><span class="keyword">.</span><span class="default">md5</span><span class="keyword">(</span><span class="default">uniqid</span><span class="keyword">(</span><span class="default">rand</span><span class="keyword">()));
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="default">$msg </span><span class="keyword">= (</span><span class="string">"From: Somebody\r\n"
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"To: test@example.co.uk\r\n"
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"Date: </span><span class="default">$dmy</span><span class="string">\r\n"
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"Subject: This is the subject\r\n"
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"MIME-Version: 1.0\r\n"
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"Content-Type: multipart/mixed; boundary=\"</span><span class="default">$boundary</span><span class="string">\"\r\n"
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"\r\n\r\n"
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"--</span><span class="default">$boundary</span><span class="string">\r\n"
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"Content-Type: text/html;\r\n\tcharset=\"ISO-8859-1\"\r\n"
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"Content-Transfer-Encoding: 8bit \r\n"
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"\r\n\r\n"
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"Hello this is a test\r\n"
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"\r\n\r\n"
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"--</span><span class="default">$boundary</span><span class="string">\r\n"
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"Content-Transfer-Encoding: base64\r\n"
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"Content-Disposition: attachment; filename=\"</span><span class="default">$filename</span><span class="string">\"\r\n"
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"\r\n" </span><span class="keyword">. </span><span class="default">$attachment </span><span class="keyword">. </span><span class="string">"\r\n"
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"\r\n\r\n\r\n"
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"--</span><span class="default">$boundary</span><span class="string">--\r\n\r\n"</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="default">imap_append</span><span class="keyword">(</span><span class="default">$mbox</span><span class="keyword">,</span><span class="default">$authhost</span><span class="keyword">,</span><span class="default">$msg</span><span class="keyword">, </span><span class="string">"\\Draft"</span><span class="keyword">); 
<br>
<br>&nbsp; &nbsp; </span><span class="default">imap_close</span><span class="keyword">(</span><span class="default">$mbox</span><span class="keyword">);
<br>}
<br>else
<br>{
<br>&nbsp; &nbsp; echo </span><span class="string">"&lt;h1&gt;FAIL!&lt;/h1&gt;\n"</span><span class="keyword">;
<br>}
<br>
<br></span><span class="default">?&gt;
<br></span>
<br>Hope this helps someone.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="111461">  
  <a class="name">
  <strong class="user"><em>rixsta at hotmail dot com</em></strong></a><div class="date" title="2013-02-21 08:59"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom111461">
<div class="phpcode"><code><span class="html">
Hi,<br><br>As we have been struggling with this for some time I wanted to share how we got imap_append working properly with all MIME parts including attachments.&nbsp; If you are sending email and also wish to append the sent message to the Sent Items folder, I cannot think of an easier way to do this, as follows:<br><br>1) Use SwiftMailer to send the message via PHP.<br>$message = Swift_Message::newInstance("Subject goes here");<br>(then add from, to, body, attachments etc)<br>$result = $mailer-&gt;send($message);<br><br>2) When you construct the message in step 1) above save it to a variable as follows:<br><br>$msg = $message-&gt;toString(); (this creates the full MIME message required for imap_append()!!&nbsp; After this you can call imap_append like this:<br><br>imap_append($imap_conn,$mail_box,$msg."\r\n","\\Seen");<br><br>I hope this helps the readers, and prevents saves people from doing what we started doing - hand crafting the MIME messages :-0</span>
</code></div>
  </div>
 </div>
  <div class="note" id="119768">  
  <a class="name">
  <strong class="user"><em>nanomoow at gmail dot com</em></strong></a><div class="date" title="2016-08-20 06:38"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom119768">
<div class="phpcode"><code><span class="html">
// this works for me, better version :]. <br><span class="default">&lt;?php<br>$fn </span><span class="keyword">= </span><span class="string">'filename.zip'</span><span class="keyword">;<br></span><span class="default">$IMAPhost </span><span class="keyword">= </span><span class="string">'imap.hostname.com'</span><span class="keyword">;<br></span><span class="comment">// IMAP port 143, 995 or POP3 port 110, 995<br></span><span class="default">$IMAPport </span><span class="keyword">= </span><span class="string">'143'</span><span class="keyword">;<br></span><span class="default">$IMAPssl </span><span class="keyword">= </span><span class="string">'tls'</span><span class="keyword">;<br></span><span class="default">$IMAP </span><span class="keyword">= </span><span class="string">'{'</span><span class="keyword">.</span><span class="default">$IMAPhost</span><span class="keyword">.</span><span class="string">':'</span><span class="keyword">.</span><span class="default">$IMAPport</span><span class="keyword">.</span><span class="string">'/imap/'</span><span class="keyword">.</span><span class="default">$IMAPssl</span><span class="keyword">.</span><span class="string">'/novalidate-cert}'</span><span class="keyword">;<br></span><span class="default">$IMAPuser </span><span class="keyword">= </span><span class="string">'hello@hostname.com'</span><span class="keyword">;&nbsp; &nbsp; &nbsp;&nbsp; <br></span><span class="default">$msg </span><span class="keyword">=</span><span class="string">'Message text &lt;h1 style="color: #093"&gt; Hello &lt;/h1&gt;'</span><span class="keyword">;<br></span><span class="comment">// imap email and password<br></span><span class="default">$ibox </span><span class="keyword">= </span><span class="default">imap_open</span><span class="keyword">(</span><span class="default">$IMAP</span><span class="keyword">, </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'email'</span><span class="keyword">], </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'pass'</span><span class="keyword">]);<br></span><span class="default">$dmy</span><span class="keyword">=</span><span class="default">date</span><span class="keyword">(</span><span class="string">"Y-m-d H:i:s"</span><span class="keyword">);<br></span><span class="comment">// pack file contents<br></span><span class="default">$attachment </span><span class="keyword">= </span><span class="default">chunk_split</span><span class="keyword">(</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">'tmp/'</span><span class="keyword">.</span><span class="default">$fn</span><span class="keyword">))); <br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$boundary1 </span><span class="keyword">= </span><span class="string">"###"</span><span class="keyword">.</span><span class="default">md5</span><span class="keyword">(</span><span class="default">microtime</span><span class="keyword">()).</span><span class="string">"###"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$boundary2 </span><span class="keyword">= </span><span class="string">"###"</span><span class="keyword">.</span><span class="default">md5</span><span class="keyword">(</span><span class="default">microtime</span><span class="keyword">().</span><span class="default">rand</span><span class="keyword">(</span><span class="default">99</span><span class="keyword">,</span><span class="default">999</span><span class="keyword">)).</span><span class="string">"###"</span><span class="keyword">; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imap_append</span><span class="keyword">(</span><span class="default">$ibox</span><span class="keyword">, </span><span class="default">$IMAP</span><span class="keyword">.</span><span class="string">"Send"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">, </span><span class="string">"From: Hello &lt;"</span><span class="keyword">.</span><span class="default">$IMAPuser</span><span class="keyword">.</span><span class="string">"&gt;\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"To: "</span><span class="keyword">.</span><span class="default">$email</span><span class="keyword">.</span><span class="string">"\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"Date: </span><span class="default">$dmy</span><span class="string">\r\n" <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"Subject: "</span><span class="keyword">.</span><span class="default">quoted_printable_encode</span><span class="keyword">(</span><span class="default">$sub</span><span class="keyword">).</span><span class="string">"\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"MIME-Version: 1.0\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"Content-Type: multipart/mixed; boundary=\"</span><span class="default">$boundary1</span><span class="string">\"\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"\r\n\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"--</span><span class="default">$boundary1</span><span class="string">\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"Content-Type: multipart/alternative; boundary=\"</span><span class="default">$boundary2</span><span class="string">\"\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"\r\n\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// ADD Plain text data<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"--</span><span class="default">$boundary2</span><span class="string">\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"Content-Type: text/plain; charset=\"utf-8\"\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"Content-Transfer-Encoding: quoted-printable\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"\r\n\r\n" <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="default">$msg</span><span class="keyword">.</span><span class="string">"\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"\r\n\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// ADD Html content<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"--</span><span class="default">$boundary2</span><span class="string">\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"Content-Type: text/html; charset=\"utf-8\"\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"Content-Transfer-Encoding: quoted-printable \r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"\r\n\r\n" <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="default">html_entity_decode</span><span class="keyword">(</span><span class="default">$msg</span><span class="keyword">).</span><span class="string">"\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"\r\n\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"--</span><span class="default">$boundary2</span><span class="string">\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"\r\n\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// ADD attachment(s)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"--</span><span class="default">$boundary1</span><span class="string">\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"Content-Type: image/gif; name=\"</span><span class="default">$fn</span><span class="string">\"\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"Content-Transfer-Encoding: base64\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"Content-Disposition: attachment; filename=\"</span><span class="default">$fn</span><span class="string">\"\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"\r\n\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="default">$attachment <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"\r\n\r\n"&nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"--</span><span class="default">$boundary1</span><span class="string">--\r\n\r\n" <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">);<br><br></span><span class="comment">// nigdy wiÄ™cej takich dziwactw :) ble..<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="33356">  
  <a class="name">
  <strong class="user"><em>bithive</em></strong></a><div class="date" title="2003-06-23 03:26"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom33356">
<div class="phpcode"><code><span class="html">
The parameter description is misleading.&nbsp; You can pass a string of flags such as '\Seen' [see imap_setflag_full()] as the last argument.&nbsp; In the other imap functions, 'options' seems to usually refer to a bitmask, not message flags.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="99407">  
  <a class="name">
  <strong class="user"><em>kaminski at istori dot com</em></strong></a><div class="date" title="2010-08-15 08:52"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom99407">
<div class="phpcode"><code><span class="html">
The date format string to use when creating $internal_date is 'd-M-Y H:i:s O'.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="117277">  
  <a class="name">
  <strong class="user"><em>Krzysiek</em></strong></a><div class="date" title="2015-05-15 12:18"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom117277">
<div class="phpcode"><code><span class="html">
You can use PHPMailer ( <a rel="nofollow" target="_blank">https://github.com/PHPMailer/PHPMailer/</a> ) with imap.<br><br><span class="default">&lt;?php<br></span><span class="comment">// after creating content of mail you have to run preSend() - part of send() method<br></span><span class="default">$mail</span><span class="keyword">-&gt;</span><span class="default">send</span><span class="keyword">();<br></span><span class="comment">// and you can get whole raw message with getSentMIMEMessage() method<br></span><span class="default">imap_append</span><span class="keyword">(</span><span class="default">$imap</span><span class="keyword">, </span><span class="default">$mailserver</span><span class="keyword">.</span><span class="string">'INBOX.Sent'</span><span class="keyword">,</span><span class="default">$mail</span><span class="keyword">-&gt;</span><span class="default">getSentMIMEMessage</span><span class="keyword">(), </span><span class="string">"\\Seen"</span><span class="keyword">);</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="74907">  
  <a class="name">
  <strong class="user"><em>jille at DIESPAMMERShexon dot cx</em></strong></a><div class="date" title="2007-05-03 07:36"><strong>14 years ago</strong></div>
  <div class="text" id="Hcom74907">
<div class="phpcode"><code><span class="html">
The last argument, $options, are flags like for use with imap_setflag_full.<br>It took a while before I found out</span>
</code></div>
  </div>
 </div>
  <div class="note" id="123429">  
  <a class="name">
  <strong class="user"><em>scott at threeam dot com dot au</em></strong></a><div class="date" title="2018-12-13 10:02"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom123429">
<div class="phpcode"><code><span class="html">
From my testing today, if using PHPMailer to send to an Exchange based IMAP server with an attachment or embedded image greater than 7kb, you will need to change the line returns from unix format to windows format. I simply did a string replace on '\n' and replaced with '\r\n' to get this done.<br><br>$content =&nbsp; str_replace("\n", "\r\n", $mail-&gt;getSentMIMEMessage());<br>$result = imap_append($imapStream, $path, $content);</span>
</code></div>
  </div>
 </div>
  <div class="note" id="72397">  
  <a class="name">
  <strong class="user"><em>svicentemolina at gmail dot com</em></strong></a><div class="date" title="2007-01-17 07:57"><strong>14 years ago</strong></div>
  <div class="text" id="Hcom72397">
<div class="phpcode"><code><span class="html">
I have used this function to copy all the emails of one account from one server to another. The problem was that this function don't copy the original receiving date for each message.<br>To add a fifth field to provide the date, I have made some changes at some php source files following the steps described in <a rel="nofollow" target="_blank">http://www.zend.com/lists/php-dev/200303/msg00843.html</a> and it has worked fine.<br>The correct date format is the returned by the function mail_date in c-client/mail.c source file, for instance: "17-Jan-2007 10:00:01 +0100"</span>
</code></div>
  </div>
 </div>
  <div class="note" id="121522">  
  <a class="name">
  <strong class="user"><em>Mime email format example</em></strong></a><div class="date" title="2017-08-14 09:22"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom121522">
<div class="phpcode"><code><span class="html">
Mime message example (smtp telnet DATA example):<br><br>From: from@ccc.cc<br>To: to@@ccc.cc<br>Subject: Example Email<br>MIME-Version: 1.0<br>Content-Type: multipart/mixed; boundary="MixedBoundaryString"<br><br>--MixedBoundaryString<br>Content-Type: multipart/related; boundary="RelatedBoundaryString"<br><br>--RelatedBoundaryString<br>Content-Type: multipart/alternative; boundary="AlternativeBoundaryString"<br><br>--AlternativeBoundaryString<br>Content-Type: text/plain;charset="utf-8"<br>Content-Transfer-Encoding: quoted-printable<br><br>This is the plain text part of the email.<br><br>--AlternativeBoundaryString<br>Content-Type: text/html;charset="utf-8"<br>Content-Transfer-Encoding: quoted-printable<br><br>&lt;html&gt;<br>&nbsp; &lt;body&gt;=0D<br>&nbsp; &nbsp; &lt;img src=3D=22cid:masthead.png=40ccc.cc=22 width 800 height=3D80=<br> =5C&gt;=0D<br>&nbsp; &nbsp; &lt;p&gt;This is the html part of the email.&lt;/p&gt;=0D<br>&nbsp; &nbsp; &lt;img src=3D=22cid:logo.png=40ccc.cc=22 width 200 height=3D60 =5C=<br>&gt;=0D<br>&nbsp; &lt;/body&gt;=0D<br>&lt;/html&gt;=0D<br><br>--AlternativeBoundaryString--<br><br>--RelatedBoundaryString<br>Content-Type: image/jpgeg;name="logo.png"<br>Content-Transfer-Encoding: base64<br>Content-Disposition: inline;filename="logo.png"<br>Content-ID: &lt;logo.png@ccc.cc&gt;<br><br>amtsb2hiaXVvbHJueXZzNXQ2XHVmdGd5d2VoYmFmaGpremxidTh2b2hydHVqd<br>dWkgb2l1b3NydGhpdXRvZ2hqdWlyb2h5dWd0aXJlaHN1aWhndXNpaHhidnVqZ<br>a25qbW9nNXRwbF0nemVycHpvemlnc3k5aDZqcm9wdHo7amlodDhpOTA4N3U5<br>LGZ2cDBbZWRzcm85eWo1Zmtsc2xrZ3g=<br><br>--RelatedBoundaryString<br>Content-Type: image/jpgeg;name="masthead.png"<br>Content-Transfer-Encoding: base64<br>Content-Disposition: inline;filename="masthead.png"<br>Content-ID: &lt;masthead.png@ccc.cc&gt;<br><br>aXR4ZGh5Yjd1OHk3MzQ4eXFndzhpYW9wO2tibHB6c2tqOTgwNXE0aW9qYWJ6aX<br>dGlmOTA0cW05dGkwbWk0OXQwYVttaXZvcnBhXGtsbGo7emt2c2pkZnI7Z2lwb2F<br>eXN6dWdoeXhiNzhuZzdnaHQ3eW9zemlqb2FqZWt0cmZ1eXZnamhka3JmdDg3aXV2dWd5aGVidXdz<br>dhyuhehe76YTGSFGA=<br><br>--RelatedBoundaryString--<br><br>--MixedBoundaryString<br>Content-Type: application/pdf;name="Invoice_1.pdf"<br>Content-Transfer-Encoding: base64<br>Content-Disposition: attachment;filename="Invoice_1.pdf"<br><br>aGZqZGtsZ3poZHVpeWZoemd2dXNoamRibngganZodWpyYWRuIHVqO0hmSjtyRVVPIEZSO05SVURF<br>SEx1aWhudWpoZ3h1XGh1c2loZWRma25kamlsXHpodXZpZmhkcnVsaGpnZmtsaG<br>a2psajY1ZWxqanNveHV5ZXJ3NTQzYXRnZnJhZXdhcmV0eXRia2xhanNueXVpNjRv<br><br>--MixedBoundaryString<br>Content-Type: application/pdf;name="SpecialOffer.pdf"<br>Content-Transfer-Encoding: base64<br>Content-Disposition: attachment;filename="SpecialOffer.pdf"<br><br>aXBvY21odWl0dnI1dWk4OXdzNHU5NTgwcDN3YTt1OTQwc3U4NTk1dTg0dTV5OG<br>cS0zNHU4NTk0eWI4OTcwdjg5MHE4cHV0O3BvYTt6dWI7dWlvenZ1em9pdW51dD<br>OTViOHk5cDV3dTh5bnB3dWZ2OHQ5dTh2cHVpO2p2Ymd1eTg5MGg3ajY4bjZ2ODl1ZGlvcjQ1amts<br>dfnhgjdfihn=<br><br>--MixedBoundaryString--<br><br>.<br><br>// Or you can download from<br><a rel="nofollow" target="_blank">https://www.phpclasses.org/browse/file/14672.html</a></span>
</code></div>
  </div>
 </div>
  <div class="note" id="31651">  
  <a class="name">
  <strong class="user"><em>michel dot jansens at ulb dot ac dot be</em></strong></a><div class="date" title="2003-04-29 07:29"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom31651">
<div class="phpcode"><code><span class="html">
I use imap_append() to decode message/rfc822 attachments type(embedded emails):<br><br>$attachment = imap_fetchbody($mbox,$mailuid,$atpos,FT_UID);<br>$attachment = imap_base64($attachment);<br>$res =&nbsp; imap_append($mbox,mboxspec("INBOX"),$attachment);<br>//the embedded email is now a normal mail in my INBOX</span>
</code></div>
  </div>
 </div>
  <div class="note" id="22244">  
  <a class="name">
  <strong class="user"><em>bluebiru78 at hotmail dot com</em></strong></a><div class="date" title="2002-06-12 12:24"><strong>19 years ago</strong></div>
  <div class="text" id="Hcom22244">
<div class="phpcode"><code><span class="html">
i used imap_append to copy any composed message into INBOX.Sent folder..<br><br>$app = imap_append($stream,"{" . $connectstring . "}INBOX.Sent","$header\r\n" ."$mbody\r\n");<br><br>if (!$app) {<br> error("Email copying to Sent folder FAILED!");<br>}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="14467">  
  <a class="name">
  <strong class="user"><em>owain at vaughan dot com</em></strong></a><div class="date" title="2001-08-01 06:49"><strong>20 years ago</strong></div>
  <div class="text" id="Hcom14467">
<div class="phpcode"><code><span class="html">
With SIMS IMAP server you also need to use \r\n as a line terminator, otherwise you will be able to add all the header lines correctly, but the body of the message will not be saved.&lt;br&gt;
<br>You can use \n by itself for each header line, but when creating the blank line between the headers and the body you must use \r\n\r\n</span>
</code></div>
  </div>
 </div>
  <div class="note" id="111323">  
  <a class="name">
  <strong class="user"><em>serpent at paradise dot net dot nz</em></strong></a><div class="date" title="2013-02-06 08:10"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom111323">
<div class="phpcode"><code><span class="html">
We couldn't get this function to work properly with MS-Exchange/IMAP, not because there's a problem with a the function as such, but because MS-Exchange changed the content-type in the header from multipart/[anything] to text/plain in every instance.&nbsp; We set ImapMessagesRetrievalMimeFormat to HtmlAndTextAlternative<br>on the Exchange server, and that didn't help either.&nbsp; I even tried wrapping the multipart message in a message/rfc822 wrapper and it reached inside the outer message and tweeked the inner message from multipart/alternative to text/plain.<br><br>Messages emailed to the mbox were unaffected, I suggest you try that route instead, and move the relevant messages to where you want them.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="105303">  
  <a class="name">
  <strong class="user"><em>Tigggger</em></strong></a><div class="date" title="2011-08-08 09:30"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom105303">
<div class="phpcode"><code><span class="html">
I encountered 3 problems when attempting to get my server to copy messages to the sent folder.
<br>
<br>1. Wouldn't login until I added /novalidate-cert
<br>2. No code example of getting the date sent
<br>3. Including an attachment
<br>
<br>Hope this code helps others
<br>
<br><span class="default">&lt;?php
<br>$dmy</span><span class="keyword">=</span><span class="default">date</span><span class="keyword">(</span><span class="string">"d-M-Y H:i:s"</span><span class="keyword">);
<br></span><span class="default">$dmy</span><span class="keyword">.= </span><span class="string">" +0100"</span><span class="keyword">; </span><span class="comment">// Had to do this bit manually as server and me are in different timezones
<br></span><span class="default">$stream</span><span class="keyword">=@</span><span class="default">imap_open</span><span class="keyword">(</span><span class="string">"{mail.example.com/novalidate-cert}INBOX.Sent"</span><span class="keyword">, </span><span class="string">"username"</span><span class="keyword">, </span><span class="string">"password"</span><span class="keyword">);
<br></span><span class="default">$boundary </span><span class="keyword">= </span><span class="string">"------="</span><span class="keyword">.</span><span class="default">md5</span><span class="keyword">(</span><span class="default">uniqid</span><span class="keyword">(</span><span class="default">rand</span><span class="keyword">()));
<br></span><span class="default">$header </span><span class="keyword">= </span><span class="string">"MIME-Version: 1.0\r\n"</span><span class="keyword">;
<br></span><span class="default">$header </span><span class="keyword">.= </span><span class="string">"Content-Type: multipart/mixed; boundary=\"</span><span class="default">$boundary</span><span class="string">\"\r\n"</span><span class="keyword">;
<br></span><span class="default">$header </span><span class="keyword">.= </span><span class="string">"\r\n"</span><span class="keyword">;
<br></span><span class="default">$file</span><span class="keyword">=</span><span class="string">"../path_to/filename.pdf"</span><span class="keyword">;
<br></span><span class="default">$filename</span><span class="keyword">=</span><span class="string">"filename.pdf"</span><span class="keyword">;
<br></span><span class="default">$ouv</span><span class="keyword">=</span><span class="default">fopen </span><span class="keyword">(</span><span class="string">"</span><span class="default">$file</span><span class="string">"</span><span class="keyword">, </span><span class="string">"rb"</span><span class="keyword">);</span><span class="default">$lir</span><span class="keyword">=</span><span class="default">fread </span><span class="keyword">(</span><span class="default">$ouv</span><span class="keyword">, </span><span class="default">filesize </span><span class="keyword">(</span><span class="string">"</span><span class="default">$file</span><span class="string">"</span><span class="keyword">));</span><span class="default">fclose
<br></span><span class="keyword">(</span><span class="default">$ouv</span><span class="keyword">);
<br></span><span class="default">$attachment </span><span class="keyword">= </span><span class="default">chunk_split</span><span class="keyword">(</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$lir</span><span class="keyword">));
<br></span><span class="default">$msg2 </span><span class="keyword">.= </span><span class="string">"--</span><span class="default">$boundary</span><span class="string">\r\n"</span><span class="keyword">;
<br></span><span class="default">$msg2 </span><span class="keyword">.= </span><span class="string">"Content-Transfer-Encoding: base64\r\n"</span><span class="keyword">;
<br></span><span class="default">$msg2 </span><span class="keyword">.= </span><span class="string">"Content-Disposition: attachment; filename=\"</span><span class="default">$filename</span><span class="string">\"\r\n"</span><span class="keyword">;
<br></span><span class="default">$msg2 </span><span class="keyword">.= </span><span class="string">"\r\n"</span><span class="keyword">;
<br></span><span class="default">$msg2 </span><span class="keyword">.= </span><span class="default">$attachment </span><span class="keyword">. </span><span class="string">"\r\n"</span><span class="keyword">;
<br></span><span class="default">$msg2 </span><span class="keyword">.= </span><span class="string">"\r\n\r\n"</span><span class="keyword">;
<br></span><span class="default">$msg3 </span><span class="keyword">.= </span><span class="string">"--</span><span class="default">$boundary</span><span class="string">--\r\n"</span><span class="keyword">;
<br></span><span class="default">imap_append</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">,</span><span class="string">"{mail.example.com/novalidate-cert}INBOX.Sent"</span><span class="keyword">,</span><span class="string">"From: Somebody\r\n"</span><span class="keyword">.</span><span class="string">"To: test@example.co.uk\r\n"</span><span class="keyword">.</span><span class="string">"Date: </span><span class="default">$dmy</span><span class="string">\r\n"</span><span class="keyword">.</span><span class="string">"Subject: This is the subject\r\n"</span><span class="keyword">.</span><span class="string">"</span><span class="default">$header</span><span class="string">\r\n"</span><span class="keyword">.</span><span class="string">"</span><span class="default">$msg2</span><span class="string">\r\n"</span><span class="keyword">.</span><span class="string">"</span><span class="default">$msg3</span><span class="string">\r\n"</span><span class="keyword">);
<br></span><span class="default">imap_close </span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">);
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="80951">  
  <a class="name">
  <strong class="user"><em>chris at sma-sportsmgmt dot com</em></strong></a><div class="date" title="2008-02-07 11:06"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom80951">
<div class="phpcode"><code><span class="html">
I spend most of today refining the example to make it work properly when saving to the Inbox.Sent folder.<br><br>The append command now looks like:<br><br>&nbsp; &nbsp; $return = imap_append($stream,$mailbox_addr<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; , "From: $fromReply\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; . "To: $to\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; . "Subject: $subject\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; . "Date: $now&nbsp; \r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . "X-Mailer: Cmail_v2.0 \r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; . "X-Originating-IP: $ip_addr \r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; . "MIME-Version: 1 \r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; . "Content-Type: text/html;\r\n\tcharset=\"ISO-8859-1\"\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; . "Content-Transfer-Encoding: 8bit \r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; . "\r\n\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; . "$wk_msg\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; );<br><br>This inserts the current date into the email and lets it support html content. The one thing that I haven't got working yet is including attachments. I presumably have to make the boundaries and attachment content part of the message body.<br><br>Chris</span>
</code></div>
  </div>
 </div>
  <div class="note" id="119759">  
  <a class="name">
  <strong class="user"><em>nanomoow at gmail dot com</em></strong></a><div class="date" title="2016-08-19 08:15"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom119759">
<div class="phpcode"><code><span class="html">
$fn = 'filename.zip';<br>$IMAPhost = 'imap.hostname.com';<br>// IMAP port 143, 995 or POP3 port 110, 995<br>$IMAPport = '143';<br>$IMAPssl = 'tls';<br>$IMAP = '{'.$IMAPhost.':'.$IMAPport.'/imap/'.$IMAPssl.'/novalidate-cert}';<br>$IMAPuser = 'hello@hostname.com';&nbsp; &nbsp; &nbsp; &nbsp; <br>$msg ='Message text &lt;h1 style="color: #093"&gt; Hello &lt;/h1&gt;';<br>// imap email and password<br>$ibox = imap_open($IMAP, $_SESSION['email'], $_SESSION['pass']);<br>$dmy=date("Y-m-d H:i:s");<br>// pack file contents<br>$attachment = chunk_split(base64_encode(file_get_contents('tmp/'.$fn)));&nbsp;&nbsp; <br>$boundary = "------=".md5(uniqid(rand())); <br>imap_append($ibox, $IMAP."Send"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; , "From: Hello &lt;".$IMAPuser."&gt;\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . "To: ".$email."\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . "Date: $dmy\r\n" <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . "Subject: ".$sub."\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; . "MIME-Version: 1.0\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . "Content-Type: multipart/mixed; boundary=\"$boundary\"\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . "\r\n\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . "--$boundary\r\n"&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . "Content-Type: text/html;\r\n\tcharset=\"utf-8\"\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . "Content-Transfer-Encoding: 8bit \r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . "\r\n\r\n" <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . html_entity_decode($msg)."\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . "\r\n\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . "--$boundary\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . "Content-Transfer-Encoding: base64\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . "Content-Disposition: attachment; filename=\"$fn\"\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . "\r\n" . $attachment . "\r\n"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . "\r\n\r\n\r\n"&nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . "--$boundary--\r\n\r\n"&nbsp; <br>);</span>
</code></div>
  </div>
 </div>
  <div class="note" id="1618">  
  <a class="name">
  <strong class="user"><em>jesper at angelo dot dk</em></strong></a><div class="date" title="1999-09-14 09:13"><strong>21 years ago</strong></div>
  <div class="text" id="Hcom1618">
<div class="phpcode"><code><span class="html">
Please observe that imap_append() do not support NNTP posting. Use fsockopen() instead, and do the work yourself.</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->

  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from www.php.net/manual/en/function.imap-append.php by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 11 Sep 2021 06:22:31 GMT -->

</body></html>