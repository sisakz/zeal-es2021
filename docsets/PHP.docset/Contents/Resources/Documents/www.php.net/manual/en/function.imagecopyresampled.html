<html><!-- Mirrored from www.php.net/manual/en/function.imagecopyresampled.php by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 11 Sep 2021 06:21:44 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>imagecopyresampled</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.imagecopyresampled.html">
 <link rel="shorturl" href="https://www.php.net/imagecopyresampled">
 <link rel="alternate" href="https://www.php.net/imagecopyresampled" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.image.html">
 <link rel="prev" href="function.imagecopymergegray.html">
 <link rel="next" href="function.imagecopyresized.html">

 <link rel="alternate" href="function.imagecopyresampled.html" hreflang="en">
 <link rel="alternate" href="https://www.php.net/manual/pt_BR/function.imagecopyresampled.php" hreflang="pt_BR">
 <link rel="alternate" href="https://www.php.net/manual/zh/function.imagecopyresampled.php" hreflang="zh">
 <link rel="alternate" href="https://www.php.net/manual/fr/function.imagecopyresampled.php" hreflang="fr">
 <link rel="alternate" href="https://www.php.net/manual/de/function.imagecopyresampled.php" hreflang="de">
 <link rel="alternate" href="https://www.php.net/manual/ja/function.imagecopyresampled.php" hreflang="ja">
 <link rel="alternate" href="https://www.php.net/manual/ro/function.imagecopyresampled.php" hreflang="ro">
 <link rel="alternate" href="https://www.php.net/manual/ru/function.imagecopyresampled.php" hreflang="ru">
 <link rel="alternate" href="https://www.php.net/manual/es/function.imagecopyresampled.php" hreflang="es">
 <link rel="alternate" href="https://www.php.net/manual/tr/function.imagecopyresampled.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached0aba.css?t=1539771603&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached2ecf.css?t=1539765004&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedba57.css?t=1606338002&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached3afa.css?t=1627831203&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="https://www.php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script>
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="https://www.php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script src="https://www.php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>


</head>
<body class="docs " style="">


<div class="headsup"><a href="https://www.php.net/conferences/index.php#id2021-09-08-1">Longhorn PHP 2021</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.errors.html">Errors</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.attributes.html">Attributes</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.sessions.html">Session Security</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
	<dd><a href="refs.ui.html">GUI Extensions</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
    <div id="breadcrumbs-inner">
          
              
          <ul>
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.utilspec.image.html">Image Processing and Generation</a></li>      <li><a href="book.image.html">GD</a></li>      <li><a href="ref.image.html">GD and Image Functions</a></li>      </ul>
    </div>
  </div>




<div id="layout" class="clearfix">
  <section id="layout-content">
  <div id="function.imagecopyresampled" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">imagecopyresampled</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.0.6, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">imagecopyresampled</span> â€” <span class="dc-title">Copy and resize part of an image with resampling</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.imagecopyresampled-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>imagecopyresampled</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type"><a href="class.gdimage.html" class="type GdImage">GdImage</a></span> <code class="parameter">$dst_image</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type"><a href="class.gdimage.html" class="type GdImage">GdImage</a></span> <code class="parameter">$src_image</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$dst_x</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$dst_y</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$src_x</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$src_y</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$dst_width</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$dst_height</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$src_width</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$src_height</code></span><br>): <span class="type">bool</span></div>

  <p class="para rdfs-comment">
   <span class="function"><strong>imagecopyresampled()</strong></span> copies a rectangular
   portion of one image to another image, smoothly interpolating pixel
   values so that, in particular, reducing the size of an image still
   retains a great deal of clarity.
  </p>
  <p class="para">
   In other words, <span class="function"><strong>imagecopyresampled()</strong></span> will take a 
   rectangular area from <code class="parameter">src_image</code> of width 
   <code class="parameter">src_width</code> and height <code class="parameter">src_height</code> at 
   position (<code class="parameter">src_x</code>,<code class="parameter">src_y</code>) 
   and place it in a rectangular area of <code class="parameter">dst_image</code> 
   of width <code class="parameter">dst_width</code> and height <code class="parameter">dst_height</code>
   at position (<code class="parameter">dst_x</code>,<code class="parameter">dst_y</code>).
  </p>
  <p class="para">
   If the source and destination coordinates and width and heights
   differ, appropriate stretching or shrinking of the image fragment
   will be performed. The coordinates refer to the upper left
   corner.  This function can be used to copy regions within the
   same image (if <code class="parameter">dst_image</code> is the same as
   <code class="parameter">src_image</code>) but if the regions overlap the
   results will be unpredictable.
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.imagecopyresampled-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>
    
     <dt>
<code class="parameter">dst_image</code></dt>

     <dd>

      <p class="para">Destination image resource.</p>
     </dd>

    
    
     <dt>
<code class="parameter">src_image</code></dt>

     <dd>

      <p class="para">Source image resource.</p>
     </dd>

    
    
     <dt>
<code class="parameter">dst_x</code></dt>

     <dd>

      <p class="para">
       x-coordinate of destination point.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">dst_y</code></dt>

     <dd>

      <p class="para">
       y-coordinate of destination point.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">src_x</code></dt>

     <dd>

      <p class="para">
       x-coordinate of source point.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">src_y</code></dt>

     <dd>

      <p class="para">
       y-coordinate of source point.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">dst_width</code></dt>

     <dd>

      <p class="para">
       Destination width.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">dst_height</code></dt>

     <dd>

      <p class="para">
       Destination height.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">src_width</code></dt>

     <dd>

      <p class="para">Source width.</p>
     </dd>

    
    
     <dt>
<code class="parameter">src_height</code></dt>

     <dd>

      <p class="para">Source height.</p>
     </dd>

    
   </dl>

  <p></p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.imagecopyresampled-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns <strong><code>true</code></strong> on success or <strong><code>false</code></strong> on failure.
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.imagecopyresampled-changelog">
  <h3 class="title">Changelog</h3>
  <table class="doctable informaltable">
   
    <thead>
     <tr>
      <th>Version</th>
      <th>Description</th>
     </tr>

    </thead>

    <tbody class="tbody">
     <tr>
      <td>8.0.0</td>
      <td>
       <code class="parameter">dst_image</code> and <code class="parameter">src_image</code> expect
       <span class="classname"><a href="class.gdimage.html" class="classname">GdImage</a></span> instances now; previously, <span class="type">resource</span>s
       were expected.
      </td>
     </tr>

    </tbody>
   
  </table>

 </div>


 <div class="refsect1 examples" id="refsect1-function.imagecopyresampled-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   </p><div class="example" id="example-2590">
    <p><strong>Example #1 Simple example</strong></p>
    <div class="example-contents"><p>
     This example will resample an image to half its original size.
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #FF8000">//&nbsp;The&nbsp;file<br></span><span style="color: #0000BB">$filename&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'test.jpg'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$percent&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0.5</span><span style="color: #007700">;<br><br></span><span style="color: #FF8000">//&nbsp;Content&nbsp;type<br></span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'Content-Type:&nbsp;image/jpeg'</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">//&nbsp;Get&nbsp;new&nbsp;dimensions<br></span><span style="color: #007700">list(</span><span style="color: #0000BB">$width</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$height</span><span style="color: #007700">)&nbsp;=&nbsp;</span><span style="color: #0000BB">getimagesize</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$new_width&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$width&nbsp;</span><span style="color: #007700">*&nbsp;</span><span style="color: #0000BB">$percent</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$new_height&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$height&nbsp;</span><span style="color: #007700">*&nbsp;</span><span style="color: #0000BB">$percent</span><span style="color: #007700">;<br><br></span><span style="color: #FF8000">//&nbsp;Resample<br></span><span style="color: #0000BB">$image_p&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecreatetruecolor</span><span style="color: #007700">(</span><span style="color: #0000BB">$new_width</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$new_height</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$image&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecreatefromjpeg</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename</span><span style="color: #007700">);<br></span><span style="color: #0000BB">imagecopyresampled</span><span style="color: #007700">(</span><span style="color: #0000BB">$image_p</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$image</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$new_width</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$new_height</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$width</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$height</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">//&nbsp;Output<br></span><span style="color: #0000BB">imagejpeg</span><span style="color: #007700">(</span><span style="color: #0000BB">$image_p</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">100</span><span style="color: #007700">);<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>The above example will output
something similar to:</p></div>
    <div class="mediaobject">
     
     <div class="imageobject">
      <img src="images/21009b70229598c6a80eef8b45bf282b-imagecopyresampled.jpg" alt="Output of example : Simple example" width="47" height="25">
     </div>
    </div>
   </div>
  <p></p>
  <p class="para">
   </p><div class="example" id="example-2591">
    <p><strong>Example #2 Resampling an image proportionally</strong></p>
    <div class="example-contents"><p>
     This example will display an image with the maximum width,
     or height, of 200 pixels.
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #FF8000">//&nbsp;The&nbsp;file<br></span><span style="color: #0000BB">$filename&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'test.jpg'</span><span style="color: #007700">;<br><br></span><span style="color: #FF8000">//&nbsp;Set&nbsp;a&nbsp;maximum&nbsp;height&nbsp;and&nbsp;width<br></span><span style="color: #0000BB">$width&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">200</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$height&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">200</span><span style="color: #007700">;<br><br></span><span style="color: #FF8000">//&nbsp;Content&nbsp;type<br></span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'Content-Type:&nbsp;image/jpeg'</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">//&nbsp;Get&nbsp;new&nbsp;dimensions<br></span><span style="color: #007700">list(</span><span style="color: #0000BB">$width_orig</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$height_orig</span><span style="color: #007700">)&nbsp;=&nbsp;</span><span style="color: #0000BB">getimagesize</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">$ratio_orig&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$width_orig</span><span style="color: #007700">/</span><span style="color: #0000BB">$height_orig</span><span style="color: #007700">;<br><br>if&nbsp;(</span><span style="color: #0000BB">$width</span><span style="color: #007700">/</span><span style="color: #0000BB">$height&nbsp;</span><span style="color: #007700">&gt;&nbsp;</span><span style="color: #0000BB">$ratio_orig</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$width&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$height</span><span style="color: #007700">*</span><span style="color: #0000BB">$ratio_orig</span><span style="color: #007700">;<br>}&nbsp;else&nbsp;{<br>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$height&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$width</span><span style="color: #007700">/</span><span style="color: #0000BB">$ratio_orig</span><span style="color: #007700">;<br>}<br><br></span><span style="color: #FF8000">//&nbsp;Resample<br></span><span style="color: #0000BB">$image_p&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecreatetruecolor</span><span style="color: #007700">(</span><span style="color: #0000BB">$width</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$height</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$image&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecreatefromjpeg</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename</span><span style="color: #007700">);<br></span><span style="color: #0000BB">imagecopyresampled</span><span style="color: #007700">(</span><span style="color: #0000BB">$image_p</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$image</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$width</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$height</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$width_orig</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$height_orig</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">//&nbsp;Output<br></span><span style="color: #0000BB">imagejpeg</span><span style="color: #007700">(</span><span style="color: #0000BB">$image_p</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">100</span><span style="color: #007700">);<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>The above example will output
something similar to:</p></div>
    <div class="mediaobject">
     
     <div class="imageobject">
      <img src="images/21009b70229598c6a80eef8b45bf282b-imagecopyresampled_2.jpg" alt="Output of example : Resampling an image proportionally" width="200" height="107">
     </div>
    </div>
   </div>
  <p></p>
 </div>

 <div class="refsect1 notes" id="refsect1-function.imagecopyresampled-notes">
  <h3 class="title">Notes</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   </p><p class="para">
    There is a problem due to palette image limitations (255+1 colors).
    Resampling or filtering an image commonly needs more colors than 255, a
    kind of approximation is used to calculate the new resampled pixel and its
    color.  With a palette image we try to allocate a new color, if that
    failed, we choose the closest (in theory) computed color.  This is
    not always the closest visual color. That may produce a weird result, like
    blank (or visually blank) images.  To skip this problem, please use a
    truecolor image as a destination image, such as one created by
    <span class="function"><a href="function.imagecreatetruecolor.html" class="function">imagecreatetruecolor()</a></span>.
   </p>
  <p></p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.imagecopyresampled-seealso">
  <h3 class="title">See Also</h3>
  <ul class="simplelist">
   <li class="member"><span class="function"><a href="function.imagecopyresized.html" class="function" rel="rdfs-seeAlso">imagecopyresized()</a> - Copy and resize part of an image</span></li>
   <li class="member"><span class="function"><a href="function.imagescale.html" class="function" rel="rdfs-seeAlso">imagescale()</a> - Scale an image using the given new width and height</span></li>
   <li class="member"><span class="function"><a href="function.imagecrop.html" class="function" rel="rdfs-seeAlso">imagecrop()</a> - Crop an image to the given rectangle</span></li>
  </ul>
 </div>

</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="112742">  
  <a class="name">
  <strong class="user"><em>wbcarts at juno dot com</em></strong></a><div class="date" title="2013-07-18 07:14"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom112742">
<div class="phpcode"><code><span class="html">
FOUR RECTANGLES<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $src_image&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $dst_image<br>+------------+---------------------------------+&nbsp;&nbsp; +------------+--------------------+<br>|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |&nbsp;&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |<br>|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |&nbsp;&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $dst_y&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |<br>|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |&nbsp;&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |<br>|&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $src_y&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |&nbsp;&nbsp; +-- $dst_x --+----$dst_width----+ |<br>|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |&nbsp;&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | |<br>|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |&nbsp;&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; Resampled&nbsp; &nbsp;&nbsp; | |<br>|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |&nbsp;&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | |<br>+-- $src_x --+------ $src_width ------+&nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;&nbsp; |&nbsp; &nbsp; &nbsp;&nbsp; $dst_height&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; | |<br>|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | |<br>|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | |<br>|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | |<br>|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; +------------------+ |<br>|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; Sample&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |<br>|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |<br>|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |<br>|&nbsp; &nbsp; &nbsp;&nbsp; $src_height&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |<br>|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;&nbsp; +---------------------------------+<br>|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; |<br>|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; |<br>|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; +------------------------+&nbsp; &nbsp; &nbsp; &nbsp; |<br>|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |<br>|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |<br>+----------------------------------------------+</span>
</code></div>
  </div>
 </div>
  <div class="note" id="104028">  
  <a class="name">
  <strong class="user"><em>promaty at gmail dot com</em></strong></a><div class="date" title="2011-05-18 05:26"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom104028">
<div class="phpcode"><code><span class="html">
Here is my ultimate image resizer that preserves transparency for gif's and png's and has an option to crop images to fixed dimensions (preserves image proportions by default)<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">image_resize</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">, </span><span class="default">$dst</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">, </span><span class="default">$crop</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">){<br><br>&nbsp; if(!list(</span><span class="default">$w</span><span class="keyword">, </span><span class="default">$h</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">)) return </span><span class="string">"Unsupported picture type!"</span><span class="keyword">;<br><br>&nbsp; </span><span class="default">$type </span><span class="keyword">= </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">strrchr</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">,</span><span class="string">"."</span><span class="keyword">),</span><span class="default">1</span><span class="keyword">));<br>&nbsp; if(</span><span class="default">$type </span><span class="keyword">== </span><span class="string">'jpeg'</span><span class="keyword">) </span><span class="default">$type </span><span class="keyword">= </span><span class="string">'jpg'</span><span class="keyword">;<br>&nbsp; switch(</span><span class="default">$type</span><span class="keyword">){<br>&nbsp; &nbsp; case </span><span class="string">'bmp'</span><span class="keyword">: </span><span class="default">$img </span><span class="keyword">= </span><span class="default">imagecreatefromwbmp</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">); break;<br>&nbsp; &nbsp; case </span><span class="string">'gif'</span><span class="keyword">: </span><span class="default">$img </span><span class="keyword">= </span><span class="default">imagecreatefromgif</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">); break;<br>&nbsp; &nbsp; case </span><span class="string">'jpg'</span><span class="keyword">: </span><span class="default">$img </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">); break;<br>&nbsp; &nbsp; case </span><span class="string">'png'</span><span class="keyword">: </span><span class="default">$img </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">); break;<br>&nbsp; &nbsp; default : return </span><span class="string">"Unsupported picture type!"</span><span class="keyword">;<br>&nbsp; }<br><br>&nbsp; </span><span class="comment">// resize<br>&nbsp; </span><span class="keyword">if(</span><span class="default">$crop</span><span class="keyword">){<br>&nbsp; &nbsp; if(</span><span class="default">$w </span><span class="keyword">&lt; </span><span class="default">$width </span><span class="keyword">or </span><span class="default">$h </span><span class="keyword">&lt; </span><span class="default">$height</span><span class="keyword">) return </span><span class="string">"Picture is too small!"</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$ratio </span><span class="keyword">= </span><span class="default">max</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">/</span><span class="default">$w</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">/</span><span class="default">$h</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$h </span><span class="keyword">= </span><span class="default">$height </span><span class="keyword">/ </span><span class="default">$ratio</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$x </span><span class="keyword">= (</span><span class="default">$w </span><span class="keyword">- </span><span class="default">$width </span><span class="keyword">/ </span><span class="default">$ratio</span><span class="keyword">) / </span><span class="default">2</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$w </span><span class="keyword">= </span><span class="default">$width </span><span class="keyword">/ </span><span class="default">$ratio</span><span class="keyword">;<br>&nbsp; }<br>&nbsp; else{<br>&nbsp; &nbsp; if(</span><span class="default">$w </span><span class="keyword">&lt; </span><span class="default">$width </span><span class="keyword">and </span><span class="default">$h </span><span class="keyword">&lt; </span><span class="default">$height</span><span class="keyword">) return </span><span class="string">"Picture is too small!"</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$ratio </span><span class="keyword">= </span><span class="default">min</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">/</span><span class="default">$w</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">/</span><span class="default">$h</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">$w </span><span class="keyword">* </span><span class="default">$ratio</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">$h </span><span class="keyword">* </span><span class="default">$ratio</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; }<br><br>&nbsp; </span><span class="default">$new </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);<br><br>&nbsp; </span><span class="comment">// preserve transparency<br>&nbsp; </span><span class="keyword">if(</span><span class="default">$type </span><span class="keyword">== </span><span class="string">"gif" </span><span class="keyword">or </span><span class="default">$type </span><span class="keyword">== </span><span class="string">"png"</span><span class="keyword">){<br>&nbsp; &nbsp; </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">, </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">127</span><span class="keyword">));<br>&nbsp; &nbsp; </span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br>&nbsp; }<br><br>&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">, </span><span class="default">$img</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">, </span><span class="default">$w</span><span class="keyword">, </span><span class="default">$h</span><span class="keyword">);<br><br>&nbsp; switch(</span><span class="default">$type</span><span class="keyword">){<br>&nbsp; &nbsp; case </span><span class="string">'bmp'</span><span class="keyword">: </span><span class="default">imagewbmp</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">, </span><span class="default">$dst</span><span class="keyword">); break;<br>&nbsp; &nbsp; case </span><span class="string">'gif'</span><span class="keyword">: </span><span class="default">imagegif</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">, </span><span class="default">$dst</span><span class="keyword">); break;<br>&nbsp; &nbsp; case </span><span class="string">'jpg'</span><span class="keyword">: </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">, </span><span class="default">$dst</span><span class="keyword">); break;<br>&nbsp; &nbsp; case </span><span class="string">'png'</span><span class="keyword">: </span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">, </span><span class="default">$dst</span><span class="keyword">); break;<br>&nbsp; }<br>&nbsp; return </span><span class="default">true</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;<br></span><br>Example that I use when uploading new images to the server.<br><br>This saves the original picture in the form:<br>original.type<br><br>and creates a new thumbnail:<br>100x100.type<br><br><span class="default">&lt;?php<br>&nbsp; $pic_type </span><span class="keyword">= </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">strrchr</span><span class="keyword">(</span><span class="default">$picture</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">],</span><span class="string">"."</span><span class="keyword">));<br>&nbsp; </span><span class="default">$pic_name </span><span class="keyword">= </span><span class="string">"original</span><span class="default">$pic_type</span><span class="string">"</span><span class="keyword">;<br>&nbsp; </span><span class="default">move_uploaded_file</span><span class="keyword">(</span><span class="default">$picture</span><span class="keyword">[</span><span class="string">'tmp_name'</span><span class="keyword">], </span><span class="default">$pic_name</span><span class="keyword">);<br>&nbsp; if (</span><span class="default">true </span><span class="keyword">!== (</span><span class="default">$pic_error </span><span class="keyword">= @</span><span class="default">image_resize</span><span class="keyword">(</span><span class="default">$pic_name</span><span class="keyword">, </span><span class="string">"100x100</span><span class="default">$pic_type</span><span class="string">"</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">))) {<br>&nbsp; &nbsp; echo </span><span class="default">$pic_error</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$pic_name</span><span class="keyword">);<br>&nbsp; }<br>&nbsp; else echo </span><span class="string">"OK!"</span><span class="keyword">;<br></span><span class="default">?&gt;<br></span><br>Cheers!</span>
</code></div>
  </div>
 </div>
  <div class="note" id="85929">  
  <a class="name">
  <strong class="user"><em>zorroswordsman at gmail dot com</em></strong></a><div class="date" title="2008-09-24 07:46"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom85929">
<div class="phpcode"><code><span class="html">
I've created a PHP5 image resize class, using ImageCopyResampled, that someone might find useful, with support for JPEG, PNG, and GIF formats. It retains the original image's aspect ratio when resizing, and doesn't resize or resample if the original width and height is smaller then the desired resize.<br><br><span class="default">&lt;?php<br><br></span><span class="comment">// Imaging<br></span><span class="keyword">class </span><span class="default">imaging<br></span><span class="keyword">{<br><br>&nbsp; &nbsp; </span><span class="comment">// Variables<br>&nbsp; &nbsp; </span><span class="keyword">private </span><span class="default">$img_input</span><span class="keyword">;<br>&nbsp; &nbsp; private </span><span class="default">$img_output</span><span class="keyword">;<br>&nbsp; &nbsp; private </span><span class="default">$img_src</span><span class="keyword">;<br>&nbsp; &nbsp; private </span><span class="default">$format</span><span class="keyword">;<br>&nbsp; &nbsp; private </span><span class="default">$quality </span><span class="keyword">= </span><span class="default">80</span><span class="keyword">;<br>&nbsp; &nbsp; private </span><span class="default">$x_input</span><span class="keyword">;<br>&nbsp; &nbsp; private </span><span class="default">$y_input</span><span class="keyword">;<br>&nbsp; &nbsp; private </span><span class="default">$x_output</span><span class="keyword">;<br>&nbsp; &nbsp; private </span><span class="default">$y_output</span><span class="keyword">;<br>&nbsp; &nbsp; private </span><span class="default">$resize</span><span class="keyword">;<br><br>&nbsp; &nbsp; </span><span class="comment">// Set image<br>&nbsp; &nbsp; </span><span class="keyword">public function </span><span class="default">set_img</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">)<br>&nbsp; &nbsp; {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Find format<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ext </span><span class="keyword">= </span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">pathinfo</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">PATHINFO_EXTENSION</span><span class="keyword">));<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// JPEG image<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">) &amp;&amp; (</span><span class="default">$ext </span><span class="keyword">== </span><span class="string">"JPG" </span><span class="keyword">OR </span><span class="default">$ext </span><span class="keyword">== </span><span class="string">"JPEG"</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">format </span><span class="keyword">= </span><span class="default">$ext</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_input </span><span class="keyword">= </span><span class="default">ImageCreateFromJPEG</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_src </span><span class="keyword">= </span><span class="default">$img</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br><br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// PNG image<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">elseif(</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">) &amp;&amp; </span><span class="default">$ext </span><span class="keyword">== </span><span class="string">"PNG"</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">format </span><span class="keyword">= </span><span class="default">$ext</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_input </span><span class="keyword">= </span><span class="default">ImageCreateFromPNG</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_src </span><span class="keyword">= </span><span class="default">$img</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// GIF image<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">elseif(</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">) &amp;&amp; </span><span class="default">$ext </span><span class="keyword">== </span><span class="string">"GIF"</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">format </span><span class="keyword">= </span><span class="default">$ext</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_input </span><span class="keyword">= </span><span class="default">ImageCreateFromGIF</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_src </span><span class="keyword">= </span><span class="default">$img</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Get dimensions<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_input</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_input</span><span class="keyword">);<br><br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; </span><span class="comment">// Set maximum image size (pixels)<br>&nbsp; &nbsp; </span><span class="keyword">public function </span><span class="default">set_size</span><span class="keyword">(</span><span class="default">$size </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">)<br>&nbsp; &nbsp; {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Resize<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input </span><span class="keyword">&gt; </span><span class="default">$size </span><span class="keyword">&amp;&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input </span><span class="keyword">&gt; </span><span class="default">$size</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Wide<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input </span><span class="keyword">&gt;= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_output </span><span class="keyword">= </span><span class="default">$size</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_output </span><span class="keyword">= (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_output </span><span class="keyword">/ </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input</span><span class="keyword">) * </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Tall<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">else<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_output </span><span class="keyword">= </span><span class="default">$size</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_output </span><span class="keyword">= (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_output </span><span class="keyword">/ </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input</span><span class="keyword">) * </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Ready<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resize </span><span class="keyword">= </span><span class="default">TRUE</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Don't resize<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">else { </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resize </span><span class="keyword">= </span><span class="default">FALSE</span><span class="keyword">; }<br><br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; </span><span class="comment">// Set image quality (JPEG only)<br>&nbsp; &nbsp; </span><span class="keyword">public function </span><span class="default">set_quality</span><span class="keyword">(</span><span class="default">$quality</span><span class="keyword">)<br>&nbsp; &nbsp; {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">is_int</span><span class="keyword">(</span><span class="default">$quality</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">quality </span><span class="keyword">= </span><span class="default">$quality</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; </span><span class="comment">// Save image<br>&nbsp; &nbsp; </span><span class="keyword">public function </span><span class="default">save_img</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">)<br>&nbsp; &nbsp; {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Resize<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resize</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_output </span><span class="keyword">= </span><span class="default">ImageCreateTrueColor</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_output</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_output</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">ImageCopyResampled</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_output</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_input</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_output</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_output</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Save JPEG<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">format </span><span class="keyword">== </span><span class="string">"JPG" </span><span class="keyword">OR </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">format </span><span class="keyword">== </span><span class="string">"JPEG"</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resize</span><span class="keyword">) { </span><span class="default">imageJPEG</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_output</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">quality</span><span class="keyword">); }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else { </span><span class="default">copy</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_src</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">); }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Save PNG<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">elseif(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">format </span><span class="keyword">== </span><span class="string">"PNG"</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resize</span><span class="keyword">) { </span><span class="default">imagePNG</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_output</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">); }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else { </span><span class="default">copy</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_src</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">); }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Save GIF<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">elseif(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">format </span><span class="keyword">== </span><span class="string">"GIF"</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resize</span><span class="keyword">) { </span><span class="default">imageGIF</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_output</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">); }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else { </span><span class="default">copy</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_src</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">); }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; </span><span class="comment">// Get width<br>&nbsp; &nbsp; </span><span class="keyword">public function </span><span class="default">get_width</span><span class="keyword">()<br>&nbsp; &nbsp; {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input</span><span class="keyword">;<br><br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; </span><span class="comment">// Get height<br>&nbsp; &nbsp; </span><span class="keyword">public function </span><span class="default">get_height</span><span class="keyword">()<br>&nbsp; &nbsp; {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input</span><span class="keyword">;<br><br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; </span><span class="comment">// Clear image cache<br>&nbsp; &nbsp; </span><span class="keyword">public function </span><span class="default">clear_cache</span><span class="keyword">()<br>&nbsp; &nbsp; {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; @</span><span class="default">ImageDestroy</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_input</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; @</span><span class="default">ImageDestroy</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_output</span><span class="keyword">);<br><br>&nbsp; &nbsp; }<br><br>}<br><br></span><span class="comment">##### DEMO #####<br><br>// Image<br></span><span class="default">$src </span><span class="keyword">= </span><span class="string">"myimage.jpg"</span><span class="keyword">;<br><br></span><span class="comment">// Begin<br></span><span class="default">$img </span><span class="keyword">= new </span><span class="default">imaging</span><span class="keyword">;<br></span><span class="default">$img</span><span class="keyword">-&gt;</span><span class="default">set_img</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">);<br></span><span class="default">$img</span><span class="keyword">-&gt;</span><span class="default">set_quality</span><span class="keyword">(</span><span class="default">80</span><span class="keyword">);<br><br></span><span class="comment">// Small thumbnail<br></span><span class="default">$img</span><span class="keyword">-&gt;</span><span class="default">set_size</span><span class="keyword">(</span><span class="default">200</span><span class="keyword">);<br></span><span class="default">$img</span><span class="keyword">-&gt;</span><span class="default">save_img</span><span class="keyword">(</span><span class="string">"small_" </span><span class="keyword">. </span><span class="default">$src</span><span class="keyword">);<br><br></span><span class="comment">// Baby thumbnail<br></span><span class="default">$img</span><span class="keyword">-&gt;</span><span class="default">set_size</span><span class="keyword">(</span><span class="default">50</span><span class="keyword">);<br></span><span class="default">$img</span><span class="keyword">-&gt;</span><span class="default">save_img</span><span class="keyword">(</span><span class="string">"baby_" </span><span class="keyword">. </span><span class="default">$src</span><span class="keyword">);<br><br></span><span class="comment">// Finalize<br></span><span class="default">$img</span><span class="keyword">-&gt;</span><span class="default">clear_cache</span><span class="keyword">();<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="81898">  
  <a class="name">
  <strong class="user"><em>bobbyboyojones at hotmail dot com</em></strong></a><div class="date" title="2008-03-18 11:41"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom81898">
<div class="phpcode"><code><span class="html">
I hated that enlarging an image resulted in giant pixels rather than a smoother look, so I wrote this function.&nbsp; It takes longer, but gives a much nicer look.<br><br><span class="default">&lt;?php<br><br></span><span class="keyword">function </span><span class="default">imagecopyresampledSMOOTH</span><span class="keyword">(&amp;</span><span class="default">$dst_img</span><span class="keyword">, &amp;</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$dst_x</span><span class="keyword">, </span><span class="default">$dst_y</span><span class="keyword">, </span><span class="default">$src_x</span><span class="keyword">, </span><span class="default">$src_y</span><span class="keyword">, </span><span class="default">$dst_w</span><span class="keyword">, </span><span class="default">$dst_h</span><span class="keyword">, </span><span class="default">$src_w</span><span class="keyword">, </span><span class="default">$src_h</span><span class="keyword">, </span><span class="default">$mult</span><span class="keyword">=</span><span class="default">1.25</span><span class="keyword">){<br>&nbsp; &nbsp; </span><span class="comment">// don't use a $mult that's too close to an int or this function won't make much of a difference<br><br>&nbsp; &nbsp; </span><span class="default">$tgt_w </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">$src_w </span><span class="keyword">* </span><span class="default">$mult</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$tgt_h </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">$src_h </span><span class="keyword">* </span><span class="default">$mult</span><span class="keyword">);<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// using $mult &lt;= 1 will make the current step w/h smaller (or the same), don't allow this, always resize by at least 1 pixel larger<br>&nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">$tgt_w </span><span class="keyword">&lt;= </span><span class="default">$src_w</span><span class="keyword">){ </span><span class="default">$tgt_w </span><span class="keyword">+= </span><span class="default">1</span><span class="keyword">; }<br>&nbsp; &nbsp; if(</span><span class="default">$tgt_h </span><span class="keyword">&lt;= </span><span class="default">$src_h</span><span class="keyword">){ </span><span class="default">$tgt_h </span><span class="keyword">+= </span><span class="default">1</span><span class="keyword">; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// if the current step w/h is larger than the final height, adjust it back to the final size<br>&nbsp; &nbsp; // this check also makes it so that if we are doing a resize to smaller image, it happens in one step (since that's already smooth)<br>&nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">$tgt_w </span><span class="keyword">&gt; </span><span class="default">$dst_w</span><span class="keyword">){ </span><span class="default">$tgt_w </span><span class="keyword">= </span><span class="default">$dst_w</span><span class="keyword">; }<br>&nbsp; &nbsp; if(</span><span class="default">$tgt_h </span><span class="keyword">&gt; </span><span class="default">$dst_h</span><span class="keyword">){ </span><span class="default">$tgt_h </span><span class="keyword">= </span><span class="default">$dst_h</span><span class="keyword">; }<br><br>&nbsp; &nbsp; </span><span class="default">$tmpImg </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$tgt_w</span><span class="keyword">, </span><span class="default">$tgt_h</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$tmpImg</span><span class="keyword">, </span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$src_x</span><span class="keyword">, </span><span class="default">$src_y</span><span class="keyword">, </span><span class="default">$tgt_w</span><span class="keyword">, </span><span class="default">$tgt_h</span><span class="keyword">, </span><span class="default">$src_w</span><span class="keyword">, </span><span class="default">$src_h</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$dst_img</span><span class="keyword">, </span><span class="default">$tmpImg</span><span class="keyword">, </span><span class="default">$dst_x</span><span class="keyword">, </span><span class="default">$dst_y</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$tgt_w</span><span class="keyword">, </span><span class="default">$tgt_h</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$tmpImg</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="comment">// as long as the final w/h has not been reached, reep on resizing<br>&nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">$tgt_w </span><span class="keyword">&lt; </span><span class="default">$dst_w </span><span class="keyword">OR </span><span class="default">$tgt_h </span><span class="keyword">&lt; </span><span class="default">$dst_h</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagecopyresampledSMOOTH</span><span class="keyword">(</span><span class="default">$dst_img</span><span class="keyword">, </span><span class="default">$dst_img</span><span class="keyword">, </span><span class="default">$dst_x</span><span class="keyword">, </span><span class="default">$dst_y</span><span class="keyword">, </span><span class="default">$dst_x</span><span class="keyword">, </span><span class="default">$dst_y</span><span class="keyword">, </span><span class="default">$dst_w</span><span class="keyword">, </span><span class="default">$dst_h</span><span class="keyword">, </span><span class="default">$tgt_w</span><span class="keyword">, </span><span class="default">$tgt_h</span><span class="keyword">, </span><span class="default">$mult</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>}<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="54448">  
  <a class="name"><strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2005-07-04 05:46"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom54448">
<div class="phpcode"><code><span class="html">
It should be noted that the imagecopyresampled() function is much more blurry than Photoshop CS's default bicubic funtion. And looks similar to a blury version of Photoshop's bilinear function. The documentation fails to note which algorithm is used in resampling.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="85038">  
  <a class="name">
  <strong class="user"><em>crash</em></strong></a><div class="date" title="2008-08-12 06:49"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom85038">
<div class="phpcode"><code><span class="html">
The suggestion of converting a gif to a png to retain transparency was useful. However the steps used to maintain the transparency work for a gif as well, so the conversion step is not necessary. Just do everything the same, and save as a gif anyway. i.e.<br><br><span class="default">&lt;?php<br>$g_iw is </span><span class="keyword">new </span><span class="default">image width<br>$g_ih is </span><span class="keyword">new </span><span class="default">image height<br><br>$img_src</span><span class="keyword">=</span><span class="default">imagecreatefromgif</span><span class="keyword">(</span><span class="default">$g_srcfile</span><span class="keyword">);<br></span><span class="default">$img_dst</span><span class="keyword">=</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$g_iw</span><span class="keyword">,</span><span class="default">$g_ih</span><span class="keyword">);<br><br></span><span class="comment">//preserve alpha<br></span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">));<br></span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br></span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br></span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">$img_src</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$g_iw</span><span class="keyword">, </span><span class="default">$g_ih</span><span class="keyword">, </span><span class="default">$g_is</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$g_is</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br><br></span><span class="default">imagegif</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">$g_dstfile</span><span class="keyword">); <br></span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">); <br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="83292">  
  <a class="name">
  <strong class="user"><em>mattura gmail com</em></strong></a><div class="date" title="2008-05-19 10:53"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom83292">
<div class="phpcode"><code><span class="html">
Here's a little function I wrote to resize images to a maximum dimension - based on what facebook does in the galleries. You put in a source, destination and a maximum dimension in pixels (eg 300), and for example if the image is long and thin, the longest edge will be 300px, yet the image retains proportions. A square image will become 300x300, a 6x4 (landscape) will become 300x200, a 4x6 (portrait) - 200x300 etc.<br>It works on jpg images, but other formats can easily be added.<br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">createThumb</span><span class="keyword">(</span><span class="default">$spath</span><span class="keyword">, </span><span class="default">$dpath</span><span class="keyword">, </span><span class="default">$maxd</span><span class="keyword">) {<br> </span><span class="default">$src</span><span class="keyword">=@</span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$spath</span><span class="keyword">);<br> if (!</span><span class="default">$src</span><span class="keyword">) {return </span><span class="default">false</span><span class="keyword">;} else {<br>&nbsp; </span><span class="default">$srcw</span><span class="keyword">=</span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">);<br>&nbsp; </span><span class="default">$srch</span><span class="keyword">=</span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">);<br>&nbsp; if (</span><span class="default">$srcw</span><span class="keyword">&lt;</span><span class="default">$srch</span><span class="keyword">) {</span><span class="default">$height</span><span class="keyword">=</span><span class="default">$maxd</span><span class="keyword">;</span><span class="default">$width</span><span class="keyword">=</span><span class="default">floor</span><span class="keyword">(</span><span class="default">$srcw</span><span class="keyword">*</span><span class="default">$height</span><span class="keyword">/</span><span class="default">$srch</span><span class="keyword">);}<br>&nbsp; else {</span><span class="default">$width</span><span class="keyword">=</span><span class="default">$maxd</span><span class="keyword">;</span><span class="default">$height</span><span class="keyword">=</span><span class="default">floor</span><span class="keyword">(</span><span class="default">$srch</span><span class="keyword">*</span><span class="default">$width</span><span class="keyword">/</span><span class="default">$srcw</span><span class="keyword">);}<br>&nbsp; if (</span><span class="default">$width</span><span class="keyword">&gt;</span><span class="default">$srcw </span><span class="keyword">&amp;&amp; </span><span class="default">$height</span><span class="keyword">&gt;</span><span class="default">$srch</span><span class="keyword">) {</span><span class="default">$width</span><span class="keyword">=</span><span class="default">$srcw</span><span class="keyword">;</span><span class="default">$height</span><span class="keyword">=</span><span class="default">$srch</span><span class="keyword">;}&nbsp; </span><span class="comment">//if image is actually smaller than you want, leave small (remove this line to resize anyway)<br>&nbsp; </span><span class="default">$thumb</span><span class="keyword">=</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);<br>&nbsp; if (</span><span class="default">$height</span><span class="keyword">&lt;</span><span class="default">100</span><span class="keyword">) {</span><span class="default">imagecopyresized</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">$src</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">, </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">), </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">));}<br>&nbsp; else {</span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">$src</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">, </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">), </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">));}<br>&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">$dpath</span><span class="keyword">);<br>&nbsp; return </span><span class="default">true</span><span class="keyword">;<br> }<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="114602">  
  <a class="name">
  <strong class="user"><em>kazuya</em></strong></a><div class="date" title="2014-03-11 02:24"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom114602">
<div class="phpcode"><code><span class="html">
<span class="default">&lt;?php<br><br>$new_file </span><span class="keyword">= </span><span class="default">img_resize</span><span class="keyword">(</span><span class="string">"./img/"</span><span class="keyword">, </span><span class="string">"test.jpg"</span><span class="keyword">,</span><span class="string">"copy_test.jpg"</span><span class="keyword">,</span><span class="default">300</span><span class="keyword">);<br>echo </span><span class="string">"&lt;IMG src = '</span><span class="default">$new_file</span><span class="string">'&gt;"</span><span class="keyword">;<br><br>function </span><span class="default">img_resize</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">,</span><span class="default">$tmp_name</span><span class="keyword">,</span><span class="default">$new_name</span><span class="keyword">,</span><span class="default">$new_width</span><span class="keyword">){<br>&nbsp; &nbsp; if (!</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">.</span><span class="default">$filename</span><span class="keyword">)){<br>&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"file not found!"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; exit;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; if (!</span><span class="default">is_writable</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">)){<br>&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"error:permission denied!"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; exit;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; list(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$path </span><span class="keyword">. </span><span class="default">$tmp_name</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$new_height </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$new_width </span><span class="keyword">* </span><span class="default">$height </span><span class="keyword">/ </span><span class="default">$width</span><span class="keyword">); <br>&nbsp; &nbsp; </span><span class="default">$image_p </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$new_width</span><span class="keyword">, </span><span class="default">$new_height</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$image </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$path </span><span class="keyword">. </span><span class="default">$tmp_name</span><span class="keyword">); <br>&nbsp; &nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$image_p</span><span class="keyword">, </span><span class="default">$image</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$new_width</span><span class="keyword">, </span><span class="default">$new_height</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">); <br>&nbsp; &nbsp; </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$image_p</span><span class="keyword">, </span><span class="default">$path </span><span class="keyword">. </span><span class="default">$new_name</span><span class="keyword">); <br>&nbsp; &nbsp; return </span><span class="default">$path</span><span class="keyword">.</span><span class="default">$new_name</span><span class="keyword">;<br>}<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="81273">  
  <a class="name">
  <strong class="user"><em>wm at violet dot bg</em></strong></a><div class="date" title="2008-02-20 01:16"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom81273">
<div class="phpcode"><code><span class="html">
This is a fixed version of ImageCopyResampledBicubic posted by liviu.malaescu<br>The original version wasn't respecting src_x &amp; src_y args<br><br><span class="default">&lt;?php<br>&nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">ImageCopyResampledBicubic</span><span class="keyword">(&amp;</span><span class="default">$dst_image</span><span class="keyword">, &amp;</span><span class="default">$src_image</span><span class="keyword">, </span><span class="default">$dst_x</span><span class="keyword">, </span><span class="default">$dst_y</span><span class="keyword">, </span><span class="default">$src_x</span><span class="keyword">, </span><span class="default">$src_y</span><span class="keyword">, </span><span class="default">$dst_w</span><span class="keyword">, </span><span class="default">$dst_h</span><span class="keyword">, </span><span class="default">$src_w</span><span class="keyword">, </span><span class="default">$src_h</span><span class="keyword">)&nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// we should first cut the piece we are interested in from the source<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$src_img </span><span class="keyword">= </span><span class="default">ImageCreateTrueColor</span><span class="keyword">(</span><span class="default">$src_w</span><span class="keyword">, </span><span class="default">$src_h</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$src_image</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$src_x</span><span class="keyword">, </span><span class="default">$src_y</span><span class="keyword">, </span><span class="default">$src_w</span><span class="keyword">, </span><span class="default">$src_h</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// this one is used as temporary image<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dst_img </span><span class="keyword">= </span><span class="default">ImageCreateTrueColor</span><span class="keyword">(</span><span class="default">$dst_w</span><span class="keyword">, </span><span class="default">$dst_h</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">ImagePaletteCopy</span><span class="keyword">(</span><span class="default">$dst_img</span><span class="keyword">, </span><span class="default">$src_img</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$rX </span><span class="keyword">= </span><span class="default">$src_w </span><span class="keyword">/ </span><span class="default">$dst_w</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$rY </span><span class="keyword">= </span><span class="default">$src_h </span><span class="keyword">/ </span><span class="default">$dst_h</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$w </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; for (</span><span class="default">$y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$y </span><span class="keyword">&lt; </span><span class="default">$dst_h</span><span class="keyword">; </span><span class="default">$y</span><span class="keyword">++)&nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ow </span><span class="keyword">= </span><span class="default">$w</span><span class="keyword">; </span><span class="default">$w </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">((</span><span class="default">$y </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">) * </span><span class="default">$rY</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$t </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (</span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt; </span><span class="default">$dst_w</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">++)&nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$r </span><span class="keyword">= </span><span class="default">$g </span><span class="keyword">= </span><span class="default">$b </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$a </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ot </span><span class="keyword">= </span><span class="default">$t</span><span class="keyword">; </span><span class="default">$t </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">((</span><span class="default">$x </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">) * </span><span class="default">$rX</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (</span><span class="default">$u </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$u </span><span class="keyword">&lt; (</span><span class="default">$w </span><span class="keyword">- </span><span class="default">$ow</span><span class="keyword">); </span><span class="default">$u</span><span class="keyword">++)&nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (</span><span class="default">$p </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$p </span><span class="keyword">&lt; (</span><span class="default">$t </span><span class="keyword">- </span><span class="default">$ot</span><span class="keyword">); </span><span class="default">$p</span><span class="keyword">++)&nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$c </span><span class="keyword">= </span><span class="default">ImageColorsForIndex</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">ImageColorAt</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$ot </span><span class="keyword">+ </span><span class="default">$p</span><span class="keyword">, </span><span class="default">$ow </span><span class="keyword">+ </span><span class="default">$u</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$r </span><span class="keyword">+= </span><span class="default">$c</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$g </span><span class="keyword">+= </span><span class="default">$c</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$b </span><span class="keyword">+= </span><span class="default">$c</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$a</span><span class="keyword">++;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">ImageSetPixel</span><span class="keyword">(</span><span class="default">$dst_img</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">ImageColorClosest</span><span class="keyword">(</span><span class="default">$dst_img</span><span class="keyword">, </span><span class="default">$r </span><span class="keyword">/ </span><span class="default">$a</span><span class="keyword">, </span><span class="default">$g </span><span class="keyword">/ </span><span class="default">$a</span><span class="keyword">, </span><span class="default">$b </span><span class="keyword">/ </span><span class="default">$a</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// apply the temp image over the returned image and use the destination x,y coordinates<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$dst_image</span><span class="keyword">, </span><span class="default">$dst_img</span><span class="keyword">, </span><span class="default">$dst_x</span><span class="keyword">, </span><span class="default">$dst_y</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$dst_w</span><span class="keyword">, </span><span class="default">$dst_h</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// we should return true since ImageCopyResampled/ImageCopyResized do it<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">return </span><span class="default">true</span><span class="keyword">;<br>&nbsp; &nbsp; }<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="90038">  
  <a class="name">
  <strong class="user"><em>satanas147 at gmail dot com</em></strong></a><div class="date" title="2009-04-02 08:33"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom90038">
<div class="phpcode"><code><span class="html">
Another add-on to previous php5 class for thumbnail (with a merge of Matt and Zorro's proposals).
<br>This is dedicated to generate thumbnail on the fly for a webpage using the subclass thumbnail.
<br>It saves the generated thumb as myimage_tn, in the same directory.
<br>I'm quite new with php5, so I think this could be optimized, but it seems to work fine.
<br>
<br><span class="default">&lt;?php
<br></span><span class="comment">// Imaging
<br></span><span class="keyword">class </span><span class="default">imaging
<br></span><span class="keyword">{
<br>&nbsp; &nbsp; </span><span class="comment">// Variables
<br>&nbsp; &nbsp; </span><span class="keyword">private </span><span class="default">$img_input</span><span class="keyword">;
<br>&nbsp; &nbsp; private </span><span class="default">$img_output</span><span class="keyword">;
<br>&nbsp; &nbsp; private </span><span class="default">$img_src</span><span class="keyword">;
<br>&nbsp; &nbsp; private </span><span class="default">$format</span><span class="keyword">;
<br>&nbsp; &nbsp; private </span><span class="default">$quality </span><span class="keyword">= </span><span class="default">80</span><span class="keyword">;
<br>&nbsp; &nbsp; private </span><span class="default">$x_input</span><span class="keyword">;
<br>&nbsp; &nbsp; private </span><span class="default">$y_input</span><span class="keyword">;
<br>&nbsp; &nbsp; private </span><span class="default">$x_output</span><span class="keyword">;
<br>&nbsp; &nbsp; private </span><span class="default">$y_output</span><span class="keyword">;
<br>&nbsp; &nbsp; private </span><span class="default">$resize</span><span class="keyword">;
<br>
<br>&nbsp; &nbsp; </span><span class="comment">// Set image
<br>&nbsp; &nbsp; </span><span class="keyword">public function </span><span class="default">set_img</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">)
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Find format
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ext </span><span class="keyword">= </span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">pathinfo</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">PATHINFO_EXTENSION</span><span class="keyword">));
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// JPEG image
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">) &amp;&amp; (</span><span class="default">$ext </span><span class="keyword">== </span><span class="string">"JPG" </span><span class="keyword">OR </span><span class="default">$ext </span><span class="keyword">== </span><span class="string">"JPEG"</span><span class="keyword">))
<br>&nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">format </span><span class="keyword">= </span><span class="default">$ext</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_input </span><span class="keyword">= </span><span class="default">ImageCreateFromJPEG</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_src </span><span class="keyword">= </span><span class="default">$img</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// PNG image
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">elseif(</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">) &amp;&amp; </span><span class="default">$ext </span><span class="keyword">== </span><span class="string">"PNG"</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">format </span><span class="keyword">= </span><span class="default">$ext</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_input </span><span class="keyword">= </span><span class="default">ImageCreateFromPNG</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_src </span><span class="keyword">= </span><span class="default">$img</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// GIF image
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">elseif(</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">) &amp;&amp; </span><span class="default">$ext </span><span class="keyword">== </span><span class="string">"GIF"</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">format </span><span class="keyword">= </span><span class="default">$ext</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_input </span><span class="keyword">= </span><span class="default">ImageCreateFromGIF</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_src </span><span class="keyword">= </span><span class="default">$img</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Get dimensions
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_input</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_input</span><span class="keyword">);
<br>&nbsp; &nbsp; }
<br>
<br>&nbsp; &nbsp; </span><span class="comment">// Set maximum image size (pixels)
<br>&nbsp; &nbsp; </span><span class="keyword">public function </span><span class="default">set_size</span><span class="keyword">(</span><span class="default">$max_x </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">,</span><span class="default">$max_y </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">)
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Resize
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input </span><span class="keyword">&gt; </span><span class="default">$max_x </span><span class="keyword">|| </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input </span><span class="keyword">&gt; </span><span class="default">$max_y</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$a</span><span class="keyword">= </span><span class="default">$max_x </span><span class="keyword">/ </span><span class="default">$max_y</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$b</span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input </span><span class="keyword">/ </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$a</span><span class="keyword">&lt;</span><span class="default">$b</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_output </span><span class="keyword">= </span><span class="default">$max_x</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_output </span><span class="keyword">= (</span><span class="default">$max_x </span><span class="keyword">/ </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input</span><span class="keyword">) * </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_output </span><span class="keyword">= </span><span class="default">$max_y</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_output </span><span class="keyword">= (</span><span class="default">$max_y </span><span class="keyword">/ </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input</span><span class="keyword">) * </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Ready
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resize </span><span class="keyword">= </span><span class="default">TRUE</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Don't resize&nbsp; &nbsp; &nbsp;&nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">else { </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resize </span><span class="keyword">= </span><span class="default">FALSE</span><span class="keyword">; }
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; </span><span class="comment">// Set image quality (JPEG only)
<br>&nbsp; &nbsp; </span><span class="keyword">public function </span><span class="default">set_quality</span><span class="keyword">(</span><span class="default">$quality</span><span class="keyword">)
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">is_int</span><span class="keyword">(</span><span class="default">$quality</span><span class="keyword">))
<br>&nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">quality </span><span class="keyword">= </span><span class="default">$quality</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; </span><span class="comment">// Save image
<br>&nbsp; &nbsp; </span><span class="keyword">public function </span><span class="default">save_img</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">)
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Resize
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resize</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_output </span><span class="keyword">= </span><span class="default">ImageCreateTrueColor</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_output</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_output</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">ImageCopyResampled</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_output</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_input</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_output</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_output</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Save JPEG
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">format </span><span class="keyword">== </span><span class="string">"JPG" </span><span class="keyword">OR </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">format </span><span class="keyword">== </span><span class="string">"JPEG"</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resize</span><span class="keyword">) { </span><span class="default">imageJPEG</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_output</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">quality</span><span class="keyword">); }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else { </span><span class="default">copy</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_src</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">); }
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Save PNG
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">elseif(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">format </span><span class="keyword">== </span><span class="string">"PNG"</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resize</span><span class="keyword">) { </span><span class="default">imagePNG</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_output</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">); }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else { </span><span class="default">copy</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_src</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">); }
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Save GIF
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">elseif(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">format </span><span class="keyword">== </span><span class="string">"GIF"</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resize</span><span class="keyword">) { </span><span class="default">imageGIF</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_output</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">); }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else { </span><span class="default">copy</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_src</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">); }
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; </span><span class="comment">// Get width
<br>&nbsp; &nbsp; </span><span class="keyword">public function </span><span class="default">get_width</span><span class="keyword">()
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; </span><span class="comment">// Get height
<br>&nbsp; &nbsp; </span><span class="keyword">public function </span><span class="default">get_height</span><span class="keyword">()
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; </span><span class="comment">// Clear image cache
<br>&nbsp; &nbsp; </span><span class="keyword">public function </span><span class="default">clear_cache</span><span class="keyword">()
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; @</span><span class="default">ImageDestroy</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_input</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; @</span><span class="default">ImageDestroy</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_output</span><span class="keyword">);
<br>&nbsp; &nbsp; }
<br>}
<br>class </span><span class="default">thumbnail </span><span class="keyword">extends </span><span class="default">imaging </span><span class="keyword">{
<br>&nbsp; &nbsp; private </span><span class="default">$image</span><span class="keyword">;
<br>&nbsp; &nbsp; private </span><span class="default">$width</span><span class="keyword">;
<br>&nbsp; &nbsp; private </span><span class="default">$height</span><span class="keyword">;
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">) {
<br></span><span class="default">parent</span><span class="keyword">::</span><span class="default">set_img</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);
<br></span><span class="default">parent</span><span class="keyword">::</span><span class="default">set_quality</span><span class="keyword">(</span><span class="default">80</span><span class="keyword">);
<br></span><span class="default">parent</span><span class="keyword">::</span><span class="default">set_size</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">thumbnail</span><span class="keyword">= </span><span class="default">pathinfo</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">PATHINFO_DIRNAME</span><span class="keyword">).</span><span class="default">pathinfo</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">PATHINFO_FILENAME</span><span class="keyword">).</span><span class="string">'_tn.'</span><span class="keyword">.</span><span class="default">pathinfo</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">PATHINFO_EXTENSION</span><span class="keyword">);
<br></span><span class="default">parent</span><span class="keyword">::</span><span class="default">save_img</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">thumbnail</span><span class="keyword">);
<br></span><span class="default">parent</span><span class="keyword">::</span><span class="default">clear_cache</span><span class="keyword">();
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; function </span><span class="default">__toString</span><span class="keyword">() {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">thumbnail</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>}
<br>
<br>********
<br>* </span><span class="default">DEMO </span><span class="keyword">*
<br>********
<br></span><span class="default">$thumb </span><span class="keyword">= new </span><span class="default">thumbnail</span><span class="keyword">(</span><span class="string">'./image_dir/sub_dir/myimage.jpg'</span><span class="keyword">,</span><span class="default">100</span><span class="keyword">,</span><span class="default">100</span><span class="keyword">);
<br>echo </span><span class="string">'&lt;img src=\''</span><span class="keyword">.</span><span class="default">$thumb</span><span class="keyword">.</span><span class="string">'\' alt=\'myimage\' title=\'myimage\'/&gt;'</span><span class="keyword">;
<br>
<br>&nbsp; &nbsp; </span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="94251">  
  <a class="name">
  <strong class="user"><em>seifer at loveletslive dot com</em></strong></a><div class="date" title="2009-10-25 05:27"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom94251">
<div class="phpcode"><code><span class="html">
Okay so I saw that others have posted this already but I just messed around and made it so figured I would share it.<br><br>Mine works, not to say others don't, I haven't tested them.<br><br>This function creates a thumbnail of the specfied size.<br>If the thumbnail is a different ration it will automatically crop the center of the source image.<br><br>It works if the source image is bigger or smaller than the desired "cropped thumbnail."<br><br>Here is the code...<br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">CroppedThumbnail</span><span class="keyword">(</span><span class="default">$imgSrc</span><span class="keyword">,</span><span class="default">$thumbnail_width</span><span class="keyword">,</span><span class="default">$thumbnail_height</span><span class="keyword">) { </span><span class="comment">//$imgSrc is a FILE - Returns an image resource.<br>&nbsp; &nbsp; //getting the image dimensions&nbsp; <br>&nbsp; &nbsp; </span><span class="keyword">list(</span><span class="default">$width_orig</span><span class="keyword">, </span><span class="default">$height_orig</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$imgSrc</span><span class="keyword">);&nbsp;&nbsp; <br>&nbsp; &nbsp; </span><span class="default">$myImage </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$imgSrc</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$ratio_orig </span><span class="keyword">= </span><span class="default">$width_orig</span><span class="keyword">/</span><span class="default">$height_orig</span><span class="keyword">;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; if (</span><span class="default">$thumbnail_width</span><span class="keyword">/</span><span class="default">$thumbnail_height </span><span class="keyword">&gt; </span><span class="default">$ratio_orig</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_height </span><span class="keyword">= </span><span class="default">$thumbnail_width</span><span class="keyword">/</span><span class="default">$ratio_orig</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_width </span><span class="keyword">= </span><span class="default">$thumbnail_width</span><span class="keyword">;<br>&nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_width </span><span class="keyword">= </span><span class="default">$thumbnail_height</span><span class="keyword">*</span><span class="default">$ratio_orig</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_height </span><span class="keyword">= </span><span class="default">$thumbnail_height</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="default">$x_mid </span><span class="keyword">= </span><span class="default">$new_width</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">;&nbsp; </span><span class="comment">//horizontal middle<br>&nbsp; &nbsp; </span><span class="default">$y_mid </span><span class="keyword">= </span><span class="default">$new_height</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">; </span><span class="comment">//vertical middle<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="default">$process </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">round</span><span class="keyword">(</span><span class="default">$new_width</span><span class="keyword">), </span><span class="default">round</span><span class="keyword">(</span><span class="default">$new_height</span><span class="keyword">)); <br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">, </span><span class="default">$myImage</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$new_width</span><span class="keyword">, </span><span class="default">$new_height</span><span class="keyword">, </span><span class="default">$width_orig</span><span class="keyword">, </span><span class="default">$height_orig</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$thumb </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$thumbnail_width</span><span class="keyword">, </span><span class="default">$thumbnail_height</span><span class="keyword">); <br>&nbsp; &nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">$process</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, (</span><span class="default">$x_mid</span><span class="keyword">-(</span><span class="default">$thumbnail_width</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">)), (</span><span class="default">$y_mid</span><span class="keyword">-(</span><span class="default">$thumbnail_height</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">)), </span><span class="default">$thumbnail_width</span><span class="keyword">, </span><span class="default">$thumbnail_height</span><span class="keyword">, </span><span class="default">$thumbnail_width</span><span class="keyword">, </span><span class="default">$thumbnail_height</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$myImage</span><span class="keyword">);<br>&nbsp; &nbsp; return </span><span class="default">$thumb</span><span class="keyword">;<br>}<br><br></span><span class="comment">//Create the thumbnail<br></span><span class="default">$newThumb </span><span class="keyword">= </span><span class="default">CroppedThumbnail</span><span class="keyword">(</span><span class="string">"MyImageName.jpg"</span><span class="keyword">,</span><span class="default">75</span><span class="keyword">,</span><span class="default">100</span><span class="keyword">);<br><br></span><span class="comment">// And display the image...<br></span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-type: image/jpeg'</span><span class="keyword">);<br></span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$newThumb</span><span class="keyword">);<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="90544">  
  <a class="name">
  <strong class="user"><em>z3n666 at gmail dot com</em></strong></a><div class="date" title="2009-04-27 11:19"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom90544">
<div class="phpcode"><code><span class="html">
I was looking around and couldn't find a function that resizes images to any ratio without leaving a blank area, so i wrote this one. It's able to resize images to any size ratio, when the ratio is no match with the original it will crop proportional area on the original and resize it.
<br>
<br><span class="default">&lt;?php
<br>
<br></span><span class="keyword">function </span><span class="default">_ckdir</span><span class="keyword">(</span><span class="default">$fn</span><span class="keyword">) {
<br>&nbsp; &nbsp; if (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$fn</span><span class="keyword">,</span><span class="string">"/"</span><span class="keyword">) !== </span><span class="default">false</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$p</span><span class="keyword">=</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$fn</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">strrpos</span><span class="keyword">(</span><span class="default">$fn</span><span class="keyword">,</span><span class="string">"/"</span><span class="keyword">));
<br>&nbsp; &nbsp; &nbsp; &nbsp; if (!</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">)) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">_o</span><span class="keyword">(</span><span class="string">"Mkdir: "</span><span class="keyword">.</span><span class="default">$p</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">mkdir</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">,</span><span class="default">777</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; }
<br>}
<br>function </span><span class="default">img_resizer</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">,</span><span class="default">$quality</span><span class="keyword">,</span><span class="default">$w</span><span class="keyword">,</span><span class="default">$h</span><span class="keyword">,</span><span class="default">$saveas</span><span class="keyword">) {
<br>&nbsp; &nbsp; </span><span class="comment">/* v2.5 with auto crop */
<br>&nbsp; &nbsp; </span><span class="default">$r</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$e</span><span class="keyword">=</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">,</span><span class="default">strrpos</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">,</span><span class="string">"."</span><span class="keyword">)+</span><span class="default">1</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">));
<br>&nbsp; &nbsp; if ((</span><span class="default">$e </span><span class="keyword">== </span><span class="string">"jpg"</span><span class="keyword">) || (</span><span class="default">$e </span><span class="keyword">== </span><span class="string">"peg"</span><span class="keyword">)) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$OldImage</span><span class="keyword">=</span><span class="default">ImageCreateFromJpeg</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">) or </span><span class="default">$r</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;
<br>&nbsp; &nbsp; } elseif (</span><span class="default">$e </span><span class="keyword">== </span><span class="string">"gif"</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$OldImage</span><span class="keyword">=</span><span class="default">ImageCreateFromGif</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">) or </span><span class="default">$r</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;
<br>&nbsp; &nbsp; } elseif (</span><span class="default">$e </span><span class="keyword">== </span><span class="string">"bmp"</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$OldImage</span><span class="keyword">=</span><span class="default">ImageCreateFromwbmp</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">) or </span><span class="default">$r</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;
<br>&nbsp; &nbsp; } elseif (</span><span class="default">$e </span><span class="keyword">== </span><span class="string">"png"</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$OldImage</span><span class="keyword">=</span><span class="default">ImageCreateFromPng</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">) or </span><span class="default">$r</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;
<br>&nbsp; &nbsp; } else {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">_o</span><span class="keyword">(</span><span class="string">"Not a Valid Image! ("</span><span class="keyword">.</span><span class="default">$e</span><span class="keyword">.</span><span class="string">") -- "</span><span class="keyword">.</span><span class="default">$src</span><span class="keyword">);</span><span class="default">$r</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; if (</span><span class="default">$r</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; list(</span><span class="default">$width</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">)=</span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// check if ratios match
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$_ratio</span><span class="keyword">=array(</span><span class="default">$width</span><span class="keyword">/</span><span class="default">$height</span><span class="keyword">,</span><span class="default">$w</span><span class="keyword">/</span><span class="default">$h</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$_ratio</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] != </span><span class="default">$_ratio</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]) { </span><span class="comment">// crop image
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // find the right scale to use
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$_scale</span><span class="keyword">=</span><span class="default">min</span><span class="keyword">((float)(</span><span class="default">$width</span><span class="keyword">/</span><span class="default">$w</span><span class="keyword">),(float)(</span><span class="default">$height</span><span class="keyword">/</span><span class="default">$h</span><span class="keyword">));
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// coords to crop
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$cropX</span><span class="keyword">=(float)(</span><span class="default">$width</span><span class="keyword">-(</span><span class="default">$_scale</span><span class="keyword">*</span><span class="default">$w</span><span class="keyword">));
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$cropY</span><span class="keyword">=(float)(</span><span class="default">$height</span><span class="keyword">-(</span><span class="default">$_scale</span><span class="keyword">*</span><span class="default">$h</span><span class="keyword">));&nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// cropped image size
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$cropW</span><span class="keyword">=(float)(</span><span class="default">$width</span><span class="keyword">-</span><span class="default">$cropX</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$cropH</span><span class="keyword">=(float)(</span><span class="default">$height</span><span class="keyword">-</span><span class="default">$cropY</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$crop</span><span class="keyword">=</span><span class="default">ImageCreateTrueColor</span><span class="keyword">(</span><span class="default">$cropW</span><span class="keyword">,</span><span class="default">$cropH</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// crop the middle part of the image to fit proportions
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">ImageCopy</span><span class="keyword">(
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$crop</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$OldImage</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">0</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">0</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (int)(</span><span class="default">$cropX</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">),
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (int)(</span><span class="default">$cropY</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">),
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$cropW</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$cropH
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// do the thumbnail
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$NewThumb</span><span class="keyword">=</span><span class="default">ImageCreateTrueColor</span><span class="keyword">(</span><span class="default">$w</span><span class="keyword">,</span><span class="default">$h</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; if (isset(</span><span class="default">$crop</span><span class="keyword">)) { </span><span class="comment">// been cropped
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">ImageCopyResampled</span><span class="keyword">(
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$NewThumb</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$crop</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">0</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">0</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">0</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">0</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$w</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$h</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$cropW</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$cropH
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">ImageDestroy</span><span class="keyword">(</span><span class="default">$crop</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; } else { </span><span class="comment">// ratio match, regular resize
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">ImageCopyResampled</span><span class="keyword">(
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$NewThumb</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$OldImage</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">0</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">0</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">0</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">0</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$w</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$h</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$width</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$height
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">_ckdir</span><span class="keyword">(</span><span class="default">$saveas</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">ImageJpeg</span><span class="keyword">(</span><span class="default">$NewThumb</span><span class="keyword">,</span><span class="default">$saveas</span><span class="keyword">,</span><span class="default">$quality</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">ImageDestroy</span><span class="keyword">(</span><span class="default">$NewThumb</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">ImageDestroy</span><span class="keyword">(</span><span class="default">$OldImage</span><span class="keyword">);
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; return </span><span class="default">$r</span><span class="keyword">;
<br>}
<br>
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="113009">  
  <a class="name">
  <strong class="user"><em>sam at durosoft.com</em></strong></a><div class="date" title="2013-08-17 06:18"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom113009">
<div class="phpcode"><code><span class="html">
The ultimate smart image re-sizing routine. You provide the original image, and a desired width and/or height. The function will intelligently re-size the original image to fit, centered, within the specified dimensions. Either width or height can be omitted to have the re-size "lock" only on width or height. Fantastic for thumbnail generation. Designed to work with PNG's.<br><br>function resize_image_smart($orig, $dest_width=null, $dest_height=null)<br>{<br>&nbsp; $orig_width = imagesx($orig);<br>&nbsp; $orig_height = imagesy($orig);<br>&nbsp; $vertical_offset = 0;<br>&nbsp; $horizontal_offset = 0;<br>&nbsp; if($dest_width == null)<br>&nbsp; {<br>&nbsp; &nbsp; if($dest_height == null)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; die('$dest_width and $dest_height cant both be null!');<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; // height is locked<br>&nbsp; &nbsp; $dest_width = $dest_height * $orig_width / $orig_height;<br>&nbsp; } else {<br>&nbsp; &nbsp; if($dest_height == null)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; // width is locked<br>&nbsp; &nbsp; &nbsp; $dest_height = $dest_width * $orig_height / $orig_width;<br>&nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; // both dimensions are locked<br>&nbsp; &nbsp; &nbsp; $vertical_offset = $dest_height - ($orig_height * $dest_width) / $orig_width;<br>&nbsp; &nbsp; &nbsp; $horizontal_offset = $dest_width - ($dest_height * $orig_width) / $orig_height;<br>&nbsp; &nbsp; &nbsp; if($vertical_offset &lt; 0) $vertical_offset = 0;<br>&nbsp; &nbsp; &nbsp; if($horizontal_offset &lt; 0) $horizontal_offset = 0;<br>&nbsp; &nbsp; }<br>&nbsp; }<br>&nbsp; $img = imagecreatetruecolor($dest_width, $dest_height);<br>&nbsp; imagesavealpha($img, true);<br>&nbsp; imagealphablending($img, false);<br>&nbsp; $transparent = imagecolorallocatealpha($img, 0, 0, 0, 127);<br>&nbsp; imagefill($img, 0, 0, $transparent);<br>&nbsp; imagecopyresampled($img, $orig, round($horizontal_offset / 2),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; round($vertical_offset / 2),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; round($dest_width - $horizontal_offset),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; round($dest_height - $vertical_offset),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $orig_width,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $orig_height);<br>&nbsp; return $img;<br>}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="110592">  
  <a class="name">
  <strong class="user"><em>alex-thennstaett-remove at gmx dot net</em></strong></a><div class="date" title="2012-11-10 05:06"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom110592">
<div class="phpcode"><code><span class="html">
Having updated GD-Library from 2.0.35-r1 to 2.0.35-r3 using negative numbers for $dstX or $dstY started to produce unpredictable results, such as inserting shrinked images and enlarging $dstH or $dstW all by itself. While it did work fine previously, one should avoid using or calculating negative numbers for imagecopyresampled from the beginning.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="61169">  
  <a class="name">
  <strong class="user"><em>areddan at silverarm dot ie</em></strong></a><div class="date" title="2006-01-27 12:40"><strong>15 years ago</strong></div>
  <div class="text" id="Hcom61169">
<div class="phpcode"><code><span class="html">
<span class="default">&lt;?php<br></span><span class="comment">// The file<br></span><span class="default">$filein </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">; </span><span class="comment">// File in<br></span><span class="default">$fileout </span><span class="keyword">= </span><span class="string">'ttt.gif'</span><span class="keyword">; </span><span class="comment">// Fileout - optional <br><br></span><span class="default">$imagethumbsize_w </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">; </span><span class="comment">// thumbnail size (area cropped in middle of image)<br></span><span class="default">$imagethumbsize_h </span><span class="keyword">= </span><span class="default">75</span><span class="keyword">; </span><span class="comment">// thumbnail size (area cropped in middle of image)<br></span><span class="default">resize_then_crop</span><span class="keyword">( </span><span class="default">$filein</span><span class="keyword">,</span><span class="default">$fileout</span><span class="keyword">,</span><span class="default">$imagethumbsize_w</span><span class="keyword">,<br></span><span class="default">$imagethumbsize_h</span><span class="keyword">,</span><span class="comment">/*rgb*/</span><span class="string">"255"</span><span class="keyword">,</span><span class="string">"255"</span><span class="keyword">,</span><span class="string">"255"</span><span class="keyword">);<br><br></span><span class="comment">//Author Alan Reddan Silverarm Solutions<br>//Date 27/01/2005<br>//Function that works well with images.<br>//It takes the image and reduces its size to best fit. i.e If you have an image<br>//that is 200 X 100 and you want a thumbnail of 75 X 50,<br>//it first resizes the image to 100 X 50<br>//and then takes out a portion 75 X 50 from then center of the input image.<br>//So loads of image information is retained.<br>//The corollary also holds if your input image is 100 X 200<br>//it first resizes image to 75 X 150 and then takes out a<br>//portion 75 X 75 from the centre<br>// The advantage here is that function decides on whether<br>//resize is by width or height itself.<br>//it also decides whether to use the height or the width as the base start point<br>//in the case that athumbnail is rectangular<br><br></span><span class="keyword">function </span><span class="default">resize_then_crop</span><span class="keyword">( </span><span class="default">$filein</span><span class="keyword">,</span><span class="default">$fileout</span><span class="keyword">,<br></span><span class="default">$imagethumbsize_w</span><span class="keyword">,</span><span class="default">$imagethumbsize_h</span><span class="keyword">,</span><span class="default">$red</span><span class="keyword">,</span><span class="default">$green</span><span class="keyword">,</span><span class="default">$blue</span><span class="keyword">)<br>{<br><br></span><span class="comment">// Get new dimensions<br></span><span class="keyword">list(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$filein</span><span class="keyword">);<br></span><span class="default">$new_width </span><span class="keyword">= </span><span class="default">$width </span><span class="keyword">* </span><span class="default">$percent</span><span class="keyword">;<br></span><span class="default">$new_height </span><span class="keyword">= </span><span class="default">$height </span><span class="keyword">* </span><span class="default">$percent</span><span class="keyword">;<br><br>&nbsp;&nbsp; if(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/.jpg/i"</span><span class="keyword">, </span><span class="string">"</span><span class="default">$filein</span><span class="string">"</span><span class="keyword">))<br>&nbsp;&nbsp; {<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$format </span><span class="keyword">= </span><span class="string">'image/jpeg'</span><span class="keyword">;<br>&nbsp;&nbsp; }<br>&nbsp;&nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/.gif/i"</span><span class="keyword">, </span><span class="string">"</span><span class="default">$filein</span><span class="string">"</span><span class="keyword">))<br>&nbsp;&nbsp; {<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$format </span><span class="keyword">= </span><span class="string">'image/gif'</span><span class="keyword">;<br>&nbsp;&nbsp; }<br>&nbsp;&nbsp; if(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/.png/i"</span><span class="keyword">, </span><span class="string">"</span><span class="default">$filein</span><span class="string">"</span><span class="keyword">))<br>&nbsp;&nbsp; {<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$format </span><span class="keyword">= </span><span class="string">'image/png'</span><span class="keyword">;<br>&nbsp;&nbsp; }<br>&nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp;&nbsp; switch(</span><span class="default">$format</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp;&nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'image/jpeg'</span><span class="keyword">:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$image </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$filein</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'image/gif'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$image </span><span class="keyword">= </span><span class="default">imagecreatefromgif</span><span class="keyword">(</span><span class="default">$filein</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'image/png'</span><span class="keyword">:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$image </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$filein</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br>&nbsp; &nbsp; &nbsp;&nbsp; }<br><br></span><span class="default">$width </span><span class="keyword">= </span><span class="default">$imagethumbsize_w </span><span class="keyword">;<br></span><span class="default">$height </span><span class="keyword">= </span><span class="default">$imagethumbsize_h </span><span class="keyword">;<br>list(</span><span class="default">$width_orig</span><span class="keyword">, </span><span class="default">$height_orig</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$filein</span><span class="keyword">);<br><br>if (</span><span class="default">$width_orig </span><span class="keyword">&lt; </span><span class="default">$height_orig</span><span class="keyword">) {<br>&nbsp; </span><span class="default">$height </span><span class="keyword">= (</span><span class="default">$imagethumbsize_w </span><span class="keyword">/ </span><span class="default">$width_orig</span><span class="keyword">) * </span><span class="default">$height_orig</span><span class="keyword">;<br>} else {<br>&nbsp; &nbsp; </span><span class="default">$width </span><span class="keyword">= (</span><span class="default">$imagethumbsize_h </span><span class="keyword">/ </span><span class="default">$height_orig</span><span class="keyword">) * </span><span class="default">$width_orig</span><span class="keyword">;<br>}<br><br>if (</span><span class="default">$width </span><span class="keyword">&lt; </span><span class="default">$imagethumbsize_w</span><span class="keyword">)<br></span><span class="comment">//if the width is smaller than supplied thumbnail size <br></span><span class="keyword">{<br></span><span class="default">$width </span><span class="keyword">= </span><span class="default">$imagethumbsize_w</span><span class="keyword">;<br></span><span class="default">$height </span><span class="keyword">= (</span><span class="default">$imagethumbsize_w</span><span class="keyword">/ </span><span class="default">$width_orig</span><span class="keyword">) * </span><span class="default">$height_orig</span><span class="keyword">;;<br>}<br><br>if (</span><span class="default">$height </span><span class="keyword">&lt; </span><span class="default">$imagethumbsize_h</span><span class="keyword">)<br></span><span class="comment">//if the height is smaller than supplied thumbnail size <br></span><span class="keyword">{<br></span><span class="default">$height </span><span class="keyword">= </span><span class="default">$imagethumbsize_h</span><span class="keyword">;<br></span><span class="default">$width </span><span class="keyword">= (</span><span class="default">$imagethumbsize_h </span><span class="keyword">/ </span><span class="default">$height_orig</span><span class="keyword">) * </span><span class="default">$width_orig</span><span class="keyword">;<br>}<br><br></span><span class="default">$thumb </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$width </span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);&nbsp; <br></span><span class="default">$bgcolor </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">$red</span><span class="keyword">, </span><span class="default">$green</span><span class="keyword">, </span><span class="default">$blue</span><span class="keyword">);&nbsp;&nbsp; <br></span><span class="default">ImageFilledRectangle</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">, </span><span class="default">$bgcolor</span><span class="keyword">);<br></span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br><br></span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">$image</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,<br></span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">, </span><span class="default">$width_orig</span><span class="keyword">, </span><span class="default">$height_orig</span><span class="keyword">);<br></span><span class="default">$thumb2 </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$imagethumbsize_w </span><span class="keyword">, </span><span class="default">$imagethumbsize_h</span><span class="keyword">);<br></span><span class="comment">// true color for best quality<br></span><span class="default">$bgcolor </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$thumb2</span><span class="keyword">, </span><span class="default">$red</span><span class="keyword">, </span><span class="default">$green</span><span class="keyword">, </span><span class="default">$blue</span><span class="keyword">);&nbsp;&nbsp; <br></span><span class="default">ImageFilledRectangle</span><span class="keyword">(</span><span class="default">$thumb2</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,<br></span><span class="default">$imagethumbsize_w </span><span class="keyword">, </span><span class="default">$imagethumbsize_h </span><span class="keyword">, </span><span class="default">$white</span><span class="keyword">);<br></span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$thumb2</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br><br></span><span class="default">$w1 </span><span class="keyword">=(</span><span class="default">$width</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">) - (</span><span class="default">$imagethumbsize_w</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">);<br></span><span class="default">$h1 </span><span class="keyword">= (</span><span class="default">$height</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">) - (</span><span class="default">$imagethumbsize_h</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">);<br><br></span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$thumb2</span><span class="keyword">, </span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">, </span><span class="default">$w1</span><span class="keyword">, </span><span class="default">$h1</span><span class="keyword">,<br></span><span class="default">$imagethumbsize_w </span><span class="keyword">, </span><span class="default">$imagethumbsize_h </span><span class="keyword">,</span><span class="default">$imagethumbsize_w</span><span class="keyword">, </span><span class="default">$imagethumbsize_h</span><span class="keyword">);<br><br></span><span class="comment">// Output<br>//header('Content-type: image/gif');<br>//imagegif($thumb); //output to browser first image when testing<br><br></span><span class="keyword">if (</span><span class="default">$fileout </span><span class="keyword">!=</span><span class="string">""</span><span class="keyword">)</span><span class="default">imagegif</span><span class="keyword">(</span><span class="default">$thumb2</span><span class="keyword">, </span><span class="default">$fileout</span><span class="keyword">); </span><span class="comment">//write to file<br></span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-type: image/gif'</span><span class="keyword">);<br></span><span class="default">imagegif</span><span class="keyword">(</span><span class="default">$thumb2</span><span class="keyword">); </span><span class="comment">//output to browser<br></span><span class="keyword">}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="123343">  
  <a class="name">
  <strong class="user"><em>aykuty at gmail dot com</em></strong></a><div class="date" title="2018-11-14 08:21"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom123343">
<div class="phpcode"><code><span class="html">
scale image with ratio and then completes to the canvas size by centering <br><br><span class="default">&lt;?php<br><br></span><span class="comment">/* <br>verilen maksimum deÄŸerlere gÃ¶re resmi boyutlandÄ±rÄ±r ve beyaz renk ile cerceveye ortalar. trendyol entegrasyonu iÃ§in yazmÄ±ÅŸtÄ±m.<br><br>Aykut YILDIZGÃ–RÃœR <br>aykuty add gmail dot com<br>*/<br><br></span><span class="keyword">function </span><span class="default">set_image2canvas</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">$new_file</span><span class="keyword">, </span><span class="default">$canvas_width</span><span class="keyword">=</span><span class="default">1200</span><span class="keyword">, </span><span class="default">$canvas_height </span><span class="keyword">=</span><span class="default">1800</span><span class="keyword">, </span><span class="default">$quality</span><span class="keyword">=</span><span class="default">100</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; if (!</span><span class="default">file_exists</span><span class="keyword">( </span><span class="default">$new_file </span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; list(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">, </span><span class="default">$type</span><span class="keyword">, </span><span class="default">$attr</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">( </span><span class="default">$file </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$width</span><span class="keyword">&gt; </span><span class="default">$height</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$width_tt</span><span class="keyword">=</span><span class="default">$canvas_width</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$height_tt</span><span class="keyword">=</span><span class="default">round</span><span class="keyword">(</span><span class="default">$height</span><span class="keyword">/</span><span class="default">$width</span><span class="keyword">*</span><span class="default">$canvas_width</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$off_y </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">(( </span><span class="default">$canvas_height </span><span class="keyword">- </span><span class="default">$height_tt</span><span class="keyword">)/</span><span class="default">2</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$off_x</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$height_tt</span><span class="keyword">=</span><span class="default">$canvas_height</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$width_tt</span><span class="keyword">=</span><span class="default">round</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">/</span><span class="default">$height</span><span class="keyword">*</span><span class="default">$canvas_height</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$off_x</span><span class="keyword">=</span><span class="default">ceil</span><span class="keyword">((</span><span class="default">$canvas_width </span><span class="keyword">- </span><span class="default">$width_tt</span><span class="keyword">)/</span><span class="default">2</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$off_y</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$thumb</span><span class="keyword">=</span><span class="default">imagecreatefromjpeg</span><span class="keyword">( </span><span class="default">$file </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$thumb_p </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$canvas_width</span><span class="keyword">, </span><span class="default">$canvas_height</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$bg </span><span class="keyword">= </span><span class="default">imagecolorallocate </span><span class="keyword">( </span><span class="default">$thumb_p</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255 </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagefill </span><span class="keyword">( </span><span class="default">$thumb_p</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$bg </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$thumb_p</span><span class="keyword">, </span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">$off_x</span><span class="keyword">, </span><span class="default">$off_y</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$width_tt</span><span class="keyword">, </span><span class="default">$height_tt</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$thumb_p</span><span class="keyword">,</span><span class="default">$new_file</span><span class="keyword">,</span><span class="default">$quality</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; }else{ </span><span class="comment">//hedef resim zaten var<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">return -</span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="114758">  
  <a class="name">
  <strong class="user"><em>julien at go-on-web dot com</em></strong></a><div class="date" title="2014-04-02 08:59"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom114758">
<div class="phpcode"><code><span class="html">
Windows does not accept floating width and height...<br><br>So, in "Example #2 Resampling an image proportionally", prefer :<br><span class="default">&lt;?php<br></span><span class="keyword">if (</span><span class="default">$width</span><span class="keyword">/</span><span class="default">$height </span><span class="keyword">&gt; </span><span class="default">$ratio_orig</span><span class="keyword">) {<br>&nbsp;&nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">( </span><span class="default">$height</span><span class="keyword">*</span><span class="default">$ratio_orig </span><span class="keyword">);<br>} else {<br>&nbsp;&nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">( </span><span class="default">$width</span><span class="keyword">/</span><span class="default">$ratio_orig </span><span class="keyword">);<br>}<br></span><span class="default">?&gt;<br></span>(used "round")<br>otherwise your image wont be resized.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="112275">  
  <a class="name">
  <strong class="user"><em>hoangvu4000 at gmail dot com</em></strong></a><div class="date" title="2013-05-26 05:50"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom112275">
<div class="phpcode"><code><span class="html">
My complete function to resize an image&nbsp; with exif data
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">CreateThumbnail</span><span class="keyword">(</span><span class="default">$pic</span><span class="keyword">,</span><span class="default">$thumb</span><span class="keyword">,</span><span class="default">$thumbwidth</span><span class="keyword">, </span><span class="default">$quality </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">)
<br>{
<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$im1</span><span class="keyword">=</span><span class="default">ImageCreateFromJPEG</span><span class="keyword">(</span><span class="default">$pic</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">"exif_read_data"</span><span class="keyword">)){
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$exif </span><span class="keyword">= </span><span class="default">exif_read_data</span><span class="keyword">(</span><span class="default">$pic</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(!empty(</span><span class="default">$exif</span><span class="keyword">[</span><span class="string">'Orientation'</span><span class="keyword">])) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; switch(</span><span class="default">$exif</span><span class="keyword">[</span><span class="string">'Orientation'</span><span class="keyword">]) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">8</span><span class="keyword">:
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$im1 </span><span class="keyword">= </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$im1</span><span class="keyword">,</span><span class="default">90</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">3</span><span class="keyword">:
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$im1 </span><span class="keyword">= </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$im1</span><span class="keyword">,</span><span class="default">180</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">6</span><span class="keyword">:
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$im1 </span><span class="keyword">= </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$im1</span><span class="keyword">,-</span><span class="default">90</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$info </span><span class="keyword">= @</span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$pic</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">$info</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];
<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$w2</span><span class="keyword">=</span><span class="default">ImageSx</span><span class="keyword">(</span><span class="default">$im1</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$h2</span><span class="keyword">=</span><span class="default">ImageSy</span><span class="keyword">(</span><span class="default">$im1</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$w1 </span><span class="keyword">= (</span><span class="default">$thumbwidth </span><span class="keyword">&lt;= </span><span class="default">$info</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]) ? </span><span class="default">$thumbwidth </span><span class="keyword">: </span><span class="default">$info</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]&nbsp; ;
<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$h1</span><span class="keyword">=</span><span class="default">floor</span><span class="keyword">(</span><span class="default">$h2</span><span class="keyword">*(</span><span class="default">$w1</span><span class="keyword">/</span><span class="default">$w2</span><span class="keyword">));
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$im2</span><span class="keyword">=</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$w1</span><span class="keyword">,</span><span class="default">$h1</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagecopyresampled </span><span class="keyword">(</span><span class="default">$im2</span><span class="keyword">,</span><span class="default">$im1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$w1</span><span class="keyword">,</span><span class="default">$h1</span><span class="keyword">,</span><span class="default">$w2</span><span class="keyword">,</span><span class="default">$h2</span><span class="keyword">); 
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$path</span><span class="keyword">=</span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">ImageJPEG</span><span class="keyword">(</span><span class="default">$im2</span><span class="keyword">,</span><span class="default">$path</span><span class="keyword">,</span><span class="default">$quality</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">ImageDestroy</span><span class="keyword">(</span><span class="default">$im1</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">ImageDestroy</span><span class="keyword">(</span><span class="default">$im2</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="98560">  
  <a class="name">
  <strong class="user"><em>guru_boy87 at hotmail dot com</em></strong></a><div class="date" title="2010-06-23 04:52"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom98560">
<div class="phpcode"><code><span class="html">
Function to resize an image.
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">resizeImage</span><span class="keyword">(</span><span class="default">$originalImage</span><span class="keyword">,</span><span class="default">$toWidth</span><span class="keyword">,</span><span class="default">$toHeight</span><span class="keyword">)
<br>{
<br>
<br>&nbsp; &nbsp; list(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$originalImage</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$xscale</span><span class="keyword">=</span><span class="default">$width</span><span class="keyword">/</span><span class="default">$toWidth</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$yscale</span><span class="keyword">=</span><span class="default">$height</span><span class="keyword">/</span><span class="default">$toHeight</span><span class="keyword">;
<br>
<br>&nbsp; &nbsp; if (</span><span class="default">$yscale</span><span class="keyword">&gt;</span><span class="default">$xscale</span><span class="keyword">){
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$new_width </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">$width </span><span class="keyword">* (</span><span class="default">1</span><span class="keyword">/</span><span class="default">$yscale</span><span class="keyword">));
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$new_height </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">$height </span><span class="keyword">* (</span><span class="default">1</span><span class="keyword">/</span><span class="default">$yscale</span><span class="keyword">));
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; else {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$new_width </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">$width </span><span class="keyword">* (</span><span class="default">1</span><span class="keyword">/</span><span class="default">$xscale</span><span class="keyword">));
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$new_height </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">$height </span><span class="keyword">* (</span><span class="default">1</span><span class="keyword">/</span><span class="default">$xscale</span><span class="keyword">));
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="default">$imageResized </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$new_width</span><span class="keyword">, </span><span class="default">$new_height</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$imageTmp&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg </span><span class="keyword">(</span><span class="default">$originalImage</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$imageResized</span><span class="keyword">, </span><span class="default">$imageTmp</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$new_width</span><span class="keyword">, </span><span class="default">$new_height</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; return </span><span class="default">$imageResized</span><span class="keyword">;
<br>&nbsp; &nbsp; 
<br>
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="93166">  
  <a class="name">
  <strong class="user"><em>asgaroth dot belem at gmail dot com</em></strong></a><div class="date" title="2009-08-26 11:38"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom93166">
<div class="phpcode"><code><span class="html">
About preserving the&nbsp; transparency when resizing PNGs this was the only thing that worked for me:<br><br><span class="default">&lt;?php imagealphablending</span><span class="keyword">(</span><span class="default">$new_watermark</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$new_watermark</span><span class="keyword">, </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$new_watermark</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">127</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$new_watermark</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$new_watermark</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$new_watermark</span><span class="keyword">, </span><span class="default">$watermark</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$new_watermark_width</span><span class="keyword">, </span><span class="default">$new_watermark_height</span><span class="keyword">, </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$watermark</span><span class="keyword">),</span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$watermark</span><span class="keyword">)); <br></span><span class="default">?&gt;<br></span><br>Tried without success:<br><br><span class="default">&lt;?php imagealphablending</span><span class="keyword">(</span><span class="default">$new_watermark</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$new_watermark</span><span class="keyword">, </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$new_watermark</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$new_watermark</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$new_watermark</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$new_watermark</span><span class="keyword">, </span><span class="default">$watermark</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$new_watermark_width</span><span class="keyword">, </span><span class="default">$new_watermark_height</span><span class="keyword">, </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$watermark</span><span class="keyword">),</span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$watermark</span><span class="keyword">));<br> </span><span class="default">?&gt;<br></span><br>hope it helps someone.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="89987">  
  <a class="name">
  <strong class="user"><em>zuegs</em></strong></a><div class="date" title="2009-03-31 10:52"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom89987">
<div class="phpcode"><code><span class="html">
Resampling GIFs and retain transparency dosen't work always, as dependent on the resample factor the resulting resampled image has some pattern-noise that prevents "imagegif" to find all the transparent-pixels.<br>One way to fix this, is to reset all pixels with high alpha to full-transparent:<br><span class="default">&lt;?php<br></span><span class="comment">// load/create images<br></span><span class="default">$img_src</span><span class="keyword">=</span><span class="default">imagecreatefromgif</span><span class="keyword">(</span><span class="default">$g_srcfile</span><span class="keyword">);<br></span><span class="default">$img_dst</span><span class="keyword">=</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$g_iw</span><span class="keyword">,</span><span class="default">$g_ih</span><span class="keyword">);<br></span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br><br></span><span class="comment">// get and reallocate transparency-color<br></span><span class="default">$transindex </span><span class="keyword">= </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$img_src</span><span class="keyword">);<br>if(</span><span class="default">$transindex </span><span class="keyword">&gt;= </span><span class="default">0</span><span class="keyword">) {<br>&nbsp; </span><span class="default">$transcol </span><span class="keyword">= </span><span class="default">imagecolorsforindex</span><span class="keyword">(</span><span class="default">$img_src</span><span class="keyword">, </span><span class="default">$transindex</span><span class="keyword">);<br>&nbsp; </span><span class="default">$transindex </span><span class="keyword">= </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">$transcol</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">], </span><span class="default">$transcol</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">], </span><span class="default">$transcol</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">], </span><span class="default">127</span><span class="keyword">);<br>&nbsp; </span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$transindex</span><span class="keyword">);<br>}<br><br></span><span class="comment">// resample<br></span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">$img_src</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$g_iw</span><span class="keyword">, </span><span class="default">$g_ih</span><span class="keyword">, </span><span class="default">$g_is</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$g_is</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br><br></span><span class="comment">// restore transparency<br></span><span class="keyword">if(</span><span class="default">$transindex </span><span class="keyword">&gt;= </span><span class="default">0</span><span class="keyword">) {<br>&nbsp; </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">$transindex</span><span class="keyword">);<br>&nbsp; for(</span><span class="default">$y</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$y</span><span class="keyword">&lt;</span><span class="default">$g_ih</span><span class="keyword">; ++</span><span class="default">$y</span><span class="keyword">)<br>&nbsp; &nbsp; for(</span><span class="default">$x</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">&lt;</span><span class="default">$g_iw</span><span class="keyword">; ++</span><span class="default">$x</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; if(((</span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">)&gt;&gt;</span><span class="default">24</span><span class="keyword">) &amp; </span><span class="default">0x7F</span><span class="keyword">) &gt;= </span><span class="default">100</span><span class="keyword">) </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$transindex</span><span class="keyword">);<br><br></span><span class="comment">// save GIF<br></span><span class="default">imagetruecolortopalette</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">);<br></span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br></span><span class="default">imagegif</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">$g_dstfile</span><span class="keyword">); <br></span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">); <br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="88263">  
  <a class="name">
  <strong class="user"><em>Warren</em></strong></a><div class="date" title="2009-01-17 11:15"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom88263">
<div class="phpcode"><code><span class="html">
This is a function I wrote for making thumbnails -&nbsp; it will accept a source *image resource* and destination *path*, plus the max dimension and whether the thumbnail should be square.
<br>
<br>I chose to accept a resource as the source to make it a bit more efficient to create multiple sizes. For example:
<br>
<br><span class="default">&lt;?php
<br>$src_im</span><span class="keyword">=@</span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$pathtofile</span><span class="keyword">);
<br></span><span class="default">$large </span><span class="keyword">= </span><span class="default">resize</span><span class="keyword">(</span><span class="default">$src_im</span><span class="keyword">,</span><span class="default">$destination_large</span><span class="keyword">,</span><span class="default">1024</span><span class="keyword">);
<br>@</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$src_im</span><span class="keyword">);
<br></span><span class="default">$medium </span><span class="keyword">= </span><span class="default">resize</span><span class="keyword">(</span><span class="default">$large</span><span class="keyword">,</span><span class="default">$destination_medium</span><span class="keyword">,</span><span class="default">500</span><span class="keyword">);
<br>@</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$large</span><span class="keyword">);
<br></span><span class="default">$small </span><span class="keyword">= </span><span class="default">resize</span><span class="keyword">(</span><span class="default">$medium</span><span class="keyword">,</span><span class="default">$destination_small</span><span class="keyword">,</span><span class="default">125</span><span class="keyword">);
<br>@</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$medium</span><span class="keyword">);
<br></span><span class="default">$square </span><span class="keyword">= </span><span class="default">resize</span><span class="keyword">(</span><span class="default">$small</span><span class="keyword">,</span><span class="default">$destination_square</span><span class="keyword">,</span><span class="default">75</span><span class="keyword">,</span><span class="default">TRUE</span><span class="keyword">);
<br>@</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$small</span><span class="keyword">);
<br>@</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$square</span><span class="keyword">);
<br>
<br>function </span><span class="default">resize</span><span class="keyword">(</span><span class="default">$src_im</span><span class="keyword">, </span><span class="default">$dpath</span><span class="keyword">, </span><span class="default">$maxd</span><span class="keyword">, </span><span class="default">$square</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">) {
<br>&nbsp; &nbsp; </span><span class="default">$src_width </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$src_im</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$src_height </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$src_im</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$src_w</span><span class="keyword">=</span><span class="default">$src_width</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$src_h</span><span class="keyword">=</span><span class="default">$src_height</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$src_x</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$src_y</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;
<br>&nbsp; &nbsp; if(</span><span class="default">$square</span><span class="keyword">){
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dst_w </span><span class="keyword">= </span><span class="default">$maxd</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dst_h </span><span class="keyword">= </span><span class="default">$maxd</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$src_width</span><span class="keyword">&gt;</span><span class="default">$src_height</span><span class="keyword">){
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$src_x </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">((</span><span class="default">$src_width</span><span class="keyword">-</span><span class="default">$src_height</span><span class="keyword">)/</span><span class="default">2</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$src_w</span><span class="keyword">=</span><span class="default">$src_height</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$src_h</span><span class="keyword">=</span><span class="default">$src_height</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; }else{
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$src_y </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">((</span><span class="default">$src_height</span><span class="keyword">-</span><span class="default">$src_width</span><span class="keyword">)/</span><span class="default">2</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$src_w</span><span class="keyword">=</span><span class="default">$src_width</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$src_h</span><span class="keyword">=</span><span class="default">$src_width</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; }else{
<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$src_width</span><span class="keyword">&gt;</span><span class="default">$src_height</span><span class="keyword">){
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dst_w</span><span class="keyword">=</span><span class="default">$maxd</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dst_h</span><span class="keyword">=</span><span class="default">floor</span><span class="keyword">(</span><span class="default">$src_height</span><span class="keyword">*(</span><span class="default">$dst_w</span><span class="keyword">/</span><span class="default">$src_width</span><span class="keyword">));
<br>&nbsp; &nbsp; &nbsp; &nbsp; }else{
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dst_h</span><span class="keyword">=</span><span class="default">$maxd</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dst_w</span><span class="keyword">=</span><span class="default">floor</span><span class="keyword">(</span><span class="default">$src_width</span><span class="keyword">*(</span><span class="default">$dst_h</span><span class="keyword">/</span><span class="default">$src_height</span><span class="keyword">));
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; </span><span class="default">$dst_im</span><span class="keyword">=@</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$dst_w</span><span class="keyword">,</span><span class="default">$dst_h</span><span class="keyword">);
<br>&nbsp; &nbsp; @</span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$dst_im</span><span class="keyword">, </span><span class="default">$src_im</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$src_x</span><span class="keyword">, </span><span class="default">$src_y</span><span class="keyword">, </span><span class="default">$dst_w</span><span class="keyword">, </span><span class="default">$dst_h</span><span class="keyword">, </span><span class="default">$src_w</span><span class="keyword">, </span><span class="default">$src_h</span><span class="keyword">);
<br>&nbsp; &nbsp; @</span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$dst_im</span><span class="keyword">,</span><span class="default">$dpath</span><span class="keyword">);
<br>&nbsp; &nbsp; return </span><span class="default">$dst_im</span><span class="keyword">;
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="93190">  
  <a class="name">
  <strong class="user"><em>asgaroth dot belem at gmail dot com</em></strong></a><div class="date" title="2009-08-27 12:42"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom93190">
<div class="phpcode"><code><span class="html">
In case you are having trouble ( like I did ) and getting some kind of noise in the resampled image.<br><br>then changing imagecopyresampled() with imagecopyresized()&nbsp; removes the noise, found that here: <a rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=45030</a><br><br>Do not ask me why. but it works.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="78239">  
  <a class="name">
  <strong class="user"><em>tim dot daldini at gmail dot be</em></strong></a><div class="date" title="2007-10-03 08:57"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom78239">
<div class="phpcode"><code><span class="html">
Tim's function is a whole lot faster, however, the quality setting doesnt seem right since resizing very big images doesnt affect quality of the resulting thumbnails that much on quality 1 for example.<br><br>Anyone has figured out how to use a more correct quality setting by comparing image surfaces (for example) basing on Tim's function?<br><br>images with a total of 10Megapixels that contain 5Megapixels when resized should use the same quality setting like images that contain 1Megapixels but only 0.5 when resized.<br><br>Not hard to understand, but the memoryload would be a lot lower if the function could decide to use a setting of quality 1 automatically when resizing big images to small thumbnails. This would be handy especially when using the function for images of various sizes in the same application.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="84516">  
  <a class="name">
  <strong class="user"><em>swizec at swizec dot com</em></strong></a><div class="date" title="2008-07-17 02:20"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom84516">
<div class="phpcode"><code><span class="html">
Wrote a function for sanitising user uploaded images. It saves the native image in size roughly 800x600 so it still fits on most screens when opened, makes a desired size thumbnail and turns all images into high quality jpegs for smaller bandwidth use.<br><br>Thumbnails are made in a similar way a designer would make them in photoshop, first resize the most troublesome dimension to desired size, then crop the rest out so the image retains proportions and most of it ends up in the thumbnail.<br><br><span class="default">&lt;?php <br><br></span><span class="comment">// $image is $_FILES[ &lt;image name&gt; ]<br>// $imageId is the id used in a database or wherever for this image<br>// $thumbWidth and $thumbHeight are desired dimensions for the thumbnail<br></span><span class="keyword">function </span><span class="default">processImage</span><span class="keyword">( </span><span class="default">$image</span><span class="keyword">, </span><span class="default">$imageId</span><span class="keyword">, </span><span class="default">$thumbWidth</span><span class="keyword">, </span><span class="default">$thumbHeight </span><span class="keyword">)<br>{<br>&nbsp; &nbsp; </span><span class="default">$type </span><span class="keyword">= </span><span class="default">$image</span><span class="keyword">[ </span><span class="string">'type' </span><span class="keyword">];<br>&nbsp; &nbsp; </span><span class="default">$galleryPath </span><span class="keyword">= </span><span class="string">'images/collection/'</span><span class="keyword">;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; if ( </span><span class="default">strpos</span><span class="keyword">( </span><span class="default">$type</span><span class="keyword">, </span><span class="string">'image/' </span><span class="keyword">) === </span><span class="default">FALSE </span><span class="keyword">)<br>&nbsp; &nbsp; { </span><span class="comment">// not an image<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">return </span><span class="default">FALSE</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; </span><span class="default">$type </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">( </span><span class="string">'image/'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$type </span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$createFunc </span><span class="keyword">= </span><span class="string">'imagecreatefrom' </span><span class="keyword">. </span><span class="default">$type</span><span class="keyword">;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="default">$im </span><span class="keyword">= </span><span class="default">$createFunc</span><span class="keyword">( </span><span class="default">$image</span><span class="keyword">[ </span><span class="string">'tmp_name' </span><span class="keyword">] );<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="default">$size </span><span class="keyword">= </span><span class="default">getimagesize</span><span class="keyword">( </span><span class="default">$image</span><span class="keyword">[ </span><span class="string">'tmp_name' </span><span class="keyword">] );<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="default">$w </span><span class="keyword">= </span><span class="default">$size</span><span class="keyword">[ </span><span class="default">0 </span><span class="keyword">];<br>&nbsp; &nbsp; </span><span class="default">$h </span><span class="keyword">= </span><span class="default">$size</span><span class="keyword">[ </span><span class="default">1 </span><span class="keyword">];<br>&nbsp; &nbsp; if ( </span><span class="default">$w </span><span class="keyword">&gt; </span><span class="default">800 </span><span class="keyword">|| </span><span class="default">$h </span><span class="keyword">&gt; </span><span class="default">600 </span><span class="keyword">)<br>&nbsp; &nbsp; { </span><span class="comment">// we make sure the image isn't too huge<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if ( </span><span class="default">$w </span><span class="keyword">&gt; </span><span class="default">800 </span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$nw </span><span class="keyword">= </span><span class="default">800</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$nh </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">( </span><span class="default">$nw</span><span class="keyword">*(</span><span class="default">$h</span><span class="keyword">/</span><span class="default">$w</span><span class="keyword">) );<br>&nbsp; &nbsp; &nbsp; &nbsp; }elseif( </span><span class="default">$h </span><span class="keyword">&gt; </span><span class="default">600 </span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$nh </span><span class="keyword">= </span><span class="default">600</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$nw </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">( </span><span class="default">$nh</span><span class="keyword">*(</span><span class="default">$w</span><span class="keyword">/</span><span class="default">$h</span><span class="keyword">) );<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$im2 </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">( </span><span class="default">$nw</span><span class="keyword">, </span><span class="default">$nh </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">( </span><span class="default">$im2</span><span class="keyword">, </span><span class="default">$im</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$nw</span><span class="keyword">, </span><span class="default">$nh</span><span class="keyword">, </span><span class="default">$w</span><span class="keyword">, </span><span class="default">$h </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagedestroy</span><span class="keyword">( </span><span class="default">$im </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$im </span><span class="keyword">= </span><span class="default">$im2</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$w </span><span class="keyword">= </span><span class="default">$nw</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$h </span><span class="keyword">= </span><span class="default">$nh</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// create thumbnail<br>&nbsp; &nbsp; </span><span class="default">$tw </span><span class="keyword">= </span><span class="default">$thumbWidth</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$th </span><span class="keyword">= </span><span class="default">$thumbHeight</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$imT </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">( </span><span class="default">$tw</span><span class="keyword">, </span><span class="default">$th </span><span class="keyword">);<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; if ( </span><span class="default">$tw</span><span class="keyword">/</span><span class="default">$th </span><span class="keyword">&gt; </span><span class="default">$th</span><span class="keyword">/</span><span class="default">$tw </span><span class="keyword">)<br>&nbsp; &nbsp; { </span><span class="comment">// wider<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmph </span><span class="keyword">= </span><span class="default">$h</span><span class="keyword">*(</span><span class="default">$tw</span><span class="keyword">/</span><span class="default">$w</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$temp </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">( </span><span class="default">$tw</span><span class="keyword">, </span><span class="default">$tmph </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">( </span><span class="default">$temp</span><span class="keyword">, </span><span class="default">$im</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$tw</span><span class="keyword">, </span><span class="default">$tmph</span><span class="keyword">, </span><span class="default">$w</span><span class="keyword">, </span><span class="default">$h </span><span class="keyword">); </span><span class="comment">// resize to width<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">( </span><span class="default">$imT</span><span class="keyword">, </span><span class="default">$temp</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$tmph</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">-</span><span class="default">$th</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">, </span><span class="default">$tw</span><span class="keyword">, </span><span class="default">$th</span><span class="keyword">, </span><span class="default">$tw</span><span class="keyword">, </span><span class="default">$th </span><span class="keyword">); </span><span class="comment">// crop<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagedestroy</span><span class="keyword">( </span><span class="default">$temp </span><span class="keyword">);<br>&nbsp; &nbsp; }else<br>&nbsp; &nbsp; { </span><span class="comment">// taller<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmpw </span><span class="keyword">= </span><span class="default">$w</span><span class="keyword">*(</span><span class="default">$th</span><span class="keyword">/</span><span class="default">$h </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$imT </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">( </span><span class="default">$tmpw</span><span class="keyword">, </span><span class="default">$th </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">( </span><span class="default">$imT</span><span class="keyword">, </span><span class="default">$im</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$tmpw</span><span class="keyword">, </span><span class="default">$h</span><span class="keyword">, </span><span class="default">$w</span><span class="keyword">, </span><span class="default">$h </span><span class="keyword">); </span><span class="comment">// resize to height<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">( </span><span class="default">$imT</span><span class="keyword">, </span><span class="default">$temp</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$tmpw</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">-</span><span class="default">$tw</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$tw</span><span class="keyword">, </span><span class="default">$th</span><span class="keyword">, </span><span class="default">$tw</span><span class="keyword">, </span><span class="default">$th </span><span class="keyword">); </span><span class="comment">// crop<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagedestroy</span><span class="keyword">( </span><span class="default">$temp </span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// save the image<br>&nbsp; &nbsp; </span><span class="default">imagejpeg</span><span class="keyword">( </span><span class="default">$im</span><span class="keyword">, </span><span class="default">$galleryPath </span><span class="keyword">. </span><span class="default">$imgid </span><span class="keyword">. </span><span class="string">'.jpg'</span><span class="keyword">, </span><span class="default">100 </span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">imagejpeg</span><span class="keyword">( </span><span class="default">$imT</span><span class="keyword">, </span><span class="default">$galleryPath </span><span class="keyword">. </span><span class="default">$imgid </span><span class="keyword">. </span><span class="string">'_thumb.jpg'</span><span class="keyword">, </span><span class="default">100 </span><span class="keyword">);<br>}<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="81856">  
  <a class="name">
  <strong class="user"><em>arnar at netvistun dot is</em></strong></a><div class="date" title="2008-03-16 10:58"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom81856">
<div class="phpcode"><code><span class="html">
A small thumb script. Lets you specify max height and width. The thumb will always be of a rectangular shape while the image itself retains it's proportions. Very clean.<br><br><span class="default">&lt;?php<br></span><span class="comment">// The file<br></span><span class="default">$filename </span><span class="keyword">= </span><span class="string">'a.jpg'</span><span class="keyword">;<br><br></span><span class="comment">// Set a maximum height and width<br></span><span class="default">$width </span><span class="keyword">= </span><span class="default">80</span><span class="keyword">;<br></span><span class="default">$height </span><span class="keyword">= </span><span class="default">80</span><span class="keyword">;<br><br></span><span class="default">$thumbsize </span><span class="keyword">= </span><span class="default">80</span><span class="keyword">;<br><br></span><span class="comment">// Content type<br></span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-type: image/jpeg'</span><span class="keyword">);<br><br></span><span class="comment">// Get new dimensions<br></span><span class="keyword">list(</span><span class="default">$width_orig</span><span class="keyword">, </span><span class="default">$height_orig</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br><br></span><span class="default">$ratio_orig </span><span class="keyword">= </span><span class="default">$width_orig</span><span class="keyword">/</span><span class="default">$height_orig</span><span class="keyword">;<br><br>if (</span><span class="default">$width</span><span class="keyword">/</span><span class="default">$height </span><span class="keyword">&gt; </span><span class="default">$ratio_orig</span><span class="keyword">) {<br>&nbsp;&nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">$height</span><span class="keyword">*</span><span class="default">$ratio_orig</span><span class="keyword">;<br>} else {<br>&nbsp;&nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">$width</span><span class="keyword">/</span><span class="default">$ratio_orig</span><span class="keyword">;<br>}<br><br></span><span class="comment">// Resample<br></span><span class="default">$image_p </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$thumbsize</span><span class="keyword">, </span><span class="default">$thumbsize</span><span class="keyword">);<br></span><span class="default">$image </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br></span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$image_p</span><span class="keyword">, </span><span class="default">$image</span><span class="keyword">, -(</span><span class="default">$width</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">) + (</span><span class="default">$thumbsize</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">), -(</span><span class="default">$height</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">) + (</span><span class="default">$thumbsize</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">, </span><span class="default">$width_orig</span><span class="keyword">, </span><span class="default">$height_orig</span><span class="keyword">);<br><br></span><span class="comment">// Output<br></span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$image_p</span><span class="keyword">, </span><span class="default">null</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">);<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="81633">  
  <a class="name">
  <strong class="user"><em>rayg at daylongraphics dot com</em></strong></a><div class="date" title="2008-03-07 02:45"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom81633">
<div class="phpcode"><code><span class="html">
Here's a simple function to resample one JPEG imagefile to another while keeping aspect ratio of the source within the destination's dimensions. You can also tune the allowable distortion if you end up making too many thumbnails with thin blank areas around them. Should work when enlarging images too. Function returns true if it worked, false if not.<br><br>function resample_picfile($src, $dst, $w, $h)<br>{<br>&nbsp; &nbsp; // If distortion stretching is within the range below,<br>&nbsp; &nbsp; // then let image be distorted.<br>&nbsp; &nbsp; $lowend = 0.8;<br>&nbsp; &nbsp; $highend = 1.25;<br><br>&nbsp; &nbsp; $src_img = imagecreatefromjpeg($src);<br>&nbsp; &nbsp; if($src_img)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; $dst_img = ImageCreateTrueColor($w, $h);<br>&nbsp; &nbsp; &nbsp; &nbsp; /* if you don't want aspect-preserved images <br>to have a black bkgnd, fill $dst_img with the color of your choice here. <br>&nbsp; &nbsp; &nbsp; &nbsp; */<br><br>&nbsp; &nbsp; &nbsp; &nbsp; if($dst_img)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $src_w = imageSX($src_img);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $src_h = imageSY($src_img);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $scaleX = (float)$w / $src_w;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $scaleY = (float)$h / $src_h;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $scale = min($scaleX, $scaleY);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $dstW = $w;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $dstH = $h;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $dstX = $dstY = 0;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $scaleR = $scaleX / $scaleY;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if($scaleR &lt; $lowend || $scaleR &gt; $highend)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $dstW = (int)($scale * $src_w + 0.5);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $dstH = (int)($scale * $src_h + 0.5);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Keep pic centered in frame.<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $dstX = (int)(0.5 * ($w - $dstW));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $dstY = (int)(0.5 * ($h - $dstH));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; imagecopyresampled(<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $dst_img, $src_img, $dstX, $dstY, 0, 0, <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $dstW, $dstH, $src_w, $src_h); <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; imagejpeg($dst_img, $dst); <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; imagedestroy($dst_img);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; imagedestroy($src_img);<br>&nbsp; &nbsp; &nbsp; &nbsp; return file_exists($dst);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; return false;<br>}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="87881">  
  <a class="name">
  <strong class="user"><em>MBorgPL at gmail dot com</em></strong></a><div class="date" title="2008-12-28 10:53"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom87881">
<div class="phpcode"><code><span class="html">
Another addition to zorroswordsman at gmail dot com's resize class. <br><br>The function takes $_FILES['sent_image'] as 1st parameter. The 2nd is complete destination path. <br><br>It only moves images. <br><br>It returns destination path if succeeded, and false if any error occurred. <br><br><span class="default">&lt;?php<br></span><span class="keyword">public function </span><span class="default">move_image</span><span class="keyword">(</span><span class="default">$tmp_img</span><span class="keyword">, </span><span class="default">$dest_img</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; </span><span class="comment">//verifies if the uploaded file is an image<br>&nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$tmp_img</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">], </span><span class="string">'image'</span><span class="keyword">) !== </span><span class="default">false</span><span class="keyword">) <br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//moves the uploaded file into the destination place<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">move_uploaded_file</span><span class="keyword">(</span><span class="default">$tmp_img</span><span class="keyword">[</span><span class="string">'tmp_name'</span><span class="keyword">], </span><span class="default">$dest_img</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$dest_img</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="87866">  
  <a class="name">
  <strong class="user"><em>MBorg_PL</em></strong></a><div class="date" title="2008-12-27 03:39"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom87866">
<div class="phpcode"><code><span class="html">
Another tiny ammendment to zorroswordsman at gmail dot com's resize class AND matt at rees-jenkins dot co dot uk addition. The class may resize to different width and height not only same ones:<br><br><span class="default">&lt;?php<br></span><span class="comment">// Set maximum image size (pixels)<br></span><span class="keyword">public function </span><span class="default">set_size</span><span class="keyword">(</span><span class="default">$max_x </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">,</span><span class="default">$max_y </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// Resize<br>&nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input </span><span class="keyword">&gt; </span><span class="default">$max_x </span><span class="keyword">|| </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input </span><span class="keyword">&gt; </span><span class="default">$max_y</span><span class="keyword">)<br>&nbsp; &nbsp; {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$a</span><span class="keyword">= </span><span class="default">$max_x </span><span class="keyword">/ </span><span class="default">$max_y</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$b</span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input </span><span class="keyword">/ </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$a</span><span class="keyword">&lt;</span><span class="default">$b</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_output </span><span class="keyword">= </span><span class="default">$max_x</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_output </span><span class="keyword">= (</span><span class="default">$max_x </span><span class="keyword">/ </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input</span><span class="keyword">) * </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_output </span><span class="keyword">= </span><span class="default">$max_y</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_output </span><span class="keyword">= (</span><span class="default">$max_y </span><span class="keyword">/ </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input</span><span class="keyword">) * </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Ready<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resize </span><span class="keyword">= </span><span class="default">TRUE</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// Don't resize&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="keyword">else { </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resize </span><span class="keyword">= </span><span class="default">FALSE</span><span class="keyword">; }<br>&nbsp; &nbsp; <br>}<br></span><span class="default">?&gt;<br></span><br>And the use of the class is now:<br><br><span class="default">&lt;?php<br><br></span><span class="comment">##### DEMO #####<br><br>// Image<br></span><span class="default">$src </span><span class="keyword">= </span><span class="string">"myimage.jpg"</span><span class="keyword">;<br><br></span><span class="comment">// Begin<br></span><span class="default">$img </span><span class="keyword">= new </span><span class="default">imaging</span><span class="keyword">;<br></span><span class="default">$img</span><span class="keyword">-&gt;</span><span class="default">set_img</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">);<br></span><span class="default">$img</span><span class="keyword">-&gt;</span><span class="default">set_quality</span><span class="keyword">(</span><span class="default">80</span><span class="keyword">);<br><br></span><span class="comment">// Small thumbnail<br></span><span class="default">$img</span><span class="keyword">-&gt;</span><span class="default">set_size</span><span class="keyword">(</span><span class="default">250</span><span class="keyword">,</span><span class="default">150</span><span class="keyword">);<br></span><span class="default">$img</span><span class="keyword">-&gt;</span><span class="default">save_img</span><span class="keyword">(</span><span class="string">"small_250x150_" </span><span class="keyword">. </span><span class="default">$src</span><span class="keyword">);<br><br></span><span class="comment">// Baby thumbnail<br></span><span class="default">$img</span><span class="keyword">-&gt;</span><span class="default">set_size</span><span class="keyword">(</span><span class="default">50</span><span class="keyword">,</span><span class="default">250</span><span class="keyword">);<br></span><span class="default">$img</span><span class="keyword">-&gt;</span><span class="default">save_img</span><span class="keyword">(</span><span class="string">"baby_50x250_" </span><span class="keyword">. </span><span class="default">$src</span><span class="keyword">);<br><br></span><span class="comment">// Finalize<br></span><span class="default">$img</span><span class="keyword">-&gt;</span><span class="default">clear_cache</span><span class="keyword">();<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="79297">  
  <a class="name">
  <strong class="user"><em>matt1walsh DESPAMMER gmail dot com</em></strong></a><div class="date" title="2007-11-19 07:15"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom79297">
<div class="phpcode"><code><span class="html">
None of the stuff I've seen for resizing transparent GIFs works consistently and yields a good image. The hack I thought of is silly, but it works okay -- convert GIF to PNG. This worked for me.<br><br>$g_iw is new image width<br>$g_ih is new image height<br><br>$img_src=imagecreatefromgif($g_srcfile);<br>$img_dst=imagecreatetruecolor($g_iw,$g_ih);<br><br>//preserve alpha<br>imagecolortransparent($img_dst, imagecolorallocate($img_dst, 0, 0, 0));<br>imagealphablending($img_dst, false);<br>imagesavealpha($img_dst, true);<br>imagecopyresampled($img_dst, $img_src, 0, 0, 0, 0, $g_iw, $g_ih, $g_is[0], $g_is[1]);<br><br>imagepng($img_dst, $g_dstfile); <br>imagedestroy($img_dst);</span>
</code></div>
  </div>
 </div>
  <div class="note" id="79119">  
  <a class="name">
  <strong class="user"><em>Dave McCourt</em></strong></a><div class="date" title="2007-11-12 05:32"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom79119">
<div class="phpcode"><code><span class="html">
This function is taken from lots of web sources so thanks to all for posting. It creates square or landscape thumbnails from .jpgs&nbsp; from either portait or landscape original images. I decide in advance which way I want the thumbs to display for consistency. I usually sharpen the images as well post-upload, to save on server resources. I can post this code if anyone wants it. I hope this helps someone...<br><br>&nbsp; &nbsp; # create thumbnails from jpgs<br>&nbsp; &nbsp; # usage:<br>&nbsp; &nbsp; # create_jpgthumb(uploaded file, final file (with path), thumb height, thumb width, jpg quality, scale thumb (true) or fixed size (false); <br>&nbsp; &nbsp; function create_jpgthumb($original, $thumbnail, $max_width, $max_height, $quality, $scale = true) {<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; list ($src_width, $src_height, $type, $w) = getimagesize($original);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; if (!$srcImage = @imagecreatefromjpeg($original)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return false;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; # image resizes to natural height and width<br>&nbsp; &nbsp; &nbsp; &nbsp; if ($scale == true) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($src_width &gt; $src_height ) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $thumb_width = $max_width;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $thumb_height = floor($src_height * ($max_width / $src_width));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else if ($src_width &lt; $src_height ) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $thumb_height = $max_height;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $thumb_width = floor($src_width * ($max_height / $src_height));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $thumb_width = $max_height;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $thumb_height = $max_height;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!@$destImage = imagecreatetruecolor($thumb_width, $thumb_height)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return false;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!@imagecopyresampled($destImage, $srcImage, 0, 0, 0, 0, $thumb_width, $thumb_height, $src_width, $src_height)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return false;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; # image is fixed to supplied width and height and cropped<br>&nbsp; &nbsp; &nbsp; &nbsp; } else if ($scale == false) {<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $ratio = $max_width / $max_height;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # thumbnail is landscape<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($ratio &gt; 1) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # uploaded pic is landscape<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($src_width &gt; $src_height) {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $thumb_width = $max_width;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $thumb_height = ceil($max_width * ($src_height / $src_width));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($thumb_height &gt; $max_width) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $thumb_height = $max_width;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $thumb_width = ceil($max_width * ($src_width / $src_height));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # uploaded pic is portrait<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $thumb_height = $max_width;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $thumb_width = ceil($max_width * ($src_height / $src_width));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($thumb_width &gt; $max_width) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $thumb_width = $max_width;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $thumb_height = ceil($max_width * ($src_height / $src_width));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $off_h = ($src_height - $src_width) / 2;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!@$destImage = imagecreatetruecolor($max_width, $max_height)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return false;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!@imagecopyresampled($destImage, $srcImage, 0, 0, 0, $off_h, $thumb_width, $thumb_height, $src_width, $src_height)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return false;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # thumbnail is square<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($src_width &gt; $src_height) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $off_w = ($src_width - $src_height) / 2;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $off_h = 0;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $src_width = $src_height;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else if ($src_height &gt; $src_width) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $off_w = 0;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $off_h = ($src_height - $src_width) / 2;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $src_height = $src_width;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $off_w = 0;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $off_h = 0;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!@$destImage = imagecreatetruecolor($max_width, $max_height)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return false;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!@imagecopyresampled($destImage, $srcImage, 0, 0, $off_w, $off_h, $max_width, $max_height, $src_width, $src_height)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return false;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; @imagedestroy($srcImage);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; if (!@imageantialias($destImage, true)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return false;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; if (!@imagejpeg($destImage, $thumbnail, $quality)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return false;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; @imagedestroy($destImage);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; return true;<br>&nbsp; &nbsp; }</span>
</code></div>
  </div>
 </div>
  <div class="note" id="86344">  
  <a class="name">
  <strong class="user"><em>matt at rees-jenkins dot co dot uk</em></strong></a><div class="date" title="2008-10-14 03:32"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom86344">
<div class="phpcode"><code><span class="html">
A tiny ammendment to zorroswordsman at gmail dot com's resize class. It was only resizing if both the width AND height where greater than the desired size. This should fix it:<br><br><span class="default">&lt;?php<br></span><span class="comment">// Set maximum image size (pixels)<br></span><span class="keyword">function </span><span class="default">set_size</span><span class="keyword">(</span><span class="default">$size </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; </span><span class="comment">// Resize<br>&nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input </span><span class="keyword">&gt; </span><span class="default">$size </span><span class="keyword">|| </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input </span><span class="keyword">&gt; </span><span class="default">$size</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Wide<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input </span><span class="keyword">&gt;= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_output </span><span class="keyword">= </span><span class="default">$size</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_output </span><span class="keyword">= (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_output </span><span class="keyword">/ </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input</span><span class="keyword">) * </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Tall<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">else<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_output </span><span class="keyword">= </span><span class="default">$size</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_output </span><span class="keyword">= (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_output </span><span class="keyword">/ </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input</span><span class="keyword">) * </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Ready<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resize </span><span class="keyword">= </span><span class="default">TRUE</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; </span><span class="comment">// Don't resize<br>&nbsp; &nbsp; </span><span class="keyword">else { </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resize </span><span class="keyword">= </span><span class="default">FALSE</span><span class="keyword">; }<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="77612">  
  <a class="name">
  <strong class="user"><em>eblejr AT phrebh DOT com</em></strong></a><div class="date" title="2007-09-05 11:38"><strong>14 years ago</strong></div>
  <div class="text" id="Hcom77612">
<div class="phpcode"><code><span class="html">
Tim's code is fast, but if you're trying to put resampled images anywhere but in the top-left corner, it doesn't work.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="75258">  
  <a class="name">
  <strong class="user"><em>rich at corephp dot co dot uk</em></strong></a><div class="date" title="2007-05-20 03:05"><strong>14 years ago</strong></div>
  <div class="text" id="Hcom75258">
<div class="phpcode"><code><span class="html">
Be wary of this function when resizing images to make them *larger* than the original due to the memory consumption rate. For example a 200KB JPEG file (1024x768) will take up 4MB of memory when loaded, but when resampled to twice the the size the memory use jumps to 20.1MB. imagecopyresized does the same. Allow approx. 5 bytes per *pixel* for memory allowance when dealing with true colour images.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="80417">  
  <a class="name">
  <strong class="user"><em>Michael Shepanski</em></strong></a><div class="date" title="2008-01-14 10:09"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom80417">
<div class="phpcode"><code><span class="html">
Here is a function I thought I would share that will resample and copy an image with rounded corners.<br><br><span class="default">&lt;?php<br></span><span class="comment">/** ------------------------------------------------------------<br> * Copy and resample an image with rounded corners.<br> * ----------------------------------------------------------- */<br></span><span class="keyword">function </span><span class="default">imageRoundedCopyResampled</span><span class="keyword">(&amp;</span><span class="default">$dstimg</span><span class="keyword">, &amp;</span><span class="default">$srcimg</span><span class="keyword">, </span><span class="default">$dstx</span><span class="keyword">, </span><span class="default">$dsty</span><span class="keyword">, </span><span class="default">$srcx</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$srcy</span><span class="keyword">, </span><span class="default">$dstw</span><span class="keyword">, </span><span class="default">$dsth</span><span class="keyword">, </span><span class="default">$srcw</span><span class="keyword">, </span><span class="default">$srch</span><span class="keyword">, </span><span class="default">$radius</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="comment"># Resize the Source Image<br>&nbsp; &nbsp; </span><span class="default">$srcResized </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$dstw</span><span class="keyword">, </span><span class="default">$dsth</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$srcResized</span><span class="keyword">, </span><span class="default">$srcimg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$srcx</span><span class="keyword">, </span><span class="default">$srcy</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dstw</span><span class="keyword">, </span><span class="default">$dsth</span><span class="keyword">, </span><span class="default">$srcw</span><span class="keyword">, </span><span class="default">$srch</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="comment"># Copy the Body without corners<br>&nbsp; &nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$dstimg</span><span class="keyword">, </span><span class="default">$srcResized</span><span class="keyword">, </span><span class="default">$dstx</span><span class="keyword">+</span><span class="default">$radius</span><span class="keyword">, </span><span class="default">$dsty</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$radius</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$dstw</span><span class="keyword">-(</span><span class="default">$radius</span><span class="keyword">*</span><span class="default">2</span><span class="keyword">), </span><span class="default">$dsth</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$dstimg</span><span class="keyword">, </span><span class="default">$srcResized</span><span class="keyword">, </span><span class="default">$dstx</span><span class="keyword">, </span><span class="default">$dsty</span><span class="keyword">+</span><span class="default">$radius</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">0</span><span class="keyword">, </span><span class="default">$radius</span><span class="keyword">, </span><span class="default">$dstw</span><span class="keyword">, </span><span class="default">$dsth</span><span class="keyword">-(</span><span class="default">$radius</span><span class="keyword">*</span><span class="default">2</span><span class="keyword">));<br>&nbsp; &nbsp; </span><span class="comment"># Create a list of iterations; array(array(X1, X2, CenterX, CenterY), ...)<br>&nbsp; &nbsp; # Iterations in order are: Top-Left, Top-Right, Bottom-Left, Bottom-Right<br>&nbsp; &nbsp; </span><span class="default">$iterations </span><span class="keyword">= array(<br>&nbsp; &nbsp; &nbsp; &nbsp; array(</span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$radius</span><span class="keyword">, </span><span class="default">$radius</span><span class="keyword">),<br>&nbsp; &nbsp; &nbsp; &nbsp; array(</span><span class="default">$dstw</span><span class="keyword">-</span><span class="default">$radius</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$dstw</span><span class="keyword">-</span><span class="default">$radius</span><span class="keyword">, </span><span class="default">$radius</span><span class="keyword">),<br>&nbsp; &nbsp; &nbsp; &nbsp; array(</span><span class="default">0</span><span class="keyword">, </span><span class="default">$dsth</span><span class="keyword">-</span><span class="default">$radius</span><span class="keyword">, </span><span class="default">$radius</span><span class="keyword">, </span><span class="default">$dsth</span><span class="keyword">-</span><span class="default">$radius</span><span class="keyword">),<br>&nbsp; &nbsp; &nbsp; &nbsp; array(</span><span class="default">$dstw</span><span class="keyword">-</span><span class="default">$radius</span><span class="keyword">, </span><span class="default">$dsth</span><span class="keyword">-</span><span class="default">$radius</span><span class="keyword">, </span><span class="default">$dstw</span><span class="keyword">-</span><span class="default">$radius</span><span class="keyword">, </span><span class="default">$dsth</span><span class="keyword">-</span><span class="default">$radius</span><span class="keyword">)<br>&nbsp; &nbsp; );<br>&nbsp; &nbsp; </span><span class="comment"># Loop through each corner 'iteration'<br>&nbsp; &nbsp; </span><span class="keyword">foreach(</span><span class="default">$iterations </span><span class="keyword">as </span><span class="default">$iteration</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; list(</span><span class="default">$x1</span><span class="keyword">,</span><span class="default">$y1</span><span class="keyword">,</span><span class="default">$cx</span><span class="keyword">,</span><span class="default">$cy</span><span class="keyword">) = </span><span class="default">$iteration</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; for (</span><span class="default">$y</span><span class="keyword">=</span><span class="default">$y1</span><span class="keyword">; </span><span class="default">$y</span><span class="keyword">&lt;=</span><span class="default">$y1</span><span class="keyword">+</span><span class="default">$radius</span><span class="keyword">; </span><span class="default">$y</span><span class="keyword">++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (</span><span class="default">$x</span><span class="keyword">=</span><span class="default">$x1</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">&lt;=</span><span class="default">$x1</span><span class="keyword">+</span><span class="default">$radius</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment"># If length (X,Y)-&gt;(CX,CY) is less then radius draw the point<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$length </span><span class="keyword">= </span><span class="default">sqrt</span><span class="keyword">(</span><span class="default">pow</span><span class="keyword">((</span><span class="default">$cx </span><span class="keyword">- </span><span class="default">$x</span><span class="keyword">), </span><span class="default">2</span><span class="keyword">) + </span><span class="default">pow</span><span class="keyword">((</span><span class="default">$cy </span><span class="keyword">- </span><span class="default">$y</span><span class="keyword">), </span><span class="default">2</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$length </span><span class="keyword">&lt; </span><span class="default">$radius</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$dstimg</span><span class="keyword">, </span><span class="default">$srcResized</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">+</span><span class="default">$dstx</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">+</span><span class="default">$dsty</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="94221">  
  <a class="name">
  <strong class="user"><em>michael at heymichael dot com</em></strong></a><div class="date" title="2009-10-22 10:08"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom94221">
<div class="phpcode"><code><span class="html">
imagecopyresampled() works amazingly well, but here is something NOT to try with it:<br><br>The resize routine I wrote looks for pixel widths, and resizes images based on the notion that if their widths and heights are too big, so are their byte sizes. It worked out well at first.<br><br>But when I saw huge byte-size images slipping through beneath my 1000px-wide benchmark, I figured I'd subject the smaller-width images to resizing if their filesize() exceeded 100K.<br><br>The idea was that I'd "resize" them keeping their original widths and heights (i.e. in (1) below, $newW = $oldW, $newH = $oldH), and letting the "75" at (2) below reduce the byte size.<br><br>DON'T try that. imagecopyresampled() will lock up the server trying to resize an 800px-wide image to a "new" width of 800px. (I caught that on my Windows server before ever putting it on the destination Linux server, so take that with a grain of salt.)<br><br>I got around it by making $newW = ($picW * 0.99), etc. You get the byte-size reduction you want without locking up.<br><br>(1) imagecopyresampled($image_p, $image, 0, 0, 0, 0, $newW, $newH, $picW, $picH);<br><br>(2) imagejpeg($image_p, $theFile, 75);</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->

  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from www.php.net/manual/en/function.imagecopyresampled.php by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 11 Sep 2021 06:21:44 GMT -->

</body></html>