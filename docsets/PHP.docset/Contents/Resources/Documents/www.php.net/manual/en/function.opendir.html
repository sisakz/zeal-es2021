<html><!-- Mirrored from www.php.net/manual/en/function.opendir.php by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 11 Sep 2021 06:30:56 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>opendir</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.opendir.html">
 <link rel="shorturl" href="https://www.php.net/opendir">
 <link rel="alternate" href="https://www.php.net/opendir" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.dir.html">
 <link rel="prev" href="function.getcwd.html">
 <link rel="next" href="function.readdir.html">

 <link rel="alternate" href="function.opendir.html" hreflang="en">
 <link rel="alternate" href="https://www.php.net/manual/pt_BR/function.opendir.php" hreflang="pt_BR">
 <link rel="alternate" href="https://www.php.net/manual/zh/function.opendir.php" hreflang="zh">
 <link rel="alternate" href="https://www.php.net/manual/fr/function.opendir.php" hreflang="fr">
 <link rel="alternate" href="https://www.php.net/manual/de/function.opendir.php" hreflang="de">
 <link rel="alternate" href="https://www.php.net/manual/ja/function.opendir.php" hreflang="ja">
 <link rel="alternate" href="https://www.php.net/manual/ro/function.opendir.php" hreflang="ro">
 <link rel="alternate" href="https://www.php.net/manual/ru/function.opendir.php" hreflang="ru">
 <link rel="alternate" href="https://www.php.net/manual/es/function.opendir.php" hreflang="es">
 <link rel="alternate" href="https://www.php.net/manual/tr/function.opendir.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached0aba.css?t=1539771603&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached2ecf.css?t=1539765004&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedba57.css?t=1606338002&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached3afa.css?t=1627831203&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="https://www.php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script>
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="https://www.php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script src="https://www.php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>


</head>
<body class="docs " style="">


<div class="headsup"><a href="https://www.php.net/conferences/index.php#id2021-09-08-1">Longhorn PHP 2021</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.errors.html">Errors</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.attributes.html">Attributes</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.sessions.html">Session Security</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
	<dd><a href="refs.ui.html">GUI Extensions</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
    <div id="breadcrumbs-inner">
          
              
          <ul>
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.fileprocess.file.html">File System Related Extensions</a></li>      <li><a href="book.dir.html">Directories</a></li>      <li><a href="ref.dir.html">Directory Functions</a></li>      </ul>
    </div>
  </div>




<div id="layout" class="clearfix">
  <section id="layout-content">
  <div id="function.opendir" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">opendir</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">opendir</span> â€” <span class="dc-title">Open directory handle</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.opendir-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>opendir</strong></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$path</code></span>, <span class="methodparam"><span class="type">resource</span> <code class="parameter">$context</code><span class="initializer"> = ?</span></span>): <span class="type"><span class="type">resource</span>|<span class="type"><span class="type false">false</span></span></span></div>

  <p class="para rdfs-comment">
   Opens up a directory handle to be used in subsequent
   <span class="function"><a href="function.closedir.html" class="function">closedir()</a></span>, <span class="function"><a href="function.readdir.html" class="function">readdir()</a></span>, and
   <span class="function"><a href="function.rewinddir.html" class="function">rewinddir()</a></span> calls.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.opendir-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>
    
     <dt>
<code class="parameter">path</code></dt>

     <dd>

      <p class="para">
       The directory path that is to be opened
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">context</code></dt>

     <dd>

      <p class="para">
       For a description of the <code class="parameter">context</code> parameter, 
       refer to <a href="ref.stream.html" class="link">the streams section</a> of
       the manual.
      </p> 
     </dd>

    
   </dl>

  <p></p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.opendir-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns a directory handle <span class="type">resource</span> on success,
    or <strong><code>false</code></strong> on failure
  </p>
 </div>


 <div class="refsect1 errors" id="refsect1-function.opendir-errors">
  <h3 class="title">Errors/Exceptions</h3>
  <p class="para">
Upon failure, an <strong><code>E_WARNING</code></strong> is emitted.
</p>
  <p class="para">
   This may happen if <code class="parameter">path</code> is not a valid directory,
   the directory can not be opened due to permission restrictions,
   or due to filesystem errors.
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.opendir-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   </p><div class="example" id="example-2072">
    <p><strong>Example #1 <span class="function"><strong>opendir()</strong></span> example</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br>$dir&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"/etc/php5/"</span><span style="color: #007700">;<br><br></span><span style="color: #FF8000">//&nbsp;Open&nbsp;a&nbsp;known&nbsp;directory,&nbsp;and&nbsp;proceed&nbsp;to&nbsp;read&nbsp;its&nbsp;contents<br></span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">is_dir</span><span style="color: #007700">(</span><span style="color: #0000BB">$dir</span><span style="color: #007700">))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$dh&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">opendir</span><span style="color: #007700">(</span><span style="color: #0000BB">$dir</span><span style="color: #007700">))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;((</span><span style="color: #0000BB">$file&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">readdir</span><span style="color: #007700">(</span><span style="color: #0000BB">$dh</span><span style="color: #007700">))&nbsp;!==&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"filename:&nbsp;</span><span style="color: #0000BB">$file</span><span style="color: #DD0000">&nbsp;:&nbsp;filetype:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">filetype</span><span style="color: #007700">(</span><span style="color: #0000BB">$dir&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$file</span><span style="color: #007700">)&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">closedir</span><span style="color: #007700">(</span><span style="color: #0000BB">$dh</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>The above example will output
something similar to:</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>filename: . : filetype: dir
filename: .. : filetype: dir
filename: apache : filetype: dir
filename: cgi : filetype: dir
filename: cli : filetype: dir
</pre></div>
    </div>
   </div>
  <p></p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.opendir-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   </p><ul class="simplelist">
    <li class="member"><span class="function"><a href="function.is-dir.html" class="function" rel="rdfs-seeAlso">is_dir()</a> - Tells whether the filename is a directory</span></li>
    <li class="member"><span class="function"><a href="function.readdir.html" class="function" rel="rdfs-seeAlso">readdir()</a> - Read entry from directory handle</span></li>
    <li class="member"><span class="function"><a href="function.dir.html" class="function" rel="rdfs-seeAlso">dir()</a> - Return an instance of the Directory class</span></li>
   </ul>
  <p></p>
 </div>

</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="119237">  
  <a class="name">
  <strong class="user"><em>hz_php at hotmail dot com { hussam alzahabi }</em></strong></a><div class="date" title="2016-04-24 10:59"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom119237">
<div class="phpcode"><code><span class="html">
Sometimes the programmer needs to access folder content which has arabic name but the opendir function will return null resources id<br><br>for that we must convert the dirname charset from utf-8 to windows-1256 by the iconv function just if the preg_match function detect arabic characters and use " U " additionality to enable multibyte matching<br><br><span class="default">&lt;?php<br><br>$dir </span><span class="keyword">= (</span><span class="string">"./"</span><span class="keyword">); </span><span class="comment">// on this file dir<br>&nbsp; &nbsp; &nbsp; <br>// detect if the path has arabic characters and use " u "&nbsp; optional to enable function to match multibyte characters<br><br></span><span class="keyword">if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'#[\x{0600}-\x{06FF}]#iu'</span><span class="keyword">, </span><span class="default">$dir</span><span class="keyword">) )&nbsp; <br>{<br><br>&nbsp; &nbsp; </span><span class="comment">// convert input ( utf-8 ) to output ( windows-1256 ) <br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="default">$dir </span><span class="keyword">= </span><span class="default">iconv</span><span class="keyword">(</span><span class="string">"utf-8"</span><span class="keyword">,</span><span class="string">"windows-1256"</span><span class="keyword">,</span><span class="default">$dir</span><span class="keyword">);<br>&nbsp; &nbsp; <br>}<br><br> if( </span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">) ) <br> {<br>&nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp;&nbsp; if(&nbsp; ( </span><span class="default">$dh </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">) ) !== </span><span class="default">null&nbsp; </span><span class="keyword">) <br>&nbsp; &nbsp;&nbsp; {<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while ( ( </span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">) ) !== </span><span class="default">false&nbsp; </span><span class="keyword">) <br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"filename: "</span><span class="keyword">.</span><span class="default">$file </span><span class="keyword">.</span><span class="string">" filetype : "</span><span class="keyword">.</span><span class="default">filetype</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">).</span><span class="string">"&lt;br/&gt;"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp;&nbsp; }<br>&nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp;&nbsp; <br> }<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="119685">  
  <a class="name">
  <strong class="user"><em>sergio dot barrios at upr dot edu dot cu</em></strong></a><div class="date" title="2016-08-02 03:08"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom119685">
<div class="phpcode"><code><span class="html">
iterated function that searches a folder or file in a directory.<br><br><span class="default">&lt;?php<br><br>$root </span><span class="keyword">= </span><span class="string">'../Classes'</span><span class="keyword">;<br></span><span class="default">$search_parameter </span><span class="keyword">= </span><span class="string">"CachedObjectStorageFactory.php"</span><span class="keyword">;<br><br></span><span class="comment">//if we call the function spider as spider($root); <br>//will show all the directory content including subdirectories<br><br>//if we call the function spider as spider('../Classes', 'Shared');<br>//and will show the address of the directory<br><br></span><span class="default">spider</span><span class="keyword">(</span><span class="default">$root</span><span class="keyword">, </span><span class="default">$search_parameter</span><span class="keyword">);<br></span><span class="default">closedir</span><span class="keyword">();<br>&nbsp; &nbsp; <br>function </span><span class="default">spider</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">,</span><span class="default">$fileName</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">){<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="default">$handle </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">);<br>&nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; while(</span><span class="default">$file</span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">)){<br><br>&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$file </span><span class="keyword">!= </span><span class="string">"." </span><span class="keyword">&amp;&amp; </span><span class="default">$file </span><span class="keyword">!= </span><span class="string">".."</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$fileName</span><span class="keyword">==</span><span class="string">""</span><span class="keyword">) <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$dir</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">.</span><span class="string">"&lt;br&gt;"</span><span class="keyword">;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$file </span><span class="keyword">== </span><span class="default">$fileName</span><span class="keyword">)&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="default">$dir</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">.</span><span class="string">"&lt;br&gt;"</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; if(!</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">))&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">spider</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">,</span><span class="default">$fileName</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; }&nbsp; &nbsp; <br>&nbsp;&nbsp; }<br>&nbsp;&nbsp; <br>}&nbsp; &nbsp;&nbsp; <br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="78261">  
  <a class="name">
  <strong class="user"><em>MetaNull</em></strong></a><div class="date" title="2007-10-04 11:39"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom78261">
<div class="phpcode"><code><span class="html">
An other way to recursively walk a directory and it's content, applying a callback to each file.<br><br>Exemple: Update the last modification time of each file in a folder<br><br><span class="default">&lt;?php<br><br>clearstatcache</span><span class="keyword">();<br><br></span><span class="default">$sourcepath </span><span class="keyword">= </span><span class="string">"C:/WINDOWS/TEMP"</span><span class="keyword">;<br><br></span><span class="comment">// Replace \ by / and remove the final / if any<br></span><span class="default">$root </span><span class="keyword">= </span><span class="default">ereg_replace</span><span class="keyword">( </span><span class="string">"/$"</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">, </span><span class="default">ereg_replace</span><span class="keyword">( </span><span class="string">"[\\]"</span><span class="keyword">, </span><span class="string">"/"</span><span class="keyword">, </span><span class="default">$sourcepath </span><span class="keyword">));<br></span><span class="comment">// Touch all the files from the $root directory<br></span><span class="keyword">if( </span><span class="default">false </span><span class="keyword">=== </span><span class="default">m_walk_dir</span><span class="keyword">( </span><span class="default">$root</span><span class="keyword">, </span><span class="string">"m_touch_file"</span><span class="keyword">, </span><span class="default">true </span><span class="keyword">)) {<br>&nbsp; &nbsp; echo </span><span class="string">"'</span><span class="keyword">{</span><span class="default">$root</span><span class="keyword">}</span><span class="string">' is not a valid directory\n"</span><span class="keyword">;<br>}<br><br></span><span class="comment">// Walk a directory recursivelly, and apply a callback on each file<br></span><span class="keyword">function </span><span class="default">m_walk_dir</span><span class="keyword">( </span><span class="default">$root</span><span class="keyword">, </span><span class="default">$callback</span><span class="keyword">, </span><span class="default">$recursive </span><span class="keyword">= </span><span class="default">true </span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="default">$dh </span><span class="keyword">= @</span><span class="default">opendir</span><span class="keyword">( </span><span class="default">$root </span><span class="keyword">);<br>&nbsp; &nbsp; if( </span><span class="default">false </span><span class="keyword">=== </span><span class="default">$dh </span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; while( </span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">( </span><span class="default">$dh </span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; if( </span><span class="string">"." </span><span class="keyword">== </span><span class="default">$file </span><span class="keyword">|| </span><span class="string">".." </span><span class="keyword">== </span><span class="default">$file </span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; continue;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">call_user_func</span><span class="keyword">( </span><span class="default">$callback</span><span class="keyword">, </span><span class="string">"</span><span class="keyword">{</span><span class="default">$root</span><span class="keyword">}</span><span class="string">/</span><span class="keyword">{</span><span class="default">$file</span><span class="keyword">}</span><span class="string">" </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; if( </span><span class="default">false </span><span class="keyword">!== </span><span class="default">$recursive </span><span class="keyword">&amp;&amp; </span><span class="default">is_dir</span><span class="keyword">( </span><span class="string">"</span><span class="keyword">{</span><span class="default">$root</span><span class="keyword">}</span><span class="string">/</span><span class="keyword">{</span><span class="default">$file</span><span class="keyword">}</span><span class="string">" </span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">m_walk_dir</span><span class="keyword">( </span><span class="string">"</span><span class="keyword">{</span><span class="default">$root</span><span class="keyword">}</span><span class="string">/</span><span class="keyword">{</span><span class="default">$file</span><span class="keyword">}</span><span class="string">"</span><span class="keyword">, </span><span class="default">$callback</span><span class="keyword">, </span><span class="default">$recursive </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; </span><span class="default">closedir</span><span class="keyword">( </span><span class="default">$dh </span><span class="keyword">);<br>&nbsp; &nbsp; return </span><span class="default">true</span><span class="keyword">;<br>}<br><br></span><span class="comment">// if the path indicates a file, run touch() on it<br></span><span class="keyword">function </span><span class="default">m_touch_file</span><span class="keyword">( </span><span class="default">$path </span><span class="keyword">) {<br>&nbsp; &nbsp; echo </span><span class="default">$path </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br>&nbsp; &nbsp; if( !</span><span class="default">is_dir</span><span class="keyword">( </span><span class="default">$path </span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">touch</span><span class="keyword">( </span><span class="default">$path </span><span class="keyword">);<br>&nbsp; &nbsp; }<br>}<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="83990">  
  <a class="name">
  <strong class="user"><em>archipel dot gb at online dot fr</em></strong></a><div class="date" title="2008-06-22 10:20"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom83990">
<div class="phpcode"><code><span class="html">
Here are two versions of the same function to list all files in a directory tree.<br><br>The first one is recursive (calls itself while going through subdirectories) :<br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">rec_listFiles</span><span class="keyword">( </span><span class="default">$from </span><span class="keyword">= </span><span class="string">'.'</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; if(! </span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$from</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="default">$files </span><span class="keyword">= array();<br>&nbsp; &nbsp; if( </span><span class="default">$dh </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$from</span><span class="keyword">))<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; while( </span><span class="default">false </span><span class="keyword">!== (</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">)))<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Skip '.' and '..'<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if( </span><span class="default">$file </span><span class="keyword">== </span><span class="string">'.' </span><span class="keyword">|| </span><span class="default">$file </span><span class="keyword">== </span><span class="string">'..'</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; continue;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$path </span><span class="keyword">= </span><span class="default">$from </span><span class="keyword">. </span><span class="string">'/' </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if( </span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">) )<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$files </span><span class="keyword">+= </span><span class="default">rec_listFiles</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$files</span><span class="keyword">[] = </span><span class="default">$path</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; return </span><span class="default">$files</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;<br></span><br>The second one is iterative (uses less memory) :<br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">listFiles</span><span class="keyword">( </span><span class="default">$from </span><span class="keyword">= </span><span class="string">'.'</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; if(! </span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$from</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="default">$files </span><span class="keyword">= array();<br>&nbsp; &nbsp; </span><span class="default">$dirs </span><span class="keyword">= array( </span><span class="default">$from</span><span class="keyword">);<br>&nbsp; &nbsp; while( </span><span class="default">NULL </span><span class="keyword">!== (</span><span class="default">$dir </span><span class="keyword">= </span><span class="default">array_pop</span><span class="keyword">( </span><span class="default">$dirs</span><span class="keyword">)))<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; if( </span><span class="default">$dh </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; while( </span><span class="default">false </span><span class="keyword">!== (</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">)))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if( </span><span class="default">$file </span><span class="keyword">== </span><span class="string">'.' </span><span class="keyword">|| </span><span class="default">$file </span><span class="keyword">== </span><span class="string">'..'</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; continue;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$path </span><span class="keyword">= </span><span class="default">$dir </span><span class="keyword">. </span><span class="string">'/' </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if( </span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dirs</span><span class="keyword">[] = </span><span class="default">$path</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$files</span><span class="keyword">[] = </span><span class="default">$path</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; return </span><span class="default">$files</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;<br></span>The iterative version should be a little faster most of the time, but the big difference is in the memory usage.<br><br>Here is also a profiling function (works in php5 only) :<br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">profile</span><span class="keyword">( </span><span class="default">$func</span><span class="keyword">, </span><span class="default">$trydir</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; </span><span class="default">$mem1 </span><span class="keyword">= </span><span class="default">memory_get_usage</span><span class="keyword">();<br>&nbsp; &nbsp; echo </span><span class="string">'&lt;pre&gt;-----------------------<br>Test run for '</span><span class="keyword">.</span><span class="default">$func</span><span class="keyword">.</span><span class="string">'() ...<br>'</span><span class="keyword">; </span><span class="default">flush</span><span class="keyword">();<br><br>&nbsp; &nbsp; </span><span class="default">$time_start </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$list </span><span class="keyword">= </span><span class="default">$func</span><span class="keyword">( </span><span class="default">$trydir</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$time </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">) - </span><span class="default">$time_start</span><span class="keyword">;<br><br>&nbsp; &nbsp; echo </span><span class="string">'Finished : '</span><span class="keyword">.</span><span class="default">count</span><span class="keyword">(</span><span class="default">$list</span><span class="keyword">).</span><span class="string">' files&lt;/pre&gt;'</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$mem2 </span><span class="keyword">= </span><span class="default">memory_get_peak_usage</span><span class="keyword">();<br><br>&nbsp; &nbsp; </span><span class="default">printf</span><span class="keyword">( </span><span class="string">'&lt;pre&gt;Max memory for '</span><span class="keyword">.</span><span class="default">$func</span><span class="keyword">.</span><span class="string">'() : %0.2f kbytes<br>Running time for '</span><span class="keyword">.</span><span class="default">$func</span><span class="keyword">.</span><span class="string">'() : %0.f s&lt;/pre&gt;'</span><span class="keyword">,<br>&nbsp; &nbsp; (</span><span class="default">$mem2</span><span class="keyword">-</span><span class="default">$mem1</span><span class="keyword">)/</span><span class="default">1024.0</span><span class="keyword">, </span><span class="default">$time</span><span class="keyword">);<br>&nbsp; &nbsp; return </span><span class="default">$list</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="73085">  
  <a class="name">
  <strong class="user"><em>NerdyDork</em></strong></a><div class="date" title="2007-02-08 08:36"><strong>14 years ago</strong></div>
  <div class="text" id="Hcom73085">
<div class="phpcode"><code><span class="html">
Here is a snippet to create a site map of all html files in a folder:<br><br><span class="default">&lt;?php<br>&nbsp; &nbsp; </span><span class="comment">// read all html file in the current directory<br>&nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">$dh </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="string">'./'</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$files </span><span class="keyword">= array();<br>&nbsp; &nbsp; &nbsp; &nbsp; while ((</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">)) !== </span><span class="default">false</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) - </span><span class="default">5</span><span class="keyword">) == </span><span class="string">'.html'</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$files</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// Sort the files and display<br>&nbsp; &nbsp; </span><span class="default">sort</span><span class="keyword">(</span><span class="default">$files</span><span class="keyword">);<br>&nbsp; &nbsp; echo </span><span class="string">"&lt;ul&gt;\n"</span><span class="keyword">;<br>&nbsp; &nbsp; foreach (</span><span class="default">$files </span><span class="keyword">as </span><span class="default">$file</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$title </span><span class="keyword">= </span><span class="default">Title</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"&lt;li&gt;&lt;a href=\"</span><span class="default">$file</span><span class="string">\" title=\"</span><span class="default">$title</span><span class="string">\"&gt;</span><span class="default">$title</span><span class="string">&lt;/a&gt;&lt;/li&gt;\n"</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; echo </span><span class="string">"&lt;/ul&gt;\n"</span><span class="keyword">;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// Function to get a human readable title from the filename<br>&nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">Title</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$title </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">) - </span><span class="default">5</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$title </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'-'</span><span class="keyword">, </span><span class="string">' '</span><span class="keyword">, </span><span class="default">$title</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$title </span><span class="keyword">= </span><span class="default">ucwords</span><span class="keyword">(</span><span class="default">$title</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$title</span><span class="keyword">;<br>&nbsp; &nbsp; }<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="57504">  
  <a class="name"><strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2005-10-05 09:40"><strong>15 years ago</strong></div>
  <div class="text" id="Hcom57504">
<div class="phpcode"><code><span class="html">
This function sorts files by name as strings, but without regard to case.&nbsp; It also does some handy string formatting of the file size information.<br><br>&lt;?<br>function getFiles($path) {<br>&nbsp; &nbsp; //Function takes a path, and returns a numerically indexed array of associative arrays containing file information,<br>&nbsp; &nbsp; //sorted by the file name (case insensitive).&nbsp; If two files are identical when compared without case, they will sort<br>&nbsp; &nbsp; //relative to each other in the order presented by readdir()<br>&nbsp; &nbsp; $files = array();<br>&nbsp; &nbsp; $fileNames = array();<br>&nbsp; &nbsp; $i = 0;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; if (is_dir($path)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; if ($dh = opendir($path)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; while (($file = readdir($dh)) !== false) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($file == "." || $file == "..") continue;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $fullpath = $path . "/" . $file;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $fkey = strtolower($file);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; while (array_key_exists($fkey,$fileNames)) $fkey .= " ";<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $a = stat($fullpath);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $files[$fkey]['size'] = $a['size'];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($a['size'] == 0) $files[$fkey]['sizetext'] = "-";<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else if ($a['size'] &gt; 1024) $files[$fkey]['sizetext'] = (ceil($a['size']/1024*100)/100) . " K";<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else if ($a['size'] &gt; 1024*1024) $files[$fkey]['sizetext'] = (ceil($a['size']/(1024*1024)*100)/100) . " Mb";<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else $files[$fkey]['sizetext'] = $a['size'] . " bytes";<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $files[$fkey]['name'] = $file;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $files[$fkey]['type'] = filetype($fullpath);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $fileNames[$i++] = $fkey;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; closedir($dh);<br>&nbsp; &nbsp; &nbsp; &nbsp; } else die ("Cannot open directory:&nbsp; $path");<br>&nbsp; &nbsp; } else die ("Path is not a directory:&nbsp; $path");<br>&nbsp; &nbsp; sort($fileNames,SORT_STRING);<br>&nbsp; &nbsp; $sortedFiles = array();<br>&nbsp; &nbsp; $i = 0;<br>&nbsp; &nbsp; foreach($fileNames as $f) $sortedFiles[$i++] = $files[$f];<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; return $sortedFiles;<br>}<br><br>$files = getFiles("C:");<br>foreach ($files as $file) print "$file[name]&lt;br&gt;\n";<br>?&gt;</span>
</code></div>
  </div>
 </div>
  <div class="note" id="79759">  
  <a class="name">
  <strong class="user"><em>Peter Hkansson</em></strong></a><div class="date" title="2007-12-11 09:01"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom79759">
<div class="phpcode"><code><span class="html">
Would you like to view your directories in your browser this script might come in handy.<br><br><span class="default">&lt;?php<br>$sub </span><span class="keyword">= (</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'dir'</span><span class="keyword">]);<br></span><span class="default">$path </span><span class="keyword">= </span><span class="string">'enter/your/directory/here/'</span><span class="keyword">;<br></span><span class="default">$path </span><span class="keyword">= </span><span class="default">$path </span><span class="keyword">. </span><span class="string">"</span><span class="default">$sub</span><span class="string">"</span><span class="keyword">;<br></span><span class="default">$dh </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">);<br></span><span class="default">$i</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">;<br>while ((</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">)) !== </span><span class="default">false</span><span class="keyword">) {<br>&nbsp; &nbsp; if(</span><span class="default">$file </span><span class="keyword">!= </span><span class="string">"." </span><span class="keyword">&amp;&amp; </span><span class="default">$file </span><span class="keyword">!= </span><span class="string">".."</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, -</span><span class="default">4</span><span class="keyword">, -</span><span class="default">3</span><span class="keyword">) ==</span><span class="string">"."</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"</span><span class="default">$i</span><span class="string">. </span><span class="default">$file</span><span class="string"> &lt;br /&gt;"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }else{&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"</span><span class="default">$i</span><span class="string">. &lt;a href='?dir=</span><span class="default">$sub</span><span class="string">/</span><span class="default">$file</span><span class="string">'&gt;</span><span class="default">$file</span><span class="string">&lt;/a&gt;&lt;br /&gt;"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$i</span><span class="keyword">++;<br>&nbsp; &nbsp; }<br>}<br></span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">);<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="90373">  
  <a class="name">
  <strong class="user"><em>DaveRandom</em></strong></a><div class="date" title="2009-04-18 09:08"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom90373">
<div class="phpcode"><code><span class="html">
A couple of notes on Matt's posts on Windows Network Drives:<br><br>Since the system() command writes the output of the executed shell command straight to the output buffer, if you wish to hide the return of the mapping command (i.e. "The command completed succesfully" or an error message) from a web browser, you need to alter the command that is sent to the shell so that the output of that command is hidden.<br><br>You probably thinking "why not just use exec()?", and it's a reasonable question, but for some reason it doesn't always work - I guess it's another NT user permissions issue. If you want to guarantee you app will work with no messing around on the host system, use the system() command.<br><br>In the Windows command shell, you can hide the output of a command by sending both the output (1) and error (2) messages to "nul" using pipes, in other words "&gt;nul 2&gt;&amp;1" on the end of the command. The username and password order in the "net use..." command needs switching in Matt's post.<br><br>Here (<a rel="nofollow" target="_blank">http://networkm.co.uk/static/drive.html</a>) is a function I wrote to dynamically choose which drive letter to use, based on what is currently mapped and accessible to PHP.<br><br><span class="default">&lt;?php<br><br></span><span class="comment">// Define the parameters for the shell command<br></span><span class="default">$location </span><span class="keyword">= </span><span class="string">"\\servername\sharename"</span><span class="keyword">;<br></span><span class="default">$user </span><span class="keyword">= </span><span class="string">"USERNAME"</span><span class="keyword">;<br></span><span class="default">$pass </span><span class="keyword">= </span><span class="string">"PASSWORD"</span><span class="keyword">;<br></span><span class="default">$letter </span><span class="keyword">= </span><span class="string">"Z"</span><span class="keyword">;<br><br></span><span class="comment">// Map the drive<br></span><span class="default">system</span><span class="keyword">(</span><span class="string">"net use "</span><span class="keyword">.</span><span class="default">$letter</span><span class="keyword">.</span><span class="string">": \""</span><span class="keyword">.</span><span class="default">$location</span><span class="keyword">.</span><span class="string">"\" "</span><span class="keyword">.</span><span class="default">$pass</span><span class="keyword">.</span><span class="string">" /user:"</span><span class="keyword">.</span><span class="default">$user</span><span class="keyword">.</span><span class="string">" /persistent:no&gt;nul 2&gt;&amp;1"</span><span class="keyword">);<br><br></span><span class="comment">// Open the directory<br></span><span class="default">$dir </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$letter</span><span class="keyword">.</span><span class="string">":/an/example/path"</span><span class="keyword">)<br><br>...<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="60169">  
  <a class="name">
  <strong class="user"><em>mstabile75 at gmail dot com</em></strong></a><div class="date" title="2005-12-28 08:26"><strong>15 years ago</strong></div>
  <div class="text" id="Hcom60169">
<div class="phpcode"><code><span class="html">
In my previous post I ran into a problem with the "global" definition of $directorylist.&nbsp; If I called the function more than once on the same page it would combine the file lists. I looked at Lasse Dalegaard's example and used the following solution.<br><br>remove global definition<br>&nbsp; &nbsp;&nbsp; global $directorylist; <br><br>REPLACE <br>&lt;?<br>if ((($maxlevel) == "all") or ($maxlevel &gt; $level)) {<br>&nbsp;&nbsp; filelist($startdir . $file . "/", $searchSubdirs, $directoriesonly, $maxlevel, $level + 1);<br>}<br>?&gt;<br>WITH<br>&lt;?<br>if ((($maxlevel) == "all") or ($maxlevel &gt; $level)) {<br>&nbsp; &nbsp; $list2 = filelist($startdir . $file . "/", $searchSubdirs, $directoriesonly, $maxlevel, $level + 1);<br>&nbsp; &nbsp; if(is_array($list2)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; $directorylist = array_merge($directorylist, $list2);<br>&nbsp; &nbsp; }<br>}<br>?&gt;</span>
</code></div>
  </div>
 </div>
  <div class="note" id="37558">  
  <a class="name">
  <strong class="user"><em>micklweiss at gmx dot net</em></strong></a><div class="date" title="2003-11-19 01:12"><strong>17 years ago</strong></div>
  <div class="text" id="Hcom37558">
<div class="phpcode"><code><span class="html">
I ran into a little snag in example 1. opendir() lists files by the last time the file was accessed. I was trying to print the files numerically in a directory. <br><br>Solution: Use scandir() instead (php5) or store the files in an array and sort it.<br><br>Hope this helps someone. <br><br>- Mick<br><br>(o&gt; Web / software developer <br>( )&nbsp; &nbsp;&nbsp; UNIX Systems Admin<br>---&nbsp;&nbsp; ~ www.mickweiss.com ~</span>
</code></div>
  </div>
 </div>
  <div class="note" id="32782">  
  <a class="name">
  <strong class="user"><em>Matt Grimm</em></strong></a><div class="date" title="2003-06-06 01:25"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom32782">
<div class="phpcode"><code><span class="html">
Thought I could help clarify something with accessing network shares on a Windows network (2000 in this case), running PHP 4.3.2 under Apache 2.0.44.<br><br>However you are logged into the Windows box, your Apache service must be running under an account which has access to the share.&nbsp; The easiest (and probably least safe) way for me was to change the user for the Apache service to the computer administrator (do this in the service properties, under the "Log On" tab).&nbsp; After restarting Apache, I could access mapped drives by their assigned drive letter ("z:\\") or regular shares by their UNC path ("\\\\shareDrive\\shareDir").</span>
</code></div>
  </div>
 </div>
  <div class="note" id="75118">  
  <a class="name">
  <strong class="user"><em>lolwut</em></strong></a><div class="date" title="2007-05-13 06:00"><strong>14 years ago</strong></div>
  <div class="text" id="Hcom75118">
<div class="phpcode"><code><span class="html">
I sometimes find this useful. Hope you will too.<br><br><span class="default">&lt;?php<br></span><span class="comment">//list_by_ext: returns an array containing an alphabetic list of files in the specified directory ($path) with a file extension that matches $extension<br><br></span><span class="keyword">function </span><span class="default">list_by_ext</span><span class="keyword">(</span><span class="default">$extension</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">){<br>&nbsp; &nbsp; </span><span class="default">$list </span><span class="keyword">= array(); </span><span class="comment">//initialise a variable<br>&nbsp; &nbsp; </span><span class="default">$dir_handle </span><span class="keyword">= @</span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">) or die(</span><span class="string">"Unable to open </span><span class="default">$path</span><span class="string">"</span><span class="keyword">); </span><span class="comment">//attempt to open path<br>&nbsp; &nbsp; </span><span class="keyword">while(</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dir_handle</span><span class="keyword">)){ </span><span class="comment">//loop through all the files in the path<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">$file </span><span class="keyword">== </span><span class="string">"." </span><span class="keyword">|| </span><span class="default">$file </span><span class="keyword">== </span><span class="string">".."</span><span class="keyword">){continue;} </span><span class="comment">//ignore these<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$filename </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"."</span><span class="keyword">,</span><span class="default">$file</span><span class="keyword">); </span><span class="comment">//seperate filename from extenstion<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$cnt </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">); </span><span class="default">$cnt</span><span class="keyword">--; </span><span class="default">$ext </span><span class="keyword">= </span><span class="default">$filename</span><span class="keyword">[</span><span class="default">$cnt</span><span class="keyword">]; </span><span class="comment">//as above<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$ext</span><span class="keyword">) == </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$extension</span><span class="keyword">)){ </span><span class="comment">//if the extension of the file matches the extension we are looking for...<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$list</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">); </span><span class="comment">//...then stick it onto the end of the list array<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">}<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; if(</span><span class="default">$list</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]){ </span><span class="comment">//...if matches were found...<br>&nbsp; &nbsp; </span><span class="keyword">return </span><span class="default">$list</span><span class="keyword">; </span><span class="comment">//...return the array<br>&nbsp; &nbsp; </span><span class="keyword">} else {</span><span class="comment">//otherwise...<br>&nbsp; &nbsp; </span><span class="keyword">return </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>}<br><br></span><span class="comment">//example usage<br></span><span class="keyword">if(</span><span class="default">$win32_exectuables </span><span class="keyword">= </span><span class="default">list_by_ext</span><span class="keyword">(</span><span class="string">"exe"</span><span class="keyword">, </span><span class="string">"C:\WINDOWS"</span><span class="keyword">)){<br>&nbsp; &nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$win32_exectuables</span><span class="keyword">);<br>} else {<br>&nbsp; &nbsp; echo </span><span class="string">"No windows executables found :(\n"</span><span class="keyword">;<br>}<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="59599">  
  <a class="name">
  <strong class="user"><em>chrys at mytechjournal dot com</em></strong></a><div class="date" title="2005-12-10 11:16"><strong>15 years ago</strong></div>
  <div class="text" id="Hcom59599">
<div class="phpcode"><code><span class="html">
I wrote a function to recursively delete files from a starting directory.&nbsp; I had to do this because my server doesn't allow me to delete files that apache writes because I don't have permissions, so... I let apache do the work.<br><br><span class="default">&lt;?php<br>$dir </span><span class="keyword">= </span><span class="string">"/path/to/base/dir"</span><span class="keyword">;<br><br></span><span class="default">recursive_delete</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">);<br><br>function </span><span class="default">recursive_delete</span><span class="keyword">( </span><span class="default">$dir </span><span class="keyword">)<br>{<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$dh </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while ((</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">)) !== </span><span class="default">false </span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if( </span><span class="default">$file </span><span class="keyword">!= </span><span class="string">"." </span><span class="keyword">&amp;&amp; </span><span class="default">$file </span><span class="keyword">!= </span><span class="string">".." </span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if( </span><span class="default">is_dir</span><span class="keyword">( </span><span class="default">$dir </span><span class="keyword">. </span><span class="default">$file </span><span class="keyword">) )<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"Entering Directory: </span><span class="default">$dir$file</span><span class="string">&lt;br/&gt;"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">recursive_delete</span><span class="keyword">( </span><span class="default">$dir </span><span class="keyword">. </span><span class="default">$file </span><span class="keyword">. </span><span class="string">"/" </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"Removing Directory: </span><span class="default">$dir$file</span><span class="string">&lt;br/&gt;&lt;br/&gt;"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">rmdir</span><span class="keyword">( </span><span class="default">$dir </span><span class="keyword">. </span><span class="default">$file </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"Deleting file: </span><span class="default">$dir$file</span><span class="string">&lt;br/&gt;"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">unlink</span><span class="keyword">( </span><span class="default">$dir </span><span class="keyword">. </span><span class="default">$file </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="79685">  
  <a class="name">
  <strong class="user"><em>mana at averna dot com</em></strong></a><div class="date" title="2007-12-07 03:02"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom79685">
<div class="phpcode"><code><span class="html">
I was trying to access network drives using this opendir function. I read so many posts saying that it was almost impossible to access a network drive and finally, I found the answer; there are 2 steps to be followed to access a network drive with PHP either on the same machine or another machine.<br><br>But first of all, here's the error I was getting:<br>Warning: opendir(\\server\folder1\sub_folder) [function.opendir]: failed to open dir: No error in C:\wamp\www\PMOT\v0.1\REPORT_MENU\index.php on line 17<br><br>Firstly, one must make sure that the folder \\server\folder1\sub_folder can be accessed by a user, let's say USER_TEST with a password PASS_TEST. By setting properties to this folder, one can add this given user with the correct password (USER_TEST with PASS_TEST).<br><br>Secondly, the APACHE service must be set-up to take this user into account. If no user is specified, APACHE uses an anonymous user and this is where the problem/error message is coming from. One must go in control panel-&gt;administrative tools-&gt;services. One will see the list of services and must look for APACHE with Apache/2.X.X in the description. (For Wampserver, it will be called wampapache, and so on!) Right click on that and pop up the properties screen. In the tab LOG ON, there are 2 options: local system account and "this account" which will be a user specified account. This is where one must specify the USER_TEST and PASS_TEST.<br><br>Following these steps worked perfectly for me but if either the folder privileges or apache log on user is disabled, then I get the initial aforementioned error message.<br><br>Anyways, I hope this can help out someone!<br><br>Cheers!<br><br>Marc</span>
</code></div>
  </div>
 </div>
  <div class="note" id="46126">  
  <a class="name">
  <strong class="user"><em>sandy at montana-riverboats dot com</em></strong></a><div class="date" title="2004-09-29 09:08"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom46126">
<div class="phpcode"><code><span class="html">
<span class="default">&lt;?php<br></span><span class="comment">/*<br>** This recursive file lister only slurps in one page at time,<br>** so it doesn't take forever to load when operating over<br>** a large system.....comes with an "Up" link for every page too.<br>*/<br><br></span><span class="default">$PHP_SELF </span><span class="keyword">= </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_SELF'</span><span class="keyword">];<br></span><span class="default">$DOCUMENT_ROOT </span><span class="keyword">= </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'DOCUMENT_ROOT'</span><span class="keyword">];<br></span><span class="comment"># activate the next line (and deactivate the last) to<br># use this script in a $DOCUMENT_ROOT/~anybody<br># environment.<br>#$DOCUMENT_ROOT="/home/sandy/public_html/";<br><br></span><span class="default">$tdir </span><span class="keyword">= </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'dir'</span><span class="keyword">];<br>echo </span><span class="string">"tdir==</span><span class="default">$tdir</span><span class="string">&lt;br&gt;"</span><span class="keyword">;<br></span><span class="default">$tparent_path </span><span class="keyword">= </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'parent_path'</span><span class="keyword">];<br></span><span class="default">$dbg </span><span class="keyword">= </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'dbg'</span><span class="keyword">];<br><br>if(!</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$tdir</span><span class="keyword">, </span><span class="default">$DOCUMENT_ROOT</span><span class="keyword">))<br>&nbsp; </span><span class="default">$tdir </span><span class="keyword">= </span><span class="default">getcwd</span><span class="keyword">();<br>if(!</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$tparent_path</span><span class="keyword">, </span><span class="default">$DOCUMENT_ROOT</span><span class="keyword">))<br>&nbsp; </span><span class="default">$tparent_path </span><span class="keyword">= </span><span class="default">$tdir</span><span class="keyword">;<br><br>if (!isset (</span><span class="default">$tdir</span><span class="keyword">))<br>&nbsp; {<br>&nbsp; &nbsp; </span><span class="default">$dir </span><span class="keyword">= </span><span class="default">getcwd </span><span class="keyword">();<br>&nbsp; }<br>else<br>&nbsp; </span><span class="default">$dir </span><span class="keyword">= </span><span class="default">$tdir</span><span class="keyword">;<br><br>if (!isset (</span><span class="default">$tparent_path</span><span class="keyword">))<br>&nbsp; {<br>&nbsp; &nbsp; </span><span class="default">$parent_path </span><span class="keyword">= </span><span class="default">$dir</span><span class="keyword">;<br>&nbsp; }<br>else<br>&nbsp; </span><span class="default">$parent_path </span><span class="keyword">= </span><span class="default">$tparent_path</span><span class="keyword">;<br><br>echo </span><span class="string">"&lt;br&gt;"</span><span class="keyword">;<br>if (!isset (</span><span class="default">$tdir</span><span class="keyword">))<br>&nbsp; {<br>&nbsp; &nbsp; </span><span class="default">$upurl </span><span class="keyword">= </span><span class="default">$PHP_SELF</span><span class="keyword">;<br>&nbsp; }<br>else<br>&nbsp; {<br>&nbsp; &nbsp; if (</span><span class="default">$parent_path </span><span class="keyword">== </span><span class="default">$DOCUMENT_ROOT</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$parent_parent_path </span><span class="keyword">= </span><span class="default">$parent_path</span><span class="keyword">;<br>&nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$parent_parent_path </span><span class="keyword">= </span><span class="default">dirname </span><span class="keyword">(</span><span class="default">$parent_path</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$upurl </span><span class="keyword">= </span><span class="default">$PHP_SELF</span><span class="keyword">.</span><span class="string">"?dir="</span><span class="keyword">.</span><span class="default">$parent_path</span><span class="keyword">.</span><span class="string">"&amp;parent_path="</span><span class="keyword">.<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$parent_parent_path</span><span class="keyword">;<br>&nbsp; }<br><br>if(</span><span class="default">$dbg</span><span class="keyword">==</span><span class="default">1</span><span class="keyword">)<br>{<br>&nbsp; echo </span><span class="string">"PHP_SELF: </span><span class="default">$PHP_SELF</span><span class="string">&lt;br&gt;\n"</span><span class="keyword">;<br>&nbsp; echo </span><span class="string">"DOCUMENT_ROOT: </span><span class="default">$DOCUMENT_ROOT</span><span class="string">&lt;br&gt;\n"</span><span class="keyword">;<br>&nbsp; echo </span><span class="string">"dir: </span><span class="default">$dir</span><span class="string">&lt;br&gt;\n"</span><span class="keyword">;<br>&nbsp; echo </span><span class="string">"parent_path: </span><span class="default">$parent_path</span><span class="string">&lt;br&gt;\n"</span><span class="keyword">;<br>&nbsp; echo </span><span class="string">"upurl: </span><span class="default">$upurl</span><span class="string">&lt;br&gt;\n"</span><span class="keyword">;<br>}<br><br>echo </span><span class="string">"&lt;a href=\"</span><span class="default">$upurl</span><span class="string">\"&gt; &lt;h3&gt;Up&lt;/h3&gt; &lt;/a&gt;\n"</span><span class="keyword">;<br>echo </span><span class="string">"&lt;h2&gt;</span><span class="default">$dir</span><span class="string">&lt;/h2&gt;\n"</span><span class="keyword">;<br><br></span><span class="default">create_tree </span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">, </span><span class="default">$parent_path</span><span class="keyword">);<br><br>function<br></span><span class="default">urlFromPath </span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">)<br>{<br>&nbsp; global </span><span class="default">$PHP_SELF</span><span class="keyword">;<br>&nbsp; global </span><span class="default">$DOCUMENT_ROOT</span><span class="keyword">;<br>&nbsp; </span><span class="default">$prefix </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br>&nbsp; if (</span><span class="default">substr </span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">) != </span><span class="string">"/"</span><span class="keyword">)<br>&nbsp; &nbsp; </span><span class="default">$prefix </span><span class="keyword">= </span><span class="string">"/"</span><span class="keyword">;<br>&nbsp; </span><span class="default">$url </span><span class="keyword">= </span><span class="default">$prefix</span><span class="keyword">.</span><span class="default">ereg_replace </span><span class="keyword">(</span><span class="default">$DOCUMENT_ROOT</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">);<br>&nbsp; return </span><span class="default">$url</span><span class="keyword">;<br>}<br><br>function<br></span><span class="default">create_tree </span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">, </span><span class="default">$parent_path</span><span class="keyword">)<br>{<br>&nbsp; if (</span><span class="default">$handle </span><span class="keyword">= </span><span class="default">opendir </span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">))<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; while (</span><span class="default">false </span><span class="keyword">!== (</span><span class="default">$file </span><span class="keyword">= @</span><span class="default">readdir </span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">)))<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; if (</span><span class="default">$file </span><span class="keyword">!= </span><span class="string">"." </span><span class="keyword">&amp;&amp; </span><span class="default">$file </span><span class="keyword">!= </span><span class="string">".."</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$list</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="default">$file</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$i</span><span class="keyword">++;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$dir_length </span><span class="keyword">= </span><span class="default">count </span><span class="keyword">(</span><span class="default">$list</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; echo </span><span class="string">"&lt;ul&gt;"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$dir_length</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; global </span><span class="default">$PHP_SELF</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; global </span><span class="default">$DOCUMENT_ROOT</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$label </span><span class="keyword">= </span><span class="default">$list</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$test </span><span class="keyword">= </span><span class="default">$dir</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$label</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$alink </span><span class="keyword">= </span><span class="default">$dir</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">ereg_replace</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">,</span><span class="string">"%20"</span><span class="keyword">,</span><span class="default">$label</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; if (!</span><span class="default">strstr </span><span class="keyword">(</span><span class="default">$PHP_SELF</span><span class="keyword">, </span><span class="default">$label</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">is_dir </span><span class="keyword">(</span><span class="default">$test</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">$PHP_SELF</span><span class="keyword">. </span><span class="string">"?dir="</span><span class="keyword">.</span><span class="default">$alink</span><span class="keyword">.</span><span class="string">"&amp;parent_path="</span><span class="keyword">.</span><span class="default">$dir</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$url </span><span class="keyword">= </span><span class="default">ereg_replace</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">, </span><span class="string">"%20"</span><span class="keyword">, </span><span class="default">$tmp</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"</span><span class="default">$url</span><span class="string">&lt;br&gt;\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"&lt;a href=\"</span><span class="default">$url</span><span class="string">\"&gt;&lt;b&gt;</span><span class="default">$label</span><span class="string">&lt;/b&gt;/&lt;/a&gt;&lt;br&gt;\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$link </span><span class="keyword">= </span><span class="default">urlFromPath </span><span class="keyword">(</span><span class="default">$alink</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$label </span><span class="keyword">= </span><span class="default">$list</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"&lt;a href=\"</span><span class="default">$link</span><span class="string">\"&gt;"</span><span class="keyword">.</span><span class="default">$label</span><span class="keyword">.</span><span class="string">"&lt;/a&gt;&lt;br&gt;\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; echo </span><span class="string">"&lt;/ul&gt;"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; </span><span class="default">closedir </span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>}<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="53045">  
  <a class="name">
  <strong class="user"><em>Lasse Dalegaard</em></strong></a><div class="date" title="2005-05-21 12:25"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom53045">
<div class="phpcode"><code><span class="html">
I made a function for finding all files in a specified directory and all subdirectories. It can be quite usefull when searching in alot of files in alot subdirectories. The function returns an array with the path of all the files found.<br><br>&lt;?<br>function getFiles($directory) {<br>&nbsp; &nbsp; // Try to open the directory<br>&nbsp; &nbsp; if($dir = opendir($directory)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; // Create an array for all files found<br>&nbsp; &nbsp; &nbsp; &nbsp; $tmp = Array();<br><br>&nbsp; &nbsp; &nbsp; &nbsp; // Add the files<br>&nbsp; &nbsp; &nbsp; &nbsp; while($file = readdir($dir)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Make sure the file exists<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if($file != "." &amp;&amp; $file != ".." &amp;&amp; $file[0] != '.') {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // If it's a directiry, list all files within it<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(is_dir($directory . "/" . $file)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $tmp2 = getFiles($directory . "/" . $file);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(is_array($tmp2)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $tmp = array_merge($tmp, $tmp2);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; array_push($tmp, $directory . "/" . $file);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; // Finish off the function<br>&nbsp; &nbsp; &nbsp; &nbsp; closedir($dir);<br>&nbsp; &nbsp; &nbsp; &nbsp; return $tmp;<br>&nbsp; &nbsp; }<br>}<br><br>// Example of use<br>print_r(getFiles('.')); // This will find all files in the current directory and all subdirectories<br>?&gt;</span>
</code></div>
  </div>
 </div>
  <div class="note" id="35198">  
  <a class="name">
  <strong class="user"><em>info at 4design dot nu</em></strong></a><div class="date" title="2003-08-22 06:31"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom35198">
<div class="phpcode"><code><span class="html">
In addition to notes above about IIS &amp; PHP reading network shares, here's one solution that works better for me.<br><br>in the management console I created a folder where my "read_dir" script runs. click on properties then select the security tab. here you can set the anonymous account to the standard IUSR_$computername% , BUT.. in this case I chose another account that I set up for reading my shares. (make sure login name and password match the credantials you set on the remote machin ;-))<br><br>I use this to read a dir and it's contents into a searchable database. and it works like a charm...</span>
</code></div>
  </div>
 </div>
  <div class="note" id="83225">  
  <a class="name">
  <strong class="user"><em>kdouglas at satarah dot com</em></strong></a><div class="date" title="2008-05-15 04:22"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom83225">
<div class="phpcode"><code><span class="html">
Breadth-first-search (BFS) for a file or directory (vs. Depth-first-search)<br><a rel="nofollow" target="_blank">http://en.wikipedia.org/wiki/Breadth-first_search</a><br><br><span class="default">&lt;?php<br><br></span><span class="comment">// Breadth-First Recursive Directory Search, for a File or Directory<br>// with optional black-list paths and optional callback function.<br>//<br>// $root -- is the relative path to the start-of-search directory<br>// $file -- is the qualified file name: 'name.ext' EX: 'data.xml'<br>//&nbsp; &nbsp; (or) $file -- is the target directory name EX: 'xml_files'<br>// $callback -- is an optional function name and will be passed all<br>//&nbsp; &nbsp; matching paths EX: 'my_func', instead of exiting on first match<br>// $omit -- is an optional array of exclude paths -- relative to root<br>//&nbsp; &nbsp; To use $omit but not $callback, pass NULL as the $callback argument<br>//<br>// TESTING VALUES FOLLOW ...<br><br></span><span class="keyword">function </span><span class="default">my_func </span><span class="keyword">( </span><span class="default">$path </span><span class="keyword">) {<br>&nbsp; print </span><span class="string">"&lt;strong&gt;</span><span class="default">$path</span><span class="string">&lt;/strong&gt;&lt;br&gt;\n"</span><span class="keyword">;<br>}<br><br></span><span class="default">$root </span><span class="keyword">= </span><span class="string">'../public_html'</span><span class="keyword">;<br></span><span class="default">$file </span><span class="keyword">= </span><span class="string">'data.xml'</span><span class="keyword">;<br></span><span class="default">$callback </span><span class="keyword">= </span><span class="string">'my_func'</span><span class="keyword">;<br></span><span class="default">$omit </span><span class="keyword">= array( </span><span class="string">'include/img'</span><span class="keyword">, </span><span class="string">'include/css'</span><span class="keyword">, </span><span class="string">'scripts' </span><span class="keyword">);<br><br></span><span class="comment">//print breadth_first_file_search ( $root, $file );<br>//print breadth_first_file_search ( $root, $file, $callback );<br>//print breadth_first_file_search ( $root, $file, NULL, $omit );<br></span><span class="keyword">print </span><span class="default">breadth_first_file_search </span><span class="keyword">( </span><span class="default">$root</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">, </span><span class="default">$callback</span><span class="keyword">, </span><span class="default">$omit </span><span class="keyword">);<br><br>function </span><span class="default">breadth_first_file_search </span><span class="keyword">( </span><span class="default">$root</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">, </span><span class="default">$callback </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">, </span><span class="default">$omit </span><span class="keyword">= array() ) {<br>&nbsp; </span><span class="default">$queue </span><span class="keyword">= array( </span><span class="default">rtrim</span><span class="keyword">( </span><span class="default">$root</span><span class="keyword">, </span><span class="string">'/' </span><span class="keyword">).</span><span class="string">'/' </span><span class="keyword">); </span><span class="comment">// normalize all paths<br>&nbsp; </span><span class="keyword">foreach ( </span><span class="default">$omit </span><span class="keyword">as &amp;</span><span class="default">$path </span><span class="keyword">) { </span><span class="comment">// &amp;$path Req. PHP ver 5.x and later<br>&nbsp; &nbsp; </span><span class="default">$path </span><span class="keyword">= </span><span class="default">$root</span><span class="keyword">.</span><span class="default">trim</span><span class="keyword">( </span><span class="default">$path</span><span class="keyword">, </span><span class="string">'/' </span><span class="keyword">).</span><span class="string">'/'</span><span class="keyword">;<br>&nbsp; }<br>&nbsp; while ( </span><span class="default">$base </span><span class="keyword">= </span><span class="default">array_shift</span><span class="keyword">( </span><span class="default">$queue </span><span class="keyword">) ) {<br>&nbsp; &nbsp; </span><span class="default">$file_path </span><span class="keyword">= </span><span class="default">$base</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">;<br>&nbsp; &nbsp; if ( </span><span class="default">file_exists</span><span class="keyword">( </span><span class="default">$file_path </span><span class="keyword">) ) { </span><span class="comment">// file found<br>&nbsp; &nbsp; &nbsp; </span><span class="keyword">if ( </span><span class="default">is_callable</span><span class="keyword">( </span><span class="default">$callback </span><span class="keyword">) ) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$callback</span><span class="keyword">( </span><span class="default">$file_path </span><span class="keyword">); </span><span class="comment">// callback =&gt; CONTINUE<br>&nbsp; &nbsp; &nbsp; </span><span class="keyword">} else {<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$file_path</span><span class="keyword">; </span><span class="comment">// return file-path =&gt; EXIT<br>&nbsp; &nbsp; &nbsp; </span><span class="keyword">}<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; if ( ( </span><span class="default">$handle </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">( </span><span class="default">$base </span><span class="keyword">) ) ) {<br>&nbsp; &nbsp; &nbsp; while ( ( </span><span class="default">$child </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">( </span><span class="default">$handle </span><span class="keyword">) ) !== </span><span class="default">FALSE </span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; if ( </span><span class="default">is_dir</span><span class="keyword">( </span><span class="default">$base</span><span class="keyword">.</span><span class="default">$child </span><span class="keyword">) &amp;&amp; </span><span class="default">$child </span><span class="keyword">!= </span><span class="string">'.' </span><span class="keyword">&amp;&amp; </span><span class="default">$child </span><span class="keyword">!= </span><span class="string">'..' </span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$combined_path </span><span class="keyword">= </span><span class="default">$base</span><span class="keyword">.</span><span class="default">$child</span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ( !</span><span class="default">in_array</span><span class="keyword">( </span><span class="default">$combined_path</span><span class="keyword">, </span><span class="default">$omit </span><span class="keyword">) ) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">array_push</span><span class="keyword">( </span><span class="default">$queue</span><span class="keyword">, </span><span class="default">$combined_path</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; </span><span class="default">closedir</span><span class="keyword">( </span><span class="default">$handle </span><span class="keyword">);<br>&nbsp; &nbsp; } </span><span class="comment">// else unable to open directory =&gt; NEXT CHILD<br>&nbsp; </span><span class="keyword">}<br>&nbsp; return </span><span class="default">FALSE</span><span class="keyword">; </span><span class="comment">// end of tree, file not found<br></span><span class="keyword">}<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="66052">  
  <a class="name">
  <strong class="user"><em>tim2005</em></strong></a><div class="date" title="2006-05-13 05:04"><strong>15 years ago</strong></div>
  <div class="text" id="Hcom66052">
<div class="phpcode"><code><span class="html">
Hello,<br><br>A friend of mine is running a webhost, I think i found a security leak with this script:<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">select_files</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">, </span><span class="default">$label </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">, </span><span class="default">$select_name</span><span class="keyword">, </span><span class="default">$curr_val </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">, </span><span class="default">$char_length </span><span class="keyword">= </span><span class="default">30</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="default">$teller </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; if (</span><span class="default">$handle </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$mydir </span><span class="keyword">= (</span><span class="default">$label </span><span class="keyword">!= </span><span class="string">""</span><span class="keyword">) ? </span><span class="string">"&lt;label for=\""</span><span class="keyword">.</span><span class="default">$select_name</span><span class="keyword">.</span><span class="string">"\"&gt;"</span><span class="keyword">.</span><span class="default">$label</span><span class="keyword">.</span><span class="string">"&lt;/label&gt;\n" </span><span class="keyword">: </span><span class="string">""</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$mydir </span><span class="keyword">.= </span><span class="string">"&lt;select name=\""</span><span class="keyword">.</span><span class="default">$select_name</span><span class="keyword">.</span><span class="string">"\"&gt;\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$curr_val </span><span class="keyword">= (isset(</span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="default">$select_name</span><span class="keyword">])) ? </span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="default">$select_name</span><span class="keyword">] : </span><span class="default">$curr_val</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$mydir </span><span class="keyword">.= (</span><span class="default">$curr_val </span><span class="keyword">== </span><span class="string">""</span><span class="keyword">) ? </span><span class="string">"&nbsp; &lt;option value=\"\" selected&gt;...\n" </span><span class="keyword">: </span><span class="string">"&lt;option value=\"\"&gt;...\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; while (</span><span class="default">false </span><span class="keyword">!== (</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">))) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$files</span><span class="keyword">[] = </span><span class="default">$file</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">sort</span><span class="keyword">(</span><span class="default">$files</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; foreach (</span><span class="default">$files </span><span class="keyword">as </span><span class="default">$val</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">.</span><span class="default">$val</span><span class="keyword">)) { </span><span class="comment">// show only real files (ver. 1.01)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$mydir </span><span class="keyword">.= </span><span class="string">"&nbsp; &nbsp; &lt;option value=\""</span><span class="keyword">.</span><span class="default">$val</span><span class="keyword">.</span><span class="string">"\""</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$mydir </span><span class="keyword">.= (</span><span class="default">$val </span><span class="keyword">== </span><span class="default">$curr_val</span><span class="keyword">) ? </span><span class="string">" selected&gt;" </span><span class="keyword">: </span><span class="string">"&gt;"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$mydir </span><span class="keyword">.= (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">) &gt; </span><span class="default">$char_length</span><span class="keyword">) ? </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$char_length</span><span class="keyword">).</span><span class="string">"...\n" </span><span class="keyword">: </span><span class="default">$val</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$teller</span><span class="keyword">++;&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$mydir </span><span class="keyword">.= </span><span class="string">"&lt;/select&gt;"</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; if (</span><span class="default">$teller </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$mydir </span><span class="keyword">= </span><span class="string">"No files!"</span><span class="keyword">;<br>&nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$mydir</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>}<br><br>echo </span><span class="default">select_files</span><span class="keyword">(</span><span class="string">"C:/winnt/"</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">, </span><span class="string">"60"</span><span class="keyword">);<br></span><span class="default">?&gt;</span> <br><br>Now i can see hist files in his windows dir. Is this a leak? and is it fixable? I'll report this as bug too!<br><br>Tim2005</span>
</code></div>
  </div>
 </div>
  <div class="note" id="64480">  
  <a class="name">
  <strong class="user"><em>tozeiler</em></strong></a><div class="date" title="2006-04-15 01:34"><strong>15 years ago</strong></div>
  <div class="text" id="Hcom64480">
<div class="phpcode"><code><span class="html">
"opendir" said:<br>------------------------------------------------------------------<br><br>23-Jan-2006 08:04<br>I Just wanted a directory list and a clickable link to download the files <br><br>&lt;snip&gt;<br>------<br>&lt;?<br>echo ("&lt;h1&gt;Directory Overzicht:&lt;/h1&gt;");<br><br>function getFiles($path) {<br><br>&lt;snip complicated function contents&gt;<br><br>------------------------------------------------------------------<br>Here's a more straightforward way to linkify $path/files:<br><br><span class="default">&lt;?php<br><br></span><span class="keyword">echo </span><span class="string">"&lt;h1&gt;Directory Overzicht:&lt;/h1&gt;"</span><span class="keyword">;<br><br></span><span class="default">$dh </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">);<br>while ((</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">)) !== </span><span class="default">false</span><span class="keyword">) {<br>&nbsp; &nbsp; echo </span><span class="string">"&lt;a href='</span><span class="default">$path</span><span class="string">/</span><span class="default">$file</span><span class="string">'&gt;</span><span class="default">$file</span><span class="string">&lt;/a&gt;&lt;br /&gt;"</span><span class="keyword">;<br>}<br></span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">);<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="51395">  
  <a class="name">
  <strong class="user"><em>iamnotanerd</em></strong></a><div class="date" title="2005-03-29 09:38"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom51395">
<div class="phpcode"><code><span class="html">
Here is a snippet of the code that I created to search for a file..recursively open the directories and search for a match..
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">search</span><span class="keyword">(</span><span class="default">$target</span><span class="keyword">, </span><span class="default">$directory</span><span class="keyword">){
<br>&nbsp; &nbsp;&nbsp; 
<br>&nbsp; &nbsp; if(</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$directory</span><span class="keyword">)){
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$direc </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$directory</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; while(</span><span class="default">false </span><span class="keyword">!== (</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$direc</span><span class="keyword">))){
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$file </span><span class="keyword">!=</span><span class="string">"." </span><span class="keyword">&amp;&amp; </span><span class="default">$file </span><span class="keyword">!= </span><span class="string">".."</span><span class="keyword">){
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$directory</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">)){
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/</span><span class="default">$target</span><span class="string">/i"</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">)){
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"&lt;a href=\"</span><span class="default">$directory</span><span class="string">/</span><span class="default">$file</span><span class="string">\"&gt;</span><span class="default">$file</span><span class="string">&lt;/a&gt;&lt;br&gt;"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }else if(</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$directory</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">)){
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">search</span><span class="keyword">(</span><span class="default">$target</span><span class="keyword">,</span><span class="default">$directory</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$direc</span><span class="keyword">);
<br>&nbsp; &nbsp; }
<br>
<br>&nbsp; &nbsp; return ;
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="72492">  
  <a class="name">
  <strong class="user"><em>frogstarr78 at yahoo dot com</em></strong></a><div class="date" title="2007-01-21 12:30"><strong>14 years ago</strong></div>
  <div class="text" id="Hcom72492">
<div class="phpcode"><code><span class="html">
Here's a function that will recrusively turn a directory into a hash of directory hashes and file arrays, automatically ignoring "dot" files. <br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">hashify_directory</span><span class="keyword">(</span><span class="default">$topdir</span><span class="keyword">, &amp;</span><span class="default">$list</span><span class="keyword">, </span><span class="default">$ignoredDirectories</span><span class="keyword">=array()) {<br>&nbsp; &nbsp; if (</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$topdir</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$dh </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$topdir</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; while ((</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">)) !== </span><span class="default">false</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!(</span><span class="default">array_search</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">,</span><span class="default">$ignoredDirectories</span><span class="keyword">) &gt; -</span><span class="default">1</span><span class="keyword">) &amp;&amp; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/^\./'</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">) == </span><span class="default">0</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">is_dir</span><span class="keyword">(</span><span class="string">"</span><span class="default">$topdir$file</span><span class="string">"</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(!isset(</span><span class="default">$list</span><span class="keyword">[</span><span class="default">$file</span><span class="keyword">])) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$list</span><span class="keyword">[</span><span class="default">$file</span><span class="keyword">] = array();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">ksort</span><span class="keyword">(</span><span class="default">$list</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">hashify_directory</span><span class="keyword">(</span><span class="string">"</span><span class="default">$topdir$file</span><span class="string">/"</span><span class="keyword">, </span><span class="default">$list</span><span class="keyword">[</span><span class="default">$file</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$list</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>}<br></span><span class="default">?&gt;<br></span><br>e.g.<br><span class="default">&lt;?php<br>$public_html</span><span class="keyword">[</span><span class="string">"StudentFiles"</span><span class="keyword">] = array();<br></span><span class="default">hashify_directory</span><span class="keyword">(</span><span class="string">"StudentFiles/"</span><span class="keyword">, </span><span class="default">$public_html</span><span class="keyword">[</span><span class="string">"StudentFiles"</span><span class="keyword">]);<br></span><span class="default">?&gt;<br></span>on the directory structure: <br>./StudentFiles/tutorial_01/case1/file1.html<br>./StudentFiles/tutorial_01/case1/file2.html<br>./StudentFiles/tutorial_02/case1/file1.html<br>./StudentFiles/tutorial_02/case2/file2.html<br>./StudentFiles/tutorial_03/case1/file2.html<br>etc...<br>becomes:<br><span class="default">&lt;?php<br>print_r</span><span class="keyword">(</span><span class="default">$public_html</span><span class="keyword">); <br></span><span class="comment">/*<br>outputs:<br>array(<br>&nbsp; "StudentFiles" =&gt; array (<br>&nbsp; &nbsp; &nbsp; &nbsp; "tutorial_01" =&gt; array (<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "case1" =&gt; array( "file1.html", "file2.html")<br>&nbsp; &nbsp; &nbsp; &nbsp; ),<br>&nbsp; &nbsp; &nbsp; &nbsp; "tutorial_02" =&gt; array (<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "case1" =&gt; array( "file1.html"),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "case2" =&gt; array( "file2.html")<br>&nbsp; &nbsp; &nbsp; &nbsp; ),<br>&nbsp; &nbsp; &nbsp;&nbsp; "tutorial_03" =&gt; array (<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "case1" =&gt; array( "file2.html")<br>&nbsp; &nbsp; &nbsp;&nbsp; )<br>&nbsp; )<br>)<br>*/<br></span><span class="default">?&gt;<br></span>I'm using it to create a tree view of a directory.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="60127">  
  <a class="name">
  <strong class="user"><em>mstabile75 at gmail dot com</em></strong></a><div class="date" title="2005-12-27 07:04"><strong>15 years ago</strong></div>
  <div class="text" id="Hcom60127">
<div class="phpcode"><code><span class="html">
<span class="default">&lt;?php<br></span><span class="comment">/* The below function will list all folders and files within a directory<br>It is a recursive function that uses a global array.&nbsp; The global array was the easiest <br>way for me to work with an array in a recursive function<br>*This function has no limit on the number of levels down you can search.<br>*The array structure was one that worked for me.<br>ARGUMENTS:<br>$startdir =&gt; specify the directory to start from; format: must end in a "/"<br>$searchSubdirs =&gt; True/false; True if you want to search subdirectories<br>$directoriesonly =&gt; True/false; True if you want to only return directories<br>$maxlevel =&gt; "all" or a number; specifes the number of directories down that you want to search<br>$level =&gt; integer; directory level that the function is currently searching<br>*/<br></span><span class="keyword">function </span><span class="default">filelist </span><span class="keyword">(</span><span class="default">$startdir</span><span class="keyword">=</span><span class="string">"./"</span><span class="keyword">, </span><span class="default">$searchSubdirs</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">, </span><span class="default">$directoriesonly</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">, </span><span class="default">$maxlevel</span><span class="keyword">=</span><span class="string">"all"</span><span class="keyword">, </span><span class="default">$level</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="comment">//list the directory/file names that you want to ignore<br>&nbsp; &nbsp; </span><span class="default">$ignoredDirectory</span><span class="keyword">[] = </span><span class="string">"."</span><span class="keyword">; <br>&nbsp; &nbsp; </span><span class="default">$ignoredDirectory</span><span class="keyword">[] = </span><span class="string">".."</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$ignoredDirectory</span><span class="keyword">[] = </span><span class="string">"_vti_cnf"</span><span class="keyword">;<br>&nbsp; &nbsp; global </span><span class="default">$directorylist</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">//initialize global array<br>&nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$startdir</span><span class="keyword">)) { <br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$dh </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$startdir</span><span class="keyword">)) { <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; while ((</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">)) !== </span><span class="default">false</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!(</span><span class="default">array_search</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">,</span><span class="default">$ignoredDirectory</span><span class="keyword">) &gt; -</span><span class="default">1</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">filetype</span><span class="keyword">(</span><span class="default">$startdir </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">) == </span><span class="string">"dir"</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//build your directory array however you choose; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //add other file details that you want.<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$directorylist</span><span class="keyword">[</span><span class="default">$startdir </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">][</span><span class="string">'level'</span><span class="keyword">] = </span><span class="default">$level</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$directorylist</span><span class="keyword">[</span><span class="default">$startdir </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">][</span><span class="string">'dir'</span><span class="keyword">] = </span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$directorylist</span><span class="keyword">[</span><span class="default">$startdir </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">] = </span><span class="default">$file</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$directorylist</span><span class="keyword">[</span><span class="default">$startdir </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">][</span><span class="string">'path'</span><span class="keyword">] = </span><span class="default">$startdir</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$searchSubdirs</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (((</span><span class="default">$maxlevel</span><span class="keyword">) == </span><span class="string">"all"</span><span class="keyword">) or (</span><span class="default">$maxlevel </span><span class="keyword">&gt; </span><span class="default">$level</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">filelist</span><span class="keyword">(</span><span class="default">$startdir </span><span class="keyword">. </span><span class="default">$file </span><span class="keyword">. </span><span class="string">"/"</span><span class="keyword">, </span><span class="default">$searchSubdirs</span><span class="keyword">, </span><span class="default">$directoriesonly</span><span class="keyword">, </span><span class="default">$maxlevel</span><span class="keyword">, </span><span class="default">$level </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$directoriesonly</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//if you want to include files; build your file array&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //however you choose; add other file details that you want.<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$directorylist</span><span class="keyword">[</span><span class="default">$startdir </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">][</span><span class="string">'level'</span><span class="keyword">] = </span><span class="default">$level</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$directorylist</span><span class="keyword">[</span><span class="default">$startdir </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">][</span><span class="string">'dir'</span><span class="keyword">] = </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$directorylist</span><span class="keyword">[</span><span class="default">$startdir </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">] = </span><span class="default">$file</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$directorylist</span><span class="keyword">[</span><span class="default">$startdir </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">][</span><span class="string">'path'</span><span class="keyword">] = </span><span class="default">$startdir</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; }}}}<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">);<br>}}<br>return(</span><span class="default">$directorylist</span><span class="keyword">);<br>}<br></span><span class="default">$files </span><span class="keyword">= </span><span class="default">filelist</span><span class="keyword">(</span><span class="string">"./"</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">); </span><span class="comment">// call the function<br></span><span class="keyword">foreach (</span><span class="default">$files </span><span class="keyword">as </span><span class="default">$list</span><span class="keyword">) {</span><span class="comment">//print array<br>&nbsp; &nbsp; </span><span class="keyword">echo </span><span class="string">"Directory: " </span><span class="keyword">. </span><span class="default">$list</span><span class="keyword">[</span><span class="string">'dir'</span><span class="keyword">] . </span><span class="string">" =&gt; Level: " </span><span class="keyword">. </span><span class="default">$list</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">] . </span><span class="string">" =&gt; Name: " </span><span class="keyword">. </span><span class="default">$list</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">] . </span><span class="string">" =&gt; Path: " </span><span class="keyword">. </span><span class="default">$list</span><span class="keyword">[</span><span class="string">'path'</span><span class="keyword">] .</span><span class="string">"&lt;br&gt;"</span><span class="keyword">;<br>}</span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="121616">  
  <a class="name">
  <strong class="user"><em>hxss at ya dot ru</em></strong></a><div class="date" title="2017-09-06 11:02"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom121616">
<div class="phpcode"><code><span class="html">
The TRUE recursive map function for working with dirs &amp; files.<br>You can create, read(find), update(or move) or delete files/dirs/tree by your callable function.<br>You can use flags for select what content you need.<br><br><span class="default">&lt;?php<br>var_dump</span><span class="keyword">(</span><span class="default">dirmap</span><span class="keyword">(</span><span class="default">$dst</span><span class="keyword">, function(</span><span class="default">$v</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="default">pre</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">);<br>&nbsp; &nbsp; return </span><span class="default">true</span><span class="keyword">;<br>}, </span><span class="default">1</span><span class="keyword">|</span><span class="default">2</span><span class="keyword">|</span><span class="default">4</span><span class="keyword">|</span><span class="default">8</span><span class="keyword">));<br><br></span><span class="comment">/**<br> * Applies the callback to the entries of the given dir path<br> * In accordance with the received flags<br> * @param&nbsp; string&nbsp;&nbsp; $path&nbsp;&nbsp; path of the working directory<br> * @param&nbsp; Callable $action Callable function that would be<br> *&nbsp; &nbsp;&nbsp; executed for every entry in path<br> * @param&nbsp; integer&nbsp; $flags&nbsp; can be the following flag:<br> *&nbsp; &nbsp;&nbsp; 1: apply Callable function for files<br> *&nbsp; &nbsp;&nbsp; 2: apply Callable function for directories<br> *&nbsp; &nbsp;&nbsp; 4: apply Callable function for $path<br> *&nbsp; &nbsp;&nbsp; 8: work recursively<br> * @return bool bitwise AND of all (bool)$action calls results<br> */<br></span><span class="keyword">function </span><span class="default">dirmap</span><span class="keyword">(</span><span class="default">string $path</span><span class="keyword">, Callable </span><span class="default">$action</span><span class="keyword">, </span><span class="default">int $flags </span><span class="keyword">= </span><span class="default">15</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="default">$flF </span><span class="keyword">= </span><span class="default">boolval</span><span class="keyword">(</span><span class="default">$flags </span><span class="keyword">&amp; </span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$flD </span><span class="keyword">= </span><span class="default">boolval</span><span class="keyword">(</span><span class="default">$flags </span><span class="keyword">&amp; </span><span class="default">2</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$flP </span><span class="keyword">= </span><span class="default">boolval</span><span class="keyword">(</span><span class="default">$flags </span><span class="keyword">&amp; </span><span class="default">4</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$flR </span><span class="keyword">= </span><span class="default">boolval</span><span class="keyword">(</span><span class="default">$flags </span><span class="keyword">&amp; </span><span class="default">8</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br><br>&nbsp; &nbsp; if (</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">)) {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dir </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; while (</span><span class="default">$entry </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$entry</span><span class="keyword">, [</span><span class="string">'.'</span><span class="keyword">, </span><span class="string">'..'</span><span class="keyword">])) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$fullEntry </span><span class="keyword">= </span><span class="string">"</span><span class="keyword">{</span><span class="default">$path</span><span class="keyword">}</span><span class="string">/</span><span class="keyword">{</span><span class="default">$entry</span><span class="keyword">}</span><span class="string">"</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$flR</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$result </span><span class="keyword">&amp;= </span><span class="default">dirmap</span><span class="keyword">(</span><span class="default">$fullEntry</span><span class="keyword">, </span><span class="default">$action</span><span class="keyword">, </span><span class="default">$flags </span><span class="keyword">&amp; </span><span class="default">11</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$flF </span><span class="keyword">&amp;&amp; </span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$fullEntry</span><span class="keyword">) || </span><span class="default">$flD </span><span class="keyword">&amp;&amp; </span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$fullEntry</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$result </span><span class="keyword">&amp;= (bool)</span><span class="default">call_user_func</span><span class="keyword">(</span><span class="default">$action</span><span class="keyword">, </span><span class="default">$fullEntry</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$flP</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$result </span><span class="keyword">&amp;= (bool)</span><span class="default">call_user_func</span><span class="keyword">(</span><span class="default">$action</span><span class="keyword">, </span><span class="default">$fullEntry</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; return (bool)</span><span class="default">$result</span><span class="keyword">;<br>&nbsp; &nbsp; } else<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">);<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="92679">  
  <a class="name">
  <strong class="user"><em>olivernassar.com</em></strong></a><div class="date" title="2009-08-03 01:46"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom92679">
<div class="phpcode"><code><span class="html">
Hopefully this helps someone else. Returns a list of all the files in the directory and any subdirectories.
<br>Excludes files/folders that are in the $exempt array. Can modifiy it so files aren't passed by reference fairly easily.
<br>
<br><span class="default">&lt;?php
<br>
<br>&nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">getFiles</span><span class="keyword">(</span><span class="default">$directory</span><span class="keyword">,</span><span class="default">$exempt </span><span class="keyword">= array(</span><span class="string">'.'</span><span class="keyword">,</span><span class="string">'..'</span><span class="keyword">,</span><span class="string">'.ds_store'</span><span class="keyword">,</span><span class="string">'.svn'</span><span class="keyword">),&amp;</span><span class="default">$files </span><span class="keyword">= array()) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$handle </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$directory</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; while(</span><span class="default">false </span><span class="keyword">!== (</span><span class="default">$resource </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">))) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(!</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$resource</span><span class="keyword">),</span><span class="default">$exempt</span><span class="keyword">)) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$directory</span><span class="keyword">.</span><span class="default">$resource</span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">))
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">array_merge</span><span class="keyword">(</span><span class="default">$files</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">getFiles</span><span class="keyword">(</span><span class="default">$directory</span><span class="keyword">.</span><span class="default">$resource</span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">,</span><span class="default">$exempt</span><span class="keyword">,</span><span class="default">$files</span><span class="keyword">));
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$files</span><span class="keyword">[] = </span><span class="default">$directory</span><span class="keyword">.</span><span class="default">$resource</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$files</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="71742">  
  <a class="name">
  <strong class="user"><em>phpguy at mailstop dot yogelements dot omitme dot com</em></strong></a><div class="date" title="2006-12-13 01:40"><strong>14 years ago</strong></div>
  <div class="text" id="Hcom71742">
<div class="phpcode"><code><span class="html">
An issue that I ran into is that opendir() could care less if you've got server authentication set on sub directories and so any such authentication is bypassed completely when accesses in this way. I did solve it for my application of a pretty file manager, by redirecting to all sub directories thusly:<br>$fdir = "./subdirectory_I_want_to_visit/";<br>if ($fdir != './') { //basically where we are or the parent<br>&nbsp; &nbsp; //redirect the browser to force authentication check on any subdirectories<br>&nbsp; &nbsp; header("Location: <a rel="nofollow" target="_blank">http://my.domain.com</a>".dirname($_SERVER["PHP_SELF"]).substr($fdir,2));<br>&nbsp; &nbsp; exit;<br>} else {<br>&nbsp; &nbsp; $dir = opendir($fdir);<br>}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="90789">  
  <a class="name">
  <strong class="user"><em>Madog Llwyd</em></strong></a><div class="date" title="2009-05-09 05:22"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom90789">
<div class="phpcode"><code><span class="html">
A simple piece to open a directory and display any files with a given extension. Great for things like newsletters, score sheets or the like where you just want to make it easy on the user - they just dump in the file with the correct extension and it's done. A link is given to the file which opens up in a new window.
<br>
<br><span class="default">&lt;?php
<br>&nbsp; $current_dir </span><span class="keyword">= </span><span class="string">"</span><span class="default">$DOCUMENT_ROOT</span><span class="string">"</span><span class="keyword">.</span><span class="string">"dirname/"</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">//Put in second part, the directory - without a leading slash but with a trailing slash!
<br>&nbsp; </span><span class="default">$dir </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$current_dir</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Open the sucker
<br>&nbsp; 
<br>&nbsp; </span><span class="keyword">echo (</span><span class="string">"&lt;p&gt;&lt;h1&gt;List of available files:&lt;/h1&gt;&lt;/p&gt;&lt;hr&gt;&lt;br /&gt;"</span><span class="keyword">);
<br>&nbsp; while (</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">))&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// while loop
<br>&nbsp; &nbsp; </span><span class="keyword">{
<br>&nbsp; &nbsp; </span><span class="default">$parts </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"."</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// pull apart the name and dissect by period
<br>&nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$parts</span><span class="keyword">) &amp;&amp; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$parts</span><span class="keyword">) &gt; </span><span class="default">1</span><span class="keyword">) {&nbsp; &nbsp; </span><span class="comment">// does the dissected array have more than one part
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$extension </span><span class="keyword">= </span><span class="default">end</span><span class="keyword">(</span><span class="default">$parts</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// set to we can see last file extension
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">$extension </span><span class="keyword">== </span><span class="string">"ext" </span><span class="keyword">OR </span><span class="default">$extension </span><span class="keyword">== </span><span class="string">"EXT"</span><span class="keyword">)&nbsp; &nbsp; </span><span class="comment">// is extension ext or EXT ?
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">"&lt;a href=\"</span><span class="default">$file</span><span class="string">\" target=\"_blank\"&gt; </span><span class="default">$file</span><span class="string"> &lt;/a&gt;&lt;br /&gt;"</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// If so, echo it out else do nothing cos it's not what we want
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">}
<br>&nbsp; &nbsp; }
<br>&nbsp; echo </span><span class="string">"&lt;hr&gt;&lt;br /&gt;"</span><span class="keyword">;
<br>&nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Close the directory after we are done
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="87454">  
  <a class="name">
  <strong class="user"><em>php at uchange dot co dot uk</em></strong></a><div class="date" title="2008-12-05 09:36"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom87454">
<div class="phpcode"><code><span class="html">
Having spent an hour or so trying to get a complete list of files from a network share on Windows, I've given up (Apache 2.2 Win32, WinXP, PHP5 -&gt; Windows 2000 R2).<br><br>Trying to use a mapped drive letter gives me an error and trying to use the UNC path works but is dog slow (it takes a couple of minutes to open and readdir() a directory with a couple of hundred files).<br><br>Using this code is fast and instant (you'll have to chop up the output yourself but so be it!)<br><br>$out = `dir $dir /B /S`;<br><br>If you don't need recursive subdirectories remove the /S from the command - for more details run 'dir /?' on Windows.<br><br>Hope this helps somebody in a similar fix!</span>
</code></div>
  </div>
 </div>
  <div class="note" id="92448">  
  <a class="name">
  <strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2009-07-24 08:42"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom92448">
<div class="phpcode"><code><span class="html">
If you want to iterate through a directory, have a look at the SPL DirectoryIterator:<br><a rel="nofollow" target="_blank">http://php.net/manual/class.directoryiterator.php</a></span>
</code></div>
  </div>
 </div>
  <div class="note" id="89517">  
  <a class="name">
  <strong class="user"><em>Richard Bronosky</em></strong></a><div class="date" title="2009-03-11 09:14"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom89517">
<div class="phpcode"><code><span class="html">
The easiest way to get a dir listing and sort it is to exec() out to ls (eg:'ls -t'). But, that is considered "unsafe". My hosting company finally caught me doing it so here is my fastest solution. (Lucky for me each file is created with a Unix Timestamp at the end of the name and no other numbers in it.)<br><br><span class="default">&lt;?php<br></span><span class="comment">#exec('ls -t ./images/motion_detection/', $files); # They outlawed exec, so now I have to do it by hand.<br></span><span class="keyword">if (</span><span class="default">$handle </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="string">'./images/motion_detection/'</span><span class="keyword">)) {<br>&nbsp; &nbsp; </span><span class="default">$files</span><span class="keyword">=array();<br>&nbsp; &nbsp; while (</span><span class="default">false </span><span class="keyword">!== (</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">))) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$files</span><span class="keyword">[</span><span class="default">$file</span><span class="keyword">] = </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/[^0-9]/'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">); </span><span class="comment"># Timestamps may not be unique, file names are.<br>&nbsp; &nbsp; </span><span class="keyword">}<br>&nbsp; &nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">arsort</span><span class="keyword">(</span><span class="default">$files</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$files</span><span class="keyword">=</span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">$files</span><span class="keyword">);<br>}<br></span><span class="default">?&gt;<br></span><br>Before you go copying someone's bloat kitchen sink function/class, consider what you have and what you really need.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="61012">  
  <a class="name"><strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2006-01-23 07:04"><strong>15 years ago</strong></div>
  <div class="text" id="Hcom61012">
<div class="phpcode"><code><span class="html">
I Just wanted a directory list and a clickable link to download the files because my plesk server does not give me this function. I edited the script a little bit.<br><br>Many thanks from a script-noob<br><br>------<br>&lt;?<br>echo ("&lt;h1&gt;Directory Overzicht:&lt;/h1&gt;");<br><br>function getFiles($path) {<br>&nbsp;&nbsp; //Function takes a path, and returns a numerically indexed array of associative arrays containing file information,<br>&nbsp;&nbsp; //sorted by the file name (case insensitive).&nbsp; If two files are identical when compared without case, they will sort<br>&nbsp;&nbsp; //relative to each other in the order presented by readdir()<br>&nbsp;&nbsp; $files = array();<br>&nbsp;&nbsp; $fileNames = array();<br>&nbsp;&nbsp; $i = 0;<br>&nbsp;&nbsp; <br>&nbsp;&nbsp; if (is_dir($path)) {<br>&nbsp; &nbsp; &nbsp;&nbsp; if ($dh = opendir($path)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while (($file = readdir($dh)) !== false) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($file == "." || $file == "..") continue;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $fullpath = $path . "/" . $file;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $fkey = strtolower($file);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while (array_key_exists($fkey,$fileNames)) $fkey .= " ";<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $a = stat($fullpath);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $files[$fkey]['size'] = $a['size'];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($a['size'] == 0) $files[$fkey]['sizetext'] = "-";<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else if ($a['size'] &gt; 1024) $files[$fkey]['sizetext'] = (ceil($a['size']/1024*100)/100) . " K";<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else if ($a['size'] &gt; 1024*1024) $files[$fkey]['sizetext'] = (ceil($a['size']/(1024*1024)*100)/100) . " Mb";<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else $files[$fkey]['sizetext'] = $a['size'] . " bytes";<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $files[$fkey]['name'] = $file;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $files[$fkey]['type'] = filetype($fullpath);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $fileNames[$i++] = $fkey;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; closedir($dh);<br>&nbsp; &nbsp; &nbsp;&nbsp; } else die ("Cannot open directory:&nbsp; $path");<br>&nbsp;&nbsp; } else die ("Path is not a directory:&nbsp; $path");<br>&nbsp;&nbsp; sort($fileNames,SORT_STRING);<br>&nbsp;&nbsp; $sortedFiles = array();<br>&nbsp;&nbsp; $i = 0;<br>&nbsp;&nbsp; foreach($fileNames as $f) $sortedFiles[$i++] = $files[$f];<br>&nbsp;&nbsp; <br>&nbsp;&nbsp; return $sortedFiles;<br>}<br><br>$files = getFiles("./");<br>foreach ($files as $file) print "&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;b&gt;&lt;a href=\"$file[name]\"&gt;$file[name]&lt;/a&gt;&lt;/b&gt;&lt;br&gt;\n";<br>?&gt;</span>
</code></div>
  </div>
 </div>
  <div class="note" id="75085">  
  <a class="name">
  <strong class="user"><em>Michael mt1955 (a) gmail.com</em></strong></a><div class="date" title="2007-05-11 07:59"><strong>14 years ago</strong></div>
  <div class="text" id="Hcom75085">
<div class="phpcode"><code><span class="html">
# simple directory walk with callback function<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">callbackDir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">)<br>{ <br>&nbsp;&nbsp; </span><span class="comment"># do whatever you want here<br>&nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">"</span><span class="default">$dir</span><span class="string">\n"</span><span class="keyword">;<br>}<br><br>function </span><span class="default">walkDir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">,</span><span class="default">$fx</span><span class="keyword">)<br>{<br>&nbsp; </span><span class="default">$arStack </span><span class="keyword">= array();<br>&nbsp; </span><span class="default">$fx</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">);<br>&nbsp; if( (</span><span class="default">$dh</span><span class="keyword">=</span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">)) )<br>&nbsp; { while( (</span><span class="default">$file</span><span class="keyword">=</span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">))!==</span><span class="default">false </span><span class="keyword">)<br>&nbsp; &nbsp; { if( </span><span class="default">$file</span><span class="keyword">==</span><span class="string">'.' </span><span class="keyword">|| </span><span class="default">$file</span><span class="keyword">==</span><span class="string">'..' </span><span class="keyword">) continue;<br>&nbsp; &nbsp; &nbsp; if( </span><span class="default">is_dir</span><span class="keyword">(</span><span class="string">"</span><span class="default">$dir</span><span class="string">/</span><span class="default">$file</span><span class="string">"</span><span class="keyword">) )<br>&nbsp; &nbsp; &nbsp; { if( !</span><span class="default">in_array</span><span class="keyword">(</span><span class="string">"</span><span class="default">$dir</span><span class="string">/</span><span class="default">$file</span><span class="string">"</span><span class="keyword">,</span><span class="default">$arStack</span><span class="keyword">) ) </span><span class="default">$arStack</span><span class="keyword">[]=</span><span class="string">"</span><span class="default">$dir</span><span class="string">/</span><span class="default">$file</span><span class="string">"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">);<br>&nbsp; }<br>&nbsp; if( </span><span class="default">count</span><span class="keyword">(</span><span class="default">$arStack</span><span class="keyword">) )<br>&nbsp; { foreach( </span><span class="default">$arStack </span><span class="keyword">as </span><span class="default">$subdir </span><span class="keyword">)<br>&nbsp; &nbsp; { </span><span class="default">walkDir</span><span class="keyword">(</span><span class="default">$subdir</span><span class="keyword">,</span><span class="default">$fx</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp; }<br>}<br><br></span><span class="default">walkDir</span><span class="keyword">(</span><span class="default">$root</span><span class="keyword">,</span><span class="default">callBackDir</span><span class="keyword">);<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->

  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from www.php.net/manual/en/function.opendir.php by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 11 Sep 2021 06:30:56 GMT -->

</body></html>