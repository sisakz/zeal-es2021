<html><!-- Mirrored from www.php.net/manual/en/class.ziparchive.php by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 11 Sep 2021 05:08:56 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>ZipArchive</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="class.ziparchive.html">
 <link rel="shorturl" href="https://www.php.net/ziparchive">
 <link rel="alternate" href="https://www.php.net/ziparchive" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="book.zip.html">
 <link rel="prev" href="zip.examples.html">
 <link rel="next" href="ziparchive.addemptydir.html">

 <link rel="alternate" href="class.ziparchive.html" hreflang="en">
 <link rel="alternate" href="https://www.php.net/manual/pt_BR/class.ziparchive.php" hreflang="pt_BR">
 <link rel="alternate" href="https://www.php.net/manual/zh/class.ziparchive.php" hreflang="zh">
 <link rel="alternate" href="https://www.php.net/manual/fr/class.ziparchive.php" hreflang="fr">
 <link rel="alternate" href="https://www.php.net/manual/de/class.ziparchive.php" hreflang="de">
 <link rel="alternate" href="https://www.php.net/manual/ja/class.ziparchive.php" hreflang="ja">
 <link rel="alternate" href="https://www.php.net/manual/ro/class.ziparchive.php" hreflang="ro">
 <link rel="alternate" href="https://www.php.net/manual/ru/class.ziparchive.php" hreflang="ru">
 <link rel="alternate" href="https://www.php.net/manual/es/class.ziparchive.php" hreflang="es">
 <link rel="alternate" href="https://www.php.net/manual/tr/class.ziparchive.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached0aba.css?t=1539771603&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached2ecf.css?t=1539765004&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedba57.css?t=1606338002&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached3afa.css?t=1627831203&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="https://www.php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script>
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="https://www.php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script src="https://www.php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>


</head>
<body class="docs " style="">


<div class="headsup"><a href="https://www.php.net/conferences/index.php#id2021-09-08-1">Longhorn PHP 2021</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.errors.html">Errors</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.attributes.html">Attributes</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.sessions.html">Session Security</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
	<dd><a href="refs.ui.html">GUI Extensions</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
    <div id="breadcrumbs-inner">
          
              
          <ul>
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.compression.html">Compression and Archive Extensions</a></li>      <li><a href="book.zip.html">Zip</a></li>      </ul>
    </div>
  </div>




<div id="layout" class="clearfix">
  <section id="layout-content">
  <div id="class.ziparchive" class="reference">
 <h1 class="title">The <span class="classname"><a href="class.ziparchive.html" class="classname">ZipArchive</a></span> class</h1>
 
 
 <div class="partintro"><p class="verinfo">(PHP 5 &gt;= 5.2.0, PHP 7, PHP 8, PECL zip &gt;= 1.1.0)</p>
 

  <div class="section" id="ziparchive.intro">
   <h2 class="title">Introduction</h2>
   <p class="para">
    A file archive, compressed with Zip.
   </p>
  </div>

 
  <div class="section" id="ziparchive.synopsis">
   <h2 class="title">Class synopsis</h2>


   <div class="classsynopsis">
    <div class="ooclass"></div>


    <div class="classsynopsisinfo">
     <span class="ooclass">
      <span class="modifier">class</span> <strong class="classname">ZipArchive</strong>
     </span>
 
     <span class="oointerface"><span class="modifier">implements</span> 
       <a href="class.countable.html" class="interfacename">Countable</a></span> {</div>

    <div class="classsynopsisinfo classsynopsisinfo_comment">/* Properties */</div>
    <div class="fieldsynopsis"><span class="type">int</span> <var class="varname"><a href="class.ziparchive.html#ziparchive.props.lastid">$<var class="varname">lastId</var></a></var>;</div>

    <div class="fieldsynopsis"><span class="type">int</span> <var class="varname"><a href="class.ziparchive.html#ziparchive.props.status">$<var class="varname">status</var></a></var>;</div>

    <div class="fieldsynopsis"><span class="type">int</span> <var class="varname"><a href="class.ziparchive.html#ziparchive.props.statussys">$<var class="varname">statusSys</var></a></var>;</div>

    <div class="fieldsynopsis"><span class="type">int</span> <var class="varname"><a href="class.ziparchive.html#ziparchive.props.numfiles">$<var class="varname">numFiles</var></a></var>;</div>

    <div class="fieldsynopsis"><span class="type">string</span> <var class="varname"><a href="class.ziparchive.html#ziparchive.props.filename">$<var class="varname">filename</var></a></var>;</div>

    <div class="fieldsynopsis"><span class="type">string</span> <var class="varname"><a href="class.ziparchive.html#ziparchive.props.comment">$<var class="varname">comment</var></a></var>;</div>


    
    <div class="classsynopsisinfo classsynopsisinfo_comment">/* Methods */</div>
    <div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="methodname"><a href="ziparchive.addemptydir.html" class="methodname">addEmptyDir</a></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$dirname</code></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code><span class="initializer"> = 0</span></span>): <span class="type">bool</span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.addfile.html" class="methodname">addFile</a></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$filepath</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$entryname</code><span class="initializer"> = ""</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$start</code><span class="initializer"> = 0</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$length</code><span class="initializer"> = 0</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code><span class="initializer"> = ZipArchive::FL_OVERWRITE</span></span><br>): <span class="type">bool</span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.addfromstring.html" class="methodname">addFromString</a></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>, <span class="methodparam"><span class="type">string</span> <code class="parameter">$content</code></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code><span class="initializer"> = ZipArchive::FL_OVERWRITE</span></span>): <span class="type">bool</span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.addglob.html" class="methodname">addGlob</a></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$pattern</code></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code><span class="initializer"> = 0</span></span>, <span class="methodparam"><span class="type">array</span> <code class="parameter">$options</code><span class="initializer"> = []</span></span>): <span class="type"><span class="type">array</span>|<span class="type"><span class="type false">false</span></span></span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.addpattern.html" class="methodname">addPattern</a></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$pattern</code></span>, <span class="methodparam"><span class="type">string</span> <code class="parameter">$path</code><span class="initializer"> = "."</span></span>, <span class="methodparam"><span class="type">array</span> <code class="parameter">$options</code><span class="initializer"> = []</span></span>): <span class="type"><span class="type">array</span>|<span class="type"><span class="type false">false</span></span></span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.close.html" class="methodname">close</a></span>(): <span class="type">bool</span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.count.html" class="methodname">count</a></span>(): <span class="type">int</span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.deleteindex.html" class="methodname">deleteIndex</a></span>(<span class="methodparam"><span class="type">int</span> <code class="parameter">$index</code></span>): <span class="type">bool</span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.deletename.html" class="methodname">deleteName</a></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>): <span class="type">bool</span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.extractto.html" class="methodname">extractTo</a></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$pathto</code></span>, <span class="methodparam"><span class="type"><span class="type">array</span>|<span class="type">string</span>|<span class="type">null</span></span> <code class="parameter">$files</code><span class="initializer"> = <strong><code>null</code></strong></span></span>): <span class="type">bool</span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.getarchivecomment.html" class="methodname">getArchiveComment</a></span>(<span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code><span class="initializer"> = 0</span></span>): <span class="type"><span class="type">string</span>|<span class="type"><span class="type false">false</span></span></span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.getcommentindex.html" class="methodname">getCommentIndex</a></span>(<span class="methodparam"><span class="type">int</span> <code class="parameter">$index</code></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code><span class="initializer"> = 0</span></span>): <span class="type"><span class="type">string</span>|<span class="type"><span class="type false">false</span></span></span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.getcommentname.html" class="methodname">getCommentName</a></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code><span class="initializer"> = 0</span></span>): <span class="type"><span class="type">string</span>|<span class="type"><span class="type false">false</span></span></span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.getexternalattributesindex.html" class="methodname">GetExternalAttributesIndex</a></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$index</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter reference">&amp;$opsys</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter reference">&amp;$attr</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code><span class="initializer"> = ?</span></span><br>): <span class="type">bool</span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.getexternalattributesname.html" class="methodname">getExternalAttributesName</a></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter reference">&amp;$opsys</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter reference">&amp;$attr</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code><span class="initializer"> = 0</span></span><br>): <span class="type">bool</span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.getfromindex.html" class="methodname">getFromIndex</a></span>(<span class="methodparam"><span class="type">int</span> <code class="parameter">$index</code></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$len</code><span class="initializer"> = 0</span></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code><span class="initializer"> = 0</span></span>): <span class="type"><span class="type">string</span>|<span class="type"><span class="type false">false</span></span></span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.getfromname.html" class="methodname">getFromName</a></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$len</code><span class="initializer"> = 0</span></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code><span class="initializer"> = 0</span></span>): <span class="type"><span class="type">string</span>|<span class="type"><span class="type false">false</span></span></span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.getnameindex.html" class="methodname">getNameIndex</a></span>(<span class="methodparam"><span class="type">int</span> <code class="parameter">$index</code></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code><span class="initializer"> = 0</span></span>): <span class="type"><span class="type">string</span>|<span class="type"><span class="type false">false</span></span></span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.getstatusstring.html" class="methodname">getStatusString</a></span>(): <span class="type">string</span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.getstream.html" class="methodname">getStream</a></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>): <span class="type"><span class="type">resource</span>|<span class="type"><span class="type false">false</span></span></span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="modifier">static</span> <span class="methodname"><a href="ziparchive.iscompressionmethoddupported.html" class="methodname">isCompressionMethodSupported</a></span>(<span class="methodparam"><span class="type">int</span> <code class="parameter">$method</code></span>, <span class="methodparam"><span class="type">bool</span> <code class="parameter">$enc</code><span class="initializer"> = <strong><code>true</code></strong></span></span>): <span class="type">bool</span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="modifier">static</span> <span class="methodname"><a href="ziparchive.isencryptionmethoddupported.html" class="methodname">isEncryptionMethodSupported</a></span>(<span class="methodparam"><span class="type">int</span> <code class="parameter">$method</code></span>, <span class="methodparam"><span class="type">bool</span> <code class="parameter">$enc</code><span class="initializer"> = <strong><code>true</code></strong></span></span>): <span class="type">bool</span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.locatename.html" class="methodname">locateName</a></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code><span class="initializer"> = 0</span></span>): <span class="type"><span class="type">int</span>|<span class="type"><span class="type false">false</span></span></span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.open.html" class="methodname">open</a></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$filename</code></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code><span class="initializer"> = 0</span></span>): <span class="type"><span class="type">bool</span>|<span class="type">int</span></span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.registercancelcallback.html" class="methodname">registerCancelCallback</a></span>(<span class="methodparam"><span class="type"><a href="language.types.callable.html" class="type callable">callable</a></span> <code class="parameter">$callback</code></span>): <span class="type">bool</span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.registerprogresscallback.html" class="methodname">registerProgressCallback</a></span>(<span class="methodparam"><span class="type">float</span> <code class="parameter">$rate</code></span>, <span class="methodparam"><span class="type"><a href="language.types.callable.html" class="type callable">callable</a></span> <code class="parameter">$callback</code></span>): <span class="type">bool</span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.renameindex.html" class="methodname">renameIndex</a></span>(<span class="methodparam"><span class="type">int</span> <code class="parameter">$index</code></span>, <span class="methodparam"><span class="type">string</span> <code class="parameter">$new_name</code></span>): <span class="type">bool</span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.renamename.html" class="methodname">renameName</a></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>, <span class="methodparam"><span class="type">string</span> <code class="parameter">$new_name</code></span>): <span class="type">bool</span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.replacefile.html" class="methodname">replaceFile</a></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$filepath</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$index</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$start</code><span class="initializer"> = 0</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$length</code><span class="initializer"> = 0</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code><span class="initializer"> = 0</span></span><br>): <span class="type">bool</span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.setarchivecomment.html" class="methodname">setArchiveComment</a></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$comment</code></span>): <span class="type">bool</span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.setcommentindex.html" class="methodname">setCommentIndex</a></span>(<span class="methodparam"><span class="type">int</span> <code class="parameter">$index</code></span>, <span class="methodparam"><span class="type">string</span> <code class="parameter">$comment</code></span>): <span class="type">bool</span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.setcommentname.html" class="methodname">setCommentName</a></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>, <span class="methodparam"><span class="type">string</span> <code class="parameter">$comment</code></span>): <span class="type">bool</span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.setcompressionindex.html" class="methodname">setCompressionIndex</a></span>(<span class="methodparam"><span class="type">int</span> <code class="parameter">$index</code></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$method</code></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$compflags</code><span class="initializer"> = 0</span></span>): <span class="type">bool</span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.setcompressionname.html" class="methodname">setCompressionName</a></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$method</code></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$compflags</code><span class="initializer"> = 0</span></span>): <span class="type">bool</span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.setencryptionindex.html" class="methodname">setEncryptionIndex</a></span>(<span class="methodparam"><span class="type">int</span> <code class="parameter">$index</code></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$method</code></span>, <span class="methodparam"><span class="type">?</span><span class="type"><span class="type">string</span><span class="type"></span></span> <code class="parameter">$password</code><span class="initializer"> = <strong><code>null</code></strong></span></span>): <span class="type">bool</span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.setencryptionname.html" class="methodname">setEncryptionName</a></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$method</code></span>, <span class="methodparam"><span class="type">?</span><span class="type"><span class="type">string</span><span class="type"></span></span> <code class="parameter">$password</code><span class="initializer"> = <strong><code>null</code></strong></span></span>): <span class="type">bool</span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.setexternalattributesindex.html" class="methodname">setExternalAttributesIndex</a></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$index</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$opsys</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$attr</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code><span class="initializer"> = 0</span></span><br>): <span class="type">bool</span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.setexternalattributesname.html" class="methodname">setExternalAttributesName</a></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$opsys</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$attr</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code><span class="initializer"> = 0</span></span><br>): <span class="type">bool</span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.setmtimeindex.html" class="methodname">setMtimeIndex</a></span>(<span class="methodparam"><span class="type">int</span> <code class="parameter">$index</code></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$timestamp</code></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code><span class="initializer"> = 0</span></span>): <span class="type">bool</span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.setmtimename.html" class="methodname">setMtimeName</a></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$timestamp</code></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code><span class="initializer"> = 0</span></span>): <span class="type">bool</span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.setpassword.html" class="methodname">setPassword</a></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$password</code></span>): <span class="type">bool</span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.statindex.html" class="methodname">statIndex</a></span>(<span class="methodparam"><span class="type">int</span> <code class="parameter">$index</code></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code><span class="initializer"> = 0</span></span>): <span class="type"><span class="type">array</span>|<span class="type"><span class="type false">false</span></span></span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.statname.html" class="methodname">statName</a></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code><span class="initializer"> = 0</span></span>): <span class="type"><span class="type">array</span>|<span class="type"><span class="type false">false</span></span></span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.unchangeall.html" class="methodname">unchangeAll</a></span>(): <span class="type">bool</span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.unchangearchive.html" class="methodname">unchangeArchive</a></span>(): <span class="type">bool</span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.unchangeindex.html" class="methodname">unchangeIndex</a></span>(<span class="methodparam"><span class="type">int</span> <code class="parameter">$index</code></span>): <span class="type">bool</span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="ziparchive.unchangename.html" class="methodname">unchangeName</a></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>): <span class="type">bool</span></div>

    
   }</div>


  </div>


  <div class="section" id="ziparchive.props">
   <h2 class="title">Properties</h2>
   <dl>
    
     <dt id="ziparchive.props.lastid"><var class="varname">lastId</var></dt>

     <dd>

      <p class="para">Index value of last added entry (file or directory).
      Available as of PHP 8.0.0 and PECL zip 1.18.0.</p>
     </dd>

    
    
     <dt id="ziparchive.props.status"><var class="varname">status</var></dt>

     <dd>

      <p class="para">Status of the Zip Archive.
      Available for closed archive, as of PHP 8.0.0 and PECL zip 1.18.0.</p>
     </dd>

    
    
     <dt id="ziparchive.props.statussys"><var class="varname">statusSys</var></dt>

     <dd>

      <p class="para">System status of the Zip Archive.
      Available for closed archive, as of PHP 8.0.0 and PECL zip 1.18.0.</p>
     </dd>

    
    
     <dt id="ziparchive.props.numfiles"><var class="varname">numFiles</var></dt>

     <dd>

      <p class="para">Number of files in archive</p>
     </dd>

    
    
     <dt id="ziparchive.props.filename"><var class="varname">filename</var></dt>

     <dd>

      <p class="para">File name in the file system</p>
     </dd>

    
    
     <dt id="ziparchive.props.comment"><var class="varname">comment</var></dt>

     <dd>

      <p class="para">Comment for the archive</p>
     </dd>

    
   </dl>

  </div>

 </div>


 






























































































































































































































































<h2>Table of Contents</h2><ul class="chunklist chunklist_reference"><li><a href="ziparchive.addemptydir.html">ZipArchive::addEmptyDir</a> — Add a new directory</li><li><a href="ziparchive.addfile.html">ZipArchive::addFile</a> — Adds a file to a ZIP archive from the given path</li><li><a href="ziparchive.addfromstring.html">ZipArchive::addFromString</a> — Add a file to a ZIP archive using its contents</li><li><a href="ziparchive.addglob.html">ZipArchive::addGlob</a> — Add files from a directory by glob pattern</li><li><a href="ziparchive.addpattern.html">ZipArchive::addPattern</a> — Add files from a directory by PCRE pattern</li><li><a href="ziparchive.close.html">ZipArchive::close</a> — Close the active archive (opened or newly created)</li><li><a href="ziparchive.count.html">ZipArchive::count</a> — Counts the number of files in the archive</li><li><a href="ziparchive.deleteindex.html">ZipArchive::deleteIndex</a> — Delete an entry in the archive using its index</li><li><a href="ziparchive.deletename.html">ZipArchive::deleteName</a> — Delete an entry in the archive using its name</li><li><a href="ziparchive.extractto.html">ZipArchive::extractTo</a> — Extract the archive contents</li><li><a href="ziparchive.getarchivecomment.html">ZipArchive::getArchiveComment</a> — Returns the Zip archive comment</li><li><a href="ziparchive.getcommentindex.html">ZipArchive::getCommentIndex</a> — Returns the comment of an entry using the entry index</li><li><a href="ziparchive.getcommentname.html">ZipArchive::getCommentName</a> — Returns the comment of an entry using the entry name</li><li><a href="ziparchive.getexternalattributesindex.html">ZipArchive::getExternalAttributesIndex</a> — Retrieve the external attributes of an entry defined by its index</li><li><a href="ziparchive.getexternalattributesname.html">ZipArchive::getExternalAttributesName</a> — Retrieve the external attributes of an entry defined by its name</li><li><a href="ziparchive.getfromindex.html">ZipArchive::getFromIndex</a> — Returns the entry contents using its index</li><li><a href="ziparchive.getfromname.html">ZipArchive::getFromName</a> — Returns the entry contents using its name</li><li><a href="ziparchive.getnameindex.html">ZipArchive::getNameIndex</a> — Returns the name of an entry using its index</li><li><a href="ziparchive.getstatusstring.html">ZipArchive::getStatusString</a> — Returns the status error message, system and/or zip messages</li><li><a href="ziparchive.getstream.html">ZipArchive::getStream</a> — Get a file handler to the entry defined by its name (read only)</li><li><a href="ziparchive.iscompressionmethoddupported.html">ZipArchive::isCompressionMethodSupported</a> — Check if a compression method is supported by libzip</li><li><a href="ziparchive.isencryptionmethoddupported.html">ZipArchive::isEncryptionMethodSupported</a> — Check if a encryption method is supported by libzip</li><li><a href="ziparchive.locatename.html">ZipArchive::locateName</a> — Returns the index of the entry in the archive</li><li><a href="ziparchive.open.html">ZipArchive::open</a> — Open a ZIP file archive</li><li><a href="ziparchive.registercancelcallback.html">ZipArchive::registerCancelCallback</a> — Register a callback to allow cancellation during archive close.</li><li><a href="ziparchive.registerprogresscallback.html">ZipArchive::registerProgressCallback</a> — Register a callback to provide updates during archive close.</li><li><a href="ziparchive.renameindex.html">ZipArchive::renameIndex</a> — Renames an entry defined by its index</li><li><a href="ziparchive.renamename.html">ZipArchive::renameName</a> — Renames an entry defined by its name</li><li><a href="ziparchive.replacefile.html">ZipArchive::replaceFile</a> — Replace file in ZIP archive with a given path</li><li><a href="ziparchive.setarchivecomment.html">ZipArchive::setArchiveComment</a> — Set the comment of a ZIP archive</li><li><a href="ziparchive.setcommentindex.html">ZipArchive::setCommentIndex</a> — Set the comment of an entry defined by its index</li><li><a href="ziparchive.setcommentname.html">ZipArchive::setCommentName</a> — Set the comment of an entry defined by its name</li><li><a href="ziparchive.setcompressionindex.html">ZipArchive::setCompressionIndex</a> — Set the compression method of an entry defined by its index</li><li><a href="ziparchive.setcompressionname.html">ZipArchive::setCompressionName</a> — Set the compression method of an entry defined by its name</li><li><a href="ziparchive.setencryptionindex.html">ZipArchive::setEncryptionIndex</a> — Set the encryption method of an entry defined by its index</li><li><a href="ziparchive.setencryptionname.html">ZipArchive::setEncryptionName</a> — Set the encryption method of an entry defined by its name</li><li><a href="ziparchive.setexternalattributesindex.html">ZipArchive::setExternalAttributesIndex</a> — Set the external attributes of an entry defined by its index</li><li><a href="ziparchive.setexternalattributesname.html">ZipArchive::setExternalAttributesName</a> — Set the external attributes of an entry defined by its name</li><li><a href="ziparchive.setmtimeindex.html">ZipArchive::setMtimeIndex</a> — Set the modification time of an entry defined by its index</li><li><a href="ziparchive.setmtimename.html">ZipArchive::setMtimeName</a> — Set the modification time of an entry defined by its name</li><li><a href="ziparchive.setpassword.html">ZipArchive::setPassword</a> — Set the password for the active archive</li><li><a href="ziparchive.statindex.html">ZipArchive::statIndex</a> — Get the details of an entry defined by its index</li><li><a href="ziparchive.statname.html">ZipArchive::statName</a> — Get the details of an entry defined by its name</li><li><a href="ziparchive.unchangeall.html">ZipArchive::unchangeAll</a> — Undo all changes done in the archive</li><li><a href="ziparchive.unchangearchive.html">ZipArchive::unchangeArchive</a> — Revert all global changes done in the archive</li><li><a href="ziparchive.unchangeindex.html">ZipArchive::unchangeIndex</a> — Revert all changes done to an entry at the given index</li><li><a href="ziparchive.unchangename.html">ZipArchive::unchangeName</a> — Revert all changes done to an entry with the given name</li></ul>
</div>

<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="110719">  
  <a class="name">
  <strong class="user"><em>umbalaconmeogia at NOSPAM dot gmail dot com</em></strong></a><div class="date" title="2012-11-28 03:48"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom110719">
<div class="phpcode"><code><span class="html">
Zip a folder (include itself).
<br>Usage:
<br>&nbsp; HZip::zipDir('/path/to/sourceDir', '/path/to/out.zip');
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">class </span><span class="default">HZip
<br></span><span class="keyword">{
<br>&nbsp; </span><span class="comment">/**
<br>&nbsp;&nbsp; * Add files and sub-directories in a folder to zip file.
<br>&nbsp;&nbsp; * @param string $folder
<br>&nbsp;&nbsp; * @param ZipArchive $zipFile
<br>&nbsp;&nbsp; * @param int $exclusiveLength Number of text to be exclusived from the file path.
<br>&nbsp;&nbsp; */
<br>&nbsp; </span><span class="keyword">private static function </span><span class="default">folderToZip</span><span class="keyword">(</span><span class="default">$folder</span><span class="keyword">, &amp;</span><span class="default">$zipFile</span><span class="keyword">, </span><span class="default">$exclusiveLength</span><span class="keyword">) {
<br>&nbsp; &nbsp; </span><span class="default">$handle </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$folder</span><span class="keyword">);
<br>&nbsp; &nbsp; while (</span><span class="default">false </span><span class="keyword">!== </span><span class="default">$f </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">)) {
<br>&nbsp; &nbsp; &nbsp; if (</span><span class="default">$f </span><span class="keyword">!= </span><span class="string">'.' </span><span class="keyword">&amp;&amp; </span><span class="default">$f </span><span class="keyword">!= </span><span class="string">'..'</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$filePath </span><span class="keyword">= </span><span class="string">"</span><span class="default">$folder</span><span class="string">/</span><span class="default">$f</span><span class="string">"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Remove prefix from file path before add to zip.
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$localPath </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$filePath</span><span class="keyword">, </span><span class="default">$exclusiveLength</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$filePath</span><span class="keyword">)) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$zipFile</span><span class="keyword">-&gt;</span><span class="default">addFile</span><span class="keyword">(</span><span class="default">$filePath</span><span class="keyword">, </span><span class="default">$localPath</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; } elseif (</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$filePath</span><span class="keyword">)) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Add sub-directory.
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$zipFile</span><span class="keyword">-&gt;</span><span class="default">addEmptyDir</span><span class="keyword">(</span><span class="default">$localPath</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">folderToZip</span><span class="keyword">(</span><span class="default">$filePath</span><span class="keyword">, </span><span class="default">$zipFile</span><span class="keyword">, </span><span class="default">$exclusiveLength</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);
<br>&nbsp; }
<br>
<br>&nbsp; </span><span class="comment">/**
<br>&nbsp;&nbsp; * Zip a folder (include itself).
<br>&nbsp;&nbsp; * Usage:
<br>&nbsp;&nbsp; *&nbsp;&nbsp; HZip::zipDir('/path/to/sourceDir', '/path/to/out.zip');
<br>&nbsp;&nbsp; *
<br>&nbsp;&nbsp; * @param string $sourcePath Path of directory to be zip.
<br>&nbsp;&nbsp; * @param string $outZipPath Path of output zip file.
<br>&nbsp;&nbsp; */
<br>&nbsp; </span><span class="keyword">public static function </span><span class="default">zipDir</span><span class="keyword">(</span><span class="default">$sourcePath</span><span class="keyword">, </span><span class="default">$outZipPath</span><span class="keyword">)
<br>&nbsp; {
<br>&nbsp; &nbsp; </span><span class="default">$pathInfo </span><span class="keyword">= </span><span class="default">pathInfo</span><span class="keyword">(</span><span class="default">$sourcePath</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$parentPath </span><span class="keyword">= </span><span class="default">$pathInfo</span><span class="keyword">[</span><span class="string">'dirname'</span><span class="keyword">];
<br>&nbsp; &nbsp; </span><span class="default">$dirName </span><span class="keyword">= </span><span class="default">$pathInfo</span><span class="keyword">[</span><span class="string">'basename'</span><span class="keyword">];
<br>
<br>&nbsp; &nbsp; </span><span class="default">$z </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">();
<br>&nbsp; &nbsp; </span><span class="default">$z</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="default">$outZipPath</span><span class="keyword">, </span><span class="default">ZIPARCHIVE</span><span class="keyword">::</span><span class="default">CREATE</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$z</span><span class="keyword">-&gt;</span><span class="default">addEmptyDir</span><span class="keyword">(</span><span class="default">$dirName</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">folderToZip</span><span class="keyword">(</span><span class="default">$sourcePath</span><span class="keyword">, </span><span class="default">$z</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="string">"</span><span class="default">$parentPath</span><span class="string">/"</span><span class="keyword">));
<br>&nbsp; &nbsp; </span><span class="default">$z</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();
<br>&nbsp; }
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="118392">  
  <a class="name">
  <strong class="user"><em>ohcc at 163 dot com</em></strong></a><div class="date" title="2015-11-28 06:14"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom118392">
<div class="phpcode"><code><span class="html">
With PHP 5.6+, you may come up with theses errors.<br><br>Warning: Unknown: Cannot destroy the zip context in Unknown on line 0<br><br>Warning: ZipArchive::close(): Can't remove file: No such file or directory in xxxx.php on line xx<br><br>Examples<br><br>Warning: Unknown: Cannot destroy the zip context in Unknown on line 0<br><br><span class="default">&lt;?php&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; $za </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$za</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="string">'51-n.com.zip'</span><span class="keyword">,</span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">CREATE</span><span class="keyword">|</span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">OVERWRITE</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>Warning: ZipArchive::close(): Can't remove file: No such file or directory in xxxx.php on line xx<br><br><span class="default">&lt;?php&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; $za </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$za</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="string">'51-n.com.zip'</span><span class="keyword">,</span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">CREATE</span><span class="keyword">|</span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">OVERWRITE</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$za</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br></span><span class="default">?&gt;<br></span><br>It happens when the zip archive is empty.<br>Your zip archive will not be saved on disk unless it has at least one file. What's more, when ZipArchive::OVERWRITE is applied, if there exists a file with the same name, it will be removed after ZipArchive::open() is called.<br><br>So, don't forget to put at least one file to your zip archive.<br><br><span class="default">&lt;?php&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; $za </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$za</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="string">'51-n.com.zip'</span><span class="keyword">,</span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">CREATE</span><span class="keyword">|</span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">OVERWRITE</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$za</span><span class="keyword">-&gt;</span><span class="default">addFromString</span><span class="keyword">(</span><span class="string">'wuxiancheng.cn.txt'</span><span class="keyword">,</span><span class="string">'yes'</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$za</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="116345">  
  <a class="name">
  <strong class="user"><em>ebestwebmaster at gmail dot com</em></strong></a><div class="date" title="2014-12-16 11:46"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom116345">
<div class="phpcode"><code><span class="html">
A way of zipping files and downloading them thereafter:<br><span class="default">&lt;?php<br><br> $files </span><span class="keyword">= array(</span><span class="string">'image.jpeg'</span><span class="keyword">,</span><span class="string">'text.txt'</span><span class="keyword">,</span><span class="string">'music.wav'</span><span class="keyword">);<br></span><span class="default">$zipname </span><span class="keyword">= </span><span class="string">'enter_any_name_for_the_zipped_file.zip'</span><span class="keyword">;<br></span><span class="default">$zip </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">;<br></span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="default">$zipname</span><span class="keyword">, </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">CREATE</span><span class="keyword">);<br>foreach (</span><span class="default">$files </span><span class="keyword">as </span><span class="default">$file</span><span class="keyword">) {<br>&nbsp; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">addFile</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br>}<br></span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br><br></span><span class="comment">///Then download the zipped file.<br></span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Type: application/zip'</span><span class="keyword">);<br></span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-disposition: attachment; filename='</span><span class="keyword">.</span><span class="default">$zipname</span><span class="keyword">);<br></span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Length: ' </span><span class="keyword">. </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$zipname</span><span class="keyword">));<br></span><span class="default">readfile</span><span class="keyword">(</span><span class="default">$zipname</span><span class="keyword">);<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="108601">  
  <a class="name">
  <strong class="user"><em>bruno dot vibert at bonobox dot fr</em></strong></a><div class="date" title="2012-05-09 08:21"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom108601">
<div class="phpcode"><code><span class="html">
There is a usefull function to get the ZipArchive status as a human readable string :<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">ZipStatusString</span><span class="keyword">( </span><span class="default">$status </span><span class="keyword">)<br>{<br>&nbsp; &nbsp; switch( (int) </span><span class="default">$status </span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_OK&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">: return </span><span class="string">'N No error'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_MULTIDISK&nbsp; &nbsp; </span><span class="keyword">: return </span><span class="string">'N Multi-disk zip archives not supported'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_RENAME&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">: return </span><span class="string">'S Renaming temporary file failed'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_CLOSE&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">: return </span><span class="string">'S Closing zip archive failed'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_SEEK&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">: return </span><span class="string">'S Seek error'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_READ&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">: return </span><span class="string">'S Read error'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_WRITE&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">: return </span><span class="string">'S Write error'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_CRC&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">: return </span><span class="string">'N CRC error'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_ZIPCLOSED&nbsp; &nbsp; </span><span class="keyword">: return </span><span class="string">'N Containing zip archive was closed'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_NOENT&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">: return </span><span class="string">'N No such file'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_EXISTS&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">: return </span><span class="string">'N File already exists'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_OPEN&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">: return </span><span class="string">'S Can\'t open file'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_TMPOPEN&nbsp; &nbsp; &nbsp; </span><span class="keyword">: return </span><span class="string">'S Failure to create temporary file'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_ZLIB&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">: return </span><span class="string">'Z Zlib error'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_MEMORY&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">: return </span><span class="string">'N Malloc failure'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_CHANGED&nbsp; &nbsp; &nbsp; </span><span class="keyword">: return </span><span class="string">'N Entry has been changed'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_COMPNOTSUPP&nbsp; </span><span class="keyword">: return </span><span class="string">'N Compression method not supported'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_EOF&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">: return </span><span class="string">'N Premature EOF'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_INVAL&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">: return </span><span class="string">'N Invalid argument'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_NOZIP&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">: return </span><span class="string">'N Not a zip archive'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_INTERNAL&nbsp; &nbsp;&nbsp; </span><span class="keyword">: return </span><span class="string">'N Internal error'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_INCONS&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">: return </span><span class="string">'N Zip archive inconsistent'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_REMOVE&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">: return </span><span class="string">'S Can\'t remove file'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_DELETED&nbsp; &nbsp; &nbsp; </span><span class="keyword">: return </span><span class="string">'N Entry has been deleted'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; default: return </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'Unknown status %s'</span><span class="keyword">, </span><span class="default">$status </span><span class="keyword">);<br>&nbsp; &nbsp; }<br>}<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="105312">  
  <a class="name">
  <strong class="user"><em>Jerry dot Saravia at emc dot com</em></strong></a><div class="date" title="2011-08-08 01:57"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom105312">
<div class="phpcode"><code><span class="html">
The following code can be used to get a list of all the file names in a zip file.
<br>
<br><span class="default">&lt;?php
<br>$za </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">();
<br>
<br></span><span class="default">$za</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="string">'theZip.zip'</span><span class="keyword">);
<br>
<br>for( </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$za</span><span class="keyword">-&gt;</span><span class="default">numFiles</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++ ){
<br>&nbsp; &nbsp; </span><span class="default">$stat </span><span class="keyword">= </span><span class="default">$za</span><span class="keyword">-&gt;</span><span class="default">statIndex</span><span class="keyword">( </span><span class="default">$i </span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">print_r</span><span class="keyword">( </span><span class="default">basename</span><span class="keyword">( </span><span class="default">$stat</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">] ) . </span><span class="default">PHP_EOL </span><span class="keyword">);
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="112195">  
  <a class="name">
  <strong class="user"><em>AshleyDambra at live dot com</em></strong></a><div class="date" title="2013-05-16 08:23"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom112195">
<div class="phpcode"><code><span class="html">
Simple class xZip to zip big folders into multiple parts and unzip multi zip files at once.<br><br><span class="default">&lt;?php<br></span><span class="keyword">class </span><span class="default">xZip </span><span class="keyword">{<br>&nbsp; &nbsp; public function </span><span class="default">__construct</span><span class="keyword">() {}<br>&nbsp; &nbsp; private function </span><span class="default">_rglobRead</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">, &amp;</span><span class="default">$array </span><span class="keyword">= array()) {<br>&nbsp; &nbsp; &nbsp; &nbsp; if (!</span><span class="default">$source </span><span class="keyword">|| </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">) == </span><span class="string">""</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$source </span><span class="keyword">= </span><span class="string">"."</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; foreach ((array) </span><span class="default">glob</span><span class="keyword">(</span><span class="default">$source </span><span class="keyword">. </span><span class="string">"/*/"</span><span class="keyword">) as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_rglobRead</span><span class="keyword">(</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"//"</span><span class="keyword">, </span><span class="string">"/"</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">), </span><span class="default">$array</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; foreach ((array) </span><span class="default">glob</span><span class="keyword">(</span><span class="default">$source </span><span class="keyword">. </span><span class="string">"*.*"</span><span class="keyword">) as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$array</span><span class="keyword">[] = </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"//"</span><span class="keyword">, </span><span class="string">"/"</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; private function </span><span class="default">_zip</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">, </span><span class="default">$part</span><span class="keyword">, </span><span class="default">$destination</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$zip </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; @</span><span class="default">mkdir</span><span class="keyword">(</span><span class="default">$destination</span><span class="keyword">, </span><span class="default">0777</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"//"</span><span class="keyword">, </span><span class="string">"/"</span><span class="keyword">, </span><span class="string">"</span><span class="keyword">{</span><span class="default">$destination</span><span class="keyword">}</span><span class="string">/partz</span><span class="keyword">{</span><span class="default">$part</span><span class="keyword">}</span><span class="string">.zip"</span><span class="keyword">), </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">CREATE</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ((array) </span><span class="default">$array </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">addFile</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">, </span><span class="default">str_replace</span><span class="keyword">(array(</span><span class="string">"../"</span><span class="keyword">, </span><span class="string">"./"</span><span class="keyword">), </span><span class="default">NULL</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; public function </span><span class="default">zip</span><span class="keyword">(</span><span class="default">$limit </span><span class="keyword">= </span><span class="default">500</span><span class="keyword">, </span><span class="default">$source </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">, </span><span class="default">$destination </span><span class="keyword">= </span><span class="string">"./"</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; if (!</span><span class="default">$destination </span><span class="keyword">|| </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$destination</span><span class="keyword">) == </span><span class="string">""</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$destination </span><span class="keyword">= </span><span class="string">"./"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_rglobRead</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">, </span><span class="default">$input</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$maxinput </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$splitinto </span><span class="keyword">= ((</span><span class="default">$maxinput </span><span class="keyword">/ </span><span class="default">$limit</span><span class="keyword">) &gt; </span><span class="default">round</span><span class="keyword">(</span><span class="default">$maxinput </span><span class="keyword">/ </span><span class="default">$limit</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">)) ? </span><span class="default">round</span><span class="keyword">(</span><span class="default">$maxinput </span><span class="keyword">/ </span><span class="default">$limit</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">) + </span><span class="default">1 </span><span class="keyword">: </span><span class="default">round</span><span class="keyword">(</span><span class="default">$maxinput </span><span class="keyword">/ </span><span class="default">$limit</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$splitinto</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_zip</span><span class="keyword">(</span><span class="default">array_slice</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">, (</span><span class="default">$i </span><span class="keyword">* </span><span class="default">$limit</span><span class="keyword">), </span><span class="default">$limit</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">), </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$destination</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; unset(</span><span class="default">$input</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; return;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; public function </span><span class="default">unzip</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">, </span><span class="default">$destination</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; @</span><span class="default">mkdir</span><span class="keyword">(</span><span class="default">$destination</span><span class="keyword">, </span><span class="default">0777</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; foreach ((array) </span><span class="default">glob</span><span class="keyword">(</span><span class="default">$source </span><span class="keyword">. </span><span class="string">"/*.zip"</span><span class="keyword">) as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$zip </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"//"</span><span class="keyword">, </span><span class="string">"/"</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">)) === </span><span class="default">true</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">extractTo</span><span class="keyword">(</span><span class="default">$destination</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; public function </span><span class="default">__destruct</span><span class="keyword">() {}<br>}<br><br></span><span class="comment">//$zip = new xZip;<br>//$zip-&gt;zip(500, "images/", "images_zip/");<br>//$zip-&gt;unzip("images_zip/", "images/");<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="98441">  
  <a class="name">
  <strong class="user"><em>hardcorevenom at gmx dot com</em></strong></a><div class="date" title="2010-06-15 03:17"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom98441">
<div class="phpcode"><code><span class="html">
Read a file from an archive to a variable.<br>A warning is printed automatically in case of a CRC32 mismatch, which we capture, so we can print our own error message.<br><br><span class="default">&lt;?php<br>$zip </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">();<br>if (</span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="string">'archive.zip'</span><span class="keyword">)) {<br>&nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">getStream</span><span class="keyword">(</span><span class="string">'myfile.txt'</span><span class="keyword">); </span><span class="comment">//file inside archive<br>&nbsp; </span><span class="keyword">if(!</span><span class="default">$fp</span><span class="keyword">)<br>&nbsp; &nbsp; die(</span><span class="string">"Error: can't get stream to zipped file"</span><span class="keyword">);<br>&nbsp; </span><span class="default">$stat </span><span class="keyword">= </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">statName</span><span class="keyword">(</span><span class="string">'myfile.txt'</span><span class="keyword">);<br><br>&nbsp; </span><span class="default">$buf </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">; </span><span class="comment">//file buffer<br>&nbsp; </span><span class="default">ob_start</span><span class="keyword">(); </span><span class="comment">//to capture CRC error message<br>&nbsp; &nbsp; </span><span class="keyword">while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$buf </span><span class="keyword">.= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">2048</span><span class="keyword">); </span><span class="comment">//reading more than 2156 bytes seems to disable internal CRC32 verification (bug?)<br>&nbsp; &nbsp; </span><span class="keyword">}<br>&nbsp; &nbsp; </span><span class="default">$s </span><span class="keyword">= </span><span class="default">ob_get_contents</span><span class="keyword">();<br>&nbsp; </span><span class="default">ob_end_clean</span><span class="keyword">();<br>&nbsp; if(</span><span class="default">stripos</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="string">"CRC error"</span><span class="keyword">) != </span><span class="default">FALSE</span><span class="keyword">){<br>&nbsp; &nbsp; echo </span><span class="string">'CRC32 mismatch, current '</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">printf</span><span class="keyword">(</span><span class="string">"%08X"</span><span class="keyword">, </span><span class="default">crc32</span><span class="keyword">(</span><span class="default">$buf</span><span class="keyword">)); </span><span class="comment">//current CRC<br>&nbsp; &nbsp; </span><span class="keyword">echo </span><span class="string">', expected '</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">printf</span><span class="keyword">(</span><span class="string">"%08X"</span><span class="keyword">, </span><span class="default">$stat</span><span class="keyword">[</span><span class="string">'crc'</span><span class="keyword">]); </span><span class="comment">//expected CRC<br>&nbsp; </span><span class="keyword">}<br><br>&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br>&nbsp; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br>&nbsp; </span><span class="comment">//Done, unpacked file is stored in $buf<br></span><span class="keyword">}<br></span><span class="default">?&gt;<br></span><br>To create a corrupt file, change a byte in a zip file using a hex editor.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="116937">  
  <a class="name">
  <strong class="user"><em>nick at fullfatthings dot com</em></strong></a><div class="date" title="2015-03-24 02:59"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom116937">
<div class="phpcode"><code><span class="html">
There is a limit withing PHP 5.3.3 (which seems to have been addressed in later versions; 5.3.29 seems ok on a different server).<br><br>If you try to open a zip file with more than 65,535 files in it (in my case it had 237,942 files) then you cannot access the later files. The numFiles property only reports the first 65k files.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="118272">  
  <a class="name">
  <strong class="user"><em>ohcc at 163 dot com</em></strong></a><div class="date" title="2015-11-06 08:58"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom118272">
<div class="phpcode"><code><span class="html">
<span class="default">&lt;?php<br>&nbsp; &nbsp; </span><span class="comment">//use bzip2 + ZipArchive to reduce file size of your zip archives.<br>&nbsp; &nbsp; </span><span class="default">$zip </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="string">'i.zip'</span><span class="keyword">,</span><span class="default">ZIPARCHIVE</span><span class="keyword">::</span><span class="default">CREATE</span><span class="keyword">|</span><span class="default">ZIPARCHIVE</span><span class="keyword">::</span><span class="default">OVERWRITE</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$file</span><span class="keyword">=</span><span class="string">'wuxiancheng.cn.sql'</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$bzFilename </span><span class="keyword">= </span><span class="default">$file</span><span class="keyword">.</span><span class="string">'.bz2'</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$sql </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$sql </span><span class="keyword">= </span><span class="default">bzcompress</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">,</span><span class="default">9</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">addFromString</span><span class="keyword">(</span><span class="default">$bzFilename</span><span class="keyword">,</span><span class="default">$sql</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">setArchiveComment</span><span class="keyword">(</span><span class="string">'zipped on '</span><span class="keyword">.</span><span class="default">date</span><span class="keyword">(</span><span class="string">'Y-M-d'</span><span class="keyword">));<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="109618">  
  <a class="name">
  <strong class="user"><em>niklas dot schumi at NOSPAM dot googlemail dot com</em></strong></a><div class="date" title="2012-08-02 10:44"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom109618">
<div class="phpcode"><code><span class="html">
Hi there.<br>I just wrote a little function to zip a whole folder while maintaining the dir-structure. I hope it might help someone.<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">folderToZip</span><span class="keyword">(</span><span class="default">$folder</span><span class="keyword">, &amp;</span><span class="default">$zipFile</span><span class="keyword">, </span><span class="default">$subfolder </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">) {<br>&nbsp; &nbsp; if (</span><span class="default">$zipFile </span><span class="keyword">== </span><span class="default">null</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// no resource given, exit<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">return </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; </span><span class="comment">// we check if $folder has a slash at its end, if not, we append one<br>&nbsp; &nbsp; </span><span class="default">$folder </span><span class="keyword">.= </span><span class="default">end</span><span class="keyword">(</span><span class="default">str_split</span><span class="keyword">(</span><span class="default">$folder</span><span class="keyword">)) == </span><span class="string">"/" </span><span class="keyword">? </span><span class="string">"" </span><span class="keyword">: </span><span class="string">"/"</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$subfolder </span><span class="keyword">.= </span><span class="default">end</span><span class="keyword">(</span><span class="default">str_split</span><span class="keyword">(</span><span class="default">$subfolder</span><span class="keyword">)) == </span><span class="string">"/" </span><span class="keyword">? </span><span class="string">"" </span><span class="keyword">: </span><span class="string">"/"</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="comment">// we start by going through all files in $folder<br>&nbsp; &nbsp; </span><span class="default">$handle </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$folder</span><span class="keyword">);<br>&nbsp; &nbsp; while (</span><span class="default">$f </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$f </span><span class="keyword">!= </span><span class="string">"." </span><span class="keyword">&amp;&amp; </span><span class="default">$f </span><span class="keyword">!= </span><span class="string">".."</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$folder </span><span class="keyword">. </span><span class="default">$f</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// if we find a file, store it<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // if we have a subfolder, store it there<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">$subfolder </span><span class="keyword">!= </span><span class="default">null</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$zipFile</span><span class="keyword">-&gt;</span><span class="default">addFile</span><span class="keyword">(</span><span class="default">$folder </span><span class="keyword">. </span><span class="default">$f</span><span class="keyword">, </span><span class="default">$subfolder </span><span class="keyword">. </span><span class="default">$f</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$zipFile</span><span class="keyword">-&gt;</span><span class="default">addFile</span><span class="keyword">(</span><span class="default">$folder </span><span class="keyword">. </span><span class="default">$f</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } elseif (</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$folder </span><span class="keyword">. </span><span class="default">$f</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// if we find a folder, create a folder in the zip <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$zipFile</span><span class="keyword">-&gt;</span><span class="default">addEmptyDir</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// and call the function again<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">folderToZip</span><span class="keyword">(</span><span class="default">$folder </span><span class="keyword">. </span><span class="default">$f</span><span class="keyword">, </span><span class="default">$zipFile</span><span class="keyword">, </span><span class="default">$f</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>}<br></span><span class="default">?&gt;<br></span><br>Use it like this:<br><span class="default">&lt;?php<br>$z </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">();<br></span><span class="default">$z</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="string">"test.zip"</span><span class="keyword">, </span><span class="default">ZIPARCHIVE</span><span class="keyword">::</span><span class="default">CREATE</span><span class="keyword">);<br></span><span class="default">folderToZip</span><span class="keyword">(</span><span class="string">"storeThisFolder"</span><span class="keyword">, </span><span class="default">$z</span><span class="keyword">);<br></span><span class="default">$z</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br></span><span class="default">?&gt;<br></span><br>Have a good day!</span>
</code></div>
  </div>
 </div>
  <div class="note" id="106062">  
  <a class="name">
  <strong class="user"><em>webmaster at sebastiangrinke dot info</em></strong></a><div class="date" title="2011-10-06 01:30"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom106062">
<div class="phpcode"><code><span class="html">
Here is a simple function which zips folders with all sub folders or only a simple file... the $data var can be a string or an array...
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">public function </span><span class="default">un_zip</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">,</span><span class="default">$arcpf</span><span class="keyword">,</span><span class="default">$mode</span><span class="keyword">=</span><span class="string">'zip'</span><span class="keyword">,</span><span class="default">$obj</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">){
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$absoluterpfad </span><span class="keyword">= </span><span class="string">'YOUR_BASE_PATH'</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$arcpf </span><span class="keyword">= </span><span class="default">$absoluterpfad</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">.</span><span class="default">$arcpf</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$obj</span><span class="keyword">)==</span><span class="default">false</span><span class="keyword">){
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$archiv </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">();
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$archiv</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="default">$arcpf</span><span class="keyword">,</span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">CREATE</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; }else{</span><span class="default">$archiv </span><span class="keyword">=&amp; </span><span class="default">$obj</span><span class="keyword">;}
<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$mode</span><span class="keyword">==</span><span class="string">'zip'</span><span class="keyword">){
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)==</span><span class="default">true</span><span class="keyword">){
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$data </span><span class="keyword">as </span><span class="default">$dtmp</span><span class="keyword">){
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$archiv </span><span class="keyword">=&amp; </span><span class="default">un_zip</span><span class="keyword">(</span><span class="default">$dtmp</span><span class="keyword">,</span><span class="default">$arcpf</span><span class="keyword">,</span><span class="string">'zip'</span><span class="keyword">,&amp;</span><span class="default">$archiv</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }else{
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)==</span><span class="default">true</span><span class="keyword">){
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$archiv</span><span class="keyword">-&gt;</span><span class="default">addEmptyDir</span><span class="keyword">(</span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$absoluterpfad</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">,</span><span class="default">$data</span><span class="keyword">));
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$files </span><span class="keyword">= </span><span class="default">scandir</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bad </span><span class="keyword">= array(</span><span class="string">'.'</span><span class="keyword">,</span><span class="string">'..'</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$files </span><span class="keyword">= </span><span class="default">array_diff</span><span class="keyword">(</span><span class="default">$files</span><span class="keyword">,</span><span class="default">$bad</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$files </span><span class="keyword">as </span><span class="default">$ftmp</span><span class="keyword">){
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">.</span><span class="default">$ftmp</span><span class="keyword">)==</span><span class="default">true</span><span class="keyword">){
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$archiv</span><span class="keyword">-&gt;</span><span class="default">addEmptyDir</span><span class="keyword">(</span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$absoluterpfad</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">,</span><span class="default">$data</span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">.</span><span class="default">$ftmp</span><span class="keyword">));
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$archiv </span><span class="keyword">=&amp; </span><span class="default">un_zip</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">.</span><span class="default">$ftmp</span><span class="keyword">,</span><span class="default">$arcpf</span><span class="keyword">,</span><span class="string">'zip'</span><span class="keyword">,&amp;</span><span class="default">$archiv</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }elseif(</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">.</span><span class="default">$ftmp</span><span class="keyword">)==</span><span class="default">true</span><span class="keyword">){
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$archiv</span><span class="keyword">-&gt;</span><span class="default">addFile</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">.</span><span class="default">$ftmp</span><span class="keyword">,</span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$absoluterpfad</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">,</span><span class="default">$data</span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">.</span><span class="default">$ftmp</span><span class="keyword">));
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }elseif(</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)==</span><span class="default">true</span><span class="keyword">){</span><span class="default">$archiv</span><span class="keyword">-&gt;</span><span class="default">addFile</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">,</span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$absoluterpfad</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">,</span><span class="default">$data</span><span class="keyword">));}
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$obj</span><span class="keyword">)==</span><span class="default">false</span><span class="keyword">){</span><span class="default">$archiv</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();}
<br>&nbsp; &nbsp; &nbsp; &nbsp; else{return </span><span class="default">$archiv</span><span class="keyword">;}
<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$mode</span><span class="keyword">==</span><span class="string">'unzip'</span><span class="keyword">){</span><span class="default">$archiv</span><span class="keyword">-&gt;</span><span class="default">extractTo</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);}
<br>&nbsp; &nbsp; }
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="109406">  
  <a class="name">
  <strong class="user"><em>panique at web dot de</em></strong></a><div class="date" title="2012-07-14 11:21"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom109406">
<div class="phpcode"><code><span class="html">
Important: Due to the natural file size limit of 4GB (~3,6GB to be correct) of zip files, this class will generate corrupt files of the result is larger than 4 GB. Using tar.gz is a proper alternative.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="100268">  
  <a class="name">
  <strong class="user"><em>h-fate at gmx dot net</em></strong></a><div class="date" title="2010-10-05 04:17"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom100268">
<div class="phpcode"><code><span class="html">
Be wary that there are several algorithms to generate a zip file. I found that Office OpenXML files created with ZipArchive are not recognized by Excel 2007, for example.<br><br>You have to use a different class to zip in this case, such as PclZip.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="114158">  
  <a class="name">
  <strong class="user"><em>piotr dot stop dot spam at gmail dot com</em></strong></a><div class="date" title="2014-01-17 04:58"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom114158">
<div class="phpcode"><code><span class="html">
You can check general purpose flag to test if the zip file is encrypted. Example function below.<br><br><span class="default">&lt;?php<br><br></span><span class="comment">/**<br> * Check if the file is encrypted<br> * <br> * Notice: if file doesn't exists or cannot be opened, function<br> * also return false.<br> * <br> * @param string $pathToArchive<br> * @return boolean return true if file is encrypted<br> */<br></span><span class="keyword">function </span><span class="default">isEncryptedZip</span><span class="keyword">( </span><span class="default">$pathToArchive </span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="default">$fp </span><span class="keyword">= @</span><span class="default">fopen</span><span class="keyword">( </span><span class="default">$pathToArchive</span><span class="keyword">, </span><span class="string">'r' </span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$encrypted </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; if ( </span><span class="default">$fp </span><span class="keyword">&amp;&amp; </span><span class="default">fseek</span><span class="keyword">( </span><span class="default">$fp</span><span class="keyword">, </span><span class="default">6 </span><span class="keyword">) == </span><span class="default">0 </span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">( </span><span class="default">$fp</span><span class="keyword">, </span><span class="default">2 </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; if ( </span><span class="default">false </span><span class="keyword">!== </span><span class="default">$string </span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">"vgeneral"</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$encrypted </span><span class="keyword">= </span><span class="default">$data</span><span class="keyword">[ </span><span class="string">'general' </span><span class="keyword">] &amp; </span><span class="default">0x01 </span><span class="keyword">? </span><span class="default">true </span><span class="keyword">: </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">( </span><span class="default">$fp </span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; return </span><span class="default">$encrypted</span><span class="keyword">;<br>}</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="119749">  
  <a class="name">
  <strong class="user"><em>M. Wolf</em></strong></a><div class="date" title="2016-08-17 05:39"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom119749">
<div class="phpcode"><code><span class="html">
How to detect corrupt files with CRC mismatch:<br><br>Creating a corrupt archive for testing is simple - zip some files and change a byte with a hex editor in the resulting ZIP file. Now you can test the file with a ZIP application to learn which file inside the archive is corrupt.<br><br>ZipArchive seems unable to detect broken files. ZipArchive::CHECKCONS doesn't help, only if it's not a ZIP file at all. It happily decompressed corrupt files in my tests and the user downloading the data is not informed.<br><br>You can simply verify on the server for smaller files:<br><span class="default">&lt;?php<br>$maxsize </span><span class="keyword">= </span><span class="default">1024</span><span class="keyword">*</span><span class="default">1024</span><span class="keyword">;<br></span><span class="default">$z </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">;<br></span><span class="default">$r </span><span class="keyword">= </span><span class="default">$z</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="string">"foo.zip"</span><span class="keyword">, </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">CHECKCONS</span><span class="keyword">);<br>if(</span><span class="default">$r </span><span class="keyword">!== </span><span class="default">TRUE</span><span class="keyword">)<br>&nbsp; die(</span><span class="string">'ZIP error when trying to open "foo.zip": '</span><span class="keyword">.</span><span class="default">$r</span><span class="keyword">);<br><br></span><span class="default">$stat </span><span class="keyword">= </span><span class="default">$z</span><span class="keyword">-&gt;</span><span class="default">statName</span><span class="keyword">(</span><span class="string">"mybrokenfile.txt"</span><span class="keyword">);<br>if(</span><span class="default">$stat</span><span class="keyword">[</span><span class="string">'size'</span><span class="keyword">] &gt; </span><span class="default">$maxsize</span><span class="keyword">)<br>&nbsp; die(</span><span class="string">'File too large, decompression denied'</span><span class="keyword">);<br></span><span class="default">$s </span><span class="keyword">= </span><span class="default">$z</span><span class="keyword">-&gt;</span><span class="default">getStream</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br></span><span class="default">$data </span><span class="keyword">= </span><span class="default">stream_get_contents</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="default">$maxsize</span><span class="keyword">);<br></span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">);<br>if(</span><span class="default">$stat</span><span class="keyword">[</span><span class="string">'crc'</span><span class="keyword">] != </span><span class="default">crc32</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">))<br>&nbsp; die(</span><span class="string">'File is corrupt!'</span><span class="keyword">);<br></span><span class="comment">//echo 'File is valid';<br><br>//you may send the file to the client now if you didn't output anything before<br></span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Description: File Transfer'</span><span class="keyword">);<br></span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Type: application/octet-stream'</span><span class="keyword">);<br></span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Disposition: attachment; filename="mybrokenfile.txt"'</span><span class="keyword">);<br></span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Transfer-Encoding: binary'</span><span class="keyword">);<br></span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Length: ' </span><span class="keyword">. </span><span class="default">$stat</span><span class="keyword">[</span><span class="string">'size'</span><span class="keyword">]);<br></span><span class="default">ob_clean</span><span class="keyword">();<br>echo </span><span class="default">$data</span><span class="keyword">;<br></span><span class="default">$z</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br></span><span class="default">?&gt;<br></span> <br>If the file shall not be fully decompressed on the server but decompressed while streaming to the client due to it's size, the file transfer already startet and printing an error message later doesn't work. Maybe the best way would be to interrupt the connection before closing the file transfer. The client should be able to detect this as corrupt download.<br>On the server side a function is needed, that can calculate the CRC32 on streamed data stepwise.</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->

  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from www.php.net/manual/en/class.ziparchive.php by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 11 Sep 2021 05:08:56 GMT -->

</body></html>