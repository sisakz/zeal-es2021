<html><!-- Mirrored from www.php.net/manual/en/function.mcrypt-encrypt.php by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 11 Sep 2021 07:18:58 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>mcrypt_encrypt</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.mcrypt-encrypt.html">
 <link rel="shorturl" href="https://www.php.net/mcrypt-encrypt">
 <link rel="alternate" href="https://www.php.net/mcrypt-encrypt" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.mcrypt.html">
 <link rel="prev" href="function.mcrypt-enc-self-test.html">
 <link rel="next" href="function.mcrypt-generic-deinit.html">

 <link rel="alternate" href="function.mcrypt-encrypt.html" hreflang="en">
 <link rel="alternate" href="https://www.php.net/manual/pt_BR/function.mcrypt-encrypt.php" hreflang="pt_BR">
 <link rel="alternate" href="https://www.php.net/manual/zh/function.mcrypt-encrypt.php" hreflang="zh">
 <link rel="alternate" href="https://www.php.net/manual/fr/function.mcrypt-encrypt.php" hreflang="fr">
 <link rel="alternate" href="https://www.php.net/manual/de/function.mcrypt-encrypt.php" hreflang="de">
 <link rel="alternate" href="https://www.php.net/manual/ja/function.mcrypt-encrypt.php" hreflang="ja">
 <link rel="alternate" href="https://www.php.net/manual/ro/function.mcrypt-encrypt.php" hreflang="ro">
 <link rel="alternate" href="https://www.php.net/manual/ru/function.mcrypt-encrypt.php" hreflang="ru">
 <link rel="alternate" href="https://www.php.net/manual/es/function.mcrypt-encrypt.php" hreflang="es">
 <link rel="alternate" href="https://www.php.net/manual/tr/function.mcrypt-encrypt.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached0aba.css?t=1539771603&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached2ecf.css?t=1539765004&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedba57.css?t=1606338002&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached3afa.css?t=1627831203&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="https://www.php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script>
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="https://www.php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script src="https://www.php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>


</head>
<body class="docs " style="">


<div class="headsup"><a href="https://www.php.net/conferences/index.php#id2021-09-08-1">Longhorn PHP 2021</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.errors.html">Errors</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.attributes.html">Attributes</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.sessions.html">Session Security</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
	<dd><a href="refs.ui.html">GUI Extensions</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
    <div id="breadcrumbs-inner">
          
              
          <ul>
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.crypto.html">Cryptography Extensions</a></li>      <li><a href="book.mcrypt.html">Mcrypt</a></li>      <li><a href="ref.mcrypt.html">Mcrypt Functions</a></li>      </ul>
    </div>
  </div>




<div id="layout" class="clearfix">
  <section id="layout-content">
  <div id="function.mcrypt-encrypt" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">mcrypt_encrypt</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.0.2, PHP 5, PHP 7 &lt; 7.2.0, PECL mcrypt &gt;= 1.0.0)</p><p class="refpurpose"><span class="refname">mcrypt_encrypt</span> â€” <span class="dc-title">Encrypts plaintext with given parameters</span></p>

 </div>
 
 <div id="function.mcrypt-encrypt-refsynopsisdiv">
  <div class="warning"><strong class="warning">Warning</strong><p class="simpara">This function has been
<em class="emphasis">DEPRECATED</em> as of PHP 7.1.0 and
<em class="emphasis">REMOVED</em> as of PHP 7.2.0. Relying on this function
is highly discouraged.</p></div>
 </div>
 
 <div class="refsect1 description" id="refsect1-function.mcrypt-encrypt-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>mcrypt_encrypt</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$cipher</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$key</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$data</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$mode</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$iv</code><span class="initializer"> = ?</span></span><br>): <span class="type"><span class="type">string</span>|<span class="type"><span class="type false">false</span></span></span></div>

  <p class="para rdfs-comment">
   Encrypts the data and returns it.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.mcrypt-encrypt-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>
    
     <dt>
<code class="parameter">cipher</code></dt>

     <dd>

      <p class="para">One of the <strong><code>MCRYPT_ciphername</code></strong> constants, or the name of the algorithm as string.</p>
     </dd>

    
    
     <dt>
<code class="parameter">key</code></dt>

     <dd>

      <p class="para">
       The key with which the data will be encrypted. If the provided key size is
       not supported by the cipher, the function will emit a warning and return <strong><code>false</code></strong>
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">data</code></dt>

     <dd>

      <p class="para">
       The data that will be encrypted with the given <code class="parameter">cipher</code>
       and <code class="parameter">mode</code>. If the size of the data is not n * blocksize,
       the data will be padded with '<code class="literal">\0</code>'.
      </p>
      <p class="para">
       The returned crypttext can be larger than the size of the data that was
       given by <code class="parameter">data</code>.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">mode</code></dt>

     <dd>

      <p class="para">One of the <strong><code>MCRYPT_MODE_modename</code></strong> constants, or one of the following strings: "ecb", "cbc", "cfb", "ofb", "nofb" or "stream".</p>
     </dd>

    
    
     <dt>
<code class="parameter">iv</code></dt>

     <dd>

      <p class="para">Used for the initialization in CBC, CFB, OFB modes, and in some algorithms in STREAM mode. If the provided IV size is not supported by the chaining mode or no IV was provided, but the chaining mode requires one, the function will emit a warning and return <strong><code>false</code></strong>.</p>
     </dd>

    
   </dl>

  <p></p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.mcrypt-encrypt-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns the encrypted data as a string  or <strong><code>false</code></strong> on failure.
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.mcrypt-encrypt-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   </p><div class="example" id="foobar.examples.basic">
    <p><strong>Example #1 <span class="function"><strong>mcrypt_encrypt()</strong></span> Example</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">#&nbsp;---&nbsp;ENCRYPTION&nbsp;---<br><br>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;the&nbsp;key&nbsp;should&nbsp;be&nbsp;random&nbsp;binary,&nbsp;use&nbsp;scrypt,&nbsp;bcrypt&nbsp;or&nbsp;PBKDF2&nbsp;to<br>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;convert&nbsp;a&nbsp;string&nbsp;into&nbsp;a&nbsp;key<br>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;key&nbsp;is&nbsp;specified&nbsp;using&nbsp;hexadecimal<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$key&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">pack</span><span style="color: #007700">(</span><span style="color: #DD0000">'H*'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"bcb04b7e103a0cd8b54763051cef08bc55abe029fdebae5e1d417e2ffb2a00a3"</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">#&nbsp;show&nbsp;key&nbsp;size&nbsp;use&nbsp;either&nbsp;16,&nbsp;24&nbsp;or&nbsp;32&nbsp;byte&nbsp;keys&nbsp;for&nbsp;AES-128,&nbsp;192<br>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;and&nbsp;256&nbsp;respectively<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$key_size&nbsp;</span><span style="color: #007700">=&nbsp;&nbsp;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$key</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Key&nbsp;size:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$key_size&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$plaintext&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"This&nbsp;string&nbsp;was&nbsp;AES-256&nbsp;/&nbsp;CBC&nbsp;/&nbsp;ZeroBytePadding&nbsp;encrypted."</span><span style="color: #007700">;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">#&nbsp;create&nbsp;a&nbsp;random&nbsp;IV&nbsp;to&nbsp;use&nbsp;with&nbsp;CBC&nbsp;encoding<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$iv_size&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mcrypt_get_iv_size</span><span style="color: #007700">(</span><span style="color: #0000BB">MCRYPT_RIJNDAEL_128</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">MCRYPT_MODE_CBC</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$iv&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mcrypt_create_iv</span><span style="color: #007700">(</span><span style="color: #0000BB">$iv_size</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">MCRYPT_RAND</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">#&nbsp;creates&nbsp;a&nbsp;cipher&nbsp;text&nbsp;compatible&nbsp;with&nbsp;AES&nbsp;(Rijndael&nbsp;block&nbsp;size&nbsp;=&nbsp;128)<br>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;to&nbsp;keep&nbsp;the&nbsp;text&nbsp;confidential&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;only&nbsp;suitable&nbsp;for&nbsp;encoded&nbsp;input&nbsp;that&nbsp;never&nbsp;ends&nbsp;with&nbsp;value&nbsp;00h<br>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;(because&nbsp;of&nbsp;default&nbsp;zero&nbsp;padding)<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$ciphertext&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mcrypt_encrypt</span><span style="color: #007700">(</span><span style="color: #0000BB">MCRYPT_RIJNDAEL_128</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$plaintext</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">MCRYPT_MODE_CBC</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$iv</span><span style="color: #007700">);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">#&nbsp;prepend&nbsp;the&nbsp;IV&nbsp;for&nbsp;it&nbsp;to&nbsp;be&nbsp;available&nbsp;for&nbsp;decryption<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$ciphertext&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$iv&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$ciphertext</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">#&nbsp;encode&nbsp;the&nbsp;resulting&nbsp;cipher&nbsp;text&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;represented&nbsp;by&nbsp;a&nbsp;string<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$ciphertext_base64&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">base64_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$ciphertext</span><span style="color: #007700">);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;&nbsp;</span><span style="color: #0000BB">$ciphertext_base64&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">#&nbsp;===&nbsp;WARNING&nbsp;===<br><br>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Resulting&nbsp;cipher&nbsp;text&nbsp;has&nbsp;no&nbsp;integrity&nbsp;or&nbsp;authenticity&nbsp;added<br>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;and&nbsp;is&nbsp;not&nbsp;protected&nbsp;against&nbsp;padding&nbsp;oracle&nbsp;attacks.<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;---&nbsp;DECRYPTION&nbsp;---<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$ciphertext_dec&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">base64_decode</span><span style="color: #007700">(</span><span style="color: #0000BB">$ciphertext_base64</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">#&nbsp;retrieves&nbsp;the&nbsp;IV,&nbsp;iv_size&nbsp;should&nbsp;be&nbsp;created&nbsp;using&nbsp;mcrypt_get_iv_size()<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$iv_dec&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$ciphertext_dec</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$iv_size</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">#&nbsp;retrieves&nbsp;the&nbsp;cipher&nbsp;text&nbsp;(everything&nbsp;except&nbsp;the&nbsp;$iv_size&nbsp;in&nbsp;the&nbsp;front)<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$ciphertext_dec&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$ciphertext_dec</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$iv_size</span><span style="color: #007700">);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">#&nbsp;may&nbsp;remove&nbsp;00h&nbsp;valued&nbsp;characters&nbsp;from&nbsp;end&nbsp;of&nbsp;plain&nbsp;text<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$plaintext_dec&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mcrypt_decrypt</span><span style="color: #007700">(</span><span style="color: #0000BB">MCRYPT_RIJNDAEL_128</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$ciphertext_dec</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">MCRYPT_MODE_CBC</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$iv_dec</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;&nbsp;</span><span style="color: #0000BB">$plaintext_dec&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>The above example will output:</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>Key size: 32
ENJW8mS2KaJoNB5E5CoSAAu0xARgsR1bdzFWpEn+poYw45q+73az5kYi4j+0haevext1dGrcW8Qi59txfCBV8BBj3bzRP3dFCp3CPQSJ8eU=
This string was AES-256 / CBC / ZeroBytePadding encrypted.
</pre></div>
    </div>
   </div>
  <p></p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.mcrypt-encrypt-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   </p><ul class="simplelist">
    <li class="member"><span class="function"><a href="function.mcrypt-decrypt.html" class="function" rel="rdfs-seeAlso">mcrypt_decrypt()</a> - Decrypts crypttext with given parameters</span></li>
    <li class="member"><span class="function"><a href="function.mcrypt-module-open.html" class="function" rel="rdfs-seeAlso">mcrypt_module_open()</a> - Opens the module of the algorithm and the mode to be used</span></li>
   </ul>
  <p></p>
 </div>

</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="117667">  
  <a class="name">
  <strong class="user"><em>scott at paragonie dot com</em></strong></a><div class="date" title="2015-07-18 10:35"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom117667">
<div class="phpcode"><code><span class="html">
If you're writing code to encrypt/encrypt data in 2015, you should use openssl_encrypt() and openssl_decrypt(). The underlying library (libmcrypt) has been abandoned since 2007, and performs far worse than OpenSSL (which leverages AES-NI on modern processors and is cache-timing safe).<br><br>Also, MCRYPT_RIJNDAEL_256 is not AES-256, it's a different variant of the Rijndael block cipher. If you want AES-256 in mcrypt, you have to use MCRYPT_RIJNDAEL_128 with a 32-byte key. OpenSSL makes it more obvious which mode you are using (i.e. 'aes-128-cbc' vs 'aes-256-ctr').<br><br>OpenSSL also uses PKCS7 padding with CBC mode rather than mcrypt's NULL byte padding. Thus, mcrypt is more likely to make your code vulnerable to padding oracle attacks than OpenSSL.<br><br>Finally, if you are not authenticating your ciphertexts (Encrypt Then MAC), you're doing it wrong.<br><br>Further reading:<br><br><a rel="nofollow" target="_blank">https://paragonie.com/blog/2015/05/using-encryption-and-authentication-correctly</a><br><br><a rel="nofollow" target="_blank">https://paragonie.com/blog/2015/05/if-you-re-typing-word-mcrypt-into-your-code-you-re-doing-it-wrong</a></span>
</code></div>
  </div>
 </div>
  <div class="note" id="47973">  
  <a class="name">
  <strong class="user"><em>jesse at pctest dot com</em></strong></a><div class="date" title="2004-12-07 02:43"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom47973">
<div class="phpcode"><code><span class="html">
Solving 3DES incompatibilities with .NET's TripleDESCryptoServiceProvider<br><br>mcrypt's 3DES only accepts 192 bit keys, but Microsoft's .NET and many other tools accept both 128 and 192 bit keys.<br>If your key is too short, mcrypt will 'helpfully' pad null characters onto the end, but .NET refuses to use a key where the last third is all null (this is a Bad Key). This prevents you from emulating mcrypt's "short key" behaviour in .NET.<br><br>How to reconcile this? A little DES theory is in order<br>3DES runs the DES algorithm three times, using each third of your 192 bit key as the 64 bit DES key<br><br>Encrypt Key1 -&gt; Decrypt Key2 -&gt; Encrypt Key3<br><br>and both .NET and PHP's mcrypt do this the same way.<br>The problem arises in short key mode on .NET, since 128 bits is only two 64 bit DES keys<br>The algorithm that they use then is:<br><br>Encrypt Key1 -&gt; Decrypt Key2 -&gt; Encrypt Key1<br><br>mcrypt does not have this mode of operation natively.<br>but before you go and start running DES three times yourself, here's a Quick Fix<br><span class="default">&lt;?php<br>$my_key </span><span class="keyword">= </span><span class="string">"12345678abcdefgh"</span><span class="keyword">; </span><span class="comment">// a 128 bit (16 byte) key<br></span><span class="default">$my_key </span><span class="keyword">.= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$my_key</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">8</span><span class="keyword">); </span><span class="comment">// append the first 8 bytes onto the end<br></span><span class="default">$secret </span><span class="keyword">= </span><span class="default">mcrypt_encrypt</span><span class="keyword">(</span><span class="default">MCRYPT_3DES</span><span class="keyword">, </span><span class="default">$my_key</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">MCRYPT_MODE_CBC</span><span class="keyword">, </span><span class="default">$iv</span><span class="keyword">);&nbsp; </span><span class="comment">//CBC is the default mode in .NET<br></span><span class="default">?&gt;<br></span><br>And, like magic, it works.<br><br>There's one more caveat: Data padding<br>mcrypt always pads data will the null character<br>but .NET has two padding modes: "Zeros" and "PKCS7"<br>Zeros is identical to the mcrypt scheme, but PKCS7 is the default.<br>PKCS7 isn't much more complex, though:<br>instead of nulls, it appends the total number of padding bytes (which means, for 3DES, it can be a value from 0x01 to 0x07)<br>if your plaintext is "ABC", it will be padded into:<br>0x41 0x42 0x43 0x05 0x05 0x05 0x05 0x05<br><br>You can remove these from a decrypted string in PHP by counting the number of times that last character appears, and if it matches it's ordinal value, truncating the string by that many characters:<br><span class="default">&lt;?php<br>&nbsp; &nbsp; $block </span><span class="keyword">= </span><span class="default">mcrypt_get_block_size</span><span class="keyword">(</span><span class="string">'tripledes'</span><span class="keyword">, </span><span class="string">'cbc'</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$packing </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">{</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">});<br>&nbsp; &nbsp; if(</span><span class="default">$packing </span><span class="keyword">and (</span><span class="default">$packing </span><span class="keyword">&lt; </span><span class="default">$block</span><span class="keyword">)){<br>&nbsp; &nbsp; &nbsp; for(</span><span class="default">$P </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">; </span><span class="default">$P </span><span class="keyword">&gt;= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">) - </span><span class="default">$packing</span><span class="keyword">; </span><span class="default">$P</span><span class="keyword">--){<br>&nbsp; &nbsp; if(</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">{</span><span class="default">$P</span><span class="keyword">}) != </span><span class="default">$packing</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$packing </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">) - </span><span class="default">$packing</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>And to pad a string that you intend to decrypt with .NET, just add the chr() value of the number of padding bytes:<br><span class="default">&lt;?php<br>&nbsp; &nbsp; $block </span><span class="keyword">= </span><span class="default">mcrypt_get_block_size</span><span class="keyword">(</span><span class="string">'tripledes'</span><span class="keyword">, </span><span class="string">'cbc'</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$len </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$dat</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$padding </span><span class="keyword">= </span><span class="default">$block </span><span class="keyword">- (</span><span class="default">$len </span><span class="keyword">% </span><span class="default">$block</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$dat </span><span class="keyword">.= </span><span class="default">str_repeat</span><span class="keyword">(</span><span class="default">chr</span><span class="keyword">(</span><span class="default">$padding</span><span class="keyword">),</span><span class="default">$padding</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>That's all there is to it.<br>Knowing this, you can encrypt, decrypt, and duplicate exactly any .NET 3DES behaviour in PHP.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="116612">  
  <a class="name">
  <strong class="user"><em>your dot brother dot t at hotmail dot com</em></strong></a><div class="date" title="2015-01-29 11:52"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom116612">
<div class="phpcode"><code><span class="html">
The encryption has no authenticity check. It can be achieved with three methods, described in <a rel="nofollow" target="_blank">http://en.wikipedia.org/wiki/Authenticated_encryption#Approaches_to_Authenticated_Encryption</a><br>Encrypt-then-MAC (EtM), Encrypt-and-MAC (E&amp;M), MAC-then-Encrypt (MtE).<br><br>The following is a suggestion for MtE:<br><br><span class="default">&lt;?php <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">public static function </span><span class="default">getMacAlgoBlockSize</span><span class="keyword">(</span><span class="default">$algorithm </span><span class="keyword">= </span><span class="string">'sha1'</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; switch(</span><span class="default">$algorithm</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">'sha1'</span><span class="keyword">:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">160</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; public static function </span><span class="default">decrypt</span><span class="keyword">(</span><span class="default">$message</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">, </span><span class="default">$mac_algorithm </span><span class="keyword">= </span><span class="string">'sha1'</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$enc_algorithm </span><span class="keyword">= </span><span class="default">MCRYPT_RIJNDAEL_256</span><span class="keyword">, </span><span class="default">$enc_mode </span><span class="keyword">= </span><span class="default">MCRYPT_MODE_CBC</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$message</span><span class="keyword">= </span><span class="default">base64_decode</span><span class="keyword">(</span><span class="default">$message</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$iv_size </span><span class="keyword">= </span><span class="default">mcrypt_get_iv_size</span><span class="keyword">(</span><span class="default">$enc_algorithm</span><span class="keyword">, </span><span class="default">$enc_mode</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$iv_dec </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$message</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$iv_size</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$message</span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$message</span><span class="keyword">, </span><span class="default">$iv_size</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$message</span><span class="keyword">= </span><span class="default">mcrypt_decrypt</span><span class="keyword">(</span><span class="default">$enc_algorithm</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">, </span><span class="default">$message</span><span class="keyword">, </span><span class="default">$enc_mode</span><span class="keyword">, </span><span class="default">$iv_dec</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$mac_block_size </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">(static::</span><span class="default">getMacAlgoBlockSize</span><span class="keyword">(</span><span class="default">$mac_algorithm</span><span class="keyword">)/</span><span class="default">8</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$mac_dec </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$message</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$mac_block_size</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$message</span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$message</span><span class="keyword">, </span><span class="default">$mac_block_size</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$mac </span><span class="keyword">= </span><span class="default">hash_hmac</span><span class="keyword">(</span><span class="default">$mac_algorithm</span><span class="keyword">, </span><span class="default">$message</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$mac_dec </span><span class="keyword">== </span><span class="default">$mac</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$password</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; public static function </span><span class="default">encrypt</span><span class="keyword">(</span><span class="default">$message</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">, </span><span class="default">$mac_algorithm </span><span class="keyword">= </span><span class="string">'sha1'</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$enc_algorithm </span><span class="keyword">= </span><span class="default">MCRYPT_RIJNDAEL_256</span><span class="keyword">, </span><span class="default">$enc_mode </span><span class="keyword">= </span><span class="default">MCRYPT_MODE_CBC</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$mac </span><span class="keyword">= </span><span class="default">hash_hmac</span><span class="keyword">(</span><span class="default">$mac_algorithm</span><span class="keyword">, </span><span class="default">$message</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$mac </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$mac</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">ceil</span><span class="keyword">(static::</span><span class="default">getMacAlgoBlockSize</span><span class="keyword">(</span><span class="default">$mac_algorithm</span><span class="keyword">)/</span><span class="default">8</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$message</span><span class="keyword">= </span><span class="default">$mac </span><span class="keyword">. </span><span class="default">$message</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$iv_size </span><span class="keyword">= </span><span class="default">mcrypt_get_iv_size</span><span class="keyword">(</span><span class="default">$enc_algorithm</span><span class="keyword">, </span><span class="default">$enc_mode</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$iv </span><span class="keyword">= </span><span class="default">mcrypt_create_iv</span><span class="keyword">(</span><span class="default">$iv_size</span><span class="keyword">, </span><span class="default">MCRYPT_RAND</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ciphertext </span><span class="keyword">= </span><span class="default">mcrypt_encrypt</span><span class="keyword">(</span><span class="default">$enc_algorithm</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$message</span><span class="keyword">, </span><span class="default">$enc_mode</span><span class="keyword">, </span><span class="default">$iv</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$iv </span><span class="keyword">. </span><span class="default">$ciphertext</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="110273">  
  <a class="name">
  <strong class="user"><em>Scott.a.Herbert at googlemail.com</em></strong></a><div class="date" title="2012-10-06 09:49"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom110273">
<div class="phpcode"><code><span class="html">
It is always better to use a standard encryption cipher's rather than to "roll your own", firstly the standard cipher has been tested by world class crypto-analysis's where as unless your a world class crypto-analysis (and if you are why are you even thinking of rolling your own?!?) you won't have the skills needed to even test it (for example if you just XOR each character with a key, it may look secure (the text will be different) but if you count the number of times a character is repeated you see whatever the letter "E" encrypts to occurs more often then the encrypted "Z" (assuming English language plain text)<br><br>Secondly, you may think that the hidden nature of your cipher makes it more secure, but the fact is that your cipher is likely *only* secure because it's secret, if someone what able to break-in to your site and steal your code (but not your key) they maybe able break you encrypted data, if someone broke in and found you where using Blowfish (for example) it wouldn't help them.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="103943">  
  <a class="name">
  <strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2011-05-12 07:03"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom103943">
<div class="phpcode"><code><span class="html">
In the other notes there are some misconceptions about crypto and the IV, especially for CBC mode.
<br>
<br>The most important point: Encryption DOES NOT provide any proof of data integrity or authentication WHATSOEVER. If you need to be sure that the data is secret and not tampered with, you need to encrypt THEN use a keyed HMAC.
<br>
<br>For CBC mode, the IV DOES NOT need to be secret. It can be sent along with the plaintext. It needs to be UNIQUE and RANDOM. So that every message is encrypted with a different IV.
<br>
<br>The best way to generate an IV is to use mcrypt_create_iv().
<br>
<br>Keys must be binary, not ASCII. To create a key from a password:
<br>
<br><span class="default">&lt;?php
<br>$password </span><span class="keyword">= </span><span class="string">"MyPassword!1!"</span><span class="keyword">;
<br></span><span class="default">$aes256Key </span><span class="keyword">= </span><span class="default">hash</span><span class="keyword">(</span><span class="string">"SHA256"</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">); </span><span class="comment">//we want a 32 byte binary blob
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="111710">  
  <a class="name">
  <strong class="user"><em>MadMass</em></strong></a><div class="date" title="2013-03-19 09:42"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom111710">
<div class="phpcode"><code><span class="html">
Note that the IV must be the same for mcrypt_encrypt and mcrypt_decrypt, otherwise you will have corrupted data after decryption.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="101889">  
  <a class="name">
  <strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2011-01-16 11:40"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom101889">
<div class="phpcode"><code><span class="html">
I've noticed some people using a-z, A-Z and 0-9 for keys and stating things like "16 characters is a 128-bit key". This isn't true. Using only these characters, you will get at most 6 bits of entropy per chartacter:<br><br>log2(26 + 26 + 10) = 5.954196310386876<br><br>So you're actually only getting 95 bits of entropy in 16 characters, which is 0.0000000117% of the keyspace you would get if you were using the full range.<br><br>In order to get the full entropy from a key using just a-z, A-Z and 0-9 you should multiply your key length by 1.3333 to account for the 2 bits of lost entropy per byte.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="78543">  
  <a class="name">
  <strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2007-10-16 04:15"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom78543">
<div class="phpcode"><code><span class="html">
I should mention that ECB mode ignores the IV, so it is misleading to show an example using both MCRYPT_MODE_ECB and an IV (the example in the manual shows the same thing).&nbsp; Also, it's important to know that ECB is useful for random data, but structured data should use a stronger mode like MCRYPT_MODE_CBC<br><br>Also, rtrim($decryptedtext, "\0") would be a better option to remove NULL padding than my lazy trim()...</span>
</code></div>
  </div>
 </div>
  <div class="note" id="96635">  
  <a class="name">
  <strong class="user"><em>Robin Leffmann</em></strong></a><div class="date" title="2010-03-09 05:58"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom96635">
<div class="phpcode"><code><span class="html">
Contrary to what is implied in the mcrypt_encrypt() manual page, as well as the info given regarding the CBC vs CFB modes, mcrypt_encrypt() works just fine for encrypting binary data as well.<br> <br>A simple example verifies that the decrypted output is binary identical once cut to its original length:<br> <br><span class="default">&lt;?php<br><br></span><span class="comment">// 448-bit key (56 bytes) - the only size that mcrypt/php uses for the Blowfish cipher<br>// (using a smaller key works just fine, as mcrypt appends \0 to reach proper key-size)<br></span><span class="default">$key </span><span class="keyword">= </span><span class="string">'SADFo92jzVnzSj39IUYGvi6eL8v6RvJH8Cytuiouh547vCytdyUFl76R'</span><span class="keyword">;<br><br></span><span class="comment">// Blowfish/CBC uses an 8-byte IV<br></span><span class="default">$iv </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">( </span><span class="default">md5</span><span class="keyword">(</span><span class="default">mt_rand</span><span class="keyword">(),</span><span class="default">true</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">, </span><span class="default">8 </span><span class="keyword">);<br><br></span><span class="comment">// do 50 encrypt/decrypt operations on some random data, and verify integrity with md5()<br></span><span class="keyword">for( </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">50</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++ )<br>{<br>&nbsp; &nbsp; </span><span class="comment">// create a random, binary string of random length<br>&nbsp; &nbsp; </span><span class="default">$size </span><span class="keyword">= </span><span class="default">mt_rand</span><span class="keyword">( </span><span class="default">25000</span><span class="keyword">, </span><span class="default">500000 </span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$c </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br>&nbsp; &nbsp; while( </span><span class="default">$c</span><span class="keyword">++ * </span><span class="default">16 </span><span class="keyword">&lt; </span><span class="default">$size </span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$data </span><span class="keyword">.= </span><span class="default">md5</span><span class="keyword">( </span><span class="default">mt_rand</span><span class="keyword">(), </span><span class="default">true </span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">( </span><span class="default">$data</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$size </span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$cksum </span><span class="keyword">= </span><span class="default">md5</span><span class="keyword">( </span><span class="default">$data </span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="comment">// encrypt using Blowfish/CBC<br>&nbsp; &nbsp; </span><span class="default">$enc </span><span class="keyword">= </span><span class="default">mcrypt_encrypt</span><span class="keyword">( </span><span class="default">MCRYPT_BLOWFISH</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">MCRYPT_MODE_CBC</span><span class="keyword">, </span><span class="default">$iv </span><span class="keyword">);<br><br>&nbsp; &nbsp; echo </span><span class="default">$size </span><span class="keyword">. </span><span class="string">' -&gt; ' </span><span class="keyword">. </span><span class="default">strlen</span><span class="keyword">( </span><span class="default">$enc </span><span class="keyword">) . </span><span class="string">' -&gt; '</span><span class="keyword">;<br><br>&nbsp; &nbsp; </span><span class="comment">// decrypt (using same IV - a must for the CBC mode)<br>&nbsp; &nbsp; </span><span class="default">$dec </span><span class="keyword">= </span><span class="default">mcrypt_decrypt</span><span class="keyword">( </span><span class="default">MCRYPT_BLOWFISH</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">, </span><span class="default">$enc</span><span class="keyword">, </span><span class="default">MCRYPT_MODE_CBC</span><span class="keyword">, </span><span class="default">$iv </span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="comment">// cut the output with substr(), NOT by using rtrim() as is suggested in some of<br>&nbsp; &nbsp; // the mcrypt manual pages - this is binary data, not plaintext<br>&nbsp; &nbsp; </span><span class="keyword">echo ( </span><span class="default">md5</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$dec</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$size</span><span class="keyword">)) == </span><span class="default">$cksum </span><span class="keyword">? </span><span class="string">'ok' </span><span class="keyword">: </span><span class="string">'bad' </span><span class="keyword">) . </span><span class="default">PHP_EOL</span><span class="keyword">;<br>}<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="114141">  
  <a class="name">
  <strong class="user"><em>stefan at katic dot me dot rs</em></strong></a><div class="date" title="2014-01-15 10:53"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom114141">
<div class="phpcode"><code><span class="html">
I was trying (and succeeded) to encrypt and decrypt in JAVA, pass it to php, and do it again,without corrupting data when I noticed something interesting. So, my code goes like this:<br>$data = 'one';<br>$key = '1234567890123456';<br><br>function encrypt($data, $key){<br>&nbsp; &nbsp; return base64_encode(<br>&nbsp; &nbsp; mcrypt_encrypt(<br>&nbsp; &nbsp; &nbsp; &nbsp; MCRYPT_RIJNDAEL_128,<br>&nbsp; &nbsp; &nbsp; &nbsp; $key,<br>&nbsp; &nbsp; &nbsp; &nbsp; $data,<br>&nbsp; &nbsp; &nbsp; &nbsp; MCRYPT_MODE_CBC,<br>&nbsp; &nbsp; &nbsp; &nbsp; "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"<br>&nbsp; &nbsp; )<br>);<br>}<br>function decrypt($data, $key){<br>&nbsp; &nbsp; $decode = base64_decode($data);<br>&nbsp; &nbsp; return mcrypt_decrypt(<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MCRYPT_RIJNDAEL_128,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $key,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $decode,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MCRYPT_MODE_CBC,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; <br>}<br>$encrypted = encrypt($data, $key);<br>$decrypted= decrypt($encrypted, $key);<br><br>//In the beginning, I thought something's wrong, because I did '===' comparison between $decrypted and $data. It didn't work (but later started working, again, dont know why...) So, I dumped both:<br>var_dump($data);<br>var_dump($decrypted);<br>//Results:<br>string(16) "one" <br>string(16) "one" <br>//Clearly, the length of both is 3, not 16. Just wanted to let you know what could happen, and I really don't know if this is a bug... <br>Thanks,<br>S.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="69580">  
  <a class="name">
  <strong class="user"><em>stonecypher at gmail dot com</em></strong></a><div class="date" title="2006-09-11 01:11"><strong>14 years ago</strong></div>
  <div class="text" id="Hcom69580">
<div class="phpcode"><code><span class="html">
Most of the user-written cipher examples here are badly broken, and there are a few cases where the manual says things that are outright incorrect, such as that it's "safe to transmit the initialization vector in plaintext" (this is incorrect: see Ciphers By Ritter, <a rel="nofollow" target="_blank">http://www.ciphersbyritter.com/GLOSSARY.HTM#IV</a> ,&nbsp; for details.)<br><br>mcrypt itself is perfectly safe, but correct and therefore safe usage is inobvious.&nbsp; It is important to use a cryptographic library correctly; a simple usage error, even when it produces results that can be unpacked at the other side, can render a strong algorithm completely useless.<br><br>The initialization vector must be permuted with a recoverable noise source (an arbitrary md5 hash is acceptable, since it's just a fake OTP and its origin contents are wholly unimportant.) <br><br>Passwords should be remade with a salted one-way hash (md5 is again acceptable even though it's been damaged, since the only thing you could recover from a cracked md5 hash is the source data to generate the password, which is useless.) <br><br>It's important to use a sane block mode (OFB is unsafe for almost all algorithms; never use it.&nbsp; Prefer CBC in all cases except where you need to deal with a degraded signal and cannot retransmit.)<br><br>A correct usage example is actually pretty long and needs a lot of explanation, so I developed a safe wrapper library which doesn't constrain usage and which comments itself very heavily.&nbsp; It's appropriate for use or for learning.&nbsp; Please see my blog for details on Stone PHP SafeCrypt:<br><br><a rel="nofollow" target="_blank">http://blog.sc.tri-bit.com/archives/101</a></span>
</code></div>
  </div>
 </div>
  <div class="note" id="122272">  
  <a class="name">
  <strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2018-01-14 09:54"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom122272">
<div class="phpcode"><code><span class="html">
<span class="default">&lt;?php<br></span><span class="comment"># Vernam Cipher (One-time pad)<br></span><span class="default">$k1 </span><span class="keyword">= </span><span class="string">'1.key'</span><span class="keyword">;<br></span><span class="default">$k2 </span><span class="keyword">= </span><span class="string">'2.key'</span><span class="keyword">;<br></span><span class="default">$d </span><span class="keyword">= </span><span class="string">'The quick brown fox jumped over the lazy dog'</span><span class="keyword">;<br></span><span class="default">VernamCipher</span><span class="keyword">::</span><span class="default">createTestKeyFile</span><span class="keyword">(</span><span class="default">$k1</span><span class="keyword">, </span><span class="default">1024</span><span class="keyword">);<br></span><span class="default">copy</span><span class="keyword">(</span><span class="default">$k1</span><span class="keyword">, </span><span class="default">$k2</span><span class="keyword">);<br></span><span class="default">$c1 </span><span class="keyword">= new </span><span class="default">VernamCipher</span><span class="keyword">(</span><span class="default">$k1</span><span class="keyword">);<br></span><span class="default">$eD </span><span class="keyword">= </span><span class="default">$c1</span><span class="keyword">-&gt;</span><span class="default">encryptWithHMAC</span><span class="keyword">(</span><span class="default">$d</span><span class="keyword">);<br>echo </span><span class="string">'Encrypted: '</span><span class="keyword">, </span><span class="default">bin2hex</span><span class="keyword">(</span><span class="default">$eD</span><span class="keyword">);<br></span><span class="default">$c2 </span><span class="keyword">= new </span><span class="default">VernamCipher</span><span class="keyword">(</span><span class="default">$k2</span><span class="keyword">);<br>echo </span><span class="default">PHP_EOL</span><span class="keyword">, </span><span class="string">'Decrypted: '</span><span class="keyword">, </span><span class="default">$c2</span><span class="keyword">-&gt;</span><span class="default">decryptWithHMAC</span><span class="keyword">(</span><span class="default">$eD</span><span class="keyword">);<br><br>class </span><span class="default">VernamCipher<br></span><span class="keyword">{<br>&nbsp; &nbsp; const </span><span class="default">DEFAULT_HMAC_ALGO </span><span class="keyword">= </span><span class="string">'sha3-256'</span><span class="keyword">;<br>&nbsp; &nbsp; const </span><span class="default">DEFAULT_HMAC_KEY_LENGTH </span><span class="keyword">= </span><span class="default">16</span><span class="keyword">;<br>&nbsp; &nbsp; const </span><span class="default">DEFAULT_HMAC_HASH_LENGTH </span><span class="keyword">= </span><span class="default">32</span><span class="keyword">;<br>&nbsp; &nbsp; private </span><span class="default">$keyFilePath</span><span class="keyword">;<br>&nbsp; &nbsp; private </span><span class="default">$keyFileHandler</span><span class="keyword">;<br>&nbsp; &nbsp; private </span><span class="default">$deferredFtruncate </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; private </span><span class="default">$deferredFtruncatePos</span><span class="keyword">;<br>&nbsp; &nbsp; private </span><span class="default">$hmacAlgo </span><span class="keyword">= </span><span class="default">self</span><span class="keyword">::</span><span class="default">DEFAULT_HMAC_ALGO</span><span class="keyword">;<br>&nbsp; &nbsp; private </span><span class="default">$hmacKeyLength </span><span class="keyword">= </span><span class="default">self</span><span class="keyword">::</span><span class="default">DEFAULT_HMAC_KEY_LENGTH</span><span class="keyword">;<br>&nbsp; &nbsp; private </span><span class="default">$hmacHashLength </span><span class="keyword">= </span><span class="default">self</span><span class="keyword">::</span><span class="default">DEFAULT_HMAC_HASH_LENGTH</span><span class="keyword">;<br><br>&nbsp; &nbsp; function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">string $keyFilePath</span><span class="keyword">, </span><span class="default">string $hmacAlgo </span><span class="keyword">= </span><span class="default">self</span><span class="keyword">::</span><span class="default">DEFAULT_HMAC_ALGO</span><span class="keyword">, </span><span class="default">int $hmacKeyLength </span><span class="keyword">= </span><span class="default">self</span><span class="keyword">::</span><span class="default">DEFAULT_HMAC_KEY_LENGTH</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">keyFilePath </span><span class="keyword">= </span><span class="default">$keyFilePath</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">openKeyFile</span><span class="keyword">();<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$hmacAlgo </span><span class="keyword">!== </span><span class="default">self</span><span class="keyword">::</span><span class="default">DEFAULT_HMAC_ALGO</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$hmacAlgo</span><span class="keyword">, </span><span class="default">hash_algos</span><span class="keyword">())) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">hmacAlgo </span><span class="keyword">= </span><span class="default">$hmacAlgo</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">hmacHashLength </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">hash</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">hmacAlgo</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">hmacAlgo </span><span class="keyword">= </span><span class="default">self</span><span class="keyword">::</span><span class="default">DEFAULT_HMAC_ALGO</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">hmacHashLength </span><span class="keyword">= </span><span class="default">self</span><span class="keyword">::</span><span class="default">DEFAULT_HMAC_HASH_LENGTH</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$hmacKeyLength </span><span class="keyword">!== </span><span class="default">self</span><span class="keyword">::</span><span class="default">DEFAULT_HMAC_KEY_LENGTH</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">hmacKeyLength </span><span class="keyword">= </span><span class="default">$hmacKeyLength</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; public function </span><span class="default">encryptWithHMAC</span><span class="keyword">(</span><span class="default">string $data</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$hmacKey </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">getBytes</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">hmacKeyLength</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$encData </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">encrypt</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dataHmac </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">hashHmac</span><span class="keyword">(</span><span class="default">$encData</span><span class="keyword">, </span><span class="default">$hmacKey</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$dataHmac</span><span class="keyword">.</span><span class="default">$encData</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; public function </span><span class="default">decryptWithHMAC</span><span class="keyword">(</span><span class="default">string $data</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dataLength </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$dataLength </span><span class="keyword">&lt; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">hmacHashLength</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">'data length '</span><span class="keyword">.</span><span class="default">$dataLength</span><span class="keyword">.</span><span class="string">' &lt; hmac length '</span><span class="keyword">. </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">hmacHashLength</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dataHmacRemote </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">hmacHashLength</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dataOnly </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">hmacHashLength</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$hmacKey </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">getBytes</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">hmacKeyLength</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dataHmacLocal </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">hashHmac</span><span class="keyword">(</span><span class="default">$dataOnly</span><span class="keyword">, </span><span class="default">$hmacKey</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">hash_equals</span><span class="keyword">(</span><span class="default">$dataHmacLocal</span><span class="keyword">, </span><span class="default">$dataHmacRemote</span><span class="keyword">) === </span><span class="default">false</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">'Hashes not equals, remote: '</span><span class="keyword">.</span><span class="default">bin2hex</span><span class="keyword">(</span><span class="default">$dataHmacRemote</span><span class="keyword">).</span><span class="string">' local:'</span><span class="keyword">. </span><span class="default">bin2hex</span><span class="keyword">(</span><span class="default">$dataHmacLocal</span><span class="keyword">));<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">deferredFtruncate</span><span class="keyword">();<br><br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">encrypt</span><span class="keyword">(</span><span class="default">$dataOnly</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; public function </span><span class="default">encrypt</span><span class="keyword">(</span><span class="default">string $data</span><span class="keyword">) : </span><span class="default">string<br>&nbsp; &nbsp; </span><span class="keyword">{<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dataLength </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$bytes </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">getBytes</span><span class="keyword">(</span><span class="default">$dataLength</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$dataLength</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">++)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$data</span><span class="keyword">{</span><span class="default">$i</span><span class="keyword">} = </span><span class="default">$data</span><span class="keyword">{</span><span class="default">$i</span><span class="keyword">} ^ </span><span class="default">$bytes</span><span class="keyword">{</span><span class="default">$i</span><span class="keyword">};<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$data</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; public function </span><span class="default">decrypt</span><span class="keyword">(</span><span class="default">string $data</span><span class="keyword">) : </span><span class="default">string<br>&nbsp; &nbsp; </span><span class="keyword">{<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">encrypt</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; private function </span><span class="default">hashHmac</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">hash_hmac</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">hmacAlgo</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; </span><span class="comment"># Don't use in production. You must use true random number generator.<br>&nbsp; &nbsp; </span><span class="keyword">public static function </span><span class="default">createTestKeyFile</span><span class="keyword">(</span><span class="default">string $filePath</span><span class="keyword">, </span><span class="default">int $size</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">file_put_contents</span><span class="keyword">(</span><span class="default">$filePath</span><span class="keyword">, </span><span class="default">random_bytes</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">));<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; private function </span><span class="default">deferredFtruncate</span><span class="keyword">()<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; if(!</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">deferredFtruncate</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return;<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">ftruncate</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">keyFileHandler</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">deferredFtruncatePos</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">deferredFtruncate </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; public function </span><span class="default">getBytes</span><span class="keyword">(</span><span class="default">int $length</span><span class="keyword">, </span><span class="default">$truncateNow </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">) : </span><span class="default">string<br>&nbsp; &nbsp; </span><span class="keyword">{<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">keyFileHandler</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">SEEK_END</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$currentPos </span><span class="keyword">= </span><span class="default">ftell</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">keyFileHandler</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$currentPos </span><span class="keyword">&lt; </span><span class="default">$length</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">'Not enough key materials, key size: '</span><span class="keyword">. </span><span class="default">$currentPos</span><span class="keyword">. </span><span class="string">' needed: '</span><span class="keyword">.</span><span class="default">$length</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">keyFileHandler</span><span class="keyword">, -</span><span class="default">$length</span><span class="keyword">, </span><span class="default">SEEK_END</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$bytes </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">keyFileHandler</span><span class="keyword">, </span><span class="default">$length</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$truncateNow</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">ftruncate</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">keyFileHandler</span><span class="keyword">, </span><span class="default">$currentPos </span><span class="keyword">- </span><span class="default">$length</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">deferredFtruncate </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">deferredFtruncatePos </span><span class="keyword">= </span><span class="default">$currentPos </span><span class="keyword">- </span><span class="default">$length</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$bytes</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; private function </span><span class="default">openKeyFile</span><span class="keyword">()<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">keyFileHandler</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; if((</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">keyFileHandler </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">keyFilePath</span><span class="keyword">, </span><span class="string">'rb+'</span><span class="keyword">)) === </span><span class="default">false</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">'Cant open key file: '</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">keyFilePath</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; if(!</span><span class="default">flock</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">keyFileHandler</span><span class="keyword">, </span><span class="default">LOCK_EX </span><span class="keyword">| </span><span class="default">LOCK_NB</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">'Cant lock key file: '</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">keyFilePath</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="119395">  
  <a class="name">
  <strong class="user"><em>leilond at hotmail dot com</em></strong></a><div class="date" title="2016-05-27 03:40"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom119395">
<div class="phpcode"><code><span class="html">
I always use this method to prevent a lot of errors<br><br>function encrypt( $string ) {<br>&nbsp; $algorithm = 'rijndael-128'; // You can use any of the available<br>&nbsp; $key = md5( "mypassword", true); // bynary raw 16 byte dimension.<br>&nbsp; $iv_length = mcrypt_get_iv_size( $algorithm, MCRYPT_MODE_CBC );<br>&nbsp; $iv = mcrypt_create_iv( $iv_length, MCRYPT_RAND );<br>&nbsp; $encrypted = mcrypt_encrypt( $algorithm, $key, $string, MCRYPT_MODE_CBC, $iv );<br>&nbsp; $result = base64_encode( $iv . $encrypted );<br>&nbsp; return $result;<br>}<br>function decrypt( $string ) {<br>&nbsp; $algorithm =&nbsp; 'rijndael-128';<br>&nbsp; $key = md5( "mypassword", true );<br>&nbsp; $iv_length = mcrypt_get_iv_size( $algorithm, MCRYPT_MODE_CBC );<br>&nbsp; $string = base64_decode( $string );<br>&nbsp; $iv = substr( $string, 0, $iv_length );<br>&nbsp; $encrypted = substr( $string, $iv_length );<br>&nbsp; $result = mcrypt_decrypt( $algoritmo, $key, $encrypted, MCRYPT_MODE_CBC, $iv );<br>&nbsp; return $result;<br>}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="115930">  
  <a class="name">
  <strong class="user"><em>gm dot outside+php at gmail dot com</em></strong></a><div class="date" title="2014-10-15 04:52"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom115930">
<div class="phpcode"><code><span class="html">
Please note that the following part of the documentation is no longer true (after commit: <a rel="nofollow" target="_blank">http://git.php.net/?p=php-src.git;a=commit;h=a861a3a93d89a50ce58e1ab1abef1eb501f97483</a>):<br><br>&gt; key<br>&gt; The key with which the data will be encrypted. If it's smaller than the required keysize, it is padded with '\0'. It is better not to use ASCII strings for keys.<br><br>That commit changed the behaviour to be strict and if the keysize is smaller than the required size a warning will be issued as follows:<br><br>Warning: mcrypt_encrypt(): Key of size 10 not supported by this algorithm. Only keys of size 16 supported in script.php on line 5<br><br>and the mcrypt_encode() will return failure.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="116058">  
  <a class="name">
  <strong class="user"><em>telefoontoestel59 at hotmail dot com</em></strong></a><div class="date" title="2014-11-04 01:19"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom116058">
<div class="phpcode"><code><span class="html">
I tried to implement the mcrypt with rijndael-128. For reference I took the code from example #1 and tried running that first, but on the decryption part came back with the error: "The IV parameter must be as long as the blocksize". After a while i figured out that the generated IV string will not have the same length every run, and is almost never the size of the result of mcrypt_get_iv_size. To work around that, before merging the IV and the encrypted text, I added null padding to match the IV size. When retrieving the IV, I then could use the IV size and rtrim null padding to get the matching IV back.<br><br>The altered parts from example #1<br><br><span class="default">&lt;?php<br>&nbsp; &nbsp; </span><span class="comment"># --- ENCRYPTION ---<br>&nbsp; &nbsp; </span><span class="default">$iv_size </span><span class="keyword">= </span><span class="default">mcrypt_get_iv_size</span><span class="keyword">(</span><span class="default">MCRYPT_RIJNDAEL_128</span><span class="keyword">, </span><span class="default">MCRYPT_MODE_CBC</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$iv </span><span class="keyword">= </span><span class="default">mcrypt_create_iv</span><span class="keyword">(</span><span class="default">$iv_size</span><span class="keyword">, </span><span class="default">MCRYPT_RAND</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="default">$ciphertext </span><span class="keyword">= </span><span class="default">mcrypt_encrypt</span><span class="keyword">(</span><span class="default">MCRYPT_RIJNDAEL_128</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$plaintext</span><span class="keyword">, </span><span class="default">MCRYPT_MODE_CBC</span><span class="keyword">, </span><span class="default">$iv</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="comment"># Add null padding to match the espected size<br>&nbsp; &nbsp; </span><span class="keyword">while(</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$iv</span><span class="keyword">) &lt; </span><span class="default">$iv_size</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$iv </span><span class="keyword">.= </span><span class="string">"\0"</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment"># prepend the IV for it to be available for decryption<br>&nbsp; &nbsp; </span><span class="default">$ciphertext </span><span class="keyword">= </span><span class="default">$iv </span><span class="keyword">. </span><span class="default">$ciphertext</span><span class="keyword">;<br></span><span class="default">?&gt;<br></span><br><span class="default">&lt;?php<br>&nbsp; &nbsp; </span><span class="comment"># --- DECRYPTION ---<br>&nbsp; &nbsp; </span><span class="default">mcrypt_get_iv_size</span><span class="keyword">()<br>&nbsp; &nbsp; </span><span class="default">$iv_dec </span><span class="keyword">= </span><span class="default">rtrim</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$ciphertext_dec</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$iv_size</span><span class="keyword">));<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="68368">  
  <a class="name">
  <strong class="user"><em>ale_ferrer at yahoo dot com</em></strong></a><div class="date" title="2006-07-24 02:35"><strong>15 years ago</strong></div>
  <div class="text" id="Hcom68368">
<div class="phpcode"><code><span class="html">
Mcript - Dot NET - 3DES problem.<br><br>This is a solution for the 3DES algorithm's problem in his interaction with .NET TripleDESCryptoServiceProvider (System.Security.Cryptography), CBC mode,&nbsp; because the key is completed to 192bits and the text is padded.<br><br>So, we has two problems:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - The key's completion&nbsp; was posted by "jesse at pctest dot com".<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - The text padding also posted by him, but the completion is a little different. The padding bytes are 0x01 to 0x08 because completed to 8 bytes blocks. If your text have a whole number of 8 bytes blocks, the algorithm add other block with padded bytes (0x08).<br><br>This is a function to encrypt a text in a equal form that the Dot NET algorithm:<br><br><span class="default">&lt;?PHP<br></span><span class="keyword">function </span><span class="default">encryptNET3DES</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$vector</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">){<br>&nbsp; &nbsp; </span><span class="default">$td </span><span class="keyword">= </span><span class="default">mcrypt_module_open </span><span class="keyword">(</span><span class="default">MCRYPT_3DES</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">MCRYPT_MODE_CBC</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="comment">// Complete the key<br>&nbsp; &nbsp; </span><span class="default">$key_add </span><span class="keyword">= </span><span class="default">24</span><span class="keyword">-</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$key </span><span class="keyword">.= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$key_add</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="comment">// Padding the text<br>&nbsp; &nbsp; </span><span class="default">$text_add </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">)%</span><span class="default">8</span><span class="keyword">;<br>&nbsp; &nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">$text_add</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">8</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++){<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$text </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">8</span><span class="keyword">-</span><span class="default">$text_add</span><span class="keyword">);<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; </span><span class="default">mcrypt_generic_init </span><span class="keyword">(</span><span class="default">$td</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">, </span><span class="default">$vector</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$encrypt64 </span><span class="keyword">= </span><span class="default">mcrypt_generic </span><span class="keyword">(</span><span class="default">$td</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">mcrypt_generic_deinit</span><span class="keyword">(</span><span class="default">$td</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">mcrypt_module_close</span><span class="keyword">(</span><span class="default">$td</span><span class="keyword">);<br><br>&nbsp; &nbsp;&nbsp; </span><span class="comment">// Return the encrypt text in 64 bits code<br>&nbsp; &nbsp; </span><span class="keyword">return </span><span class="default">$encrypt64</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->

  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from www.php.net/manual/en/function.mcrypt-encrypt.php by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 11 Sep 2021 07:18:58 GMT -->

</body></html>