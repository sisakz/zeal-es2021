<html><!-- Mirrored from www.php.net/manual/en/function.mysql-query.php by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 11 Sep 2021 06:25:22 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>mysql_query</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.mysql-query.html">
 <link rel="shorturl" href="https://www.php.net/mysql-query">
 <link rel="alternate" href="https://www.php.net/mysql-query" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.mysql.html">
 <link rel="prev" href="function.mysql-ping.html">
 <link rel="next" href="function.mysql-real-escape-string.html">

 <link rel="alternate" href="function.mysql-query.html" hreflang="en">
 <link rel="alternate" href="https://www.php.net/manual/pt_BR/function.mysql-query.php" hreflang="pt_BR">
 <link rel="alternate" href="https://www.php.net/manual/zh/function.mysql-query.php" hreflang="zh">
 <link rel="alternate" href="https://www.php.net/manual/fr/function.mysql-query.php" hreflang="fr">
 <link rel="alternate" href="https://www.php.net/manual/de/function.mysql-query.php" hreflang="de">
 <link rel="alternate" href="https://www.php.net/manual/ja/function.mysql-query.php" hreflang="ja">
 <link rel="alternate" href="https://www.php.net/manual/ro/function.mysql-query.php" hreflang="ro">
 <link rel="alternate" href="https://www.php.net/manual/ru/function.mysql-query.php" hreflang="ru">
 <link rel="alternate" href="https://www.php.net/manual/es/function.mysql-query.php" hreflang="es">
 <link rel="alternate" href="https://www.php.net/manual/tr/function.mysql-query.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached0aba.css?t=1539771603&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached2ecf.css?t=1539765004&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedba57.css?t=1606338002&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached3afa.css?t=1627831203&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="https://www.php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script>
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="https://www.php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script src="https://www.php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>


</head>
<body class="docs " style="">


<div class="headsup"><a href="https://www.php.net/conferences/index.php#id2021-09-08-1">Longhorn PHP 2021</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.errors.html">Errors</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.attributes.html">Attributes</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.sessions.html">Session Security</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
	<dd><a href="refs.ui.html">GUI Extensions</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
    <div id="breadcrumbs-inner">
          
              
          <ul>
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.database.html">Database Extensions</a></li>      <li><a href="refs.database.vendors.html">Vendor Specific Database Extensions</a></li>      <li><a href="set.mysqlinfo.html">MySQL</a></li>      <li><a href="book.mysql.html">MySQL (Original)</a></li>      <li><a href="ref.mysql.html">MySQL Functions</a></li>      </ul>
    </div>
  </div>




<div id="layout" class="clearfix">
  <section id="layout-content">
  <div id="function.mysql-query" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">mysql_query</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">mysql_query</span> â€” <span class="dc-title">Send a MySQL query</span></p>

 </div>

 <div id="function.mysql-query-refsynopsisdiv">
  <div class="warning"><strong class="warning">Warning</strong>
   <p class="para">This extension was deprecated in PHP 5.5.0, and it was removed in PHP 7.0.0.
Instead, the <a href="book.mysqli.html" class="link">MySQLi</a> or <a href="ref.pdo-mysql.html" class="link">PDO_MySQL</a> extension should be used.
See also <a href="mysqlinfo.api.choosing.html" class="link">MySQL: choosing an API</a> guide.
Alternatives to this function include:</p>
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="mysqli.query.html" class="function">mysqli_query()</a></span></li>
    <li class="member"><span class="methodname"><a href="pdo.query.html" class="methodname">PDO::query()</a></span></li>
   </ul>
  </div>
 </div>

 <div class="refsect1 description" id="refsect1-function.mysql-query-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>mysql_query</strong></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$query</code></span>, <span class="methodparam"><span class="type">resource</span> <code class="parameter">$link_identifier</code><span class="initializer"> = NULL</span></span>): <span class="type"><a href="language.types.declarations.html#language.types.declarations.mixed" class="type mixed">mixed</a></span></div>

  <p class="para rdfs-comment">
   <span class="function"><strong>mysql_query()</strong></span> sends a unique query (multiple queries
   are not supported) to the currently
   active database on the server that's associated with the
   specified <code class="parameter">link_identifier</code>.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.mysql-query-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>
    
     <dt>
<code class="parameter">query</code></dt>

     <dd>

      <p class="para">
       An SQL query
      </p>
      <p class="para">
       The query string should not end with a semicolon.
       Data inside the query should be <a href="function.mysql-real-escape-string.html" class="link">properly escaped</a>.
      </p>
     </dd>

    
    <dt>
<code class="parameter">
link_identifier</code></dt>
<dd>
<p class="para">The MySQL connection. If the
link identifier is not specified, the last link opened by
<span class="function"><a href="function.mysql-connect.html" class="function">mysql_connect()</a></span> is assumed. If no such link is found, it
will try to create one as if <span class="function"><a href="function.mysql-connect.html" class="function">mysql_connect()</a></span> had been called
with no arguments. If no connection is found or established, an
<strong><code>E_WARNING</code></strong> level error is generated.</p></dd>


   </dl>

  <p></p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.mysql-query-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   For SELECT, SHOW, DESCRIBE, EXPLAIN and other statements returning resultset,
   <span class="function"><strong>mysql_query()</strong></span> 
   returns a <span class="type">resource</span> on success, or <strong><code>false</code></strong> on
   error.
  </p>
  <p class="para">
   For other type of SQL statements, INSERT, UPDATE, DELETE, DROP, etc,
   <span class="function"><strong>mysql_query()</strong></span> returns <strong><code>true</code></strong> on success
   or <strong><code>false</code></strong> on error.
  </p>
  <p class="para">
   The returned result resource should be passed to
   <span class="function"><a href="function.mysql-fetch-array.html" class="function">mysql_fetch_array()</a></span>, and other
   functions for dealing with result tables, to access the returned data.
  </p>
  <p class="para">
   Use <span class="function"><a href="function.mysql-num-rows.html" class="function">mysql_num_rows()</a></span> to find out how many rows
   were returned for a SELECT statement or
   <span class="function"><a href="function.mysql-affected-rows.html" class="function">mysql_affected_rows()</a></span> to find out how many
   rows were affected by a DELETE, INSERT, REPLACE, or UPDATE
   statement.
  </p>
  <p class="para">
   <span class="function"><strong>mysql_query()</strong></span> will also fail and return <strong><code>false</code></strong>
   if the user does not have permission to access the table(s) referenced by
   the query.
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.mysql-query-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   </p><div class="example" id="example-1710">
    <p><strong>Example #1 Invalid Query</strong></p>
    <div class="example-contents"><p>
     The following query is syntactically invalid, so
     <span class="function"><strong>mysql_query()</strong></span> fails and returns <strong><code>false</code></strong>.
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br>$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysql_query</span><span style="color: #007700">(</span><span style="color: #DD0000">'SELECT&nbsp;*&nbsp;WHERE&nbsp;1=1'</span><span style="color: #007700">);<br>if&nbsp;(!</span><span style="color: #0000BB">$result</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #DD0000">'Invalid&nbsp;query:&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">mysql_error</span><span style="color: #007700">());<br>}<br><br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  <p></p>
  <p class="para">
   </p><div class="example" id="example-1711">
    <p><strong>Example #2 Valid Query</strong></p>
    <div class="example-contents"><p>
     The following query is valid, so <span class="function"><strong>mysql_query()</strong></span>
     returns a <span class="type">resource</span>.
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #FF8000">//&nbsp;This&nbsp;could&nbsp;be&nbsp;supplied&nbsp;by&nbsp;a&nbsp;user,&nbsp;for&nbsp;example<br></span><span style="color: #0000BB">$firstname&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'fred'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$lastname&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'fox'</span><span style="color: #007700">;<br><br></span><span style="color: #FF8000">//&nbsp;Formulate&nbsp;Query<br>//&nbsp;This&nbsp;is&nbsp;the&nbsp;best&nbsp;way&nbsp;to&nbsp;perform&nbsp;an&nbsp;SQL&nbsp;query<br>//&nbsp;For&nbsp;more&nbsp;examples,&nbsp;see&nbsp;mysql_real_escape_string()<br></span><span style="color: #0000BB">$query&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;firstname,&nbsp;lastname,&nbsp;address,&nbsp;age&nbsp;FROM&nbsp;friends&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;firstname='%s'&nbsp;AND&nbsp;lastname='%s'"</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">mysql_real_escape_string</span><span style="color: #007700">(</span><span style="color: #0000BB">$firstname</span><span style="color: #007700">),<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">mysql_real_escape_string</span><span style="color: #007700">(</span><span style="color: #0000BB">$lastname</span><span style="color: #007700">));<br><br></span><span style="color: #FF8000">//&nbsp;Perform&nbsp;Query<br></span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysql_query</span><span style="color: #007700">(</span><span style="color: #0000BB">$query</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">//&nbsp;Check&nbsp;result<br>//&nbsp;This&nbsp;shows&nbsp;the&nbsp;actual&nbsp;query&nbsp;sent&nbsp;to&nbsp;MySQL,&nbsp;and&nbsp;the&nbsp;error.&nbsp;Useful&nbsp;for&nbsp;debugging.<br></span><span style="color: #007700">if&nbsp;(!</span><span style="color: #0000BB">$result</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$message&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'Invalid&nbsp;query:&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">mysql_error</span><span style="color: #007700">()&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$message&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">'Whole&nbsp;query:&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$query</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #0000BB">$message</span><span style="color: #007700">);<br>}<br><br></span><span style="color: #FF8000">//&nbsp;Use&nbsp;result<br>//&nbsp;Attempting&nbsp;to&nbsp;print&nbsp;$result&nbsp;won't&nbsp;allow&nbsp;access&nbsp;to&nbsp;information&nbsp;in&nbsp;the&nbsp;resource<br>//&nbsp;One&nbsp;of&nbsp;the&nbsp;mysql&nbsp;result&nbsp;functions&nbsp;must&nbsp;be&nbsp;used<br>//&nbsp;See&nbsp;also&nbsp;mysql_result(),&nbsp;mysql_fetch_array(),&nbsp;mysql_fetch_row(),&nbsp;etc.<br></span><span style="color: #007700">while&nbsp;(</span><span style="color: #0000BB">$row&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysql_fetch_assoc</span><span style="color: #007700">(</span><span style="color: #0000BB">$result</span><span style="color: #007700">))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'firstname'</span><span style="color: #007700">];<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'lastname'</span><span style="color: #007700">];<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'address'</span><span style="color: #007700">];<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'age'</span><span style="color: #007700">];<br>}<br><br></span><span style="color: #FF8000">//&nbsp;Free&nbsp;the&nbsp;resources&nbsp;associated&nbsp;with&nbsp;the&nbsp;result&nbsp;set<br>//&nbsp;This&nbsp;is&nbsp;done&nbsp;automatically&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;script<br></span><span style="color: #0000BB">mysql_free_result</span><span style="color: #007700">(</span><span style="color: #0000BB">$result</span><span style="color: #007700">);<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  <p></p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.mysql-query-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   </p><ul class="simplelist">
    <li class="member"><span class="function"><a href="function.mysql-connect.html" class="function" rel="rdfs-seeAlso">mysql_connect()</a> - Open a connection to a MySQL Server</span></li>
    <li class="member"><span class="function"><a href="function.mysql-error.html" class="function" rel="rdfs-seeAlso">mysql_error()</a> - Returns the text of the error message from previous MySQL operation</span></li>
    <li class="member"><span class="function"><a href="function.mysql-real-escape-string.html" class="function" rel="rdfs-seeAlso">mysql_real_escape_string()</a> - Escapes special characters in a string for use in an SQL statement</span></li>
    <li class="member"><span class="function"><a href="function.mysql-result.html" class="function" rel="rdfs-seeAlso">mysql_result()</a> - Get result data</span></li>
    <li class="member"><span class="function"><a href="function.mysql-fetch-assoc.html" class="function" rel="rdfs-seeAlso">mysql_fetch_assoc()</a> - Fetch a result row as an associative array</span></li>
    <li class="member"><span class="function"><a href="function.mysql-unbuffered-query.html" class="function" rel="rdfs-seeAlso">mysql_unbuffered_query()</a> - Send an SQL query to MySQL without fetching and buffering the result rows</span></li>
   </ul>
  <p></p>
 </div>


</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="76848">  
  <a class="name">
  <strong class="user"><em>jack dot whoami at gmail dot com</em></strong></a><div class="date" title="2007-08-01 06:13"><strong>14 years ago</strong></div>
  <div class="text" id="Hcom76848">
<div class="phpcode"><code><span class="html">
Simulating an atomic operation for application locks using mysql.<br><br>$link = mysql_connect('localhost', 'user', 'pass');<br>if (!$link) {<br>&nbsp; &nbsp; die('Not connected : ' . mysql_error());<br>}<br><br>// make foo the current db<br>$db_selected = mysql_select_db('foo', $link);<br>if (!$db_selected) {<br>&nbsp; &nbsp; die ('Can\'t use foo : ' . mysql_error());<br>}<br><br>$q = "update `table` set `LOCK`='F' where `ID`='1'";<br>$lock = mysql_affected_rows();<br><br>If we assume<br>&nbsp; &nbsp;&nbsp; NOT LOCKED = "" (empty string)<br>&nbsp; &nbsp;&nbsp; LOCKED = 'F'<br><br>then if the column LOCK had a value other than F (normally should be an empty string) the update statement sets it to F and set the affected rows to 1. Which mean than we got the lock.<br>If affected rows return 0 then the value of that column was already F and somebody else has the lock.<br><br>The secret lies in the following statement taken from the mysql manual:<br>"If you set a column to the value it currently has, MySQL notices this and does not update it."<br><br>Of course all this is possible if the all application processes agree on the locking algorithm.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="76991">  
  <a class="name">
  <strong class="user"><em>halion at gmail dot com</em></strong></a><div class="date" title="2007-08-09 02:53"><strong>14 years ago</strong></div>
  <div class="text" id="Hcom76991">
<div class="phpcode"><code><span class="html">
mysql_query doesnt support multiple queries, a way round this is to use innodb and transactions<br><br>this db class/function will accept an array of arrays of querys, it will auto check every line for affected rows in db, if one is 0 it will rollback and return false, else it will commit and return true, the call to the function is simple and is easy to read etc<br>----------<br><br>class MySQLDB<br>{<br>&nbsp;&nbsp; private $connection;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // The MySQL database connection<br><br>&nbsp;&nbsp; /* Class constructor */<br>&nbsp;&nbsp; function MySQLDB(){<br>&nbsp; &nbsp; &nbsp; /* Make connection to database */<br>&nbsp; &nbsp; &nbsp; $this-&gt;connection = mysql_connect(DB_SERVER, DB_USER, DB_PASS) or die(mysql_error());<br>&nbsp; &nbsp; &nbsp; mysql_select_db(DB_NAME, $this-&gt;connection) or die(mysql_error());<br>&nbsp;&nbsp; }<br><br>&nbsp;&nbsp; /* Transactions functions */<br><br>&nbsp;&nbsp; function begin(){<br>&nbsp; &nbsp; &nbsp; $null = mysql_query("START TRANSACTION", $this-&gt;connection);<br>&nbsp; &nbsp; &nbsp; return mysql_query("BEGIN", $this-&gt;connection);<br>&nbsp;&nbsp; }<br><br>&nbsp;&nbsp; function commit(){<br>&nbsp; &nbsp; &nbsp; return mysql_query("COMMIT", $this-&gt;connection);<br>&nbsp;&nbsp; }<br>&nbsp;&nbsp; <br>&nbsp;&nbsp; function rollback(){<br>&nbsp; &nbsp; &nbsp; return mysql_query("ROLLBACK", $this-&gt;connection);<br>&nbsp;&nbsp; }<br><br>&nbsp;&nbsp; function transaction($q_array){<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $retval = 1;<br><br>&nbsp; &nbsp; &nbsp; $this-&gt;begin();<br><br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach($q_array as $qa){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $result = mysql_query($qa['query'], $this-&gt;connection);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(mysql_affected_rows() == 0){ $retval = 0; }<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br><br>&nbsp; &nbsp; &nbsp; if($retval == 0){<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;rollback();<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false;<br>&nbsp; &nbsp; &nbsp; }else{<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;commit();<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return true;<br>&nbsp; &nbsp; &nbsp; }<br>&nbsp;&nbsp; }<br><br>};<br><br>/* Create database connection object */<br>$database = new MySQLDB;<br><br>// then from anywhere else simply put the transaction queries in an array or arrays like this:<br><br>&nbsp;&nbsp; function function(){<br>&nbsp; &nbsp; &nbsp; global $database;<br><br>&nbsp; &nbsp; &nbsp; $q = array ( <br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array("query" =&gt; "UPDATE table WHERE something = 'something'"),<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array("query" =&gt; "UPDATE table WHERE something_else = 'something_else'"),<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array("query" =&gt; "DELETE FROM table WHERE something_else2 = 'something_else2'"),<br>&nbsp; &nbsp; &nbsp; );<br><br>&nbsp; &nbsp; &nbsp; $database-&gt;transaction($q);<br><br>&nbsp;&nbsp; }</span>
</code></div>
  </div>
 </div>
  <div class="note" id="31381">  
  <a class="name">
  <strong class="user"><em>davidc at edeca dot net</em></strong></a><div class="date" title="2003-04-19 12:30"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom31381">
<div class="phpcode"><code><span class="html">
Regarding the idea for returning all possible values of an enum field, the mySQL manual says that "SHOW COLUMNS FROM table LIKE column" should be used to do this.<br><br>The function below (presumes db connection) will return an array of the possible values of an enum.<br><br>function GetEnumValues($Table,$Column)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; $dbSQL = "SHOW COLUMNS FROM ".$Table." LIKE '".$Column."'";<br>&nbsp; &nbsp; $dbQuery = mysql_query($dbSQL);<br><br>&nbsp; &nbsp; $dbRow = mysql_fetch_assoc($dbQuery);<br>&nbsp; &nbsp; $EnumValues = $dbRow["Type"];<br><br>&nbsp; &nbsp; $EnumValues = substr($EnumValues, 6, strlen($EnumValues)-8); <br>&nbsp; &nbsp; $EnumValues = str_replace("','",",",$EnumValues);<br><br>&nbsp; &nbsp; return explode(",",$EnumValues);<br>&nbsp; &nbsp; }<br><br>Cavaets:<br><br>1) If the LIKE matches more than one column you get the enum from the first, so be careful with the $Column argument<br>2) You can't have ',' as part of one of the enums (I guess mySQL would escape this, but I haven't tried)<br>3) If the field isn't an enum you'll get garbage back!<br><br>This is just a quick example to show how to do it, some tidying up needs to be done (ie checking if the field is actually an enum) before it is perfect.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="122783">  
  <a class="name">
  <strong class="user"><em>fbraz3 at gmail dot com</em></strong></a><div class="date" title="2018-05-30 07:36"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom122783">
<div class="phpcode"><code><span class="html">
This project implements a wrapper to mysql functions in PHP7.0+<br><br><a rel="nofollow" target="_blank">https://github.com/OOPS-ORG-PHP/mysql-extension-wrapper</a><br><br>tested and working fine =)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="2984">  
  <a class="name">
  <strong class="user"><em>nikhil-php at nols dot com</em></strong></a><div class="date" title="2000-01-02 12:38"><strong>21 years ago</strong></div>
  <div class="text" id="Hcom2984">
<div class="phpcode"><code><span class="html">
When trying to INSERT or UPDATE and trying to put a large amount of text or data (blob) into a mysql table you might run into problems.
<br>
<br>In mysql.err you might see:
<br>Packet too large (73904)
<br>
<br>To fix you just have to start up mysql with the option -O max_allowed_packet=maxsize 
<br>
<br>You would just replace maxsize with the max size you want to insert, the default is 65536</span>
</code></div>
  </div>
 </div>
  <div class="note" id="85807">  
  <a class="name">
  <strong class="user"><em>Mr. Tim</em></strong></a><div class="date" title="2008-09-18 11:42"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom85807">
<div class="phpcode"><code><span class="html">
It should be noted that mysql_query can generate an E_WARNING (not documented).&nbsp; The warning that I hit was when the db user did not have permission to execute a UDF. <br><br>Expected behavior would be like an Invalid SQL statement, where there is no E_WARNING generated by mysql_query.<br><br>Warning: mysql_query() [function.mysql-query]: Unable to save result set in filename.php<br><br>The mysql_errno is 1370 and the mysql_error is:<br><br>execute command denied to user 'username'@'%' for routine 'database_name.MyUDF'</span>
</code></div>
  </div>
 </div>
  <div class="note" id="62247">  
  <a class="name"><strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2006-02-22 11:11"><strong>15 years ago</strong></div>
  <div class="text" id="Hcom62247">
<div class="phpcode"><code><span class="html">
If, like me, you come from perl, you may not like having to use sprintf to 'simulate' placeholders that the DBI package from perl provides. I have created the following wrapper function for mysql_query() that allows you to use '?' characters to substitute values in your DB queries. Note that this is not how DBI in perl handles placeholders, but it's pretty similar.<br><br><span class="default">&lt;?php<br>&nbsp; &nbsp; </span><span class="comment">// mysql_query() wrapper. takes two arguments. first<br>&nbsp; &nbsp; // is the query with '?' placeholders in it. second argument<br>&nbsp; &nbsp; // is an array containing the values to substitute in place<br>&nbsp; &nbsp; // of the placeholders (in order, of course).<br>&nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">mysql_prepare </span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">, </span><span class="default">$phs </span><span class="keyword">= array()) {<br>&nbsp; &nbsp; &nbsp; &nbsp; foreach (</span><span class="default">$phs </span><span class="keyword">as </span><span class="default">$ph</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ph </span><span class="keyword">= </span><span class="string">"'" </span><span class="keyword">. </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$ph</span><span class="keyword">) . </span><span class="string">"'"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$query </span><span class="keyword">= </span><span class="default">substr_replace</span><span class="keyword">(<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$query</span><span class="keyword">, </span><span class="default">$ph</span><span class="keyword">, </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">), </span><span class="default">1<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">);<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; </span><span class="comment">// sample usage<br>&nbsp; &nbsp; </span><span class="keyword">list(</span><span class="default">$user</span><span class="keyword">, </span><span class="default">$passwd</span><span class="keyword">) = array(</span><span class="string">'myuser'</span><span class="keyword">, </span><span class="string">'mypass'</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="default">$sth </span><span class="keyword">= </span><span class="default">mysql_prepare</span><span class="keyword">(<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'select userid from users where userid=? and passwd=?'</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; array(</span><span class="default">$user</span><span class="keyword">, </span><span class="default">sha1</span><span class="keyword">(</span><span class="default">$passwd</span><span class="keyword">))<br>&nbsp; &nbsp; );<br>&nbsp; &nbsp; </span><span class="default">$row </span><span class="keyword">= </span><span class="default">mysql_fetch_row</span><span class="keyword">(</span><span class="default">$sth</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="comment">// successfull username &amp; password authentication<br>&nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">$row </span><span class="keyword">!== </span><span class="default">false</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"logging in as '</span><span class="keyword">{</span><span class="default">$row</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]}</span><span class="string">'!\n"</span><span class="keyword">;<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; </span><span class="comment">// oops, wrong userid or passwd<br>&nbsp; &nbsp; </span><span class="keyword">else {<br>&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"Invalid username and password combination.\n"</span><span class="keyword">;<br>&nbsp; &nbsp; }<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="88602">  
  <a class="name">
  <strong class="user"><em>ialsoagree</em></strong></a><div class="date" title="2009-01-30 08:24"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom88602">
<div class="phpcode"><code><span class="html">
When you run a select statement and receive a response, the data types of your response will be a string regardless of the data type of the column.<br><br><span class="default">&lt;?php<br></span><span class="comment">// Query to select an int column<br></span><span class="default">$query </span><span class="keyword">= </span><span class="string">'SELECT user_id FROM users WHERE user_id = 1'</span><span class="keyword">;<br></span><span class="default">$result </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">);<br></span><span class="default">$array </span><span class="keyword">= </span><span class="default">mysql_fetch_assoc</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">);<br><br></span><span class="comment">// Echoes: string<br></span><span class="keyword">echo </span><span class="default">gettype</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">[</span><span class="string">'user_id'</span><span class="keyword">]);<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="101488">  
  <a class="name">
  <strong class="user"><em>ddlshack [at] gmail.dot.com</em></strong></a><div class="date" title="2010-12-20 09:12"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom101488">
<div class="phpcode"><code><span class="html">
Use this to neatly insert data into a mysql table:<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">mysql_insert</span><span class="keyword">(</span><span class="default">$table</span><span class="keyword">, </span><span class="default">$inserts</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="default">$values </span><span class="keyword">= </span><span class="default">array_map</span><span class="keyword">(</span><span class="string">'mysql_real_escape_string'</span><span class="keyword">, </span><span class="default">array_values</span><span class="keyword">(</span><span class="default">$inserts</span><span class="keyword">));<br>&nbsp; &nbsp; </span><span class="default">$keys </span><span class="keyword">= </span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">$inserts</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; return </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="string">'INSERT INTO `'</span><span class="keyword">.</span><span class="default">$table</span><span class="keyword">.</span><span class="string">'` (`'</span><span class="keyword">.</span><span class="default">implode</span><span class="keyword">(</span><span class="string">'`,`'</span><span class="keyword">, </span><span class="default">$keys</span><span class="keyword">).</span><span class="string">'`) VALUES (\''</span><span class="keyword">.</span><span class="default">implode</span><span class="keyword">(</span><span class="string">'\',\''</span><span class="keyword">, </span><span class="default">$values</span><span class="keyword">).</span><span class="string">'\')'</span><span class="keyword">);<br>}<br></span><span class="default">?&gt;<br></span><br>For example:<br><br><span class="default">&lt;?php<br><br>mysql_insert</span><span class="keyword">(</span><span class="string">'cars'</span><span class="keyword">, array(<br>&nbsp; &nbsp; </span><span class="string">'make' </span><span class="keyword">=&gt; </span><span class="string">'Aston Martin'</span><span class="keyword">,<br>&nbsp; &nbsp; </span><span class="string">'model' </span><span class="keyword">=&gt; </span><span class="string">'DB9'</span><span class="keyword">,<br>&nbsp; &nbsp; </span><span class="string">'year' </span><span class="keyword">=&gt; </span><span class="string">'2009'</span><span class="keyword">,<br>));<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="57377">  
  <a class="name">
  <strong class="user"><em>php at arcannon dot com</em></strong></a><div class="date" title="2005-10-01 03:30"><strong>15 years ago</strong></div>
  <div class="text" id="Hcom57377">
<div class="phpcode"><code><span class="html">
I believe there is a typo in celtic at raven-blue dot com version with:<br><br>if (($sql != "") &amp;&amp; (substr($tsl, 0, 2) != "--") &amp;&amp; (substr($tsl, 0, 1) != "#")) {<br><br>I think you really ment: <br><br>if (($tsl != "") &amp;&amp; (substr($tsl, 0, 2) != "--") &amp;&amp; (substr($tsl, 0, 1) != "#")) {<br><br>I changed the $sql to $tsl</span>
</code></div>
  </div>
 </div>
  <div class="note" id="79255">  
  <a class="name">
  <strong class="user"><em>masteracc0 at aol dot com</em></strong></a><div class="date" title="2007-11-17 10:00"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom79255">
<div class="phpcode"><code><span class="html">
Keep in mind when dealing with PHP &amp; MySQL that sending a null-terminated string to a MySQL query can be misleading if you use echo($sql) in PHP because the null terminator may not be visible.<br><br>For example (this assumes connection is already made),<br>$string1 = "mystring\0";<br>$string2 = "mystring";<br><br>$query1 = "SELECT * FROM table WHERE mystring='".$string1."'"<br>$query2 = "SELECT * FROM table WHERE mystring='".$string2."'"<br> <br>$result1 = mysql_query($query1);<br><br>$result2 = mysql_query($query2);<br><br>//$result1 IS NOT EQUAL TO $result2 but will not provide an error<br><br>//but printing these queries to the screen will provide the same result<br>echo($result1);<br>echo($result2);<br><br>Not knowing this could lead to some mind-numbing troubleshooting when dealing with any strings with a null terminator.&nbsp; So now you know! :)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="67943">  
  <a class="name">
  <strong class="user"><em>rob desbois</em></strong></a><div class="date" title="2006-07-07 02:38"><strong>15 years ago</strong></div>
  <div class="text" id="Hcom67943">
<div class="phpcode"><code><span class="html">
Note that the 'source' command used in the mysql client program is *not* a feature of the server but of the client.<br>This means that you cannot do<br>&nbsp;&nbsp; mysql_query('source myfile.sql');<br>You will get a syntax error. Use LOAD DATA INFILE as an alternative.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="70132">  
  <a class="name">
  <strong class="user"><em>veyita_angi at hotmail dot com</em></strong></a><div class="date" title="2006-10-04 09:35"><strong>14 years ago</strong></div>
  <div class="text" id="Hcom70132">
<div class="phpcode"><code><span class="html">
this could be a nice way to print values from 2 tables with a foreign key. i have not yet tested correctly but it should work fine.<br><br>$buscar = mysql_query("SELECT k.*, e.Clasificacion FROM cat_plan_k k, cat_equipo e WHERE Tipo='$tipo' AND k.ID_Eq=a.ID_Eq"); <br>&nbsp; &nbsp; while ($row=mysql_fetch_array($buscar))<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $nombre = "e.Clasificacion"; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $row[$nombre] = $Clasific; echo $row[$nombre].'convertido en '.$Clasific;<br>&nbsp; &nbsp; &nbsp; &nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; mysql_free_result($buscar);</span>
</code></div>
  </div>
 </div>
  <div class="note" id="69365">  
  <a class="name">
  <strong class="user"><em>cc+php at c2se dot com</em></strong></a><div class="date" title="2006-09-02 05:39"><strong>15 years ago</strong></div>
  <div class="text" id="Hcom69365">
<div class="phpcode"><code><span class="html">
Here's a parameterised query function for MySQL similar to pg_query_params, I've been using something similar for a while now and while there is a slight drop in speed, it's far better than making a mistake escaping the parameters of your query and allowing an SQL injection attack on your server.<br><br><span class="default">&lt;?php&nbsp;&nbsp; </span><span class="comment"># Parameterised query implementation for MySQL (similar PostgreSQL's PHP function pg_query_params)<br>&nbsp; &nbsp; &nbsp; &nbsp; # Example: mysql_query_params( "SELECT * FROM my_table WHERE col1=$1 AND col2=$2", array( 42, "It's ok" ) );<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if( !</span><span class="default">function_exists</span><span class="keyword">( </span><span class="string">'mysql_query_params' </span><span class="keyword">) ) {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; function </span><span class="default">mysql_query_params__callback</span><span class="keyword">( </span><span class="default">$at </span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; global </span><span class="default">$mysql_query_params__parameters</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$mysql_query_params__parameters</span><span class="keyword">[ </span><span class="default">$at</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]-</span><span class="default">1 </span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; function </span><span class="default">mysql_query_params</span><span class="keyword">( </span><span class="default">$query</span><span class="keyword">, </span><span class="default">$parameters</span><span class="keyword">=array(), </span><span class="default">$database</span><span class="keyword">=</span><span class="default">false </span><span class="keyword">) {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Escape parameters as required &amp; build parameters for callback function<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">global </span><span class="default">$mysql_query_params__parameters</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach( </span><span class="default">$parameters </span><span class="keyword">as </span><span class="default">$k</span><span class="keyword">=&gt;</span><span class="default">$v </span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$parameters</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">] = ( </span><span class="default">is_int</span><span class="keyword">( </span><span class="default">$v </span><span class="keyword">) ? </span><span class="default">$v </span><span class="keyword">: ( </span><span class="default">NULL</span><span class="keyword">===</span><span class="default">$v </span><span class="keyword">? </span><span class="string">'NULL' </span><span class="keyword">: </span><span class="string">"'"</span><span class="keyword">.</span><span class="default">mysql_real_escape_string</span><span class="keyword">( </span><span class="default">$v </span><span class="keyword">).</span><span class="string">"'" </span><span class="keyword">) );<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$mysql_query_params__parameters </span><span class="keyword">= </span><span class="default">$parameters</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Call using mysql_query<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if( </span><span class="default">false</span><span class="keyword">===</span><span class="default">$database </span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">mysql_query</span><span class="keyword">( </span><span class="default">preg_replace_callback</span><span class="keyword">( </span><span class="string">'/\$([0-9]+)/'</span><span class="keyword">, </span><span class="string">'mysql_query_params__callback'</span><span class="keyword">, </span><span class="default">$query </span><span class="keyword">) );<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else&nbsp; &nbsp; return </span><span class="default">mysql_query</span><span class="keyword">( </span><span class="default">preg_replace_callback</span><span class="keyword">( </span><span class="string">'/\$([0-9]+)/'</span><span class="keyword">, </span><span class="string">'mysql_query_params__callback'</span><span class="keyword">, </span><span class="default">$query </span><span class="keyword">), </span><span class="default">$database </span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="83884">  
  <a class="name">
  <strong class="user"><em>fernandoleal at loytek dot com</em></strong></a><div class="date" title="2008-06-16 03:28"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom83884">
<div class="phpcode"><code><span class="html">
Dunno if is it a bug but when you are working with replications servers and work with multiple databases queries if you don't select the database it will only insert,update,delete into the master and bypass the slave, I think it its because it doesn't insert the sql on the binary log so the work around its to just call mysql_select_db <br>MYSQL : 5.0.51a-log<br>PHP: 5.2.6<br>Example:<br><span class="default">&lt;?php<br></span><span class="comment">#Inserts only to master<br></span><span class="default">$link</span><span class="keyword">=</span><span class="default">mysql_connect</span><span class="keyword">(</span><span class="string">'host'</span><span class="keyword">,</span><span class="string">'user'</span><span class="keyword">,</span><span class="string">'pass'</span><span class="keyword">);<br></span><span class="default">$sql </span><span class="keyword">=</span><span class="string">"INSERT INTO mysql.host (host) VALUES ('localhost');"<br></span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">,</span><span class="default">$link</span><span class="keyword">));<br><br></span><span class="comment">#The Working Way Master - Slave<br></span><span class="default">$link2</span><span class="keyword">=</span><span class="default">mysql_connect</span><span class="keyword">(</span><span class="string">'host'</span><span class="keyword">,</span><span class="string">'user'</span><span class="keyword">,</span><span class="string">'pass'</span><span class="keyword">);<br></span><span class="default">$select_db </span><span class="keyword">= </span><span class="default">mysql_select_db</span><span class="keyword">(</span><span class="string">'mysql'</span><span class="keyword">, </span><span class="default">$link2</span><span class="keyword">);<br></span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">,</span><span class="default">$link2</span><span class="keyword">));&nbsp;&nbsp; <br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="31078">  
  <a class="name"><strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2003-04-09 12:43"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom31078">
<div class="phpcode"><code><span class="html">
Until this function prohibits them, watch out for SQL comments (--) in your input.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="82429">  
  <a class="name">
  <strong class="user"><em>rogier</em></strong></a><div class="date" title="2008-04-10 06:55"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom82429">
<div class="phpcode"><code><span class="html">
For all you programmers out there getting the 'Command out of synch' errors when executing a stored procedure call:<br><br>There are known bugs related to this issue, and the best workaround for avoiding this error seems to be switching to mysqli.<br><br>Still, I needed mysql to also handle these calls correctly.<br>The error is normally related to wrong function call sequences, though the bug report at&nbsp; <a rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=39727</a> shows otherwise.<br><br>For me, after commenting out hundreds of lines and several introspection calls to parse the procedure information (using information_schema and 'SHOW' extensions), I still got the same error.<br>The first result is returned, because I initiated my connection using the MYSQL_MULTI_RESULTS value of 131072 (forget this and you will never get any output, but an error message stating mysql cannot return results in this context)<br><br>After testing with this code (sproc2 simply calls 'SELECT * FROM sometable'), I found the error must be in the mysql library/extension. Somehow, mysql does not handle multiple resultsets correctly, or is at least missing some functionality related to handling multiple results.<br><br><span class="default">&lt;?php<br>&nbsp; &nbsp; </span><span class="comment">//...<br>&nbsp; &nbsp; </span><span class="default">$rs </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="string">'CALL sproc2(500)'</span><span class="keyword">);<br>&nbsp; &nbsp; while ((</span><span class="default">$row</span><span class="keyword">=</span><span class="default">mysql_fetch_assoc</span><span class="keyword">(</span><span class="default">$rs</span><span class="keyword">))!==</span><span class="default">false</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$row</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; </span><span class="default">mysql_free_result</span><span class="keyword">(</span><span class="default">$rs</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="default">$rs </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="string">'CALL sproc2(500)'</span><span class="keyword">);<br>&nbsp; &nbsp; print </span><span class="default">mysql_error</span><span class="keyword">(); </span><span class="comment">//the notorious 'command out of synch' message :(<br>&nbsp; &nbsp; </span><span class="keyword">while ((</span><span class="default">$row</span><span class="keyword">=</span><span class="default">mysql_fetch_assoc</span><span class="keyword">(</span><span class="default">$rs</span><span class="keyword">))!==</span><span class="default">false</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$row</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; </span><span class="default">mysql_free_result</span><span class="keyword">(</span><span class="default">$rs</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>After spending hours debugging my code (the full library is already over the MB), the only solution seemed to be to CLOSE the connection after the first call, and reopening it before the second. <br><br>So if you ever make a uniform database accessing interface and implement stored procedures/prepared statements (or classes for it), this could be a solution if you really wish to enable stored procedures.<br><br>Still, be aware that this is really a serious flaw in your design (and IMHO, the mysql extension)<br><br>Also see the documentation for mysqli on mysqli_query, which seems to be working fine.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="55811">  
  <a class="name">
  <strong class="user"><em>ix at nivelzero dot ro</em></strong></a><div class="date" title="2005-08-14 03:07"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom55811">
<div class="phpcode"><code><span class="html">
here's a script for parsing a *.sql file (tested only on dumps created with phpMyAdmin) which is short and simple (why do people say "here's a short and simple script" and it has a 100 lines?). the script skips comments and allows ; to be present within the querys<br><br><span class="default">&lt;?php<br>&nbsp; </span><span class="keyword">function </span><span class="default">parse_mysql_dump</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">){<br>&nbsp; &nbsp; </span><span class="default">$file_content </span><span class="keyword">= </span><span class="default">file</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$query </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br>&nbsp; &nbsp; foreach(</span><span class="default">$file_content </span><span class="keyword">as </span><span class="default">$sql_line</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; if(</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$sql_line</span><span class="keyword">) != </span><span class="string">"" </span><span class="keyword">&amp;&amp; </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$sql_line</span><span class="keyword">, </span><span class="string">"--"</span><span class="keyword">) === </span><span class="default">false</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$query </span><span class="keyword">.= </span><span class="default">$sql_line</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/;[\040]*\$/"</span><span class="keyword">, </span><span class="default">$sql_line</span><span class="keyword">)){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">)or die(</span><span class="default">mysql_error</span><span class="keyword">());<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$query </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; }<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="91791">  
  <a class="name">
  <strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2009-06-25 08:18"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom91791">
<div class="phpcode"><code><span class="html">
When processing a RENAME TABLE query, PHP apparently always returns false, no matter if the query was successfully processed or not.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="108160">  
  <a class="name">
  <strong class="user"><em>mwwaygoo at hotmail dot com</em></strong></a><div class="date" title="2012-04-03 02:16"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom108160">
<div class="phpcode"><code><span class="html">
I much prefer to use the same syntax for single INSERT, REPLACE and UPDATE queries as it is easier to read and keeps my code shorter (no seperate building of insert and update values)<br><br>INSERT INTO table SET x='1', y=3<br>UPDATE table SET x='2' WHERE y=3<br><br>So if your using a function to build your query, you will only ever need to code the "field=value, field2=value2" part for any query.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="49375">  
  <a class="name">
  <strong class="user"><em>jon at websandbox dot net</em></strong></a><div class="date" title="2005-01-25 05:25"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom49375">
<div class="phpcode"><code><span class="html">
I think it's important to note (for newbies, like me especially) that an empty result is not the same as an error:<br><span class="default">&lt;?php<br></span><span class="comment">/* 'bar' is an empty table in the db */<br></span><span class="default">$rs </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="string">"SELECT `foo` FROM `bar`"</span><span class="keyword">)<br>if(</span><span class="default">$rs</span><span class="keyword">) {<br>&nbsp; echo </span><span class="default">mysql_num_rows</span><span class="keyword">(</span><span class="default">$rs</span><span class="keyword">); </span><span class="comment">//outputs: 0<br></span><span class="keyword">}<br><br></span><span class="comment">/* malformed query /*<br>$rs = mysql_query("SELECT `foo` FRO `bar`");<br>if($rs) {<br>&nbsp; echo "This will never be echoed";<br>}<br>?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="30783">  
  <a class="name">
  <strong class="user"><em>allen a brooker gb net</em></strong></a><div class="date" title="2003-03-28 05:35"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom30783">
<div class="phpcode"><code><span class="html">
One way to reduce the dangers of queries like the dlete command above that dletes the whole DB is to use limits wherever possible. <br><br>EG. If you have a routine that is only deisnged to delete 1 record, add 'LIMIT 1' to the end of the command. This way you'll only lose one record if someone does something stupid.<br><br>You should also check all input, especially if it is sent using GET. ie. make sure that $_GET['id'] is not NULL or == "", is a number that is positive, not 0 (generally, I know this doesn't apply to some table types, but it applies to the default) and is within the valid range for that field.<br><br>Just don't trust ANY data that is sent to your script.<br><br>HTH<br>Allen</span>
</code></div>
  </div>
 </div>
  <div class="note" id="37870">  
  <a class="name">
  <strong class="user"><em>Predrag Supurovic</em></strong></a><div class="date" title="2003-11-30 04:52"><strong>17 years ago</strong></div>
  <div class="text" id="Hcom37870">
<div class="phpcode"><code><span class="html">
If you need to execute sevaral SQL commands in a row (usually called batcg SQL) using PHP you canot use mysql_query() since it can execute single command only.<br><br>Here is simple but effective function that can run batch SQL commands. Take cere, if string contains semicolon (;) anywhere except as command delimiter (within string expression for example) function will not work.<br><br>function mysql_exec_batch ($p_query, $p_transaction_safe = true) {<br>&nbsp; if ($p_transaction_safe) {<br>&nbsp; &nbsp; &nbsp; $p_query = 'START TRANSACTION;' . $p_query . '; COMMIT;';<br>&nbsp; &nbsp; };<br>&nbsp; $query_split = preg_split ("/[;]+/", $p_query);<br>&nbsp; foreach ($query_split as $command_line) {<br>&nbsp; &nbsp; $command_line = trim($command_line);<br>&nbsp; &nbsp; if ($command_line != '') {<br>&nbsp; &nbsp; &nbsp; $query_result = mysql_query($command_line);<br>&nbsp; &nbsp; &nbsp; if ($query_result == 0) {<br>&nbsp; &nbsp; &nbsp; &nbsp; break;<br>&nbsp; &nbsp; &nbsp; };<br>&nbsp; &nbsp; };<br>&nbsp; };<br>&nbsp; return $query_result;<br>}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="93774">  
  <a class="name">
  <strong class="user"><em>Richie (at) RichieBartlett.com</em></strong></a><div class="date" title="2009-09-28 04:43"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom93774">
<div class="phpcode"><code><span class="html">
For those of you whom spent hours bashing your brains against the keyboard wondering why your non-English characters are output as question marks... Try the following:
<br>
<br><span class="default">&lt;?php
<br>
<br>$db </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">(</span><span class="string">'YOUR_DB_ADDRESS'</span><span class="keyword">,</span><span class="string">'YOUR_DB_USER'</span><span class="keyword">,</span><span class="string">'YOUR_DB_PASS'</span><span class="keyword">) or die(</span><span class="string">"Database error"</span><span class="keyword">);
<br></span><span class="default">mysql_select_db</span><span class="keyword">(</span><span class="string">'YOUR_DB'</span><span class="keyword">, </span><span class="default">$db</span><span class="keyword">);
<br>
<br></span><span class="comment">//SOLUTION::&nbsp; add this comment before your 1st query -- force multiLanuage support
<br></span><span class="default">$result </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="string">"set names 'utf8'"</span><span class="keyword">);
<br>
<br></span><span class="default">$query </span><span class="keyword">= </span><span class="string">"select * from YOUR_DB_TABLE"</span><span class="keyword">;
<br></span><span class="default">$result </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">);
<br>
<br></span><span class="comment">//-THE_REST_IS_UP_TO_YOU-
<br>
<br></span><span class="default">?&gt;
<br></span>
<br>Simply run the query "set names 'utf8' " against the MySQL DB and your output should appear correct.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="31707">  
  <a class="name">
  <strong class="user"><em>chris at hotmail dot com</em></strong></a><div class="date" title="2003-04-30 06:28"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom31707">
<div class="phpcode"><code><span class="html">
Windows programmers, keep in mind that although table names in Windows queries are not case sensitive, many *NIX versions of Mysql require the correct table name case (perhaps others as well). So you're better off using the right case from the beginning, in case you ever decide to go with a *NIX server.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="52427">  
  <a class="name">
  <strong class="user"><em>wjyong at sh163 dot net</em></strong></a><div class="date" title="2005-04-30 04:21"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom52427">
<div class="phpcode"><code><span class="html">
The following query is not valid as expected:<br><span class="default">&lt;?php<br>$username </span><span class="keyword">= </span><span class="string">'dicteworld'</span><span class="keyword">;<br></span><span class="default">$username</span><span class="keyword">{</span><span class="default">4</span><span class="keyword">} = </span><span class="string">''</span><span class="keyword">;<br></span><span class="default">$sql </span><span class="keyword">= </span><span class="string">"SELECT * FROM `user` WHERE `User` = '</span><span class="default">$username</span><span class="string">'"</span><span class="keyword">;<br>print(</span><span class="default">$sql</span><span class="keyword">); </span><span class="comment">// Result: SELECT * FROM `user` WHERE `User` = 'dictworld'<br></span><span class="default">$res </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">);<br></span><span class="default">$row </span><span class="keyword">= </span><span class="default">mysql_fetch_array</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">);<br></span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$row</span><span class="keyword">);</span><span class="comment">// Result: still return Array(), supposed that the user 'dictworld' exists.<br></span><span class="default">?&gt;<br></span>Pay more attention that null string '' is equivalent to '\0',therefore SQL statement above is equivalent to SELECT * FROM `user` WHERE `User` = 'dict\0world',though printing string is right.</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->

  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from www.php.net/manual/en/function.mysql-query.php by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 11 Sep 2021 06:25:22 GMT -->

</body></html>