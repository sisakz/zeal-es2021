<html><!-- Mirrored from www.php.net/manual/en/class.parallel-runtime.php by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 11 Sep 2021 05:25:27 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>parallel\Runtime</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="class.parallel-runtime.html">
 <link rel="shorturl" href="https://www.php.net/parallel-runtime">
 <link rel="alternate" href="https://www.php.net/parallel-runtime" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="book.parallel.html">
 <link rel="prev" href="parallel.run.html">
 <link rel="next" href="parallel-runtime.construct.html">

 <link rel="alternate" href="class.parallel-runtime.html" hreflang="en">
 <link rel="alternate" href="https://www.php.net/manual/pt_BR/class.parallel-runtime.php" hreflang="pt_BR">
 <link rel="alternate" href="https://www.php.net/manual/zh/class.parallel-runtime.php" hreflang="zh">
 <link rel="alternate" href="https://www.php.net/manual/fr/class.parallel-runtime.php" hreflang="fr">
 <link rel="alternate" href="https://www.php.net/manual/de/class.parallel-runtime.php" hreflang="de">
 <link rel="alternate" href="https://www.php.net/manual/ja/class.parallel-runtime.php" hreflang="ja">
 <link rel="alternate" href="https://www.php.net/manual/ro/class.parallel-runtime.php" hreflang="ro">
 <link rel="alternate" href="https://www.php.net/manual/ru/class.parallel-runtime.php" hreflang="ru">
 <link rel="alternate" href="https://www.php.net/manual/es/class.parallel-runtime.php" hreflang="es">
 <link rel="alternate" href="https://www.php.net/manual/tr/class.parallel-runtime.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached0aba.css?t=1539771603&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached2ecf.css?t=1539765004&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedba57.css?t=1606338002&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached3afa.css?t=1627831203&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="https://www.php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script>
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="https://www.php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script src="https://www.php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>


</head>
<body class="docs " style="">


<div class="headsup"><a href="https://www.php.net/conferences/index.php#id2021-09-08-1">Longhorn PHP 2021</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.errors.html">Errors</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.attributes.html">Attributes</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.sessions.html">Session Security</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
	<dd><a href="refs.ui.html">GUI Extensions</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
    <div id="breadcrumbs-inner">
          
              
          <ul>
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.fileprocess.process.html">Process Control Extensions</a></li>      <li><a href="book.parallel.html">parallel</a></li>      </ul>
    </div>
  </div>




<div id="layout" class="clearfix">
  <section id="layout-content">
  <div id="class.parallel-runtime" class="reference">

 <h1 class="title">The parallel\Runtime class</h1>
 

 <div class="partintro"><p class="verinfo">(0.8.0)</p>

  <div class="section">
    <h2 class="title">Runtime Objects</h2>
    <p class="para">
     Each runtime represents a single PHP thread, the thread is created (and bootstrapped) upon construction. 
     The thread then waits for tasks to be scheduled: Scheduled tasks will be executed FIFO and then the thread will resume waiting until 
     more tasks are scheduled, or it's closed, killed, or destroyed by the normal scoping rules of PHP objects.
    </p>
    <div class="warning"><strong class="warning">Warning</strong>
     <p class="para">
      When a runtime is destroyed by the normal scoping rules of PHP objects, it will first execute all of the tasks that were scheduled,
      and block while doing so. 
     </p>
    </div>
  </div>

  <div class="section">
    <h2 class="title">Runtime Bootstrapping</h2>
    <p class="para">
     When a new runtime is created, it does not share code with the thread (or process) that created it. This means it doesn't have the same
     classes and functions loaded, nor the same autoloader set. In some cases, a very lightweight runtime is desirable because the tasks that
     will be scheduled do not need access to the code in the parent thread. In those cases where the tasks do need to access the same code, it
     is enough to set an autoloader as the bootstrap.
    </p>
    <blockquote class="note"><p><strong class="note">Note</strong>: 
     </p><p class="para">
      preloading may be used in conjunction with parallel, in this case preloaded code is available without bootstrapping
     </p>
    <p></p></blockquote>
  </div>

  <div class="section" id="parallel-runtime.synopsis">
   <h2 class="title">Class synopsis</h2>


   <div class="classsynopsis">
    <div class="ooclass"></div>


    <div class="classsynopsisinfo">
     <span class="ooclass">
      <span class="modifier">final</span>
      <span class="modifier">class</span> <strong class="classname">parallel\Runtime</strong>
     </span>
     {</div>


    <div class="classsynopsisinfo classsynopsisinfo_comment">/* Create */</div>
    <div class="constructorsynopsis dc-description">
   <span class="modifier">public</span> <span class="methodname"><a href="parallel-runtime.construct.html" class="methodname">__construct</a></span>()</div>
<div class="constructorsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="parallel-runtime.construct.html" class="methodname">__construct</a></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$bootstrap</code></span>)</div>


    <div class="classsynopsisinfo classsynopsisinfo_comment">/* Execute */</div>
    <div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="parallel-runtime.run.html" class="methodname">run</a></span>(<span class="methodparam"><span class="type"><a href="class.closure.html" class="type Closure">Closure</a></span> <code class="parameter">$task</code></span>): <span class="type"><span class="type">?</span><span class="type"><span class="type Future">Future</span></span></span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="parallel-runtime.run.html" class="methodname">run</a></span>(<span class="methodparam"><span class="type"><a href="class.closure.html" class="type Closure">Closure</a></span> <code class="parameter">$task</code></span>, <span class="methodparam"><span class="type">array</span> <code class="parameter">$argv</code></span>): <span class="type"><span class="type">?</span><span class="type"><span class="type Future">Future</span></span></span></div>


    <div class="classsynopsisinfo classsynopsisinfo_comment">/* Join */</div>
    <div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="parallel-runtime.close.html" class="methodname">close</a></span>(): <span class="type"><span class="type void">void</span></span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="parallel-runtime.kill.html" class="methodname">kill</a></span>(): <span class="type"><span class="type void">void</span></span></div>

   }</div>


  </div>

 </div>

 






 






 






 







<h2>Table of Contents</h2><ul class="chunklist chunklist_reference"><li><a href="parallel-runtime.construct.html">parallel\Runtime::__construct</a> — Runtime Construction</li><li><a href="parallel-runtime.run.html">parallel\Runtime::run</a> — Execution</li><li><a href="parallel-runtime.close.html">parallel\Runtime::close</a> — Runtime Graceful Join</li><li><a href="parallel-runtime.kill.html">parallel\Runtime::kill</a> — Runtime Join</li></ul>
</div>

<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="124434">  
  <a class="name">
  <strong class="user"><em>Luciano Vettoretti</em></strong></a><div class="date" title="2019-11-25 08:27"><strong>1 year ago</strong></div>
  <div class="text" id="Hcom124434">
<div class="phpcode"><code><span class="html">
basic-multithreading-test.php<br><br><span class="default">&lt;?php<br></span><span class="keyword">use </span><span class="default">parallel</span><span class="keyword">\</span><span class="default">Runtime</span><span class="keyword">;<br>use </span><span class="default">parallel</span><span class="keyword">\</span><span class="default">Channel</span><span class="keyword">;<br><br></span><span class="default">$test </span><span class="keyword">= </span><span class="string">"this var is not accesible in a thread"</span><span class="keyword">;<br><br></span><span class="comment">// this function will be the threads<br></span><span class="default">$thread_function </span><span class="keyword">= function (</span><span class="default">int $id</span><span class="keyword">, </span><span class="default">Channel $ch</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="comment">// delay the first thread to simulate better multithreading<br>&nbsp; &nbsp; // second thread always finishes first<br>&nbsp; &nbsp; </span><span class="default">$sleep </span><span class="keyword">= (</span><span class="default">$id </span><span class="keyword">== </span><span class="default">2</span><span class="keyword">) ? </span><span class="default">1 </span><span class="keyword">: </span><span class="default">2</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">$sleep</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="comment">// print thread id<br>&nbsp; &nbsp; // so it's clear second thread goes first<br>&nbsp; &nbsp; // and also you can make sure multithreading is working<br>&nbsp; &nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="string">"thread </span><span class="default">$id</span><span class="string"> sleep </span><span class="default">$sleep</span><span class="string">"</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="comment">// try to capture globals, but it's not possible<br>&nbsp; &nbsp; </span><span class="keyword">echo </span><span class="string">'$GLOBALS["test"] = '</span><span class="keyword">;<br>&nbsp; &nbsp; @</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$GLOBALS</span><span class="keyword">[</span><span class="string">"test"</span><span class="keyword">]);<br><br>&nbsp; &nbsp; </span><span class="comment">// the only way to share data is between channels<br>&nbsp; &nbsp; </span><span class="default">$ch</span><span class="keyword">-&gt;</span><span class="default">send</span><span class="keyword">(</span><span class="default">$sleep</span><span class="keyword">);<br>};<br><br>try {<br>&nbsp; &nbsp; </span><span class="comment">// each runtime represents a thread<br>&nbsp; &nbsp; </span><span class="default">$r1 </span><span class="keyword">= new </span><span class="default">Runtime</span><span class="keyword">();<br>&nbsp; &nbsp; </span><span class="default">$r2 </span><span class="keyword">= new </span><span class="default">Runtime</span><span class="keyword">();<br><br>&nbsp; &nbsp; </span><span class="comment">// channel where the date will be sharead<br>&nbsp; &nbsp; </span><span class="default">$ch1 </span><span class="keyword">= new </span><span class="default">Channel</span><span class="keyword">();<br><br>&nbsp; &nbsp; </span><span class="comment">// args that will be sent to $thread_function<br>&nbsp; &nbsp; </span><span class="default">$args </span><span class="keyword">= array();<br>&nbsp; &nbsp; </span><span class="default">$args</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] = </span><span class="default">null</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$args</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = </span><span class="default">$ch1</span><span class="keyword">;<br><br>&nbsp; &nbsp; </span><span class="comment">// running thread 1<br>&nbsp; &nbsp; </span><span class="default">$args</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] = </span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$r1</span><span class="keyword">-&gt;</span><span class="default">run</span><span class="keyword">(</span><span class="default">$thread_function</span><span class="keyword">, </span><span class="default">$args</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="comment">// running thread 2<br>&nbsp; &nbsp; </span><span class="default">$args</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] = </span><span class="default">2</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$r2</span><span class="keyword">-&gt;</span><span class="default">run</span><span class="keyword">(</span><span class="default">$thread_function</span><span class="keyword">, </span><span class="default">$args</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="comment">// receive data from channel<br>&nbsp; &nbsp; </span><span class="default">$x </span><span class="keyword">= </span><span class="default">$ch1</span><span class="keyword">-&gt;</span><span class="default">recv</span><span class="keyword">();<br>&nbsp; &nbsp; </span><span class="default">$y </span><span class="keyword">= </span><span class="default">$ch1</span><span class="keyword">-&gt;</span><span class="default">recv</span><span class="keyword">();<br><br>&nbsp; &nbsp; </span><span class="comment">// close channel<br>&nbsp; &nbsp; </span><span class="default">$ch1</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br><br>&nbsp; &nbsp; echo </span><span class="string">"\nData received by the channel: </span><span class="default">$x</span><span class="string"> and </span><span class="default">$y</span><span class="string">"</span><span class="keyword">;<br>} catch (</span><span class="default">Error $err</span><span class="keyword">) {<br>&nbsp; &nbsp; echo </span><span class="string">"\nError:"</span><span class="keyword">, </span><span class="default">$err</span><span class="keyword">-&gt;</span><span class="default">getMessage</span><span class="keyword">();<br>} catch (</span><span class="default">Exception $e</span><span class="keyword">) {<br>&nbsp; &nbsp; echo </span><span class="string">"\nException:"</span><span class="keyword">, </span><span class="default">$e</span><span class="keyword">-&gt;</span><span class="default">getMessage</span><span class="keyword">();<br>}</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="126411">  
  <a class="name">
  <strong class="user"><em>gam6itko</em></strong></a><div class="date" title="2021-09-10 05:54"><strong>11 hours ago</strong></div>
  <div class="text" id="Hcom126411">
<div class="phpcode"><code><span class="html">
<span class="default">&lt;?php<br><br></span><span class="comment">// make sure that is really parallel execution (showcase2).<br>// Then you use echo within task-function there is a real chance that the application will hang.<br>// We should control Futures to avoid this behaviour.<br>// You will get different output on each execution.<br><br></span><span class="keyword">use </span><span class="default">parallel</span><span class="keyword">\{</span><span class="default">Future</span><span class="keyword">, </span><span class="default">Runtime</span><span class="keyword">};<br><br>const </span><span class="default">THREADS_COUNT </span><span class="keyword">= </span><span class="default">10</span><span class="keyword">;<br>const </span><span class="default">THREADS_I_MAX </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">;<br><br></span><span class="comment">// executed within thread<br></span><span class="default">$task </span><span class="keyword">= static function (</span><span class="default">int $i</span><span class="keyword">, </span><span class="default">int $to</span><span class="keyword">): </span><span class="default">void </span><span class="keyword">{<br>&nbsp; &nbsp; echo </span><span class="string">"[enter</span><span class="default">$i</span><span class="string">]"</span><span class="keyword">;<br>&nbsp; &nbsp; for (</span><span class="default">$j </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">$to</span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="default">$i</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; echo </span><span class="string">"[exit</span><span class="default">$i</span><span class="string">]"</span><span class="keyword">;<br>};<br><br></span><span class="comment">// creating a few threads<br></span><span class="default">$runtimeList </span><span class="keyword">= [];<br>for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">THREADS_COUNT</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br>&nbsp; &nbsp; </span><span class="default">$runtimeList</span><span class="keyword">[] = new </span><span class="default">Runtime</span><span class="keyword">();<br>}<br></span><span class="comment">// run all threads<br></span><span class="default">$futureList </span><span class="keyword">= [];<br>foreach (</span><span class="default">$runtimeList </span><span class="keyword">as </span><span class="default">$i </span><span class="keyword">=&gt; </span><span class="default">$runtime</span><span class="keyword">) {<br>&nbsp; &nbsp; echo </span><span class="string">"[run</span><span class="default">$i</span><span class="string">]"</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$futureList</span><span class="keyword">[] = </span><span class="default">$runtime</span><span class="keyword">-&gt;</span><span class="default">run</span><span class="keyword">(</span><span class="default">$task</span><span class="keyword">, [</span><span class="default">$i</span><span class="keyword">, </span><span class="default">THREADS_I_MAX</span><span class="keyword">]);<br>}<br><br></span><span class="comment">// waiting until all threads are done<br>// if you delete code bellow then your script will hang<br></span><span class="keyword">do {<br>&nbsp; &nbsp; </span><span class="default">usleep</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$allDone </span><span class="keyword">= </span><span class="default">array_reduce</span><span class="keyword">(<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$futureList</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; function (</span><span class="default">bool $c</span><span class="keyword">, </span><span class="default">Future $future</span><span class="keyword">): </span><span class="default">bool </span><span class="keyword">{<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$c </span><span class="keyword">&amp;&amp; </span><span class="default">$future</span><span class="keyword">-&gt;</span><span class="default">done</span><span class="keyword">();<br>&nbsp; &nbsp; &nbsp; &nbsp; },<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">true<br>&nbsp; &nbsp; </span><span class="keyword">);<br>} while (</span><span class="default">false </span><span class="keyword">=== </span><span class="default">$allDone</span><span class="keyword">);<br>echo </span><span class="string">"done\n"</span><span class="keyword">;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="126410">  
  <a class="name">
  <strong class="user"><em>gam6itko</em></strong></a><div class="date" title="2021-09-10 04:58"><strong>12 hours ago</strong></div>
  <div class="text" id="Hcom126410">
<div class="phpcode"><code><span class="html">
<span class="default">&lt;?php<br><br></span><span class="comment">// make sure that is really parallel execution<br>// you will get different output on each script run<br><br></span><span class="keyword">use </span><span class="default">parallel</span><span class="keyword">\{</span><span class="default">Channel</span><span class="keyword">, </span><span class="default">Runtime</span><span class="keyword">};<br><br>const </span><span class="default">THREADS_COUNT </span><span class="keyword">= </span><span class="default">5</span><span class="keyword">;<br>const </span><span class="default">THREADS_I_MAX </span><span class="keyword">= </span><span class="default">10</span><span class="keyword">;<br><br></span><span class="default">$ch </span><span class="keyword">= new </span><span class="default">Channel</span><span class="keyword">();<br><br></span><span class="comment">// executed within thread<br></span><span class="default">$task </span><span class="keyword">= static function (</span><span class="default">Channel $ch</span><span class="keyword">, </span><span class="default">int $i</span><span class="keyword">, </span><span class="default">int $to</span><span class="keyword">): </span><span class="default">void </span><span class="keyword">{<br>&nbsp; &nbsp; echo </span><span class="string">"[enter: </span><span class="default">$i</span><span class="string">]\n"</span><span class="keyword">;<br>&nbsp; &nbsp; for (</span><span class="default">$j </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">$to</span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ch</span><span class="keyword">-&gt;</span><span class="default">send</span><span class="keyword">(</span><span class="default">$i</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; echo </span><span class="string">"[exit: </span><span class="default">$i</span><span class="string">]\n"</span><span class="keyword">;<br>};<br><br></span><span class="comment">// creating a few threads<br></span><span class="default">$runtimeList </span><span class="keyword">= [];<br>for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">THREADS_COUNT</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br>&nbsp; &nbsp; </span><span class="default">$runtimeList</span><span class="keyword">[] = new </span><span class="default">Runtime</span><span class="keyword">();<br>}<br></span><span class="comment">// run all threads<br></span><span class="keyword">foreach (</span><span class="default">$runtimeList </span><span class="keyword">as </span><span class="default">$i </span><span class="keyword">=&gt; </span><span class="default">$runtime</span><span class="keyword">) {<br>&nbsp; &nbsp; echo </span><span class="string">"[run: </span><span class="default">$i</span><span class="string">]\n"</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$runtime</span><span class="keyword">-&gt;</span><span class="default">run</span><span class="keyword">(</span><span class="default">$task</span><span class="keyword">, [</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">THREADS_I_MAX</span><span class="keyword">]);<br>}<br><br></span><span class="comment">// reading messages from channel<br></span><span class="default">$queue </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br>for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">THREADS_COUNT </span><span class="keyword">* </span><span class="default">THREADS_I_MAX</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br>&nbsp; &nbsp; </span><span class="default">$queue </span><span class="keyword">.= </span><span class="default">$ch</span><span class="keyword">-&gt;</span><span class="default">recv</span><span class="keyword">();<br>}<br></span><span class="default">$ch</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br><br>echo </span><span class="default">$queue </span><span class="keyword">. </span><span class="default">PHP_EOL</span><span class="keyword">;</span>
</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->

  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from www.php.net/manual/en/class.parallel-runtime.php by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 11 Sep 2021 05:25:27 GMT -->

</body></html>